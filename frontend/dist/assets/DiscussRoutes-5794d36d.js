import{u as I,r as n,j as e,a2 as He,M as We,b as $,ag as xe,m as V,Z as X,B as g,J as ee,d as Be,ab as H,ac as W,F as Je,R as Ge,a4 as Ye,an as je,aa as Ke,D as fe,c as ge,P as pe,H as ve,ah as Ze,K as $e,a3 as me,$ as L,a0 as Xe,ao as es,A as ss,ap as ts,O as ns,Q as q,S as as,U as is,am as rs,V as ls}from"./index-343737ff.js";import{Q as we,T as os,I as cs,W as ds}from"./Question-3088b031.js";import{P as ye}from"./react-bootstrap-pagination-control.esm-60bcad8d.js";import{Q as be}from"./QuestionPlaceholder-ea41bc06.js";import{P as Ne,R as us}from"./ReactionsList-cd4a7652.js";import{M as k}from"./Modal-88de8eda.js";import{P as Se}from"./UserSearch-d02dba13.js";import{a as Pe}from"./discussAllowedUrls-4f3044c5.js";import{M as De}from"./MarkdownRenderer-61fba914.js";import{t as ms}from"./StringUtils-91be14c5.js";import{r as hs}from"./roles-68ed67e6.js";const _=({MainPage:a})=>{const{sendJsonRequest:u}=I(),[j,l]=n.useState([]);n.useEffect(()=>{i()},[]);const i=async()=>{const d=await u("/Discussion","POST",{page:1,count:10,searchQuery:"",filter:5,userId:null});d&&d.questions&&l(d.questions)};return e.jsxs(e.Fragment,{children:[e.jsxs(He,{children:[" ",e.jsx("title",{children:"Q&A Discussions | Webler Codes"})," ",e.jsx("meta",{name:"description",content:"Join Webler’s programming forum to ask questions, share knowledge, and solve real-world coding challenges with a global community of developers."})," "]}),e.jsx("div",{className:"bg-white",children:e.jsx(We,{children:e.jsxs("div",{className:"row pt-2",style:{minHeight:"100vh"},children:[e.jsx("div",{className:"col-12 col-md-8",children:a}),e.jsxs("div",{className:"col-12 col-md-4",children:[e.jsx("h2",{children:"Hot today"}),e.jsx("div",{className:"my-3",children:j.map(d=>e.jsx("div",{className:"mb-2",children:e.jsx(we,{question:d,searchQuery:"",showUserProfile:!1})},d.id))})]})]})})})]})},xs=()=>{const{sendJsonRequest:a}=I(),{userInfo:u}=$(),[j,l]=n.useState([]),i=10,[d,P]=n.useState(1),[h,b]=n.useState(0),[m,f]=n.useState(!1),[F,p]=n.useState(1),[D,v]=n.useState(""),[o,w]=xe();n.useEffect(()=>{Q()},[o]),n.useEffect(()=>{C(1)},[F,D]),n.useEffect(()=>{o.has("page")&&P(Number(o.get("page"))),o.has("filter")&&p(Number(o.get("filter"))),o.has("query")&&v(o.get("query"))},[]);const C=t=>{d!==t&&(o.set("page",t.toString()),w(o,{replace:!0}),P(t))},T=t=>{o.set("query",t),w(o,{replace:!0}),v(t)},Q=async()=>{f(!0);const t=o.has("page")?Number(o.get("page")):1,x=o.has("filter")?Number(o.get("filter")):1,M=o.has("query")?o.get("query"):"",A=await a("/Discussion","POST",{page:t,count:i,filter:x,searchQuery:M,userId:u?u.id:null});A&&A.questions&&(l(A.questions),b(A.count)),f(!1)},N=t=>{const x=Number(t.target.selectedOptions[0].value);o.set("filter",x.toString()),w(o,{replace:!0}),p(x)};let S=[];for(let t=0;t<i;++t)S.push(e.jsx(be,{},t));return e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("h2",{children:"Q&A Discussions"}),e.jsxs("div",{className:"mt-2",children:[e.jsx(V.Label,{htmlFor:"search",className:"visually-hidden",children:"Search"}),e.jsx(os,{id:"search",placeholder:"Search by tags or title...",maxWidthPx:360,query:D,handleSearch:T})]}),e.jsxs("div",{className:"mt-2 d-flex justify-content-between",children:[e.jsx(V.Label,{htmlFor:"filter",className:"visually-hidden",children:"Filter"}),e.jsxs(V.Select,{id:"filter",style:{width:"140px"},size:"sm",value:F,onChange:N,children:[e.jsx("option",{value:"1",children:"Most Recent"}),e.jsx("option",{value:"2",children:"Unanswered"}),e.jsx("option",{value:"6",children:"Trending"}),u&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"3",children:"My Questions"}),e.jsx("option",{value:"4",children:"My Answers"})]})]}),e.jsx(X.LinkContainer,{to:"/Discuss/New",children:e.jsx(g,{size:"sm",children:"Ask a question"})})]}),e.jsx("div",{className:"mt-2",children:m?S:h==0?e.jsx("div",{className:"wb-discuss-empty-questions",children:e.jsx("h3",{children:"Nothing to show"})}):j.map(t=>e.jsx(we,{question:t,searchQuery:D,showUserProfile:!0},t.id))}),e.jsx("div",{className:"my-3",children:e.jsx(ye,{page:d,between:3,total:h,limit:i,changePage:C,ellipsis:1})})]})},Ce=({questionId:a})=>{const{sendJsonRequest:u}=I(),j=ee(),[l,i]=n.useState(""),[d,P]=n.useState(""),[h,b]=n.useState([]),[m,f]=n.useState(!1),[F,p]=n.useState(),[D,v]=n.useState(!1);n.useEffect(()=>{a&&o()},[a]);const o=async()=>{f(!0);const t=await u("/Discussion/GetQuestion","POST",{questionId:a});t&&t.question&&(i(t.question.title),P(t.question.message),b(t.question.tags)),f(!1)},w=async()=>{f(!0),p(void 0),a?await T():await C(),f(!1)},C=async()=>{const t=await u("/Discussion/CreateQuestion","POST",{title:l,message:d,tags:h});t&&t.question?j("/Discuss/"+t.question.id):p(t.error)},T=async()=>{const t=await u("/Discussion/EditQuestion","PUT",{questionId:a,title:l,message:d,tags:h});t&&t.success?j("/Discuss/"+a):p(t.error)},Q=()=>{v(!1)},N=async()=>{f(!0);const t=await u("/Discussion/DeleteQuestion","DELETE",{questionId:a});t&&t.success?(Q(),j("/Discuss?filter=3")):p(t!=null&&t.error?t.error.message:t.message),f(!1)};let S=m||l.trim().length==0||d.trim().length==0;return e.jsxs(e.Fragment,{children:[e.jsxs(k,{show:D,onHide:Q,centered:!0,children:[e.jsx(k.Header,{closeButton:!0,children:e.jsx(k.Title,{children:"Are you sure?"})}),e.jsx(k.Body,{children:"Your question will be permanently deleted."}),e.jsxs(k.Footer,{children:[e.jsx(g,{variant:"secondary",onClick:Q,children:"Cancel"}),e.jsx(g,{variant:"danger",onClick:N,children:"Delete"})]})]}),a===null&&e.jsx("h2",{className:"mb-4",children:"Ask the community a question"}),e.jsxs("div",{className:"small",children:[e.jsx(Be,{errors:F}),e.jsxs(H,{children:[e.jsx(W,{children:"Your question"}),e.jsx(Je,{size:"sm",placeholder:"What would you like to know?",type:"text",required:!0,value:l,onChange:t=>i(t.target.value)}),e.jsx("p",{className:"text-secondary",children:"Tip: write as if asking a friend, being as specific as possible"})]}),e.jsxs(H,{children:[e.jsx(W,{children:"Description"}),e.jsx(Ne,{size:"sm",placeholder:"Include as much detail as possible to get the most relevant answers.",rows:10,maxLength:4096,required:!0,value:d,setValue:P})]}),e.jsxs(H,{children:[e.jsx(W,{children:"Tags"}),e.jsx(cs,{values:h,setValues:b,placeholder:"Add tag..."})]}),e.jsxs("div",{className:"mt-2 d-flex justify-content-end",children:[e.jsx(X.LinkContainer,{to:a?"/Discuss/"+a:"/Discuss",children:e.jsx(g,{size:"sm",type:"button",variant:"secondary",disabled:m,children:"Cancel"})}),a?e.jsxs(e.Fragment,{children:[e.jsx(g,{size:"sm",variant:"secondary",className:"ms-2",type:"button",onClick:()=>v(!0),disabled:m,children:"Delete"}),e.jsx(g,{size:"sm",variant:"primary",className:"ms-2",type:"button",onClick:w,disabled:S,children:"Save changes"})]}):e.jsx(g,{size:"sm",className:"ms-2",variant:"primary",type:"button",onClick:w,disabled:S,children:"Post question"})]})]})]})},he=Ge.forwardRef(({answer:a,acceptedAnswer:u,toggleAcceptedAnswer:j,isQuestionOwner:l,showEditAnswer:i,newlyCreatedAnswer:d,onShowVoters:P},h)=>{const{sendJsonRequest:b}=I(),{userInfo:m}=$(),[f,F]=n.useState(a.isUpvoted),[p,D]=n.useState(a.votes),v=(m==null?void 0:m.id)===a.userId,o=ee(),w=async()=>{if(!m){o("/Users/Login");return}const x=f?0:1;(await b("/Discussion/VotePost","POST",{postId:a.id,vote:x})).vote===x&&(F(x===1),D(p+(x?1:-1)))},C=()=>{P(a.id)};let T=u===a.id,N=d===a.id?"beige":"white",S=e.jsxs("div",{className:"gap-2 d-flex flex-column border-bottom border-2 py-2",style:{background:N},children:[e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("div",{className:"d-flex flex-column align-items-center",children:[(l||T)&&e.jsx("div",{onClick:()=>j(a.id),className:"wb-discuss-reply__actions__best-answer-button"+(T?" text-success":" text-secondary"),style:{cursor:l?"pointer":"default"},children:e.jsx(Ye,{})}),e.jsxs("div",{className:"wb-discuss-voting mt-2",children:[e.jsx("span",{onClick:w,className:"wb-icon-button"+(f?" text-black":""),children:e.jsx(je,{})}),e.jsx("b",{className:"wb-icon-button text-black",onClick:C,children:p})]})]}),e.jsxs("div",{className:"flex-grow-1 d-flex flex-column gap-2",style:{minWidth:0},children:[e.jsx("div",{className:"d-flex justify-content-end align-items-center",children:v&&e.jsx("span",{style:{cursor:"pointer"},onClick:()=>i(a.id),children:e.jsx(Ke,{})})}),e.jsx("div",{className:"wb-discuss-question__description",children:e.jsx(De,{content:a.message,allowedUrls:Pe})}),e.jsx("div",{className:"mt-2",children:a.attachments.map(x=>e.jsx("div",{className:"mt-1",children:e.jsx(Se,{data:x})},x.id))})]})]}),e.jsx("div",{className:"d-flex justify-content-end align-items-end mt-1",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("small",{className:"text-secondary",children:fe.format(new Date(a.date))})}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(ge,{userId:a.userId,userName:a.userName})})]}),e.jsx("div",{className:"ms-2",children:e.jsx(pe,{size:32,avatarImage:a.userAvatar})})]})})]});return h?e.jsx("div",{ref:h,children:S}):e.jsx("div",{children:S})}),js=()=>{const{sendJsonRequest:a}=I(),{questionId:u}=ve(),j=ee(),{userInfo:l}=$(),[i,d]=n.useState(null),[P,h]=n.useState(["",""]),[b,m]=n.useState(!1),[f,F]=n.useState(!1),[p,D]=n.useState(1),v=10,[o,w]=n.useState([]),C=n.useRef(null),[T,Q]=n.useState(!1),[N,S]=n.useState(""),t=4096,[x,M]=n.useState(null),[A,Ae]=n.useState(null),[ke,se]=n.useState(!1),[te,B]=n.useState(1),[y,ne]=xe(),U=Ze(),[E,J]=n.useState(null),G=n.useRef(null),Y=n.useRef(null),[Fe,Qe]=n.useState(""),[Te,K]=n.useState(!1),[Re,ae]=n.useState({parentId:""});$e(Fe),n.useEffect(()=>{i&&Qe(i.title+" | Webler Codes")},[i]),n.useEffect(()=>{U.state&&U.state.postId&&(J(U.state.postId),B(2))},[U]),n.useEffect(()=>{y.has("page")&&D(Number(y.get("page"))),y.has("filter")&&B(Number(y.get("filter")))},[]),n.useEffect(()=>{Le()},[u]),n.useEffect(()=>{qe()},[y,u,E]),n.useEffect(()=>{ie(1)},[te]);const ie=s=>{s!==p&&(J(null),y.set("page",s.toString()),ne(y,{replace:!0}),D(s))},Ee=s=>{const r=Number(s.target.selectedOptions[0].value);y.set("filter",r.toString()),ne(y,{replace:!0}),B(r),J(null)},Le=async()=>{m(!0);const s=await a("/Discussion/GetQuestion","POST",{questionId:u});s&&s.question&&d(s.question),m(!1)},qe=async()=>{F(!0);const s=y.has("page")?Number(y.get("page")):1,r=y.has("filter")?Number(y.get("filter")):1,c=await a("/Discussion/GetQuestionReplies","POST",{questionId:u,index:(s-1)*v,count:v,filter:r,findPostId:E});if(c&&c.posts){w(c.posts),E&&(D(c.posts.length>0?Math.floor(c.posts[0].index/v)+1:1),setTimeout(()=>{G.current&&G.current.scrollIntoView({behavior:"smooth",block:"end"})}));let R=null;for(let z=0;z<c.posts.length;++z)if(c.posts[z].isAccepted){R=c.posts[z].id;break}M(R)}F(!1)},Me=async()=>{if(!l){j("/Users/Login");return}m(!0);const s=await a("/Discussion/CreateReply","POST",{message:N,questionId:u});s&&s.post?(w(r=>[{...s.post,userName:l.name,userAvatar:l.avatarImage},...r]),d(r=>r?{...r,answers:r.answers+1}:null),O(),h(["success","Your answer was posted successfully"])):h(["danger",s!=null&&s.error?s.error.message:s.message]),m(!1)},Ve=async()=>{if(!l){j("/Users/Login");return}m(!0);const s=await a("/Discussion/EditReply","PUT",{message:N,replyId:A});s&&s.success?(w(r=>{const c=[...r];for(let R=0;R<c.length;++R)c[R].id===A&&(c[R].message=s.data.message,c[R].attachments=s.data.attachments);return c}),O(),h(["success","Your answer was updated successfully"])):h(["danger",s!=null&&s.error?s.error.message:s.message]),m(!1)},re=(s,r)=>{l?(h(["",""]),Q(!0),S(s),Ae(r),setTimeout(()=>{C.current&&C.current.scrollIntoView({behavior:"smooth",block:"end"}),Y.current&&Y.current.focus()})):j("/Users/Login")},O=()=>{Q(!1),S("")},le=async s=>{const r=await a("/Discussion/ToggleAcceptedAnswer","POST",{postId:s,accepted:s!==x});r&&r.success&&M(s===x?null:s)},oe=s=>{const r=o.find(c=>c.id==s);r&&re(r.message,s)},Z=()=>{se(!1)},Ie=()=>{K(!1)},Ue=async()=>{m(!0);const s=await a("/Discussion/DeleteReply","DELETE",{replyId:A});s&&s.success?(Z(),O(),w(r=>r.filter(c=>c.id!==A)),d(r=>r?{...r,answers:r.answers-1}:null)):h(["danger",s!=null&&s.error?s.error._message:s.message]),m(!1)},Oe=async()=>{if(!i)return;if(!l){j("/Users/Login");return}const s=i.isUpvoted?0:1;(await a("/Discussion/VotePost","POST",{postId:u,vote:s})).vote===s&&d(c=>c?{...c,votes:c.votes+(s?1:-1),isUpvoted:s===1}:null)},ze=async()=>{if(!i)return;if(!l){j("/Users/Login");return}const s=i.isFollowed,r=await a(s?"/Discussion/UnfollowQuestion":"/Discussion/FollowQuestion","POST",{postId:u});r&&r.success&&d(c=>c?{...c,isFollowed:!s}:null)},_e=()=>{i!=null&&i.id&&(ae({parentId:i.id}),K(!0))},ce=s=>{ae({parentId:s}),K(!0)};let de=t-N.length,ue=[];for(let s=0;s<v;++s)ue.push(e.jsx(be,{},s));return i!==null?e.jsxs(e.Fragment,{children:[e.jsxs(k,{show:ke,onHide:Z,centered:!0,children:[e.jsx(k.Header,{closeButton:!0,children:e.jsx(k.Title,{children:"Are you sure?"})}),e.jsx(k.Body,{children:"Your answer will be permanently deleted."}),e.jsxs(k.Footer,{children:[e.jsx(g,{variant:"secondary",onClick:Z,children:"Cancel"}),e.jsx(g,{variant:"danger",onClick:Ue,children:"Delete"})]})]}),e.jsx(us,{title:"Likes",options:Re,visible:Te,onClose:Ie,showReactions:!0,countPerPage:10}),e.jsxs("div",{className:"d-flex gap-2 py-2",children:[e.jsx(me,{to:"/Discuss",children:"Q&A"}),e.jsx("span",{children:"›"}),e.jsx("span",{children:ms(i.title,20)})]}),e.jsxs("div",{className:"mb-3 d-flex flex-column position-relative",children:[e.jsx("div",{className:"wb-edit-button",children:e.jsxs(L,{drop:"start",children:[e.jsx(L.Toggle,{as:Xe}),e.jsxs(L.Menu,{children:[l&&e.jsxs(e.Fragment,{children:[i&&i.userId===l.id&&e.jsx(X.LinkContainer,{to:"/Discuss/Edit/"+u,children:e.jsx(L.Item,{children:"Edit"})}),e.jsx(L.Item,{onClick:ze,children:i.isFollowed?"Unfollow":"Follow"})]}),e.jsx(L.Item,{onClick:()=>{navigator.clipboard.writeText(window.location.href)},children:"Share"})]})]})}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("div",{className:"d-flex flex-column align-items-center",children:[e.jsxs("div",{className:"wb-discuss-voting",children:[e.jsx("span",{onClick:Oe,className:"wb-icon-button"+(i.isUpvoted?" text-black":""),children:e.jsx(je,{})}),e.jsx("b",{className:"wb-icon-button text-black",onClick:_e,children:i.votes})]}),e.jsx("div",{children:e.jsx("span",{className:i.isFollowed?"text-warning":"text-secondary",children:e.jsx(es,{})})})]}),e.jsxs("div",{className:"flex-grow-1 d-flex flex-column gap-2",style:{minWidth:"0"},children:[e.jsx("h3",{className:"wb-discuss-question__title",children:i.title}),e.jsx("div",{className:"d-flex mb-1 flex-wrap gap-1",children:i.tags.map((s,r)=>e.jsx(ds,{name:s,state:"neutral"},r))}),e.jsx("div",{className:"mt-1 wb-discuss-question__description",children:e.jsx(De,{content:i.message,allowedUrls:Pe})}),e.jsx("div",{className:"mt-1",children:i.attachments.map(s=>e.jsx("div",{className:"mt-1",children:e.jsx(Se,{data:s})},s.id))})]})]}),e.jsxs("div",{className:"d-flex justify-content-end mt-2 align-items-center gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("small",{children:fe.format(new Date(i.date))})}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(ge,{userId:i.userId,userName:i.userName})})]}),e.jsx(pe,{size:32,avatarImage:i.userAvatar})]})]}),P[1]&&e.jsx(ss,{variant:P[0],onClose:()=>h(["",""]),dismissible:!0,children:P[1]}),e.jsx("div",{hidden:!T,className:"mt-2 border bg-white rounded p-2",children:e.jsxs(V,{ref:C,children:[e.jsxs(H,{children:[e.jsx(W,{children:e.jsx("b",{children:l==null?void 0:l.name})}),e.jsx(Ne,{ref:Y,rows:10,placeholder:"Write your reply here...",required:!0,maxLength:t,value:N,setValue:S}),e.jsxs("p",{className:de>0?"text-secondary":"text-danger",children:[de," characters remaining"]})]}),e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx(g,{size:"sm",variant:"secondary",onClick:O,disabled:b,children:"Cancel"}),A===null?e.jsx(e.Fragment,{children:e.jsx(g,{size:"sm",variant:"primary",className:"ms-2",onClick:Me,disabled:b||N.length===0,children:"Post"})}):e.jsxs(e.Fragment,{children:[e.jsx(g,{size:"sm",variant:"secondary",className:"ms-2",onClick:()=>se(!0),disabled:b,children:"Delete"}),e.jsx(g,{size:"sm",variant:"primary",className:"ms-2",onClick:Ve,disabled:b||N.length===0,children:"Save"})]})]})]})}),e.jsx("div",{className:"d-flex",children:e.jsxs("h4",{children:[i.answers," Answers"]})}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs(V.Select,{size:"sm",style:{width:"140px"},value:te,onChange:Ee,children:[e.jsx("option",{value:"1",children:"Sort by: Votes"}),e.jsx("option",{value:"2",children:"Sort by: Date"})]}),e.jsx(g,{size:"sm",variant:"primary",className:"ms-2",onClick:()=>re("",null),children:"Answer"})]}),e.jsx("div",{className:"mt-2 d-flex flex-column w-100",children:f?ue:o.map(s=>E===s.id?e.jsx(he,{ref:G,answer:s,acceptedAnswer:x,toggleAcceptedAnswer:le,isQuestionOwner:(l==null?void 0:l.id)===i.userId,showEditAnswer:oe,newlyCreatedAnswer:E,onShowVoters:ce},s.id):e.jsx(he,{answer:s,acceptedAnswer:x,toggleAcceptedAnswer:le,isQuestionOwner:(l==null?void 0:l.id)===i.userId,showEditAnswer:oe,newlyCreatedAnswer:E,onShowVoters:ce},s.id))}),e.jsx("div",{className:"my-3",children:e.jsx(ye,{page:p,between:3,total:i.answers,limit:v,changePage:ie,ellipsis:1})})]}):!b&&e.jsxs("div",{className:"d-flex h-100 flex-column align-items-center justify-content-center text-center",children:[e.jsx("h4",{children:e.jsx(ts,{})}),e.jsx("h5",{children:"Question not found"}),e.jsx("div",{children:e.jsx(me,{to:"/Discuss",children:"Go back"})})]})},fs=()=>{const{questionId:a}=ve();return e.jsx(Ce,{questionId:a})};const As=()=>e.jsx(ns,{children:e.jsxs(q,{element:e.jsx(as,{Header:e.jsx(is,{variant:"light"}),Footer:e.jsx(rs,{})}),children:[e.jsx(q,{index:!0,element:e.jsx(_,{MainPage:e.jsx(xs,{})})}),e.jsx(q,{path:":questionId",element:e.jsx(_,{MainPage:e.jsx(js,{})})}),e.jsxs(q,{element:e.jsx(ls,{allowedRoles:hs}),children:[e.jsx(q,{path:"New",element:e.jsx(_,{MainPage:e.jsx(Ce,{questionId:null})})}),e.jsx(q,{path:"Edit/:questionId",element:e.jsx(_,{MainPage:e.jsx(fs,{})})})]})]})});export{As as default};
