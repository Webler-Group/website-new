import{j as e,ak as Ne,r as a,aE as we,q as ae,aF as Fe,aG as ue,e as se,f as B,aH as Se,w as oe,T as ye,d as Q,U as me,Y as he,aI as ne,aJ as Ee,V as Pe,D as z,E as Ce,aa as ke,ab as Re,aK as le,ax as Me,L as xe,B as Y,ag as re,b as X,n as fe,h as Te,s as Le,aL as De,aM as Ie,aj as Oe,aN as He,v as Ae,av as Ue,F as qe,Z as _e,M as ze,N as V,ah as Ve,Q as $e,S as Be}from"./index-39cfc24f.js";import{M as je,a as Je}from"./MdEditorField-4c6c395a.js";import{M}from"./Modal-eb79c083.js";import{N as pe}from"./NotificationToast-f8b906d9.js";import{r as $,a as ge,R as We}from"./ReactionsList-a8a01792.js";import{P as Ye}from"./PostAttachment-d6132de4.js";import{M as Qe}from"./PostTextareaControl-1c99a64b.js";import{C as Ke}from"./CommentList-adbc6a87.js";import{r as Ze}from"./roles-68ed67e6.js";import"./PostAttachmentSelect-ae1d51e6.js";import"./CodeList-f241da5f.js";import"./react-bootstrap-pagination-control.esm-95f9c811.js";import"./Code-da17448f.js";import"./Tab-875264b5.js";import"./Spinner-f9aedc0f.js";import"./Toast-237a6189.js";const G=({MainPage:s})=>e.jsxs(e.Fragment,{children:[e.jsxs(Ne,{children:[" ",e.jsx("title",{children:"Feed | Webler Codes"})," ",e.jsx("meta",{name:"description",content:"Stay up to date with the Webler community! Explore the latest project updates, shared snippets, and highlights from developers worldwide."})," "]}),e.jsx("div",{className:"wb-feed-layout-container",children:s})]});var be=(s=>(s[s.QUESTION=1]="QUESTION",s[s.ANSWER=2]="ANSWER",s[s.CODE_COMMENT=3]="CODE_COMMENT",s[s.FEED=4]="FEED",s[s.SHARED_FEED=5]="SHARED_FEED",s[s.FEED_COMMENT=6]="FEED_COMMENT",s))(be||{});const Xe=({show:s,feedId:i,onShare:c,onClose:l})=>{const[j,v]=a.useState(""),[r,p]=a.useState(!1),[g,w]=a.useState(!1),[m]=a.useState([]),h=window.location.origin+`/feed/${i}`,k=async()=>{p(!0),await c(j,m),l(),p(!1)},C=async()=>{await navigator.clipboard.writeText(h),w(!0),setTimeout(()=>w(!1),2e3)};return e.jsxs(M,{show:s,onHide:l,size:"lg",centered:!0,backdropClassName:"wb-feed-edit-modal__backdrop",fullscreen:"sm-down",backdrop:"static",style:{zIndex:"1060"},children:[e.jsx(M.Header,{closeButton:!0,children:e.jsxs(M.Title,{children:[e.jsx(we,{}),"Share Post"]})}),e.jsxs(M.Body,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx(ae,{className:"form-label",children:"Add your thoughts"}),e.jsx(je,{text:j,setText:v,row:10,placeHolder:"What do you think about this post?"})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between p-2 border rounded bg-light",children:[e.jsx("span",{className:"text-truncate me-2",style:{maxWidth:"75%"},children:h}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-secondary d-flex align-items-center gap-1",onClick:C,children:[e.jsx(Fe,{}),g?"Copied!":"Copy"]})]})]}),e.jsxs(M.Footer,{children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:l,disabled:r,children:"Cancel"}),e.jsxs("button",{type:"button",className:"btn btn-primary d-flex align-items-center gap-2",onClick:k,disabled:r,children:[e.jsx(ue,{}),r?"Sharing...":"Share Post"]})]})]})},Ge=({onReactionChange:s,currentState:i})=>{const[c,l]=a.useState(i),[j,v]=a.useState(!1),[r,p]=a.useState(null),g=a.useRef(null),w=a.useRef(null),{userInfo:m}=se(),h=B();a.useEffect(()=>{l(i)},[i]);const k=x=>{const S=x==c?null:x;l(S),s(S),v(!1)},C=()=>{m!=null&&m.id||h("/Users/Login"),v(!j)},d=()=>{m!=null&&m.id||h("/Users/Login");const x=window.setTimeout(()=>{v(!0)},500);p(x)},L=()=>{r&&(clearTimeout(r),p(null))},R=()=>{w.current&&clearTimeout(w.current)};return a.useEffect(()=>{const x=S=>{g.current&&!g.current.contains(S.target)&&v(!1)};return document.addEventListener("mousedown",x),document.addEventListener("touchstart",x),()=>{document.removeEventListener("mousedown",x),document.removeEventListener("touchstart",x),w.current&&clearTimeout(w.current),r&&clearTimeout(r)}},[r]),e.jsxs("div",{ref:g,className:"position-relative d-flex align-items-center",children:[e.jsxs("span",{className:"wb-reaction-picker-btn",onClick:C,onTouchStart:d,onTouchEnd:L,style:{color:c?$[c].color:"#65676b"},children:[e.jsx("span",{children:c?$[c].emoji:e.jsx(Se,{})}),e.jsx("span",{children:c?$[c].label:$[ge.LIKE].label})]}),j&&e.jsx("div",{className:"position-absolute bg-white border rounded-pill shadow-lg d-flex align-items-center gap-1",style:{bottom:"100%",left:"0",marginBottom:"8px",zIndex:1e3,animation:"slideUp 0.2s ease-out",whiteSpace:"nowrap",borderColor:"#dadde1"},onMouseEnter:R,onTouchStart:x=>x.stopPropagation(),children:Object.entries($).map(([x,S])=>{const D=Number(x);return e.jsx("button",{type:"button",className:"btn p-1 border-0 d-flex align-items-center justify-content-center",style:{width:"32px",height:"32px",borderRadius:"50%",backgroundColor:c==D?`${S.color}20`:"transparent"},onClick:o=>{o.stopPropagation(),k(D)},title:S.label,children:S.emoji},D)})})]})},es=({show:s,onConfirm:i,onClose:c})=>{const[l,j]=a.useState(!1),v=async()=>{j(!0),await i(),j(!1)};return e.jsxs(M,{show:s,onHide:c,centered:!0,backdropClassName:"wb-feed-edit-modal__backdrop",style:{zIndex:"1060"},children:[e.jsx(M.Header,{closeButton:!0,children:e.jsxs(M.Title,{children:[e.jsx(oe,{}),"Delete Post"]})}),e.jsx(M.Body,{children:e.jsx("p",{className:"text-muted mb-0",children:"Are you sure you want to delete this post? This action cannot be undone."})}),e.jsxs(M.Footer,{children:[e.jsx("button",{onClick:c,className:"btn btn-light px-4 rounded-3 shadow-sm",disabled:l,children:"Cancel"}),e.jsxs("button",{onClick:v,disabled:l,className:"btn btn-danger px-4 d-inline-flex align-items-center gap-2 rounded-3 shadow-sm",children:[e.jsx(oe,{}),l?"Deleting...":"Delete"]})]})]})},ss=({originalPost:s})=>{const i=B();return e.jsxs("div",{onClick:()=>i(`/Feed/${s.id}`),className:"mt-2 border bg-light p-2 text-dark text-decoration-none mb-2",style:{cursor:"pointer"},children:[e.jsxs("div",{className:"d-flex gap-2 align-items-center mb-2",children:[e.jsx(me,{size:28,avatarImage:s.userAvatarImage}),e.jsx(he,{userId:s.userId,userName:s.userName}),e.jsx("span",{children:"wrote"})]}),e.jsx("div",{className:"wb-feed-content__message",children:e.jsx("i",{children:s.message})})]})},ee=ye.forwardRef(({feed:s,onCommentsClick:i,onShowFullContent:c,onShowUserReactions:l,onGeneralUpdate:j,commentCount:v,onDelete:r,onTogglePin:p,showFullContent:g=!0},w)=>{var U,q,_,Z;const{sendJsonRequest:m}=Q(),{userInfo:h}=se(),k=h==null?void 0:h.id,[C,d]=a.useState(!1),[L,R]=a.useState(!1),x=B(),S=((U=h==null?void 0:h.roles)==null?void 0:U.includes("Admin"))||((q=h==null?void 0:h.roles)==null?void 0:q.includes("Moderator")),[D,o]=a.useState(null),[F,f]=a.useState(!1),b=a.useRef(null),y=a.useCallback((t,n)=>{o({type:t,message:n}),setTimeout(()=>o(null),3e3)},[]);a.useLayoutEffect(()=>{if(b.current&&!g){const{scrollHeight:t,clientHeight:n}=b.current;f(t>n)}else f(!1)},[s.message,s.attachments,g]);const T=async()=>{const t=await m("/Feed/PinFeed","POST",{feedId:s.id,pinned:!s.isPinned});t&&t.success?(p==null||p({...s,isPinned:t.data.isPinned}),y("success",t.data.isPinned?"Post pinned":"Post unpinned")):y("error",t==null?void 0:t.error[0].message)},O=async()=>{const t=await m("/Feed/DeleteFeed","DELETE",{feedId:s.id});t&&t.success?(r(s),x("/Feed"),y("success","Post deleted successfully")):y("error",t==null?void 0:t.error[0].message)},H=async t=>{const n=await m("/Feed/VotePost","POST",{postId:s.id,vote:t!=null,reaction:t});if(n&&n.success){const u=s.votes+(s.isUpvoted!=n.vote?n.vote?1:-1:0);let N=[...s.topReactions];const ie=s.reaction;if(ie){for(let E=0;E<N.length;++E)if(N[E].reaction==ie){N[E].count==1?N.splice(E,1):--N[E].count;break}}if(t){let E=-1;for(let W=0;W<N.length;++W)if(N[W].reaction==t){++N[W].count,E=W;break}if(E==-1)N.push({reaction:t,count:1});else for(;E>0&&!(N[E-1].count>N[E].count);)[N[E],N[E-1]]=[N[E-1],N[E]],--E}n.vote===1?s.isUpvoted&&s.reaction===t?(s.totalReactions-=1,s.isUpvoted=!1):s.isUpvoted||(s.totalReactions+=1,s.isUpvoted=!0):s.isUpvoted&&(s.totalReactions-=1,s.isUpvoted=!1),j==null||j({...s,reaction:t,votes:u,isUpvoted:n.vote,topReactions:N,totalReactions:s.totalReactions})}else y("error",n==null?void 0:n.error[0].message)},I=async(t,n)=>{const u=await m("/Feed/ShareFeed","POST",{feedId:s.id,message:t,tags:n});u&&u.success?(x(`/Feed/${u.feed.id}`),d(!1),y("success","Post shared successfully")):y("error",u==null?void 0:u.error[0].message)},P=()=>{i==null||i(s.id)},K=()=>{l==null||l(s.id)},te=()=>{c==null||c(s.id)},J=s.userId===k,A=e.jsx(e.Fragment,{children:e.jsxs("article",{className:"wb-feed-item",children:[e.jsx(pe,{notification:D,onClose:()=>o(null)}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"d-flex align-items-start gap-2 flex-grow-1",children:[e.jsx(me,{size:36,avatarImage:s.userAvatarImage}),e.jsxs("div",{className:"d-flex flex-column",children:[e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(he,{userId:s.userId,userName:s.userName}),s.isPinned&&e.jsxs("span",{className:"badge bg-warning bg-opacity-10 text-warning border border-warning border-opacity-25",children:[e.jsx(ne,{className:"me-1"}),"Pinned"]})]}),e.jsxs("div",{className:"text-muted d-flex align-items-center gap-1 small",children:[e.jsx(Ee,{}),e.jsx("time",{dateTime:s.date,children:Pe.format2(new Date(s.date))})]})]})]}),(J||S)&&e.jsxs(z,{children:[e.jsx(z.Toggle,{as:Ce}),e.jsxs(z.Menu,{style:{width:"200px"},children:[J&&e.jsx(e.Fragment,{children:e.jsxs(z.Item,{className:"dropdown-item d-flex align-items-center gap-2",onClick:()=>x("/Feed/Edit/"+s.id),children:[e.jsx(ke,{})," Edit Post"]})}),(J||S)&&e.jsx(e.Fragment,{children:e.jsxs(z.Item,{className:"dropdown-item d-flex align-items-center gap-2 text-danger",onClick:()=>R(!0),children:[e.jsx(Re,{})," Delete Post"]})}),S&&e.jsxs(z.Item,{className:"dropdown-item d-flex align-items-center gap-2 text-warning",onClick:()=>T(),children:[e.jsx(ne,{})," ",s.isPinned?"Unpin Post":"Pin Post"]})]})]})]}),s.type===be.SHARED_FEED&&(s.originalPost?e.jsx(ss,{originalPost:s.originalPost}):e.jsxs("div",{className:"wb-feed-shared-post-unavailable",children:[e.jsx(le,{className:"mb-3 opacity-50"}),e.jsx("p",{className:"mb-0 fw-medium text-muted",children:"This shared post is no longer available"})]})),e.jsxs("div",{ref:b,className:`mt-2 wb-feed-content position-relative ${g?"":"truncated clickable"}`,onClick:g?void 0:te,children:[e.jsx("div",{style:g?{}:{pointerEvents:"none"},children:e.jsx(Qe,{content:s.message,allowedUrls:Je})}),((_=s.attachments)==null?void 0:_.length)>0&&e.jsx("div",{className:"mt-2 rounded text-dark text-decoration-none",children:((Z=s.attachments)==null?void 0:Z.length)>0&&e.jsx("div",{className:"mt-2 rounded text-dark text-decoration-none",children:e.jsx("div",{className:"d-flex flex-column gap-2",children:s.attachments.map(t=>e.jsx("div",{className:"mt-1",children:e.jsx(Ye,{data:t})},t.id))})})}),!g&&F&&e.jsx("div",{className:"fade-overlay"})]}),e.jsxs("div",{className:"wb-feed-reactions mt-2 d-flex gap-1 align-items-center",onClick:K,children:[e.jsx("div",{className:"d-flex",children:s.topReactions.map((t,n)=>e.jsx("span",{className:"bg-white rounded-circle d-flex align-items-center justify-content-center",style:{marginLeft:n===0?"0":"-6px",width:"18px",height:"18px",zIndex:(s.topReactions.length-n).toString()},children:$[t.reaction??ge.LIKE].emoji},`${t.reaction}-${n}`))}),s.totalReactions>0&&e.jsx("span",{className:"text-muted",children:s.totalReactions})]}),e.jsxs("div",{className:"mt-3 d-flex align-items-center justify-content-between",children:[e.jsx(Ge,{onReactionChange:H,currentState:s.reaction}),e.jsxs("span",{className:"wb-feed-action-btn",onClick:P,children:[e.jsx(le,{}),e.jsx("span",{children:v}),e.jsx("span",{children:v===1?"comment":"comments"})]}),e.jsxs("span",{className:"wb-feed-action-btn",onClick:()=>{if(!h){x("/Users/Login");return}d(!0)},children:[e.jsx(ue,{}),e.jsx("span",{children:s.shares||0}),e.jsx("span",{children:s.shares===1?"share":"shares"})]})]}),L&&e.jsx(es,{show:L,onConfirm:O,onClose:()=>R(!1)}),C&&e.jsx(Xe,{show:C,feedId:s.id,onShare:I,onClose:()=>d(!1)})]})});return w?e.jsx("div",{ref:w,children:A}):A});ee.displayName="FeedItem";const ts=({feedId:s,onGeneralUpdate:i,onShowUserReactions:c,onDelete:l,onTogglePin:j})=>{const v=B(),[r,p]=a.useState(null),[g,w]=a.useState(!0),[m,h]=a.useState(null),{sendJsonRequest:k}=Q(),[C,d]=a.useState(null),[L,R]=a.useState(null),[x,S]=a.useState(!1),[D,o]=a.useState({section:"Feed",params:{feedId:s}}),[F,f]=a.useState(0),b=Me();a.useEffect(()=>{b.state?((b.state.postId||b.state.comments)&&y(),b.state.postId&&R({id:b.state.postId,isReply:b.state.isReply})):T()},[b]),a.useEffect(()=>{if(!s)return;(async()=>{try{w(!0);const P=await k("/Feed/GetFeed","POST",{feedId:s});if(!P.success)throw new Error(P.message);p(P.feed),f(P.feed.answers),i(P.feed)}catch(P){h("Failed to load feed"),console.error("Error fetching feed:",P),O("error",String(P))}finally{w(!1)}})(),o({section:"Feed",params:{feedId:s}})},[s]),a.useEffect(()=>{r&&i({...r,answers:F})},[F]);const y=()=>{s&&S(!0)},T=()=>{S(!1)},O=(I,P)=>{d({type:I,message:P}),setTimeout(()=>d(null),5e3)},H=I=>{p(I),i(I)};return g?e.jsx(e.Fragment,{children:e.jsx("div",{className:"loading-container",children:e.jsx(xe,{})})}):m||!r?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"error-container",children:[e.jsx(pe,{notification:C,onClose:()=>d(null)}),e.jsxs("div",{className:"error-content",children:[e.jsx("h4",{className:"error-title",children:m||"Feed not found"}),e.jsxs(Y,{onClick:()=>v("/Feed"),variant:"primary",children:[e.jsx(re,{}),"Back to Feed"]})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(X,{show:x,onHide:T,backdropClassName:"wb-feed-comment-modal__backdrop",style:{zIndex:1060},placement:"end",children:[e.jsx(X.Header,{closeButton:!0,children:e.jsxs(X.Title,{children:[F," Comments"]})}),e.jsx(X.Body,{className:"d-flex flex-column",style:{height:"calc(100% - 62px)"},children:e.jsx(Ke,{findPost:L,options:D,setCommentCount:f})})]}),e.jsx("div",{className:"wb-feed-details-container p-2",children:e.jsxs("div",{className:"wb-feed-main-content",children:[e.jsxs("button",{onClick:()=>v("/Feed"),className:"wb-feed-back-button",children:[e.jsx(re,{size:16}),"Back to Feed"]}),e.jsx(ee,{feed:r,onCommentsClick:y,onGeneralUpdate:H,commentCount:F,onShowUserReactions:c,onDelete:l,onTogglePin:j})]})})]})},as=(s,i,c)=>{const[l,j]=a.useState({page:0}),[v,r]=a.useState([]),[p,g]=a.useState(!1),[w,m]=a.useState([]),[h,k]=a.useState(!1),[C,d]=a.useState(0),{sendJsonRequest:L}=Q(),{userInfo:R}=se();a.useEffect(()=>{l.page!=0&&x()},[l]),a.useEffect(()=>{j({page:1})},[s,i]);const x=async()=>{m([]),g(!0);let F=l.page!=1;F||r([]);const f=await L("/Feed","POST",{page:l.page,count:c,filter:s,searchQuery:i,userId:R==null?void 0:R.id});f&&f.success?(r(F?b=>{const y=f.feeds.filter(T=>!b.some(O=>O.id===T.id));return[...b,...y]}:()=>f.feeds),d(f.count),k(f.feeds.length===c)):m(f.error),g(!1)};return{state:l,results:v,loading:p,error:w,hasNextPage:h,totalCount:C,setState:j,editPost:F=>{r(f=>f.map(b=>b.id==F.id?F:b))},deletePost:F=>{r(f=>f.filter(b=>b.id!=F))},addPost:F=>{r(f=>[F,...f])}}},ce=[{value:1,label:"Latest",requireLogin:!1},{value:2,label:"My Posts",requireLogin:!0},{value:3,label:"Following",requireLogin:!0},{value:4,label:"Trending (24h)",requireLogin:!1},{value:5,label:"Most Popular",requireLogin:!1},{value:6,label:"Most Shared",requireLogin:!1}],de=()=>{const{feedId:s}=fe(),i=B(),{userInfo:c}=se(),[l,j]=a.useState("");let v=1;const r=localStorage.getItem("feed");if(r){const t=JSON.parse(r),n=ce.find(u=>u.value===t.filter);n&&(!n.requireLogin||c!=null)&&(v=t.filter)}const[p,g]=a.useState(v),[w,m]=a.useState(!0),[h,k]=a.useState(l),[C,d]=a.useState(!1),[L,R]=a.useState({parentId:""}),[x,S]=a.useState(!0),{sendJsonRequest:D}=Q(),o=as(p,l,10),[F,f]=a.useState([]),[b,y]=a.useState(!1),T=a.useRef(),O=a.useCallback(t=>{o.loading||(T.current&&T.current.disconnect(),T.current=new IntersectionObserver(n=>{n[0].isIntersecting&&o.hasNextPage&&o.results.length>0&&o.setState(u=>({page:u.page+1}))}),t&&T.current.observe(t))},[o.loading,o.hasNextPage,o.results]);a.useEffect(()=>{let t=window.scrollY;const n=()=>{const u=window.scrollY;u<60?m(!0):u>t?m(!1):u<t&&m(!0),t=u};return addEventListener("scroll",n,{passive:!0}),()=>removeEventListener("scroll",n)},[]),a.useEffect(()=>{H()},[]),a.useEffect(()=>{o.state.page===1&&setTimeout(()=>{scrollTo({top:0,behavior:"instant"})})},[o.state]),a.useEffect(()=>{localStorage.setItem("feed",JSON.stringify({filter:p}))},[p]);const H=async()=>{y(!0);const t=await D("/Feed","POST",{page:1,count:10,filter:7,searchQuery:""});t&&t.feeds&&f(()=>t.feeds),y(!1)},I=t=>{const n=Number(t.target.selectedOptions[0].value);g(n)},P=()=>{j(()=>h)},K=async()=>{y(!0),o.setState({page:1}),await H(),y(!1)},te=()=>{i("/Feed")},J=()=>{d(!1)},A=t=>{t.isPinned?f(n=>n.map(u=>u.id==t.id?t:u)):o.editPost(t)},U=t=>{t.isPinned?f(n=>n.filter(u=>u.id!=t.id)):o.deletePost(t.id)},q=t=>{R({parentId:t}),d(!0)},_=t=>{t.isPinned?(o.deletePost(t.id),f(n=>[t,...n]),setTimeout(()=>{scrollTo({top:0,behavior:"smooth"})})):(f(n=>n.filter(u=>u.id!==t.id)),o.addPost(t))},Z=()=>{S(t=>!t)};return e.jsxs(e.Fragment,{children:[e.jsx(M,{show:s!=null,onHide:te,fullscreen:!0,backdrop:"static",children:e.jsx(M.Body,{className:"p-0",children:e.jsx(ts,{feedId:s,onGeneralUpdate:A,onShowUserReactions:q,onDelete:U,onTogglePin:_})})}),e.jsx(We,{title:"Reactions",options:L,visible:C,onClose:J,showReactions:!0,countPerPage:10}),e.jsxs("div",{className:"wb-feed-list-container",children:[e.jsx("div",{className:`p-2 wb-feed-list-header ${w?"wb-feed-visible":"wb-feed-hidden"}`,children:e.jsxs("div",{className:"d-flex flex-column gap-2",children:[e.jsx("h2",{className:"h4 fw-bold text-dark mb-0",children:"Feed"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(ae,{htmlFor:"search",className:"visually-hidden",children:"Search"}),e.jsx(Te,{id:"search",type:"search",size:"sm",placeholder:"Search...",value:h,onChange:t=>k(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),P())}}),e.jsx(Y,{size:"sm",onClick:P,children:"Search"})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between gap-2",children:[e.jsx(ae,{htmlFor:"filter",className:"visually-hidden",children:"Filter"}),e.jsx(Le,{id:"filter",size:"sm",style:{width:"140px"},value:p,onChange:I,children:ce.filter(t=>t.requireLogin==!1||c!=null).map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsxs("button",{onClick:K,disabled:o.loading||b,className:"btn btn-light rounded-pill shadow-sm d-flex align-items-center justify-content-center gap-2 wb-feed-control-button",children:[e.jsx(De,{className:"text-muted"}),e.jsx("span",{className:"d-none d-sm-inline",children:"Refresh"})]})]})]})}),b?e.jsx("div",{className:"d-flex justify-content-center mt-5 text-center",children:e.jsx(xe,{})}):e.jsxs(e.Fragment,{children:[F.length>0&&e.jsxs("div",{className:"px-2 wb-pinned-feeds-section bg-light",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2",children:[e.jsxs("h6",{className:"text-warning mb-0",children:[e.jsx(ne,{})," Pinned Posts"]}),e.jsx(Y,{size:"sm",variant:"link",className:"text-secondary",onClick:Z,children:x?e.jsx(Ie,{}):e.jsx(Oe,{})})]}),x&&e.jsx("div",{children:F.map(t=>e.jsx("div",{className:"border-2 border-bottom mt-3",children:e.jsx(ee,{feed:t,onGeneralUpdate:A,onCommentsClick:n=>i(`/Feed/${n}`,{state:{comments:!0}}),commentCount:t.answers||0,onShowUserReactions:q,onDelete:U,onTogglePin:_,showFullContent:!1,onShowFullContent:n=>i(`/Feed/${n}`)})},t.id))})]}),e.jsxs("div",{className:"px-2 wb-feed-items",children:[o.error.length>0&&e.jsxs("div",{className:"alert alert-danger rounded-4 border-0 d-flex align-items-center gap-3",children:[e.jsx(He,{}),e.jsxs("div",{children:[e.jsx("strong",{children:"Error loading feeds"}),e.jsx("ul",{children:o.error.map((t,n)=>e.jsx("li",{children:t.message},n))}),e.jsx("button",{onClick:K,className:"btn btn-sm btn-outline-danger mt-2",children:"Try Again"})]})]}),!o.loading&&o.error.length==0&&o.results.length===0&&e.jsxs("div",{className:"text-center py-5",children:[e.jsx(Ae,{size:40,className:"opacity-50 mb-3"}),e.jsx("h5",{className:"text-muted",children:"No feeds found"}),e.jsx("p",{className:"text-muted small",children:l?`No results found for "${l}". Try adjusting search or filters.`:"No feeds available at the moment."})]}),e.jsx("div",{children:o.results.map((t,n)=>{const u=n===o.results.length-1;return e.jsx("div",{className:"border-2 border-bottom mt-3",ref:u?O:void 0,children:e.jsx(ee,{feed:t,onGeneralUpdate:A,onCommentsClick:N=>i(`/Feed/${N}`,{state:{comments:!0}}),commentCount:t.answers||0,onShowUserReactions:q,onDelete:U,onTogglePin:_,showFullContent:!1,onShowFullContent:N=>i(`/Feed/${N}`)})},t.id)})}),!o.hasNextPage&&o.results.length>0&&e.jsx("div",{className:"text-center py-4 text-muted small",children:e.jsx("span",{children:"You've reached the end of the feed"})})]})]}),e.jsxs("button",{onClick:()=>i("/Feed/new"),className:"wb-feed-new-post-button",title:"Create new post",children:[e.jsx("span",{className:"d-none d-md-inline",children:"New Post"}),e.jsx(Ue,{className:"d-md-none",size:24})]})]})]})},ve=({feedId:s})=>{const[i,c]=a.useState(""),[l,j]=a.useState(!1),[v,r]=a.useState(),p=B(),{sendJsonRequest:g}=Q();a.useEffect(()=>{s&&w()},[s]);const w=async()=>{j(!0);const d=await g("/Feed/GetFeed","POST",{feedId:s});d&&d.feed&&c(d.feed.message),j(!1)},m=async()=>{const d=await g("/Feed/CreateFeed","POST",{message:i});d.success?p("/Feed/"+d.feed.id):r(d.error)},h=async()=>{const d=await g("/Feed/EditFeed","PUT",{feedId:s,message:i});d.success?p("/Feed/"+d.data.id):r(d.error)},k=async d=>{d.preventDefault(),i.trim()&&(j(!0),r(void 0),s?await h():await m(),j(!1))},C=()=>{p("/Feed")};return e.jsxs("div",{className:"p-2",children:[e.jsx("h2",{className:"fw-semibold my-3",children:s?"Edit Post":"Create New Post"}),e.jsxs(qe,{onSubmit:k,children:[e.jsx(_e,{errors:v}),e.jsx(je,{text:i,setText:c,row:10,placeHolder:"What's on your mind"}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx(Y,{type:"button",variant:"secondary",onClick:C,disabled:l,children:"Cancel"}),e.jsx(Y,{type:"submit",variant:"primary",disabled:!i.trim()||l,children:s?"Save":"Post"})]})]})]})};const ns=()=>{const{feedId:s}=fe();return e.jsx(ve,{feedId:s})},Ns=()=>e.jsx(ze,{children:e.jsxs(V,{element:e.jsx(Ve,{Header:e.jsx($e,{variant:"light"}),Footer:null}),children:[e.jsx(V,{index:!0,element:e.jsx(G,{MainPage:e.jsx(de,{})})}),e.jsxs(V,{element:e.jsx(Be,{allowedRoles:Ze}),children:[e.jsx(V,{path:"New",element:e.jsx(G,{MainPage:e.jsx(ve,{feedId:null})})}),e.jsx(V,{path:"Edit/:feedId",element:e.jsx(G,{MainPage:e.jsx(ns,{})})})]}),e.jsx(V,{path:":feedId",element:e.jsx(G,{MainPage:e.jsx(de,{})})})]})});export{Ns as default};
