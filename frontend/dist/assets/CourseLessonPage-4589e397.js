import{h as V,r as a,g as q,d as z,e as G,u as J,j as s}from"./index-b2f3d98e.js";import{c as Q,f as W}from"./index.esm-cb18ecd9.js";import{A as D,B as K}from"./index.esm-4a619d62.js";import{L as U}from"./LessonNode-b285ef1b.js";import{C as X}from"./CommentList-a5c46d75.js";import{O as u}from"./Offcanvas-c2fce8b4.js";import{B as v}from"./Button-a8db19a8.js";import{N as h}from"./Nav-faaa223c.js";import"./iconBase-7a454df3.js";import"./MarkdownRenderer-0f98c67a.js";import"./useMergedRefs-f5c2a768.js";import"./Form-4647d33b.js";import"./ThemeProvider-c318c21f.js";import"./index-11ee592c.js";import"./FormControl-a036e454.js";import"./Col-1c3a04d0.js";import"./createWithBsPrefix-c6deafcc.js";import"./PostAttachment-84505555.js";import"./index-19ddc0d1.js";import"./DateUtils-6b83375c.js";import"./PostTextareaControl-1be45863.js";import"./UserSearch-78852d36.js";import"./ProfileAvatar-4b9caa46.js";import"./Nav-131532f4.js";import"./DataKey-e12315fd.js";import"./NavContext-f8abb837.js";import"./Anchor-1fe32030.js";import"./ReactionsList-cdc0f7ea.js";import"./Modal-d6b02714.js";import"./useWindow-763af26a.js";import"./AbstractModalHeader-f9d4f376.js";import"./CloseButton-439f23fc.js";import"./divWithClassName-9b80bbe4.js";import"./NavbarContext-864acb8f.js";import"./CardHeaderContext-82a24767.js";const Be=()=>{var y;const{lessonId:c,courseCode:w}=V(),[o,p]=a.useState(null),[f,S]=a.useState(0),{sendJsonRequest:b}=q(),L=z(),d=G(),[i,x]=J(),[E,j]=a.useState(!1),[P,I]=a.useState({section:"Courses",params:{lessonId:c}}),[g,C]=a.useState(0),[B,F]=a.useState(null);a.useEffect(()=>{c&&(O(),I({section:"Courses",params:{lessonId:c}}))},[c]),a.useEffect(()=>{i.has("slide")&&S(Number(i.get("slide")))},[i]),a.useEffect(()=>{d.state&&d.state.postId&&(N(),F({id:d.state.postId,isReply:d.state.isReply}))},[d]),a.useEffect(()=>{if(o&&!i.has("slide")){const e=o.nodes.filter(t=>t.unlocked).sort((t,n)=>n.index-t.index);e.length&&(i.set("slide",e[0].index.toString()),x(i,{replace:!0}))}},[o]);const O=async()=>{const e=await b("/Courses/GetLesson","POST",{lessonId:c});e&&e.lesson&&(p(e.lesson),C(e.lesson.comments))},A=(e,t)=>{o&&t&&(i.set("slide",e.toString()),x(i,{replace:!0}))},M=e=>{if(!o)return;const t=o.nodes.find(n=>n.id==e);t&&(t.index<o.nodeCount?(i.set("slide",(t.index+1).toString()),x(i,{replace:!0})):k())},R=e=>{if(!o)return;const t=o.nodes.find(n=>n.id==e);t&&t.type==1&&p(n=>{if(!n)return null;const r=n.nodes;for(let l=0;l<r.length;++l)r[l].index==t.index+1&&(r[l].unlocked=!0);return{...n,nodes:r}})},T=(e,t)=>{if(!o)return;const n=o.nodes.find(r=>r.id==e);n&&t&&p(r=>{if(!r)return null;const l=r.nodes;for(let m=0;m<l.length;++m)l[m].index==n.index+1&&(l[m].unlocked=!0);return{...r,nodes:l}})},N=()=>{c&&j(!0)},H=()=>{j(!1)},k=()=>{L("/Courses/"+w)};return s.jsx("div",{className:"wb-course-lesson-container d-flex flex-column",children:o&&s.jsxs(s.Fragment,{children:[s.jsxs(u,{show:E,onHide:H,placement:"end",children:[s.jsx(u.Header,{closeButton:!0,children:s.jsxs(u.Title,{children:[g," Comments"]})}),s.jsx(u.Body,{className:"d-flex flex-column",style:{height:"calc(100% - 62px)"},children:s.jsx(X,{findPost:B,options:P,setCommentCount:C})})]}),s.jsxs("div",{className:"d-flex justify-content-between p-2",children:[s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx(v,{variant:"link",className:"text-secondary",onClick:k,children:s.jsx(Q,{})}),s.jsx("span",{className:"text-secondary",style:{fontSize:"24px",fontWeight:"bold"},children:o.title})]}),s.jsxs("div",{className:"d-flex align-items-center gap-1",children:[s.jsx("span",{className:"small text-secondary",children:g}),s.jsx(v,{variant:"link",className:"text-secondary",onClick:N,children:s.jsx(D,{})})]})]}),s.jsx("div",{className:"wb-course-lesson-main",children:s.jsx(h,{variant:"pills",className:"flex-row overflow-auto my-3 row-gap-1",children:o.nodes.map(e=>{const t=e.index===f,n=e.type===1?s.jsx(K,{}):s.jsx(W,{});return s.jsx(h.Item,{children:s.jsx(h.Link,{className:"wb-course-lesson-arrow-pill "+(e.unlocked?t?"bg-warning text-dark":"bg-primary text-light":"bg-secondary text-light"),onClick:()=>A(e.index,e.unlocked),disabled:!e.unlocked,children:n})},e.id)})})}),s.jsx("div",{className:"flex-grow-1 mt-2",children:f!=0&&s.jsx(U,{nodeId:(y=o.nodes.find(e=>e.index==f))==null?void 0:y.id,mock:!1,onContinue:M,onAnswered:T,onEnter:R})})]})})};export{Be as default};
