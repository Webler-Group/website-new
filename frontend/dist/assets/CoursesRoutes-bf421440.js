import{r,u as Fe,j as e,c as Ne,ad as Ae,k as se,D as K,E as we,ae as Ie,d as W,e as _e,af as Me,B as w,C as he,n as te,P as be,o as X,R as Re,a as De,Q as Y,l as re,F as Be,ag as qe,ah as Oe,ai as ze,aj as He,ak as Ue,al as $e,a6 as xe,i as Q,V as Ve,am as U,q as $,an as fe,ao as me,h as ae,s as Ge,g as Se,f as je,L as ke,ap as Je,b as oe,m as Qe,aq as We,U as le,ar as Ye,as as Ke,T as ge,z as Xe,A as O,ac as ce,H as de,at as ue,G as pe}from"./index-80db11cf.js";import{M as D}from"./Modal-19ce6b28.js";import{t as ie}from"./StringUtils-91be14c5.js";import{r as Ze}from"./roles-68ed67e6.js";import{M as es}from"./PostTextareaControl-3c30086b.js";import{M as ss,B as ts,T as ns}from"./MdEditorField-3b4133e9.js";import{N as rs}from"./NotificationToast-c5164c8d.js";import{C as os}from"./CommentList-76d5c9ba.js";import{T as is}from"./ToggleSwitch-2c2600fd.js";import"./PostAttachmentSelect-8cd57bbf.js";import"./CodeList-7b842335.js";import"./react-bootstrap-pagination-control.esm-b45f6320.js";import"./Code-d9d12e4f.js";import"./PostAttachment-c1c636f2.js";import"./ReactionsList-1ba1f18d.js";import"./Toast-6154fa82.js";const Ce=1e3;function as(s,h,t){const u=(s-h)/(t-h)*100;return Math.round(u*Ce)/Ce}function ve({min:s,now:h,max:t,label:u,visuallyHidden:g,striped:n,animated:x,className:v,style:p,variant:d,bsPrefix:E,...m},o){return e.jsx("div",{ref:o,...m,role:"progressbar",className:Ne(v,`${E}-bar`,{[`bg-${d}`]:d,[`${E}-bar-animated`]:x,[`${E}-bar-striped`]:x||n}),style:{width:`${as(h,s,t)}%`,...p},"aria-valuenow":h,"aria-valuemin":s,"aria-valuemax":t,children:g?e.jsx("span",{className:"visually-hidden",children:u}):u})}const Le=r.forwardRef(({isChild:s=!1,...h},t)=>{const u={min:0,max:100,animated:!1,visuallyHidden:!1,striped:!1,...h};if(u.bsPrefix=Fe(u.bsPrefix,"progress"),s)return ve(u,t);const{min:g,now:n,max:x,label:v,visuallyHidden:p,striped:d,animated:E,bsPrefix:m,variant:o,className:y,children:_,...q}=u;return e.jsx("div",{ref:t,...q,className:Ne(y,m),children:_?Ae(_,b=>r.cloneElement(b,{isChild:!0})):ve({min:g,now:n,max:x,label:v,visuallyHidden:p,striped:d,animated:E,bsPrefix:m,variant:o},t)})});Le.displayName="ProgressBar";const ls=Le,Ee=({course:s,isEditor:h})=>e.jsx(se.LinkContainer,{to:h?"/Courses/Editor/"+s.id:"/Courses/"+s.code,children:e.jsxs("div",{className:"wb-courses-course-card rounded border p-2 bg-white d-sm-flex gap-3 position-relative",children:[h&&e.jsx("div",{className:"wb-courses-course__edit-button",children:e.jsxs(K,{drop:"start",children:[e.jsx(K.Toggle,{as:we}),e.jsx(K.Menu,{children:e.jsx(se.LinkContainer,{to:"/Courses/Editor/Edit/"+s.id,children:e.jsx(K.Item,{children:"Edit"})})})]})}),e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx("div",{className:"rounded-circle",children:e.jsx("img",{className:"wb-courses-course__cover-image",src:s.coverImage?"/uploads/courses/"+s.coverImage:"/resources/images/logoicon.svg",alt:"Cover image"})})}),e.jsxs("div",{className:"d-flex flex-column align-items-sm-start align-items-center",children:[e.jsxs("h5",{style:{wordBreak:"break-word"},children:[s.title," ",!s.visible&&e.jsx(Ie,{})]}),e.jsx("p",{className:"wb-courses-course__description",children:s.description})]})]})}),cs=({course:s,onRestart:h})=>{const t=async()=>{h(s.id)};return e.jsx(se.LinkContainer,{to:"/Courses/"+s.code,children:e.jsxs("div",{className:"wb-courses-course-card rounded border p-2 d-sm-flex gap-3 bg-white position-relative",children:[e.jsx("div",{className:"wb-courses-course__edit-button",children:e.jsxs(K,{drop:"start",children:[e.jsx(K.Toggle,{as:we}),e.jsx(K.Menu,{children:e.jsx(K.Item,{onClick:t,children:"Restart"})})]})}),e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx("div",{className:"rounded-circle",children:e.jsx("img",{className:"wb-courses-course__cover-image",src:s.coverImage?"/uploads/courses/"+s.coverImage:"/resources/images/logoicon.svg",alt:"Cover image"})})}),e.jsx("div",{className:"d-flex flex-column align-items-sm-start align-items-center",children:e.jsx("h5",{style:{wordBreak:"break-word"},children:s.title})})]})})},ds=()=>{const{sendJsonRequest:s}=W(),[h,t]=r.useState([]),[u,g]=r.useState([]),[n,x]=r.useState(!1),{userInfo:v}=_e(),[p,d]=r.useState(!1),[E,m]=r.useState(null);r.useEffect(()=>{o()},[]);const o=async()=>{x(!0);const b=await s("/Courses","POST",{excludeUserId:v==null?void 0:v.id});if(b&&b.courses&&t(b.courses),v){const j=await s("/Courses/GetUserCourses","POST",{userId:v.id});j&&j.courses&&g(j.courses)}x(!1)},y=()=>{d(!1)},_=async()=>{if(!E)return;const b=await s("/Courses/ResetCourseProgress","POST",{courseId:E});b!=null&&b.success,d(!1)},q=b=>{m(b),d(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(Me,{children:[" ",e.jsx("title",{children:"Courses | Webler Codes"})," ",e.jsx("meta",{name:"description",content:"Learn by doing with Webler’s interactive coding courses. Practice with hands-on lessons, quizzes, and real-world projects at your own pace."})," "]}),e.jsxs(D,{show:p,onHide:y,centered:!0,children:[e.jsx(D.Header,{closeButton:!0,children:e.jsx(D.Title,{children:"Are you sure?"})}),e.jsx(D.Body,{children:"Course progress will be restarted."}),e.jsxs(D.Footer,{children:[e.jsx(w,{variant:"secondary",onClick:y,children:"Cancel"}),e.jsx(w,{variant:"danger",onClick:_,children:"Restart"})]})]}),e.jsx(he,{children:e.jsxs("div",{className:"wb-courses-main p-4",children:[v!==null&&u.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx("h2",{children:"My Courses"})}),e.jsx("div",{className:"my-3",children:u.map(b=>e.jsx("div",{className:"mt-3",children:e.jsx(cs,{course:b,onRestart:q})},b.id))})]}),e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx("h2",{children:"Explore our courses"})}),e.jsx("div",{className:"my-3",children:h.length==0?e.jsx("div",{className:"wb-empty-list",children:e.jsx("h3",{children:"Nothing to show"})}):h.map(b=>e.jsx("div",{className:"mt-3",children:e.jsx(Ee,{course:b,isEditor:!1})},b.id))})]})})]})},us=()=>{const{courseCode:s}=te(),{sendJsonRequest:h}=W(),[t,u]=r.useState(null),[g,n]=r.useState(!0),[x,v]=r.useState("Webler Codes");be(x),r.useEffect(()=>{p()},[s]);const p=async()=>{n(!0);const o=await h("/Courses/GetCourse","POST",{courseCode:s,includeLessons:!0});o&&o.course&&(u(o.course),v("Courses - "+o.course.title+" | Webler Codes")),n(!1)},d=()=>{if(!t||!t.lessons.length)return 0;const o=t.lessons.filter(y=>y.completed).length;return Math.round(o/t.lessons.length*100)};let m=(()=>{let o=null;if(t){const y=t.lessons.filter(_=>_.unlocked).sort((_,q)=>q.index-_.index);y.length&&(o=y[0])}return o})();return e.jsx(he,{children:e.jsx("div",{className:"wb-courses-main pt-2",children:g?e.jsx("p",{children:"Loading..."}):t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex gap-2 py-2",children:[e.jsx(X,{to:"/Courses",children:"Courses"}),e.jsx("span",{children:"›"}),e.jsx("span",{children:ie(t.title,20)})]}),e.jsx("h3",{children:t.title}),e.jsx("p",{className:"wb-courses-course__description",children:t.description}),m&&e.jsx(Y,{className:"mt-4 shadow-sm",children:e.jsxs(Y.Body,{children:[e.jsx(Y.Title,{children:"Continue your progress"}),e.jsxs(Y.Text,{children:["You can continue with lesson ",e.jsx("strong",{children:m.title}),"."]}),e.jsx(X,{to:`/Courses/${t.code}/Lesson/${m.id}`,children:e.jsx(w,{variant:"primary",children:"Go to Lesson"})})]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{children:"Progress"}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(ls,{now:d(),className:"flex-grow-1 me-2"}),e.jsxs("span",{children:[t.lessons.filter(o=>o.completed).length," / ",t.lessons.length]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{children:"Lessons"}),e.jsx(Re,{children:t.lessons.map(o=>{const y=o.unlocked&&!o.completed;return e.jsx(De,{md:6,lg:4,className:"mb-3",children:e.jsx(Y,{className:`h-100 shadow-sm ${o.unlocked?"":"bg-light text-muted"}`,style:{cursor:o.unlocked?"pointer":"not-allowed"},children:e.jsxs(Y.Body,{children:[e.jsx(Y.Title,{children:o.title}),e.jsxs(Y.Text,{children:["Slides: ",o.nodeCount]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[o.unlocked&&o.completed&&e.jsxs(re,{bg:"success",children:[e.jsx(Be,{}),"Completed"]}),y&&e.jsxs(re,{bg:"info",children:[e.jsx(qe,{}),"In Progress"]}),o.unlocked&&!o.completed&&!y&&e.jsxs(re,{bg:"light",text:"dark",children:[e.jsx(Oe,{}),"Available"]}),!o.unlocked&&e.jsxs(re,{bg:"secondary",children:[e.jsx(ze,{}),"Locked"]}),e.jsxs("small",{children:["#",o.index]})]}),o.unlocked&&e.jsx(X,{to:`/Courses/${t.code}/Lesson/${o.id}`,children:e.jsx(w,{size:"sm",variant:"outline-primary",children:"Open"})})]})})},o.id)})})]})]}):e.jsx("p",{children:"Course not found."})})})},ee=({MainPage:s})=>(be("Course Editor",!1),e.jsx(he,{children:e.jsx("div",{className:"wb-courses-main pt-2",children:s})})),xs=()=>{const{sendJsonRequest:s}=W(),[h,t]=r.useState([]),[u,g]=r.useState(!1);r.useEffect(()=>{n()},[]);const n=async()=>{g(!0);const x=await s("/CourseEditor","POST",{});x&&x.courses&&t(x.courses),g(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Course Editor"}),e.jsx("div",{className:"mt-4 d-flex justify-content-end",children:e.jsx(se.LinkContainer,{to:"/Courses/Editor/New",children:e.jsx(w,{size:"sm",children:"Create course"})})}),e.jsx("div",{className:"my-3",children:h.length==0?e.jsx("div",{className:"wb-empty-list",children:e.jsx("h3",{children:"Nothing to show"})}):h.map(x=>e.jsx("div",{className:"mt-3",children:e.jsx(Ee,{course:x,isEditor:!0})},x.id))})]})},ms=({lesson:s,courseId:h,onEdit:t,onDelete:u,onChangeIndex:g,isFirst:n,isLast:x})=>{const v=()=>{t(s.id,s.title)},p=()=>{u(s.id)},d=()=>{n||g(s.id,s.index-1)},E=()=>{x||g(s.id,s.index+1)};return e.jsxs("div",{className:"border p-2 bg-white d-flex justify-content-between gap-3 align-items-center",children:[e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("span",{className:`wb-comments__options__item ${n?"text-muted":""}`,onClick:d,style:{cursor:n?"not-allowed":"pointer"},children:e.jsx(He,{})}),e.jsx("span",{className:`wb-comments__options__item ${x?"text-muted":""}`,onClick:E,style:{cursor:x?"not-allowed":"pointer"},children:e.jsx(Ue,{})}),e.jsxs("div",{children:[e.jsxs("b",{className:"me-1",children:[s.index,"."]}),e.jsx(X,{to:"/Courses/Editor/"+h+"/Lesson/"+s.id,children:s.title})]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("span",{className:"wb-comments__options__item",onClick:v,children:e.jsx($e,{})}),e.jsx("span",{className:"wb-comments__options__item",onClick:p,children:e.jsx(xe,{})})]})]})},hs=[/^https?:\/\/.+/i],Pe=({nodeId:s,mock:h,onAnswered:t,onContinue:u,onEnter:g})=>{const[n,x]=r.useState(null),[v,p]=r.useState([]),[d,E]=r.useState(""),[m,o]=r.useState(null),{sendJsonRequest:y}=W();r.useEffect(()=>{p([]),E(""),o(null),_()},[s]);const _=async()=>{const A=await y("/Courses/GetLessonNode","POST",{nodeId:s,mock:h});A&&A.lessonNode&&(x(A.lessonNode),g(s))},q=A=>{m===null&&p([A])},b=A=>{if(m!==null)return;let P=[...v];P.includes(A)?P=P.filter(z=>z!==A):P.push(A),p(P)},j=A=>{E(A)},l=async()=>{if(!n)return;let A={nodeId:n.id,mock:h};n.type===2||n.type===3?A.answers=n.answers.map(z=>({id:z.id,correct:v.includes(z.id)})):n.type===4&&(A.correctAnswer=d);const P=await y("/Courses/SolveNode","POST",A);P&&P.success&&(o(P.data.correct),t(n.id,P.data.correct))},M=()=>{p([]),o(null)},L=()=>{n&&u(n.id)},B=A=>v.includes(A)?m===null?"selected":m?"selected correct":"selected incorrect":"initial";let R=e.jsx(e.Fragment,{});if(n){const A=()=>n.answers.map((P,z)=>e.jsx("div",{className:`wb-courses-lesson-answer p-2 mt-3 ${B(P.id)}`,role:"button",onClick:()=>{n.type===2?q(P.id):b(P.id)},children:e.jsx("div",{className:"card-body",children:P.text})},z));R=e.jsxs("div",{className:"h-100 d-flex flex-column",children:[e.jsxs("div",{className:"wb-courses-lesson-node-question p-2 flex-grow-1",children:[e.jsx(es,{content:n.text,allowedUrls:hs}),n.type===2||n.type===3?A():n.type===4?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(Q,{className:"wb-courses-lesson-answer p-2"+(m===null?"":m?" correct":" incorrect"),style:{width:"120px"},value:d,readOnly:m!==null,onChange:P=>j(P.target.value)})}):null]}),e.jsx("div",{className:"text-center bg-light p-3",children:n.type==1?e.jsx(w,{variant:"success",onClick:L,children:"Continue"}):e.jsx(e.Fragment,{children:m===!0?e.jsx(w,{variant:"success",onClick:L,children:"Continue"}):m===!1?e.jsx(w,{variant:"danger",onClick:M,children:"Try Again"}):e.jsx(w,{variant:"primary",onClick:l,disabled:n.type===4&&d.trim()===""||(n.type===2||n.type===3)&&v.length===0,children:"Check"})})})]})}return R},js=({nodeId:s,nodeCount:h,onDelete:t,onChangeIndex:u})=>{const{sendJsonRequest:g}=W(),[n,x]=r.useState(null),[v,p]=r.useState(""),[d,E]=r.useState(0),[m,o]=r.useState([]),[y,_]=r.useState(""),[q,b]=r.useState(!1),[j,l]=r.useState(["",""]),[M,L]=r.useState(!1),[B,R]=r.useState(!0);r.useEffect(()=>{A(),l(["",""])},[s]),r.useEffect(()=>{d==2&&o(c=>{const C=[...c];let N=!1;for(let F=0;F<C.length;++F)C[F].correct&&(N?C[F].correct=!1:N=!0);return!N&&C.length>0&&(C[0].correct=!0),C})},[d]);const A=async()=>{L(!0);const c=await g("/CourseEditor/GetLessonNode","POST",{nodeId:s});c&&c.lessonNode&&(x(c.lessonNode),E(c.lessonNode.type),p(c.lessonNode.text??""),_(c.lessonNode.correctAnswer??""),o(c.lessonNode.answers)),L(!1)},P=async()=>{if(!n)return;L(!0);const c=await g("/CourseEditor/DeleteLessonNode","DELETE",{nodeId:n.id});c&&c.success&&(I(),t(s)),L(!1)},z=()=>n&&(d!=n.type||v.trim()!=n.text||y!=n.correctAnswer||m.length!=n.answers.length||!n.answers.every(c=>{const C=m.find(N=>N.id==c.id);return C&&C.text==c.text&&C.correct==c.correct})),V=c=>{if(d==2||d==3){if(m.length<2)return c&&l(["danger","Question cannot have less than 2 answers"]),!1;if(m.length>4)return c&&l(["danger","Question cannot have more than 4 answers"]),!1}else if(d==4&&y.length==0)return c&&l(["danger","Correct answer cannot be empty"]),!1;return!0},G=async c=>{if(!n||!V(c))return!1;const C=await g("/CourseEditor/EditLessonNode","PUT",{nodeId:n.id,type:d,text:v,correctAnswer:y,answers:m});return C&&C.success?(x(N=>N?{...N,type:C.data.type,text:C.data.text,correctAnswer:C.data.correctAnswer,answers:C.data.answers}:null),o(C.data.answers),c&&l(["success","Lessson node was saved successfully."]),!0):(c&&l(["danger",C==null?void 0:C.error[0].message]),!1)},S=async c=>{c.preventDefault(),L(!0),await G(!0),L(!1)},I=()=>{b(!1)},i=(c,C)=>{o(N=>{const F=[...N];return F[c].text=C,F})},f=(c,C,N)=>{o(F=>{const H=[...F];if(N&&C)for(let ne=0;ne<H.length;++ne)F[ne].correct=ne==c;else H[c].correct=C;return H})},T=c=>{o(C=>C.filter((N,F)=>c!=F))},a=c=>{o(C=>[...C,{text:"",correct:C.length==0&&c}])},k=async c=>{if(!n)return;if(L(!0),z()?await G(!0):V(!0)){const N=await g("/CourseEditor/ChangeLessonNodeIndex","POST",{nodeId:n.id,newIndex:c});N&&N.success?(x(F=>F?{...F,index:N.data.index}:null),u(n.id,c),l(["success","Node index changed successfully."])):l(["danger",N==null?void 0:N.error[0].message])}L(!1)},J=c=>{R(c=="write")},Z=()=>{const c=[{name:"Text block",value:1},{name:"Singlechoice question",value:2},{name:"Multichoice question",value:3},{name:"Text question",value:4}];let C=e.jsx(e.Fragment,{});switch(d){case 2:C=e.jsxs(U,{children:[e.jsx($,{children:"Answers"}),m.map((N,F)=>e.jsxs("div",{className:"d-flex gap-3 align-items-center mb-2",children:[e.jsx(Q,{value:N.text,onChange:H=>i(F,H.target.value),placeholder:`Answer ${F+1}`,required:!0}),e.jsx(fe,{name:"answer-correct",type:"radio",label:"Correct",id:"answer-correct-input-"+F,checked:N.correct,onChange:H=>f(F,H.target.checked,!0)}),e.jsx("span",{className:"wb-comments__options__item",onClick:()=>T(F),children:e.jsx(xe,{})})]},F)),e.jsx("div",{children:e.jsxs(w,{size:"sm",className:"mt-2",onClick:()=>a(!0),disabled:m.length>=4,children:[e.jsx(me,{className:"me-1"})," Add answer"]})})]});break;case 3:C=e.jsxs(U,{children:[e.jsx($,{children:"Answers"}),m.map((N,F)=>e.jsxs("div",{className:"d-flex gap-3 align-items-center mb-2",children:[e.jsx(Q,{value:N.text,onChange:H=>i(F,H.target.value),placeholder:`Answer ${F+1}`,required:!0,maxLength:120}),e.jsx(fe,{name:"answer-correct",type:"checkbox",label:"Correct",id:"answer-correct-input-"+F,checked:N.correct,onChange:H=>f(F,H.target.checked,!1)}),e.jsx("span",{className:"wb-comments__options__item",onClick:()=>T(F),children:e.jsx(xe,{})})]},F)),e.jsx("div",{children:e.jsxs(w,{size:"sm",className:"mt-2",onClick:()=>a(!1),disabled:m.length>=4,children:[e.jsx(me,{className:"me-1"})," Add answer"]})})]});break;case 4:C=e.jsxs(U,{children:[e.jsx($,{children:"Correct answer"}),e.jsx(Q,{value:y,onChange:N=>_(N.target.value),required:!0,maxLength:60})]});break}return n!==null&&e.jsx("div",{className:"mt-2",children:e.jsxs(ae,{onSubmit:S,children:[e.jsxs(U,{children:[e.jsx($,{children:"Type"}),e.jsx(Ge,{value:d,onChange:N=>E(Number(N.target.value)),required:!0,children:c.map(N=>e.jsx("option",{value:N.value,children:N.name},N.value))})]}),e.jsxs(U,{children:[e.jsx($,{children:"Text"}),e.jsx(ss,{text:v,setText:p,maxCharacters:2e3,row:10,placeHolder:"Enter Description",onModeChange:J,customPreview:e.jsx("div",{className:"d-flex flex-column",style:{minHeight:"368px"},children:e.jsx("div",{className:"flex-grow-1 border border-2 rounded",children:e.jsx(Pe,{nodeId:s,mock:!0,onAnswered:()=>{},onContinue:()=>{},onEnter:()=>{}})})}),isPost:!1})]}),B&&C,e.jsxs("div",{className:"d-sm-flex justify-content-between mt-4",children:[e.jsxs("div",{className:"d-flex gap-2 justify-content-end",children:[e.jsx(w,{size:"sm",disabled:M||n.index<=1,onClick:()=>k(n.index-1),children:"Move left"}),e.jsx(w,{size:"sm",disabled:M||n.index>=h,onClick:()=>k(n.index+1),children:"Move right"})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-end mt-2 mt-sm-0",children:[e.jsx(w,{size:"sm",disabled:M,variant:"secondary",type:"button",onClick:()=>b(!0),children:"Delete"}),e.jsx(w,{size:"sm",disabled:M,type:"submit",children:"Save"})]})]})]})})};return n!==null&&e.jsxs(e.Fragment,{children:[e.jsxs(D,{show:q,onHide:I,centered:!0,children:[e.jsx(D.Header,{closeButton:!0,children:e.jsx(D.Title,{children:"Are you sure?"})}),e.jsx(D.Body,{children:"Lesson node will be permanently deleted."}),e.jsxs(D.Footer,{children:[e.jsx(w,{variant:"secondary",onClick:I,children:"Cancel"}),e.jsx(w,{variant:"danger",onClick:P,children:"Delete"})]})]}),j[1]&&e.jsx(Ve,{variant:j[0],onClose:()=>l(["",""]),dismissible:!0,children:j[1]}),Z()]})},fs=({lessonId:s})=>{const{sendJsonRequest:h}=W(),[t,u]=r.useState(null),[g,n]=r.useState(null),[x,v]=Se(),[p,d]=r.useState(!1),{courseId:E}=te(),m=je();r.useEffect(()=>{o()},[s]),r.useEffect(()=>{if(t&&x.has("slide")){const j=t.nodes.find(l=>l.index==Number(x.get("slide")));j&&n(j.id)}},[t==null?void 0:t.id]);const o=async()=>{d(!0);const j=await h("/CourseEditor/GetLesson","POST",{lessonId:s});j&&j.lesson&&u(j.lesson),d(!1)},y=async()=>{const j=await h("/CourseEditor/CreateLessonNode","POST",{lessonId:s});j&&j.lessonNode&&(u(l=>l?{...l,nodeCount:l.nodeCount+1,nodes:[...l.nodes,{id:j.lessonNode.id,index:j.lessonNode.index,type:j.lessonNode.type,unlocked:!0}]}:null),n(j.lessonNode.id))},_=j=>{n(null),u(l=>{if(!l)return null;let M=[],L=!1;for(let B=0;B<l.nodes.length;++B){const R=l.nodes[B];if(R.id===j){L=!0;continue}L&&--R.index,M.push(R)}return{...l,nodeCount:M.length,nodes:M}})},q=(j,l)=>{u(M=>{if(!M)return null;let L=[...M.nodes];const B=L.find(R=>R.id==j);if(B){const R=B.index;L[l-1].index=R,L[R-1].index=l,L[R-1]=L[l-1],L[l-1]=B,x.set("slide",l.toString()),v(x,{replace:!0})}return{...M,nodes:L}})},b=j=>{if(!t)return;n(j);const l=t.nodes.find(M=>M.id==j);l&&(x.set("slide",l.index.toString()),v(x,{replace:!0}))};return t!==null?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-2",children:[e.jsx("h4",{children:t.title}),e.jsxs("div",{className:"d-flex justify-content-between my-3",children:[e.jsx(ts,{size:"sm",children:t.nodes.map((j,l)=>e.jsx(ns,{id:`current-lesson-input-${j.index}`,type:"radio",variant:"outline-primary",name:"current-lesson",value:j.id,checked:g===j.id,onChange:M=>b(M.currentTarget.value),size:"sm",children:j.index},l))}),e.jsx(w,{size:"sm",onClick:y,children:e.jsx(me,{})})]}),g!==null&&e.jsx(js,{nodeId:g,nodeCount:t.nodeCount,onChangeIndex:q,onDelete:_})]})}):e.jsx("div",{className:"my-5 text-center",children:p?e.jsx(ke,{}):e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:"Lesson could not be loaded"}),e.jsx(w,{size:"sm",onClick:()=>m("/Courses/Editor/"+E),children:"Back to course"})]})})},ye=()=>{const{sendJsonRequest:s}=W(),{courseId:h,lessonId:t}=te(),[u,g]=r.useState(null),[n,x]=r.useState([]),[v,p]=r.useState(!1),[d,E]=r.useState(!1),[m,o]=r.useState(""),[y,_]=r.useState(null),[q,b]=r.useState(!1),[j,l]=r.useState(null);r.useEffect(()=>{M(!0)},[h]);const M=async i=>{p(!0);const f=await s("/CourseEditor/GetCourse","POST",{courseId:h,includeLessons:i});f&&f.course&&(g(f.course),x(f.course.lessons)),p(!1)},L=(i,f)=>{o(i),E(!0),_(f)},B=()=>{E(!1),o("")},R=async()=>{p(!0);const i=await s("/CourseEditor/CreateLesson","POST",{courseId:u.id,title:m});i&&i.lesson?(x(f=>[...f,{...i.lesson}]),B(),l({type:"success",message:"Lesson created successfully"})):l({type:"error",message:i==null?void 0:i.error[0].message}),p(!1)},A=async()=>{p(!0);const i=n.find(T=>T.id===y);if(!i)return;const f=await s("/CourseEditor/EditLesson","PUT",{lessonId:y,title:m,index:i.index});f&&f.success?(x(T=>{let a=[...T];for(let k=0;k<a.length;++k)a[k].id===y&&(a[k].title=f.data.title);return a}),B(),l({type:"success",message:"Lesson edited successfully"})):l({type:"error",message:f==null?void 0:f.error[0].message}),p(!1)},P=async()=>{p(!0);const i=await s("/CourseEditor/DeleteLesson","DELETE",{lessonId:y});i&&i.success?(S(),x(f=>{let T=[],a=!1;for(let k=0;k<f.length;++k){const J=f[k];if(J.id===y){a=!0;continue}a&&--J.index,T.push(J)}return T}),l({type:"success",message:"Lesson deleted successfully"})):l({type:"error",message:i==null?void 0:i.error[0].message}),p(!1)},z=async(i,f)=>{p(!0);const T=await s("/CourseEditor/ChangeLessonIndex","POST",{lessonId:i,newIndex:f});T&&T.success?(x(a=>{const k=[...a],J=k.findIndex(c=>c.id===i);if(J===-1)return k;const Z=k.findIndex(c=>c.index===f);return Z===-1||([k[J].index,k[Z].index]=[k[Z].index,k[J].index],k.sort((c,C)=>c.index-C.index)),k}),l({type:"success",message:"Lesson index changed successfully"})):l({type:"error",message:T==null?void 0:T.error[0].message}),p(!1)},V=(i,f)=>{L(f,i)},G=i=>{_(i),b(!0)},S=()=>{b(!1)},I=()=>{const i=n.find(T=>T.id===t);if(!i)return e.jsx(e.Fragment,{});const f=ie(i.title,20);return e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"›"}),e.jsx("span",{children:f})]})};return u!==null?e.jsxs(e.Fragment,{children:[e.jsx(rs,{notification:j,onClose:()=>l(null)}),e.jsxs(D,{show:q,onHide:S,centered:!0,children:[e.jsx(D.Header,{closeButton:!0,children:e.jsx(D.Title,{children:"Are you sure?"})}),e.jsx(D.Body,{children:"Lesson will be permanently deleted."}),e.jsxs(D.Footer,{children:[e.jsx(w,{variant:"secondary",onClick:S,children:"Cancel"}),e.jsx(w,{variant:"danger",onClick:P,children:"Delete"})]})]}),e.jsxs("div",{className:"d-flex gap-2 py-2",children:[e.jsx(X,{to:"/Courses/Editor",children:"Course Editor"}),e.jsx("span",{children:"›"}),t!==null?e.jsxs(e.Fragment,{children:[e.jsx(X,{to:"/Courses/Editor/"+u.id,children:ie(u.title,20)}),I()]}):e.jsx("span",{children:ie(u.title,20)})]}),e.jsx("div",{className:"mb-3",children:e.jsx("h3",{className:"wb-courses-course__title",style:{wordBreak:"break-word"},children:u.title})}),e.jsx("div",{hidden:!d,className:"mb-2 border bg-white rounded p-2",children:e.jsxs(ae,{children:[e.jsx("h4",{children:y===null?"New lesson":"Edit lesson"}),e.jsxs(U,{children:[e.jsx($,{children:"Title"}),e.jsx(Q,{type:"text",placeholder:"Enter lesson title",maxLength:60,value:m,onChange:i=>o(i.target.value)})]}),e.jsxs("div",{className:"d-flex justify-content-end mt-2",children:[e.jsx(w,{size:"sm",variant:"secondary",disabled:v,onClick:()=>B(),children:"Cancel"}),y===null?e.jsx(w,{size:"sm",variant:"primary",className:"ms-2",onClick:R,disabled:v||m.length===0,children:"Create"}):e.jsx(w,{size:"sm",variant:"primary",className:"ms-2",onClick:A,disabled:v,children:"Save"})]})]})}),t?e.jsx(fs,{lessonId:t}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(w,{className:"ms-2 btn btn-primary btn-sm",onClick:()=>L("",null),children:"Create Lesson"})}),e.jsx("div",{className:"mt-3",children:n.map(i=>e.jsx("div",{className:"mt-2",children:e.jsx(ms,{lesson:i,courseId:u.id,onDelete:G,onEdit:V,onChangeIndex:z,isFirst:i.index===1,isLast:i.index===n.length})},i.index))})]})]}):e.jsx("div",{className:"my-5 text-center",children:v?e.jsx(ke,{}):e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:"Course could not be loaded"}),e.jsx(X,{to:"/Courses/Editor",children:"Back"})]})})},gs=()=>{var G;const{lessonId:s,courseCode:h}=te(),[t,u]=r.useState(null),[g,n]=r.useState(0),{sendJsonRequest:x}=W(),v=je(),p=Je(),[d,E]=Se(),[m,o]=r.useState(!1),[y,_]=r.useState({section:"Courses",params:{lessonId:s}}),[q,b]=r.useState(0),[j,l]=r.useState(null);r.useEffect(()=>{s&&(M(),_({section:"Courses",params:{lessonId:s}}))},[s]),r.useEffect(()=>{d.has("slide")&&n(Number(d.get("slide")))},[d]),r.useEffect(()=>{p.state&&p.state.postId&&(P(),l({id:p.state.postId,isReply:p.state.isReply}))},[p]),r.useEffect(()=>{if(t&&!d.has("slide")){const S=t.nodes.filter(I=>I.unlocked).sort((I,i)=>i.index-I.index);S.length&&(d.set("slide",S[0].index.toString()),E(d,{replace:!0}))}},[t]);const M=async()=>{const S=await x("/Courses/GetLesson","POST",{lessonId:s});S&&S.lesson&&(u(S.lesson),b(S.lesson.comments))},L=(S,I)=>{t&&I&&(d.set("slide",S.toString()),E(d,{replace:!0}))},B=S=>{if(!t)return;const I=t.nodes.find(i=>i.id==S);I&&(I.index<t.nodeCount?(d.set("slide",(I.index+1).toString()),E(d,{replace:!0})):V())},R=S=>{if(!t)return;const I=t.nodes.find(i=>i.id==S);I&&I.type==1&&u(i=>{if(!i)return null;const f=i.nodes;for(let T=0;T<f.length;++T)f[T].index==I.index+1&&(f[T].unlocked=!0);return{...i,nodes:f}})},A=(S,I)=>{if(!t)return;const i=t.nodes.find(f=>f.id==S);i&&I&&u(f=>{if(!f)return null;const T=f.nodes;for(let a=0;a<T.length;++a)T[a].index==i.index+1&&(T[a].unlocked=!0);return{...f,nodes:T}})},P=()=>{s&&o(!0)},z=()=>{o(!1)},V=()=>{v("/Courses/"+h)};return e.jsx("div",{className:"wb-courses-lesson-container d-flex flex-column",children:t&&e.jsxs(e.Fragment,{children:[e.jsxs(oe,{show:m,onHide:z,placement:"end",children:[e.jsx(oe.Header,{closeButton:!0,children:e.jsxs(oe.Title,{children:[q," Comments"]})}),e.jsx(oe.Body,{className:"d-flex flex-column",style:{height:"calc(100% - 62px)"},children:e.jsx(os,{findPost:j,options:y,setCommentCount:b})})]}),e.jsxs("div",{className:"d-flex justify-content-between p-2",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(w,{variant:"link",className:"text-secondary",onClick:V,children:e.jsx(Qe,{})}),e.jsx("span",{className:"text-secondary",style:{fontSize:"24px",fontWeight:"bold"},children:t.title})]}),e.jsxs("div",{className:"d-flex align-items-center gap-1",children:[e.jsx("span",{className:"small text-secondary",children:q}),e.jsx(w,{variant:"link",className:"text-secondary",onClick:P,children:e.jsx(We,{})})]})]}),e.jsx("div",{className:"wb-courses-lesson-main",children:e.jsx(le,{variant:"pills",className:"flex-row overflow-auto my-3 row-gap-1",children:t.nodes.map(S=>{const I=S.index===g,i=S.type===1?e.jsx(Ye,{}):e.jsx(Ke,{});return e.jsx(le.Item,{children:e.jsx(le.Link,{className:"wb-courses-lesson-arrow-pill "+(S.unlocked?I?"bg-warning text-dark":"bg-primary text-light":"bg-secondary text-light"),onClick:()=>L(S.index,S.unlocked),disabled:!S.unlocked,children:i})},S.id)})})}),e.jsx("div",{className:"flex-grow-1 mt-2",children:g!=0&&e.jsx(Pe,{nodeId:(G=t.nodes.find(S=>S.index==g))==null?void 0:G.id,mock:!1,onContinue:B,onAnswered:A,onEnter:R})})]})})},Te=({courseId:s})=>{const{sendJsonRequest:h}=W(),t=je(),[u,g]=r.useState(!1),[n,x]=r.useState(""),[v,p]=r.useState(""),[d,E]=r.useState(""),[m,o]=r.useState(!1),[y,_]=r.useState(),[q,b]=r.useState(""),[j,l]=r.useState(!1),[M,L]=r.useState(null),[B,R]=r.useState(null),[A,P]=r.useState({});r.useEffect(()=>{s&&z()},[s]);const z=async()=>{g(!0);const a=await h("/CourseEditor/GetCourse","POST",{courseId:s});a&&a.course&&(x(a.course.code),p(a.course.title),E(a.course.description),o(a.course.visible),L(a.course.coverImage)),g(!1)},V=async a=>{a.preventDefault(),g(!0),s?await S():await G(),g(!1)},G=async()=>{_(void 0);const a=await h("/CourseEditor/CreateCourse","POST",{code:n,title:v,description:d,visible:m});a&&a.course?t("/Courses/Editor"):_(a.error)},S=async()=>{_(void 0),b("");const a=await h("/CourseEditor/EditCourse","PUT",{courseId:s,title:v,code:n,description:d,visible:m});a&&a.success?b("Course edited successfully"):_(a.error)},I=()=>{l(!1)},i=async()=>{g(!0);const a=await h("/CourseEditor/DeleteCourse","DELETE",{courseId:s});a&&a.success?(I(),t("/Courses/Editor")):_(a!=null&&a.error?a.error.message:a.message),g(!1)},f=async a=>{a.preventDefault(),P({}),g(!0);const k=await h("/CourseEditor/UploadCourseCoverImage","POST",{courseId:s,coverImage:B},{},!0);k&&k.success?(L(k.data.coverImage),P({message:"Course cover image updated successfully"})):P({errors:k==null?void 0:k.error}),g(!1)},T=a=>{const k=a.target.files;k&&R(k[0])};return e.jsxs(e.Fragment,{children:[e.jsxs(D,{show:j,onHide:I,centered:!0,children:[e.jsx(D.Header,{closeButton:!0,children:e.jsx(D.Title,{children:"Are you sure?"})}),e.jsx(D.Body,{children:"Course will be permanently deleted."}),e.jsxs(D.Footer,{children:[e.jsx(w,{variant:"secondary",onClick:I,children:"Cancel"}),e.jsx(w,{variant:"danger",onClick:i,children:"Delete"})]})]}),e.jsxs("div",{className:"row",children:[s!==null&&e.jsxs("div",{className:"col-12 col-md-4",children:[e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx("div",{className:"rounded-circle",children:e.jsx("img",{className:"wb-courses-course__cover-image",src:M?"/uploads/courses/"+M:"/resources/images/logoicon.svg",alt:"Cover image"})})}),e.jsxs(ae,{onSubmit:f,children:[e.jsx(ge,{errors:A.errors,message:A.message}),e.jsxs(U,{children:[e.jsx($,{children:"Cover image"}),e.jsx(Q,{size:"sm",type:"file",required:!0,onChange:T,accept:"image/png"})]}),e.jsx("div",{className:"d-flex justify-content-end mt-2",children:e.jsx(w,{size:"sm",className:"ms-2",variant:"primary",type:"submit",disabled:u,children:"Upload"})})]})]}),e.jsx("div",{className:"col-12 col-md-8",children:e.jsxs(ae,{onSubmit:V,children:[e.jsx(ge,{errors:y,message:q}),e.jsxs(U,{children:[e.jsx($,{children:"Course title"}),e.jsx(Q,{type:"text",required:!0,value:v,onChange:a=>p(a.target.value)})]}),e.jsxs(U,{children:[e.jsx($,{children:"Course code"}),e.jsx(Q,{type:"text",required:!0,value:n,onChange:a=>x(a.target.value)})]}),e.jsxs(U,{children:[e.jsx($,{children:"Course description"}),e.jsx(Q,{as:"textarea",rows:8,maxLength:1e3,required:!0,value:d,onChange:a=>E(a.target.value)})]}),e.jsxs(U,{className:"d-flex align-items-center mt-2 gap-2",children:[e.jsx($,{children:"Is visible"}),e.jsx(is,{value:m,onChange:a=>o(a.target.checked)})]}),e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx(se.LinkContainer,{to:"/Courses/Editor",children:e.jsx(w,{size:"sm",type:"button",variant:"secondary",disabled:u,children:"Cancel"})}),s?e.jsxs(e.Fragment,{children:[e.jsx(w,{size:"sm",variant:"secondary",className:"ms-2",type:"button",onClick:()=>l(!0),disabled:u,children:"Delete"}),e.jsx(w,{size:"sm",variant:"primary",className:"ms-2",type:"submit",disabled:u,children:"Save changes"})]}):e.jsx(e.Fragment,{children:e.jsx(w,{size:"sm",className:"ms-2",variant:"primary",type:"submit",disabled:u,children:"Create course"})})]})]})})]})]})},ps=()=>{const{courseId:s}=te();return e.jsx(Te,{courseId:s})};const Ms=()=>e.jsxs(Xe,{children:[e.jsx(O,{element:e.jsx(ce,{Header:e.jsx(de,{variant:"light"}),Footer:e.jsx(ue,{})}),children:e.jsx(O,{element:e.jsx(pe,{allowedRoles:["Admin","Creator"]}),children:e.jsxs(O,{path:"Editor",children:[e.jsx(O,{index:!0,element:e.jsx(ee,{MainPage:e.jsx(xs,{})})}),e.jsx(O,{path:"New",element:e.jsx(ee,{MainPage:e.jsx(Te,{courseId:null})})}),e.jsx(O,{path:"Edit/:courseId",element:e.jsx(ee,{MainPage:e.jsx(ps,{})})}),e.jsxs(O,{path:":courseId",children:[e.jsx(O,{index:!0,element:e.jsx(ee,{MainPage:e.jsx(ye,{})})}),e.jsx(O,{path:"Lesson/:lessonId",element:e.jsx(ee,{MainPage:e.jsx(ye,{})})})]})]})})}),e.jsx(O,{element:e.jsx(ce,{Header:e.jsx(de,{variant:"light"}),Footer:e.jsx(ue,{})}),children:e.jsx(O,{index:!0,element:e.jsx(ds,{})})}),e.jsx(O,{element:e.jsx(pe,{allowedRoles:Ze}),children:e.jsxs(O,{path:":courseCode",children:[e.jsx(O,{element:e.jsx(ce,{Header:e.jsx(de,{variant:"light"}),Footer:e.jsx(ue,{})}),children:e.jsx(O,{index:!0,element:e.jsx(us,{})})}),e.jsx(O,{path:"Lesson/:lessonId",element:e.jsx(gs,{})})]})})]});export{Ms as default};
