import{R as _e,g as ae,f as oe,r,d as le,j as e,h as Re,u as Te,e as Ve,i as ie}from"./index-b2f3d98e.js";import{D as ce,P as de}from"./DateUtils-6b83375c.js";import{P as Ee}from"./react-bootstrap-pagination-control.esm-59f727af.js";import{e as Le,c as Ue}from"./index.esm-4a619d62.js";import{F as Me,a as ue,b as Qe}from"./index.esm-cb18ecd9.js";import{P as me}from"./PostAttachment-84505555.js";import{P as xe}from"./ProfileAvatar-4b9caa46.js";import{M as fe}from"./MarkdownRenderer-0f98c67a.js";import{a as he}from"./discussAllowedUrls-4f3044c5.js";import{r as Oe}from"./index-19ddc0d1.js";import{D as y,E as ze}from"./EllipsisDropdownToggle-ab206b50.js";import{W as Be}from"./InputTags-66a0d8a7.js";import{t as We}from"./StringUtils-91be14c5.js";import{P as Ge}from"./PageTitle-83c92925.js";import{P as Ye}from"./PostTextareaControl-1be45863.js";import{R as He}from"./ReactionsList-cdc0f7ea.js";import{Q as Je}from"./QuestionPlaceholder-73174a39.js";import{M as D}from"./Modal-d6b02714.js";import{B as v}from"./Button-a8db19a8.js";import{A as qe}from"./Alert-f0171b20.js";import{F as re,a as Ke,b as Xe}from"./Form-4647d33b.js";import"./ThemeProvider-c318c21f.js";import"./Anchor-1fe32030.js";import"./iconBase-7a454df3.js";import"./useMergedRefs-f5c2a768.js";import"./index-11ee592c.js";import"./DataKey-e12315fd.js";import"./import-c49ebc7f.js";import"./useWindow-763af26a.js";import"./NavContext-f8abb837.js";import"./InputGroupContext-66571c02.js";import"./NavbarContext-864acb8f.js";import"./createWithBsPrefix-c6deafcc.js";import"./Badge-d192c51b.js";import"./FormControl-a036e454.js";import"./UserSearch-78852d36.js";import"./Nav-131532f4.js";import"./Col-1c3a04d0.js";import"./AbstractModalHeader-f9d4f376.js";import"./CloseButton-439f23fc.js";import"./divWithClassName-9b80bbe4.js";const ne=_e.forwardRef(({answer:a,acceptedAnswer:u,toggleAcceptedAnswer:h,isQuestionOwner:o,showEditAnswer:t,newlyCreatedAnswer:p,onShowVoters:P},m)=>{const{sendJsonRequest:j}=ae(),{userInfo:l}=oe(),[F,I]=r.useState(a.isUpvoted),[S,A]=r.useState(a.votes),g=(l==null?void 0:l.id)===a.userId,_=le(),w=async()=>{if(!l){_("/Users/Login");return}const d=F?0:1;(await j("/Discussion/VotePost","POST",{postId:a.id,vote:d})).vote===d&&(I(d===1),A(S+(d?1:-1)))},C=()=>{P(a.id)};let R=u===a.id,x=p===a.id?"beige":"white",b=e.jsxs("div",{className:"gap-2 d-flex flex-column border-bottom border-2 py-2",style:{background:x},children:[e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("div",{className:"d-flex flex-column align-items-center",children:[(o||R)&&e.jsx("div",{onClick:()=>h(a.id),className:"wb-discuss-reply__actions__best-answer-button"+(R?" text-success":" text-secondary"),style:{cursor:o?"pointer":"default"},children:e.jsx(Me,{})}),e.jsxs("div",{className:"wb-discuss-voting mt-2",children:[e.jsx("span",{onClick:w,className:"wb-discuss-voting__button"+(F?" text-black":""),children:e.jsx(ue,{})}),e.jsx("b",{className:"wb-discuss-voting__button text-black",onClick:C,children:S})]})]}),e.jsxs("div",{className:"flex-grow-1 d-flex flex-column gap-2",style:{minWidth:0},children:[e.jsx("div",{className:"d-flex justify-content-end align-items-center",children:g&&e.jsx("span",{style:{cursor:"pointer"},onClick:()=>t(a.id),children:e.jsx(Le,{})})}),e.jsx("div",{className:"wb-discuss-question__description",children:e.jsx(fe,{content:a.message,allowedUrls:he})}),e.jsx("div",{className:"mt-2",children:a.attachments.map(d=>e.jsx("div",{className:"mt-1",children:e.jsx(me,{data:d})},d.id))})]})]}),e.jsx("div",{className:"d-flex justify-content-end align-items-end mt-1",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("small",{className:"text-secondary",children:ce.format(new Date(a.date))})}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(de,{userId:a.userId,userName:a.userName})})]}),e.jsx("div",{className:"ms-2 wb-p-follow-item__avatar",children:e.jsx(xe,{size:32,avatarImage:a.userAvatar})})]})})]});return m?e.jsx("div",{ref:m,children:b}):e.jsx("div",{children:b})}),Ms=()=>{const{sendJsonRequest:a}=ae(),{questionId:u}=Re(),h=le(),{userInfo:o}=oe(),[t,p]=r.useState(null),[P,m]=r.useState(["",""]),[j,l]=r.useState(!1),[F,I]=r.useState(!1),[S,A]=r.useState(1),g=10,[_,w]=r.useState([]),C=r.useRef(null),[R,L]=r.useState(!1),[x,b]=r.useState(""),U=4096,[d,M]=r.useState(null),[k,pe]=r.useState(null),[je,Y]=r.useState(!1),[H,Q]=r.useState(1),[c,J]=Te(),T=Ve(),[N,O]=r.useState(null),z=r.useRef(null),B=r.useRef(null),[ge,ve]=r.useState(""),[we,W]=r.useState(!1),[be,q]=r.useState({parentId:""});Ge(ge),r.useEffect(()=>{t&&ve(t.title+" | Webler Codes")},[t]),r.useEffect(()=>{T.state&&T.state.postId&&(O(T.state.postId),Q(2))},[T]),r.useEffect(()=>{c.has("page")&&A(Number(c.get("page"))),c.has("filter")&&Q(Number(c.get("filter")))},[]),r.useEffect(()=>{ye()},[u]),r.useEffect(()=>{Pe()},[c,u,N]),r.useEffect(()=>{K(1)},[H]);const K=s=>{s!==S&&(O(null),c.set("page",s.toString()),J(c,{replace:!0}),A(s))},Ne=s=>{const i=Number(s.target.selectedOptions[0].value);c.set("filter",i.toString()),J(c,{replace:!0}),Q(i),O(null)},ye=async()=>{l(!0);const s=await a("/Discussion/GetQuestion","POST",{questionId:u});s&&s.question&&p(s.question),l(!1)},Pe=async()=>{I(!0);const s=c.has("page")?Number(c.get("page")):1,i=c.has("filter")?Number(c.get("filter")):1,n=await a("/Discussion/GetQuestionReplies","POST",{questionId:u,index:(s-1)*g,count:g,filter:i,findPostId:N});if(n&&n.posts){w(n.posts),N&&(A(n.posts.length>0?Math.floor(n.posts[0].index/g)+1:1),setTimeout(()=>{z.current&&z.current.scrollIntoView({behavior:"smooth",block:"end"})}));let f=null;for(let E=0;E<n.posts.length;++E)if(n.posts[E].isAccepted){f=n.posts[E].id;break}M(f)}I(!1)},Se=async()=>{if(!o){h("/Users/Login");return}l(!0);const s=await a("/Discussion/CreateReply","POST",{message:x,questionId:u});s&&s.post?(w(i=>[{...s.post,userName:o.name,userAvatar:o.avatarImage},...i]),p(i=>i?{...i,answers:i.answers+1}:null),V(),m(["success","Your answer was posted successfully"])):m(["danger",s!=null&&s.error?s.error.message:s.message]),l(!1)},Ae=async()=>{if(!o){h("/Users/Login");return}l(!0);const s=await a("/Discussion/EditReply","PUT",{message:x,replyId:k});s&&s.success?(w(i=>{const n=[...i];for(let f=0;f<n.length;++f)n[f].id===k&&(n[f].message=s.data.message,n[f].attachments=s.data.attachments);return n}),V(),m(["success","Your answer was updated successfully"])):m(["danger",s!=null&&s.error?s.error.message:s.message]),l(!1)},X=(s,i)=>{o?(m(["",""]),L(!0),b(s),pe(i),setTimeout(()=>{C.current&&C.current.scrollIntoView({behavior:"smooth",block:"end"}),B.current&&B.current.focus()})):h("/Users/Login")},V=()=>{L(!1),b("")},Z=async s=>{const i=await a("/Discussion/ToggleAcceptedAnswer","POST",{postId:s,accepted:s!==d});i&&i.success&&M(s===d?null:s)},$=s=>{const i=_.find(n=>n.id==s);i&&X(i.message,s)},G=()=>{Y(!1)},Ce=()=>{W(!1)},ke=async()=>{l(!0);const s=await a("/Discussion/DeleteReply","DELETE",{replyId:k});s&&s.success?(G(),V(),w(i=>i.filter(n=>n.id!==k)),p(i=>i?{...i,answers:i.answers-1}:null)):m(["danger",s!=null&&s.error?s.error._message:s.message]),l(!1)},De=async()=>{if(!t)return;if(!o){h("/Users/Login");return}const s=t.isUpvoted?0:1;(await a("/Discussion/VotePost","POST",{postId:u,vote:s})).vote===s&&p(n=>n?{...n,votes:n.votes+(s?1:-1),isUpvoted:s===1}:null)},Fe=async()=>{if(!t)return;if(!o){h("/Users/Login");return}const s=t.isFollowed,i=await a(s?"/Discussion/UnfollowQuestion":"/Discussion/FollowQuestion","POST",{postId:u});i&&i.success&&p(n=>n?{...n,isFollowed:!s}:null)},Ie=()=>{t!=null&&t.id&&(q({parentId:t.id}),W(!0))},ee=s=>{q({parentId:s}),W(!0)};let se=U-x.length,te=[];for(let s=0;s<g;++s)te.push(e.jsx(Je,{},s));return t!==null?e.jsxs(e.Fragment,{children:[e.jsxs(D,{show:je,onHide:G,centered:!0,children:[e.jsx(D.Header,{closeButton:!0,children:e.jsx(D.Title,{children:"Are you sure?"})}),e.jsx(D.Body,{children:"Your answer will be permanently deleted."}),e.jsxs(D.Footer,{children:[e.jsx(v,{variant:"secondary",onClick:G,children:"Cancel"}),e.jsx(v,{variant:"danger",onClick:ke,children:"Delete"})]})]}),e.jsx(He,{title:"Likes",options:be,visible:we,onClose:Ce,showReactions:!0,countPerPage:10}),e.jsxs("div",{className:"d-flex gap-2 py-2",children:[e.jsx(ie,{to:"/Discuss",children:"Q&A"}),e.jsx("span",{children:"â€º"}),e.jsx("span",{children:We(t.title,20)})]}),e.jsxs("div",{className:"mb-3 d-flex flex-column position-relative",children:[e.jsx("div",{className:"wb-discuss-reply__edit-button",children:e.jsxs(y,{drop:"start",children:[e.jsx(y.Toggle,{as:ze}),e.jsxs(y.Menu,{children:[o&&e.jsxs(e.Fragment,{children:[t&&t.userId===o.id&&e.jsx(Oe.LinkContainer,{to:"/Discuss/Edit/"+u,children:e.jsx(y.Item,{children:"Edit"})}),e.jsx(y.Item,{onClick:Fe,children:t.isFollowed?"Unfollow":"Follow"})]}),e.jsx(y.Item,{onClick:()=>{navigator.clipboard.writeText(window.location.href)},children:"Share"})]})]})}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("div",{className:"d-flex flex-column align-items-center",children:[e.jsxs("div",{className:"wb-discuss-voting",children:[e.jsx("span",{onClick:De,className:"wb-discuss-voting__button"+(t.isUpvoted?" text-black":""),children:e.jsx(ue,{})}),e.jsx("b",{className:"wb-discuss-voting__button text-black",onClick:Ie,children:t.votes})]}),e.jsx("div",{children:e.jsx("span",{className:t.isFollowed?"text-warning":"text-secondary",children:e.jsx(Ue,{})})})]}),e.jsxs("div",{className:"flex-grow-1 d-flex flex-column gap-2",style:{minWidth:"0"},children:[e.jsx("h3",{className:"wb-discuss-question__title",children:t.title}),e.jsx("div",{className:"d-flex mb-1 flex-wrap gap-1",children:t.tags.map((s,i)=>e.jsx(Be,{name:s,state:"neutral"},i))}),e.jsx("div",{className:"mt-1 wb-discuss-question__description",children:e.jsx(fe,{content:t.message,allowedUrls:he})}),e.jsx("div",{className:"mt-1",children:t.attachments.map(s=>e.jsx("div",{className:"mt-1",children:e.jsx(me,{data:s})},s.id))})]})]}),e.jsxs("div",{className:"d-flex justify-content-end mt-2 align-items-center gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("small",{children:ce.format(new Date(t.date))})}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(de,{userId:t.userId,userName:t.userName})})]}),e.jsx(xe,{size:32,avatarImage:t.userAvatar})]})]}),P[1]&&e.jsx(qe,{variant:P[0],onClose:()=>m(["",""]),dismissible:!0,children:P[1]}),e.jsx("div",{hidden:!R,className:"mt-2 border bg-white rounded p-2",children:e.jsxs(re,{ref:C,children:[e.jsxs(Ke,{children:[e.jsx(Xe,{children:e.jsx("b",{children:o==null?void 0:o.name})}),e.jsx(Ye,{ref:B,rows:10,placeholder:"Write your reply here...",required:!0,maxLength:U,value:x,setValue:b}),e.jsxs("p",{className:se>0?"text-secondary":"text-danger",children:[se," characters remaining"]})]}),e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx(v,{size:"sm",variant:"secondary",onClick:V,disabled:j,children:"Cancel"}),k===null?e.jsx(e.Fragment,{children:e.jsx(v,{size:"sm",variant:"primary",className:"ms-2",onClick:Se,disabled:j||x.length===0,children:"Post"})}):e.jsxs(e.Fragment,{children:[e.jsx(v,{size:"sm",variant:"secondary",className:"ms-2",onClick:()=>Y(!0),disabled:j,children:"Delete"}),e.jsx(v,{size:"sm",variant:"primary",className:"ms-2",onClick:Ae,disabled:j||x.length===0,children:"Save"})]})]})]})}),e.jsx("div",{className:"d-flex",children:e.jsxs("h4",{children:[t.answers," Answers"]})}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs(re.Select,{size:"sm",style:{width:"140px"},value:H,onChange:Ne,children:[e.jsx("option",{value:"1",children:"Sort by: Votes"}),e.jsx("option",{value:"2",children:"Sort by: Date"})]}),e.jsx(v,{size:"sm",variant:"primary",className:"ms-2",onClick:()=>X("",null),children:"Answer"})]}),e.jsx("div",{className:"mt-2 d-flex flex-column w-100",children:F?te:_.map(s=>N===s.id?e.jsx(ne,{ref:z,answer:s,acceptedAnswer:d,toggleAcceptedAnswer:Z,isQuestionOwner:(o==null?void 0:o.id)===t.userId,showEditAnswer:$,newlyCreatedAnswer:N,onShowVoters:ee},s.id):e.jsx(ne,{answer:s,acceptedAnswer:d,toggleAcceptedAnswer:Z,isQuestionOwner:(o==null?void 0:o.id)===t.userId,showEditAnswer:$,newlyCreatedAnswer:N,onShowVoters:ee},s.id))}),e.jsx("div",{className:"my-3",children:e.jsx(Ee,{page:S,between:3,total:t.answers,limit:g,changePage:K,ellipsis:1})})]}):!j&&e.jsxs("div",{className:"d-flex h-100 flex-column align-items-center justify-content-center text-center",children:[e.jsx("h4",{children:e.jsx(Qe,{})}),e.jsx("h5",{children:"Question not found"}),e.jsx("div",{children:e.jsx(ie,{to:"/Discuss",children:"Go back"})})]})};export{Ms as default};
