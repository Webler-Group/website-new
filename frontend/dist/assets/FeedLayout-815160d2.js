import{r as a,j as e,f as Z,d as W,R as Ne,g as G,e as we,L as me,h as Se}from"./index-c193dc40.js";import{P as ue}from"./ProfileAvatar-bb4fbb5b.js";import{M as he}from"./MarkdownRenderer-9f88d60a.js";import{J as ye,K as Ee,L as xe,h as Ce,M as te,N as Fe,v as ke,d as ie,I as oe,O as Pe,s as Re,r as Me,w as Le}from"./index.esm-70a25315.js";import{N as fe}from"./NotificationToast-3324b982.js";import{r as U,a as be,R as Te}from"./ReactionsList-03ae5412.js";import{P as ge,D as Ie}from"./DateUtils-1d735d3b.js";import{P as De}from"./PostTextareaControl-56ef6c20.js";import{l as le,c as pe,m as Oe,n as $e,k as re,g as Ae,o as _e,b as ze}from"./index.esm-54ce3fd1.js";import{a as je}from"./discussAllowedUrls-4f3044c5.js";import{P as Ve}from"./PostAttachment-f38b6576.js";import{D as q,E as qe}from"./EllipsisDropdownToggle-442591de.js";import{C as Ue}from"./CommentList-207d2f83.js";import{B as ae}from"./Button-b8db3fe4.js";import{O as Q}from"./Offcanvas-1b3442fd.js";import{M as ce}from"./Modal-261a0993.js";import{F as He}from"./FormControl-cc700203.js";import{d as Be}from"./Form-19731f2f.js";import"./useMergedRefs-2ac3001c.js";import"./iconBase-11f2ad60.js";import"./UserSearch-025b778c.js";import"./ThemeProvider-ec2a0fef.js";import"./Nav-f0da06cf.js";import"./DataKey-e12315fd.js";import"./NavContext-d33865e3.js";import"./Anchor-22c8f756.js";import"./index-99a242c6.js";import"./index-3b750fb9.js";import"./import-955c954a.js";import"./useWindow-822d8a97.js";import"./InputGroupContext-b5682b53.js";import"./NavbarContext-9c60203e.js";import"./createWithBsPrefix-6b62a92d.js";import"./AbstractModalHeader-72c903dd.js";import"./CloseButton-710dc957.js";import"./divWithClassName-a88e1404.js";import"./Col-6d72f785.js";var ve=(s=>(s[s.QUESTION=1]="QUESTION",s[s.ANSWER=2]="ANSWER",s[s.CODE_COMMENT=3]="CODE_COMMENT",s[s.FEED=4]="FEED",s[s.SHARED_FEED=5]="SHARED_FEED",s[s.FEED_COMMENT=6]="FEED_COMMENT",s))(ve||{});const Je=({feedId:s,onShare:l,onClose:o})=>{const[r,p]=a.useState(""),[h,c]=a.useState(!1),[b,f]=a.useState(!1),[S]=a.useState([]),x=window.location.origin+`/feed/${s}`,j=async()=>{c(!0),await l(r,S),o(),c(!1)},I=async()=>{await navigator.clipboard.writeText(x),f(!0),setTimeout(()=>f(!1),2e3)};return e.jsx("div",{className:"modal fade show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered modal-fullscreen-sm-down",children:e.jsxs("div",{className:"modal-content shadow-lg rounded-3 border-0",children:[e.jsxs("div",{className:"modal-header border-bottom",children:[e.jsxs("h5",{className:"modal-title d-flex align-items-center gap-2",children:[e.jsx(ye,{})," Share Post"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:o})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Add your thoughts"}),e.jsx("textarea",{value:r,onChange:D=>p(D.target.value),placeholder:"What do you think about this post?",rows:4,className:"form-control",disabled:h})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between p-2 border rounded bg-light",children:[e.jsx("span",{className:"text-truncate me-2",style:{maxWidth:"75%"},children:x}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-secondary d-flex align-items-center gap-1",onClick:I,children:[e.jsx(Ee,{}),b?"Copied!":"Copy"]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:o,disabled:h,children:"Cancel"}),e.jsxs("button",{type:"button",className:"btn btn-primary d-flex align-items-center gap-2",onClick:j,disabled:h,children:[e.jsx(xe,{}),h?"Sharing...":"Share Post"]})]})]})})})},We=({onReactionChange:s,currentState:l})=>{const[o,r]=a.useState(l),[p,h]=a.useState(!1),[c,b]=a.useState(null),f=a.useRef(null),S=a.useRef(null),{userInfo:x}=Z(),j=W();a.useEffect(()=>{r(l)},[l]);const I=v=>{const y=v==o?null:v;r(y),s(y),h(!1)},D=()=>{x!=null&&x.id||j("/Users/Login"),h(!p)},P=()=>{x!=null&&x.id||j("/Users/Login");const v=window.setTimeout(()=>{h(!0)},500);b(v)},O=()=>{c&&(clearTimeout(c),b(null))},R=()=>{S.current&&clearTimeout(S.current)};return a.useEffect(()=>{const v=y=>{f.current&&!f.current.contains(y.target)&&h(!1)};return document.addEventListener("mousedown",v),document.addEventListener("touchstart",v),()=>{document.removeEventListener("mousedown",v),document.removeEventListener("touchstart",v),S.current&&clearTimeout(S.current),c&&clearTimeout(c)}},[c]),e.jsxs("div",{ref:f,className:"position-relative d-flex align-items-center",children:[e.jsxs("span",{className:"wb-reaction-picker-btn",onClick:D,onTouchStart:P,onTouchEnd:O,style:{color:o?U[o].color:"#65676b"},children:[e.jsx("span",{children:o?U[o].emoji:e.jsx(Ce,{})}),e.jsx("span",{children:o?U[o].label:U[be.LIKE].label})]}),p&&e.jsx("div",{className:"position-absolute bg-white border rounded-pill shadow-lg d-flex align-items-center gap-1",style:{bottom:"100%",left:"0",marginBottom:"8px",zIndex:1e3,animation:"slideUp 0.2s ease-out",whiteSpace:"nowrap",borderColor:"#dadde1"},onMouseEnter:R,onTouchStart:v=>v.stopPropagation(),children:Object.entries(U).map(([v,y])=>{const L=Number(v);return e.jsx("button",{type:"button",className:"btn p-1 border-0 d-flex align-items-center justify-content-center",style:{width:"32px",height:"32px",borderRadius:"50%",backgroundColor:o==L?`${y.color}20`:"transparent"},onClick:i=>{i.stopPropagation(),I(L)},title:y.label,children:y.emoji},L)})})]})},Ye=({feed:s,onSave:l,onClose:o})=>{const[r,p]=a.useState(s.message),[h,c]=a.useState(!1),[b,f]=a.useState("write"),S=async()=>{r.trim()&&(c(!0),await l(r.trim()),c(!1))};return e.jsx("div",{className:"modal fade show d-block",style:{backgroundColor:"rgba(0,0,0,0.6)",backdropFilter:"blur(4px)",zIndex:1050},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered modal-fullscreen-sm-down",children:e.jsxs("div",{className:"modal-content border-0 shadow-lg rounded-4 overflow-hidden",children:[e.jsxs("div",{className:"modal-header bg-light border-0",children:[e.jsxs("h5",{className:"modal-title d-flex align-items-center gap-2 fw-semibold text-dark mb-0",children:[e.jsx(le,{}),"Edit Post"]}),e.jsx("button",{type:"button",className:"btn btn-sm btn-icon btn-outline-secondary","aria-label":"Close",onClick:o,disabled:h,children:e.jsx(pe,{})})]}),e.jsx("div",{className:"modal-body bg-white",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-medium text-muted",children:"Post Content"}),e.jsxs("div",{className:"d-flex gap-2 mb-2",children:[e.jsxs("button",{type:"button",className:`btn btn-sm ${b==="write"?"btn-primary":"btn-outline-primary"}`,onClick:()=>f("write"),children:[e.jsx(Oe,{className:"me-1"})," Write"]}),e.jsxs("button",{type:"button",className:`btn btn-sm ${b==="preview"?"btn-primary":"btn-outline-primary"}`,onClick:()=>f("preview"),children:[e.jsx($e,{className:"me-1"})," Preview"]})]}),b==="write"&&e.jsx(De,{value:r,setValue:p,placeholder:"What's on your mind?",rows:6}),b==="preview"&&e.jsx("div",{className:"wb-feed-content__message",children:e.jsx(he,{content:r,allowedUrls:je})})]})}),e.jsxs("div",{className:"modal-footer border-0 d-flex justify-content-end gap-2",children:[e.jsx("button",{onClick:o,className:"btn btn-light px-4 rounded-3 shadow-sm",disabled:h,children:"Cancel"}),e.jsxs("button",{onClick:S,disabled:!r.trim()||h,className:"btn btn-primary px-4 d-inline-flex align-items-center gap-2 rounded-3 shadow-sm",children:[e.jsx(le,{}),h?"Saving...":"Save Changes"]})]})]})})})},Ke=({onConfirm:s,onClose:l})=>{const[o,r]=a.useState(!1),p=async()=>{r(!0),await s(),r(!1)};return e.jsx("div",{className:"modal fade show d-block",style:{backgroundColor:"rgba(0,0,0,0.6)",backdropFilter:"blur(4px)",zIndex:1050},onClick:l,children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content border-0 shadow-lg rounded-4 overflow-hidden",children:[e.jsxs("div",{className:"modal-header bg-light border-0",children:[e.jsxs("h5",{className:"modal-title d-flex align-items-center gap-2 fw-semibold text-danger mb-0",children:[e.jsx(re,{}),"Delete Post"]}),e.jsx("button",{type:"button",className:"btn btn-sm btn-icon btn-outline-secondary","aria-label":"Close",onClick:l,disabled:o,children:e.jsx(pe,{})})]}),e.jsx("div",{className:"modal-body bg-white",children:e.jsx("p",{className:"text-muted mb-0",children:"Are you sure you want to delete this post? This action cannot be undone."})}),e.jsxs("div",{className:"modal-footer border-0 d-flex justify-content-end gap-2",children:[e.jsx("button",{onClick:l,className:"btn btn-light px-4 rounded-3 shadow-sm",disabled:o,children:"Cancel"}),e.jsxs("button",{onClick:p,disabled:o,className:"btn btn-danger px-4 d-inline-flex align-items-center gap-2 rounded-3 shadow-sm",children:[e.jsx(re,{}),o?"Deleting...":"Delete"]})]})]})})})},Qe=({originalPost:s})=>{const l=W();return e.jsxs("div",{onClick:()=>l(`/feed/${s.id}`),className:"mt-2 border bg-light p-2 text-dark text-decoration-none mb-2",style:{cursor:"pointer"},children:[e.jsxs("div",{className:"d-flex gap-2 align-items-center mb-2",children:[e.jsx(ue,{size:28,avatarImage:s.userAvatarImage}),e.jsx(ge,{userId:s.userId,userName:s.userName}),e.jsx("span",{children:"wrote"})]}),e.jsx("div",{className:"wb-feed-content__message",children:e.jsx("i",{children:s.message})})]})},X=Ne.forwardRef(({feed:s,onCommentsClick:l,onShowFullContent:o,onShowUserReactions:r,onGeneralUpdate:p,commentCount:h,onDelete:c,onTogglePin:b,showFullContent:f=!0},S)=>{var K,t,d,N;const{sendJsonRequest:x}=G(),{userInfo:j}=Z(),I=j==null?void 0:j.id,[D,P]=a.useState(!1),[O,R]=a.useState(!1),[v,y]=a.useState(!1),L=W(),i=((K=j==null?void 0:j.roles)==null?void 0:K.includes("Admin"))||((t=j==null?void 0:j.roles)==null?void 0:t.includes("Moderator")),[w,u]=a.useState(null),[g,T]=a.useState(!1),M=a.useRef(null),F=a.useCallback((n,m)=>{u({type:n,message:m}),setTimeout(()=>u(null),3e3)},[]);a.useLayoutEffect(()=>{if(M.current&&!f){const{scrollHeight:n,clientHeight:m}=M.current;T(n>m)}else T(!1)},[s.message,s.attachments,f]);const z=async()=>{const n=await x("/Feed/PinFeed","POST",{feedId:s.id,pinned:!s.isPinned});n&&n.success?(b==null||b({...s,isPinned:n.data.isPinned}),F("success",n.data.isPinned?"Post pinned":"Post unpinned")):F("error",n==null?void 0:n.error[0].message)},$=async n=>{const m=await x("/Feed/EditFeed","PUT",{feedId:s.id,message:n});m&&m.success?(p==null||p({...s,message:m.data.message,attachments:m.data.attachments}),F("success","Post updated successfully"),P(!1)):F("error",m==null?void 0:m.error[0].message)},k=async()=>{const n=await x("/Feed/DeleteFeed","DELETE",{feedId:s.id});n&&n.success?(c(s),L("/feed"),F("success","Post deleted successfully")):F("error",n==null?void 0:n.error[0].message)},Y=async n=>{const m=await x("/Feed/VotePost","POST",{postId:s.id,vote:n!=null,reaction:n});if(m&&m.success){const A=s.votes+(s.isUpvoted!=m.vote?m.vote?1:-1:0);let C=[...s.topReactions];const ne=s.reaction;if(ne){for(let E=0;E<C.length;++E)if(C[E].reaction==ne){C[E].count==1?C.splice(E,1):--C[E].count;break}}if(n){let E=-1;for(let J=0;J<C.length;++J)if(C[J].reaction==n){++C[J].count,E=J;break}if(E==-1)C.push({reaction:n,count:1});else for(;E>0&&!(C[E-1].count>C[E].count);)[C[E],C[E-1]]=[C[E-1],C[E]],--E}m.vote===1?s.isUpvoted&&s.reaction===n?(s.totalReactions-=1,s.isUpvoted=!1):s.isUpvoted||(s.totalReactions+=1,s.isUpvoted=!0):s.isUpvoted&&(s.totalReactions-=1,s.isUpvoted=!1),p==null||p({...s,reaction:n,votes:A,isUpvoted:m.vote,topReactions:C,totalReactions:s.totalReactions})}else F("error",m==null?void 0:m.error[0].message)},ee=async(n,m)=>{const A=await x("/Feed/ShareFeed","POST",{feedId:s.id,message:n,tags:m});A&&A.success?(L(`/feed/${A.feed.id}`),R(!1),F("success","Post shared successfully")):F("error",A==null?void 0:A.error[0].message)},se=()=>{l==null||l(s.id)},H=()=>{r==null||r(s.id)},B=()=>{o==null||o(s.id)},_=s.userId===I,V=e.jsx(e.Fragment,{children:e.jsxs("article",{className:"wb-feed-item",children:[e.jsx(fe,{notification:w,onClose:()=>u(null)}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"d-flex align-items-start gap-2 flex-grow-1",children:[e.jsx(ue,{size:36,avatarImage:s.userAvatarImage}),e.jsxs("div",{className:"d-flex flex-column",children:[e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(ge,{userId:s.userId,userName:s.userName}),s.isPinned&&e.jsxs("span",{className:"badge bg-warning bg-opacity-10 text-warning border border-warning border-opacity-25",children:[e.jsx(te,{className:"me-1"}),"Pinned"]})]}),e.jsxs("div",{className:"text-muted d-flex align-items-center gap-1 small",children:[e.jsx(Fe,{}),e.jsx("time",{dateTime:s.date,children:Ie.format2(new Date(s.date))})]})]})]}),(_||i)&&e.jsxs(q,{children:[e.jsx(q.Toggle,{as:qe}),e.jsxs(q.Menu,{style:{width:"200px"},children:[_&&e.jsx(e.Fragment,{children:e.jsxs(q.Item,{className:"dropdown-item d-flex align-items-center gap-2",onClick:()=>P(!0),children:[e.jsx(Ae,{})," Edit Post"]})}),(_||i)&&e.jsx(e.Fragment,{children:e.jsxs(q.Item,{className:"dropdown-item d-flex align-items-center gap-2 text-danger",onClick:()=>y(!0),children:[e.jsx(ke,{})," Delete Post"]})}),i&&e.jsxs(q.Item,{className:"dropdown-item d-flex align-items-center gap-2 text-warning",onClick:()=>z(),children:[e.jsx(te,{})," ",s.isPinned?"Unpin Post":"Pin Post"]})]})]})]}),s.type===ve.SHARED_FEED&&(s.originalPost?e.jsx(Qe,{originalPost:s.originalPost}):e.jsxs("div",{className:"wb-feed-shared-post-unavailable",children:[e.jsx(ie,{className:"mb-3 opacity-50"}),e.jsx("p",{className:"mb-0 fw-medium text-muted",children:"This shared post is no longer available"})]})),e.jsxs("div",{ref:M,className:`mt-2 wb-feed-content position-relative ${f?"":"truncated"} ${!f&&g?"clickable":""}`,onClick:!f&&g?B:void 0,children:[e.jsx("div",{className:"wb-feed-content__message",style:!f&&g?{pointerEvents:"none"}:{},children:e.jsx(he,{content:s.message,allowedUrls:je})}),((d=s.attachments)==null?void 0:d.length)>0&&e.jsx("div",{className:"mt-2 rounded text-dark text-decoration-none",children:((N=s.attachments)==null?void 0:N.length)>0&&e.jsx("div",{className:"mt-2 rounded text-dark text-decoration-none",children:e.jsx("div",{className:"d-flex flex-column gap-2",children:s.attachments.map(n=>e.jsx("div",{className:"mt-1",children:e.jsx(Ve,{data:n})},n.id))})})}),!f&&g&&e.jsx("div",{className:"fade-overlay"})]}),e.jsxs("div",{className:"wb-feed-reactions mt-2 d-flex gap-1 align-items-center",onClick:H,children:[e.jsx("div",{className:"d-flex",children:s.topReactions.map((n,m)=>e.jsx("span",{className:"bg-white rounded-circle d-flex align-items-center justify-content-center",style:{marginLeft:m===0?"0":"-6px",width:"18px",height:"18px",zIndex:(s.topReactions.length-m).toString()},children:U[n.reaction??be.LIKE].emoji},`${n.reaction}-${m}`))}),s.totalReactions>0&&e.jsx("span",{className:"text-muted",children:s.totalReactions})]}),e.jsxs("div",{className:"mt-3 d-flex align-items-center justify-content-between",children:[e.jsx(We,{onReactionChange:Y,currentState:s.reaction}),e.jsxs("span",{className:"wb-feed-action-btn",onClick:se,children:[e.jsx(ie,{}),e.jsx("span",{children:h}),e.jsx("span",{children:h===1?"comment":"comments"})]}),e.jsxs("span",{className:"wb-feed-action-btn",onClick:()=>{if(!j){L("/Users/Login");return}R(!0)},children:[e.jsx(xe,{}),e.jsx("span",{children:s.shares||0}),e.jsx("span",{children:s.shares===1?"share":"shares"})]})]}),D&&e.jsx(Ye,{feed:s,onSave:$,onClose:()=>P(!1)}),v&&e.jsx(Ke,{onConfirm:k,onClose:()=>y(!1)}),O&&e.jsx(Je,{feedId:s.id,onShare:ee,onClose:()=>R(!1)})]})});return S?e.jsx("div",{ref:S,children:V}):V});X.displayName="FeedItem";const Xe=({feedId:s,onGeneralUpdate:l,onShowUserReactions:o,onDelete:r,onTogglePin:p})=>{const h=W(),[c,b]=a.useState(null),[f,S]=a.useState(!0),[x,j]=a.useState(null),{sendJsonRequest:I}=G(),[D,P]=a.useState(null),[O,R]=a.useState(null),[v,y]=a.useState(!1),[L,i]=a.useState({section:"Feed",params:{feedId:s}}),[w,u]=a.useState(0),g=we();a.useEffect(()=>{g.state?((g.state.postId||g.state.comments)&&T(),g.state.postId&&R({id:g.state.postId,isReply:g.state.isReply})):M()},[g]),a.useEffect(()=>{if(!s)return;(async()=>{try{S(!0);const k=await I("/Feed/GetFeed","POST",{feedId:s});if(!k.success)throw new Error(k.message);b(k.feed),u(k.feed.answers),l(k.feed)}catch(k){j("Failed to load feed"),console.error("Error fetching feed:",k),F("error",String(k))}finally{S(!1)}})(),i({section:"Feed",params:{feedId:s}})},[s]),a.useEffect(()=>{c&&l({...c,answers:w})},[w]);const T=()=>{s&&y(!0)},M=()=>{y(!1)},F=($,k)=>{P({type:$,message:k}),setTimeout(()=>P(null),5e3)},z=$=>{b($),l($)};return f?e.jsx(e.Fragment,{children:e.jsx("div",{className:"loading-container",children:e.jsx(me,{})})}):x||!c?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"error-container",children:[e.jsx(fe,{notification:D,onClose:()=>P(null)}),e.jsxs("div",{className:"error-content",children:[e.jsx("h4",{className:"error-title",children:x||"Feed not found"}),e.jsxs(ae,{onClick:()=>h("/feed"),variant:"primary",children:[e.jsx(oe,{}),"Back to Feed"]})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(Q,{show:v,onHide:M,backdropClassName:"wb-feed-comment-modal__backdrop",style:{zIndex:1060},placement:"end",children:[e.jsx(Q.Header,{closeButton:!0,children:e.jsxs(Q.Title,{children:[w," Comments"]})}),e.jsx(Q.Body,{className:"d-flex flex-column",style:{height:"calc(100% - 62px)"},children:e.jsx(Ue,{findPost:O,options:L,setCommentCount:u})})]}),e.jsx("div",{className:"wb-feed-details-container p-2",children:e.jsxs("div",{className:"wb-feed-main-content",children:[e.jsxs("button",{onClick:()=>h("/feed"),className:"wb-feed-back-button",children:[e.jsx(oe,{size:16}),"Back to Feed"]}),e.jsx(X,{feed:c,onCommentsClick:T,onGeneralUpdate:z,commentCount:w,onShowUserReactions:o,onDelete:r,onTogglePin:p})]})})]})},Ze=(s,l,o)=>{const[r,p]=a.useState({page:0}),[h,c]=a.useState([]),[b,f]=a.useState(!1),[S,x]=a.useState([]),[j,I]=a.useState(!1),[D,P]=a.useState(0),{sendJsonRequest:O}=G(),{userInfo:R}=Z();a.useEffect(()=>{r.page!=0&&v()},[r]),a.useEffect(()=>{p({page:1})},[s,l]);const v=async()=>{x([]),f(!0);let w=r.page!=1;w||c([]);const u=await O("/Feed","POST",{page:r.page,count:o,filter:s,searchQuery:l,userId:R==null?void 0:R.id});u&&u.success?(c(w?g=>{const T=u.feeds.filter(M=>!g.some(F=>F.id===M.id));return[...g,...T]}:()=>u.feeds),P(u.count),I(u.feeds.length===o)):x(u.error),f(!1)};return{state:r,results:h,loading:b,error:S,hasNextPage:j,totalCount:D,setState:p,editPost:w=>{c(u=>u.map(g=>g.id==w.id?w:g))},deletePost:w=>{c(u=>u.filter(g=>g.id!=w))},addPost:w=>{c(u=>[w,...u])}}},de=[{value:1,label:"Latest",requireLogin:!1},{value:2,label:"My Posts",requireLogin:!0},{value:3,label:"Following",requireLogin:!0},{value:4,label:"Trending (24h)",requireLogin:!1},{value:5,label:"Most Popular",requireLogin:!1},{value:6,label:"Most Shared",requireLogin:!1}],Ge=()=>{const{feedId:s}=Se(),l=W(),{userInfo:o}=Z(),[r,p]=a.useState("");let h=1;const c=localStorage.getItem("feed");if(c){const t=JSON.parse(c),d=de.find(N=>N.value===t.filter);d&&(!d.requireLogin||o!=null)&&(h=t.filter)}const[b,f]=a.useState(h),[S,x]=a.useState(!0),[j,I]=a.useState(r),[D,P]=a.useState(!1),[O,R]=a.useState({parentId:""}),[v,y]=a.useState(!0),{sendJsonRequest:L}=G(),i=Ze(b,r,10),[w,u]=a.useState([]),[g,T]=a.useState(!1),M=a.useRef(),F=a.useCallback(t=>{i.loading||(M.current&&M.current.disconnect(),M.current=new IntersectionObserver(d=>{d[0].isIntersecting&&i.hasNextPage&&i.results.length>0&&i.setState(N=>({page:N.page+1}))}),t&&M.current.observe(t))},[i.loading,i.hasNextPage,i.results]);a.useEffect(()=>{let t=window.scrollY;const d=()=>{const N=window.scrollY;N<60?x(!0):N>t?x(!1):N<t&&x(!0),t=N};return addEventListener("scroll",d,{passive:!0}),()=>removeEventListener("scroll",d)},[]),a.useEffect(()=>{z()},[]),a.useEffect(()=>{i.state.page===1&&setTimeout(()=>{scrollTo({top:0,behavior:"instant"})})},[i.state]),a.useEffect(()=>{localStorage.setItem("feed",JSON.stringify({filter:b}))},[b]);const z=async()=>{T(!0);const t=await L("/Feed","POST",{page:1,count:10,filter:7,searchQuery:""});t&&t.feeds&&u(()=>t.feeds),T(!1)},$=t=>{const d=Number(t.target.selectedOptions[0].value);f(d)},k=()=>{p(()=>j)},Y=async()=>{T(!0),i.setState({page:1}),await z(),T(!1)},ee=()=>{l("/Feed")},se=()=>{P(!1)},H=t=>{t.isPinned?u(d=>d.map(N=>N.id==t.id?t:N)):i.editPost(t)},B=t=>{t.isPinned?u(d=>d.filter(N=>N.id!=t.id)):i.deletePost(t.id)},_=t=>{R({parentId:t}),P(!0)},V=t=>{t.isPinned?(i.deletePost(t.id),u(d=>[t,...d]),setTimeout(()=>{scrollTo({top:0,behavior:"smooth"})})):(u(d=>d.filter(N=>N.id!==t.id)),i.addPost(t))},K=()=>{y(t=>!t)};return e.jsxs(e.Fragment,{children:[e.jsx(ce,{show:s!=null,onHide:ee,fullscreen:!0,backdrop:"static",children:e.jsx(ce.Body,{className:"p-0",children:e.jsx(Xe,{feedId:s,onGeneralUpdate:H,onShowUserReactions:_,onDelete:B,onTogglePin:V})})}),e.jsx(Te,{title:"Reactions",options:O,visible:D,onClose:se,showReactions:!0,countPerPage:10}),e.jsxs("div",{className:"wb-feed-list-container",children:[e.jsx("div",{className:`p-2 wb-feed-list-header ${S?"wb-feed-visible":"wb-feed-hidden"}`,children:e.jsxs("div",{className:"d-flex flex-column gap-2",children:[e.jsx("h2",{className:"h4 fw-bold text-dark mb-0",children:"Feed"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(He,{type:"search",size:"sm",placeholder:"Search...",value:j,onChange:t=>I(t.target.value),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),k())}}),e.jsx(ae,{size:"sm",onClick:k,children:"Search"})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between gap-2",children:[e.jsx(Be,{size:"sm",style:{width:"140px"},value:b,onChange:$,children:de.filter(t=>t.requireLogin==!1||o!=null).map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsxs("button",{onClick:Y,disabled:i.loading||g,className:"btn btn-light rounded-pill shadow-sm d-flex align-items-center justify-content-center gap-2 wb-feed-control-button",children:[e.jsx(Pe,{className:"text-muted"}),e.jsx("span",{className:"d-none d-sm-inline",children:"Refresh"})]})]})]})}),g?e.jsx("div",{className:"d-flex justify-content-center mt-5 text-center",children:e.jsx(me,{})}):e.jsxs(e.Fragment,{children:[w.length>0&&e.jsxs("div",{className:"px-2 wb-pinned-feeds-section bg-light",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2",children:[e.jsxs("h6",{className:"text-warning mb-0",children:[e.jsx(te,{})," Pinned Posts"]}),e.jsx(ae,{size:"sm",variant:"link",className:"text-secondary",onClick:K,children:v?e.jsx(Re,{}):e.jsx(Me,{})})]}),v&&e.jsx("div",{children:w.map(t=>e.jsx("div",{className:"border-2 border-bottom mt-3",children:e.jsx(X,{feed:t,onGeneralUpdate:H,onCommentsClick:d=>l(`/feed/${d}`,{state:{comments:!0}}),commentCount:t.answers||0,onShowUserReactions:_,onDelete:B,onTogglePin:V,showFullContent:!1,onShowFullContent:d=>l(`/feed/${d}`)})},t.id))})]}),e.jsxs("div",{className:"px-2 wb-feed-items",children:[i.error.length>0&&e.jsxs("div",{className:"alert alert-danger rounded-4 border-0 d-flex align-items-center gap-3",children:[e.jsx(_e,{}),e.jsxs("div",{children:[e.jsx("strong",{children:"Error loading feeds"}),e.jsx("ul",{children:i.error.map((t,d)=>e.jsx("li",{children:t.message},d))}),e.jsx("button",{onClick:Y,className:"btn btn-sm btn-outline-danger mt-2",children:"Try Again"})]})]}),!i.loading&&i.error.length==0&&i.results.length===0&&e.jsxs("div",{className:"text-center py-5",children:[e.jsx(ze,{size:40,className:"opacity-50 mb-3"}),e.jsx("h5",{className:"text-muted",children:"No feeds found"}),e.jsx("p",{className:"text-muted small",children:r?`No results found for "${r}". Try adjusting search or filters.`:"No feeds available at the moment."})]}),e.jsx("div",{children:i.results.map((t,d)=>{const N=d===i.results.length-1;return e.jsx("div",{className:"border-2 border-bottom mt-3",ref:N?F:void 0,children:e.jsx(X,{feed:t,onGeneralUpdate:H,onCommentsClick:n=>l(`/feed/${n}`,{state:{comments:!0}}),commentCount:t.answers||0,onShowUserReactions:_,onDelete:B,onTogglePin:V,showFullContent:!1,onShowFullContent:n=>l(`/feed/${n}`)})},t.id)})}),!i.hasNextPage&&i.results.length>0&&e.jsx("div",{className:"text-center py-4 text-muted small",children:e.jsx("span",{children:"You've reached the end of the feed"})})]})]}),e.jsxs("button",{onClick:()=>l("/feed/new"),className:"wb-feed-new-post-button",title:"Create new post",children:[e.jsx("span",{className:"d-none d-md-inline",children:"New Post"}),e.jsx(Le,{className:"d-md-none",size:24})]})]})]})},$s=()=>e.jsx("div",{className:"wb-feed-layout-container",children:e.jsx(Ge,{})});export{$s as default};
