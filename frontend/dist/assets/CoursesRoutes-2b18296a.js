import{r as n,W as Te,j as e,X as ye,Y as Fe,Z as ee,$ as K,a0 as we,a1 as Ae,u as Q,b as Ie,a2 as _e,B as S,M as me,H as te,K as Ne,a3 as X,n as Me,o as Re,C as Y,p as re,a4 as De,a5 as Be,a6 as qe,a7 as Oe,a8 as ze,a9 as He,aa as Ue,v as ue,A as $e,ab as $,ac as V,F as G,ad as je,ae as xe,m as se,af as Ve,ag as be,J as he,L as Se,ah as Ge,ai as oe,w as Je,aj as Qe,N as ae,ak as We,al as Ye,d as fe,O as Ke,Q as H,S as le,U as ce,am as de,V as ge}from"./index-343737ff.js";import{M as B}from"./Modal-88de8eda.js";import{t as ie}from"./StringUtils-91be14c5.js";import{r as Xe}from"./roles-68ed67e6.js";import{M as Ze}from"./MarkdownRenderer-61fba914.js";import{B as es,T as ss}from"./ToggleButton-34241fc2.js";import{N as ts}from"./NotificationToast-79343890.js";import{C as ns}from"./CommentList-93b95c8a.js";import{T as rs}from"./ToggleSwitch-aac3144f.js";import"./UserSearch-d02dba13.js";import"./ReactionsList-cd4a7652.js";const pe=1e3;function os(s,m,t){const u=(s-m)/(t-m)*100;return Math.round(u*pe)/pe}function Ce({min:s,now:m,max:t,label:u,visuallyHidden:v,striped:a,animated:r,className:y,style:f,variant:g,bsPrefix:b,...w},o){return e.jsx("div",{ref:o,...w,role:"progressbar",className:ye(y,`${b}-bar`,{[`bg-${g}`]:g,[`${b}-bar-animated`]:r,[`${b}-bar-striped`]:r||a}),style:{width:`${os(m,s,t)}%`,...f},"aria-valuenow":m,"aria-valuemin":s,"aria-valuemax":t,children:v?e.jsx("span",{className:"visually-hidden",children:u}):u})}const ke=n.forwardRef(({isChild:s=!1,...m},t)=>{const u={min:0,max:100,animated:!1,visuallyHidden:!1,striped:!1,...m};if(u.bsPrefix=Te(u.bsPrefix,"progress"),s)return Ce(u,t);const{min:v,now:a,max:r,label:y,visuallyHidden:f,striped:g,animated:b,bsPrefix:w,variant:o,className:N,children:A,...q}=u;return e.jsx("div",{ref:t,...q,className:ye(N,w),children:A?Fe(A,E=>n.cloneElement(E,{isChild:!0})):Ce({min:v,now:a,max:r,label:y,visuallyHidden:f,striped:g,animated:b,bsPrefix:w,variant:o},t)})});ke.displayName="ProgressBar";const is=ke,Le=({course:s,isEditor:m})=>e.jsx(ee.LinkContainer,{to:m?"/Courses/Editor/"+s.id:"/Courses/"+s.code,children:e.jsxs("div",{className:"wb-courses-course-card rounded border p-2 bg-white d-sm-flex gap-3 position-relative",children:[m&&e.jsx("div",{className:"wb-courses-course__edit-button",children:e.jsxs(K,{drop:"start",children:[e.jsx(K.Toggle,{as:we}),e.jsx(K.Menu,{children:e.jsx(ee.LinkContainer,{to:"/Courses/Editor/Edit/"+s.id,children:e.jsx(K.Item,{children:"Edit"})})})]})}),e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx("div",{className:"rounded-circle",children:e.jsx("img",{className:"wb-courses-course__cover-image",src:s.coverImage?"/uploads/courses/"+s.coverImage:"/resources/images/logoicon.svg",alt:"Cover image"})})}),e.jsxs("div",{className:"d-flex flex-column align-items-sm-start align-items-center",children:[e.jsxs("h5",{style:{wordBreak:"break-word"},children:[s.title," ",!s.visible&&e.jsx(Ae,{})]}),e.jsx("p",{className:"wb-courses-course__description",children:s.description})]})]})}),as=({course:s,onRestart:m})=>{const t=async()=>{m(s.id)};return e.jsx(ee.LinkContainer,{to:"/Courses/"+s.code,children:e.jsxs("div",{className:"wb-courses-course-card rounded border p-2 d-sm-flex gap-3 bg-white position-relative",children:[e.jsx("div",{className:"wb-courses-course__edit-button",children:e.jsxs(K,{drop:"start",children:[e.jsx(K.Toggle,{as:we}),e.jsx(K.Menu,{children:e.jsx(K.Item,{onClick:t,children:"Restart"})})]})}),e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx("div",{className:"rounded-circle",children:e.jsx("img",{className:"wb-courses-course__cover-image",src:s.coverImage?"/uploads/courses/"+s.coverImage:"/resources/images/logoicon.svg",alt:"Cover image"})})}),e.jsx("div",{className:"d-flex flex-column align-items-sm-start align-items-center",children:e.jsx("h5",{style:{wordBreak:"break-word"},children:s.title})})]})})},ls=()=>{const{sendJsonRequest:s}=Q(),[m,t]=n.useState([]),[u,v]=n.useState([]),[a,r]=n.useState(!1),{userInfo:y}=Ie(),[f,g]=n.useState(!1),[b,w]=n.useState(null);n.useEffect(()=>{o()},[]);const o=async()=>{r(!0);const E=await s("/Courses","POST",{excludeUserId:y==null?void 0:y.id});if(E&&E.courses&&t(E.courses),y){const z=await s("/Courses/GetUserCourses","POST",{userId:y.id});z&&z.courses&&v(z.courses)}r(!1)},N=()=>{g(!1)},A=async()=>{if(!b)return;const E=await s("/Courses/ResetCourseProgress","POST",{courseId:b});E!=null&&E.success,g(!1)},q=E=>{w(E),g(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(_e,{children:[" ",e.jsx("title",{children:"Courses | Webler Codes"})," ",e.jsx("meta",{name:"description",content:"Learn by doing with Webler’s interactive coding courses. Practice with hands-on lessons, quizzes, and real-world projects at your own pace."})," "]}),e.jsxs(B,{show:f,onHide:N,centered:!0,children:[e.jsx(B.Header,{closeButton:!0,children:e.jsx(B.Title,{children:"Are you sure?"})}),e.jsx(B.Body,{children:"Course progress will be restarted."}),e.jsxs(B.Footer,{children:[e.jsx(S,{variant:"secondary",onClick:N,children:"Cancel"}),e.jsx(S,{variant:"danger",onClick:A,children:"Restart"})]})]}),e.jsx(me,{children:e.jsxs("div",{className:"wb-courses-main p-4",children:[y!==null&&u.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx("h2",{children:"My Courses"})}),e.jsx("div",{className:"my-3",children:u.map(E=>e.jsx("div",{className:"mt-3",children:e.jsx(as,{course:E,onRestart:q})},E.id))})]}),e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx("h2",{children:"Explore our courses"})}),e.jsx("div",{className:"my-3",children:m.length==0?e.jsx("div",{className:"wb-discuss-empty-questions",children:e.jsx("h3",{children:"Nothing to show"})}):m.map(E=>e.jsx("div",{className:"mt-3",children:e.jsx(Le,{course:E,isEditor:!1})},E.id))})]})})]})},cs=()=>{const{courseCode:s}=te(),{sendJsonRequest:m}=Q(),[t,u]=n.useState(null),[v,a]=n.useState(!0),[r,y]=n.useState("Webler Codes");Ne(r),n.useEffect(()=>{f()},[s]);const f=async()=>{a(!0);const o=await m("/Courses/GetCourse","POST",{courseCode:s,includeLessons:!0});o&&o.course&&(u(o.course),y("Courses - "+o.course.title+" | Webler Codes")),a(!1)},g=()=>{if(!t||!t.lessons.length)return 0;const o=t.lessons.filter(N=>N.completed).length;return Math.round(o/t.lessons.length*100)};let w=(()=>{let o=null;if(t){const N=t.lessons.filter(A=>A.unlocked).sort((A,q)=>q.index-A.index);N.length&&(o=N[0])}return o})();return e.jsx(me,{children:e.jsx("div",{className:"wb-courses-main pt-2",children:v?e.jsx("p",{children:"Loading..."}):t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex gap-2 py-2",children:[e.jsx(X,{to:"/Courses",children:"Courses"}),e.jsx("span",{children:"›"}),e.jsx("span",{children:ie(t.title,20)})]}),e.jsx("h3",{children:t.title}),e.jsx("p",{className:"wb-courses-course__description",children:t.description}),w&&e.jsx(Y,{className:"mt-4 shadow-sm",children:e.jsxs(Y.Body,{children:[e.jsx(Y.Title,{children:"Continue your progress"}),e.jsxs(Y.Text,{children:["You can continue with lesson ",e.jsx("strong",{children:w.title}),"."]}),e.jsx(X,{to:`/Courses/${t.code}/Lesson/${w.id}`,children:e.jsx(S,{variant:"primary",children:"Go to Lesson"})})]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{children:"Progress"}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(is,{now:g(),className:"flex-grow-1 me-2"}),e.jsxs("span",{children:[t.lessons.filter(o=>o.completed).length," / ",t.lessons.length]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{children:"Lessons"}),e.jsx(Me,{children:t.lessons.map(o=>{const N=o.unlocked&&!o.completed;return e.jsx(Re,{md:6,lg:4,className:"mb-3",children:e.jsx(Y,{className:`h-100 shadow-sm ${o.unlocked?"":"bg-light text-muted"}`,style:{cursor:o.unlocked?"pointer":"not-allowed"},children:e.jsxs(Y.Body,{children:[e.jsx(Y.Title,{children:o.title}),e.jsxs(Y.Text,{children:["Slides: ",o.nodeCount]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[o.unlocked&&o.completed&&e.jsxs(re,{bg:"success",children:[e.jsx(De,{}),"Completed"]}),N&&e.jsxs(re,{bg:"info",children:[e.jsx(Be,{}),"In Progress"]}),o.unlocked&&!o.completed&&!N&&e.jsxs(re,{bg:"light",text:"dark",children:[e.jsx(qe,{}),"Available"]}),!o.unlocked&&e.jsxs(re,{bg:"secondary",children:[e.jsx(Oe,{}),"Locked"]}),e.jsxs("small",{children:["#",o.index]})]}),o.unlocked&&e.jsx(X,{to:`/Courses/${t.code}/Lesson/${o.id}`,children:e.jsx(S,{size:"sm",variant:"outline-primary",children:"Open"})})]})})},o.id)})})]})]}):e.jsx("p",{children:"Course not found."})})})},Z=({MainPage:s})=>(Ne("Course Editor",!1),e.jsx(me,{children:e.jsx("div",{className:"wb-courses-main pt-2",children:s})})),ds=()=>{const{sendJsonRequest:s}=Q(),[m,t]=n.useState([]),[u,v]=n.useState(!1);n.useEffect(()=>{a()},[]);const a=async()=>{v(!0);const r=await s("/CourseEditor","POST",{});r&&r.courses&&t(r.courses),v(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Course Editor"}),e.jsx("div",{className:"mt-4 d-flex justify-content-end",children:e.jsx(ee.LinkContainer,{to:"/Courses/Editor/New",children:e.jsx(S,{size:"sm",children:"Create course"})})}),e.jsx("div",{className:"my-3",children:m.length==0?e.jsx("div",{className:"wb-discuss-empty-questions",children:e.jsx("h3",{children:"Nothing to show"})}):m.map(r=>e.jsx("div",{className:"mt-3",children:e.jsx(Le,{course:r,isEditor:!0})},r.id))})]})},us=({lesson:s,courseId:m,onEdit:t,onDelete:u,onChangeIndex:v,isFirst:a,isLast:r})=>{const y=()=>{t(s.id,s.title)},f=()=>{u(s.id)},g=()=>{a||v(s.id,s.index-1)},b=()=>{r||v(s.id,s.index+1)};return e.jsxs("div",{className:"border p-2 bg-white d-flex justify-content-between gap-3 align-items-center",children:[e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("span",{className:`wb-comments__options__item ${a?"text-muted":""}`,onClick:g,style:{cursor:a?"not-allowed":"pointer"},children:e.jsx(ze,{})}),e.jsx("span",{className:`wb-comments__options__item ${r?"text-muted":""}`,onClick:b,style:{cursor:r?"not-allowed":"pointer"},children:e.jsx(He,{})}),e.jsxs("div",{children:[e.jsxs("b",{className:"me-1",children:[s.index,"."]}),e.jsx(X,{to:"/Courses/Editor/"+m+"/Lesson/"+s.id,children:s.title})]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("span",{className:"wb-comments__options__item",onClick:y,children:e.jsx(Ue,{})}),e.jsx("span",{className:"wb-comments__options__item",onClick:f,children:e.jsx(ue,{})})]})]})},xs=({nodeId:s,nodeCount:m,onDelete:t,onChangeIndex:u,onPreview:v})=>{const{sendJsonRequest:a}=Q(),[r,y]=n.useState(null),[f,g]=n.useState(""),[b,w]=n.useState(0),[o,N]=n.useState([]),[A,q]=n.useState(""),[E,z]=n.useState(!1),[M,R]=n.useState(["",""]),[O,c]=n.useState(!1);n.useEffect(()=>{L(),R(["",""])},[s]),n.useEffect(()=>{b==2&&N(d=>{const x=[...d];let C=!1;for(let F=0;F<x.length;++F)x[F].correct&&(C?x[F].correct=!1:C=!0);return!C&&x.length>0&&(x[0].correct=!0),x})},[b]);const L=async()=>{c(!0);const d=await a("/CourseEditor/GetLessonNode","POST",{nodeId:s});d&&d.lessonNode&&(y(d.lessonNode),w(d.lessonNode.type),g(d.lessonNode.text??""),q(d.lessonNode.correctAnswer??""),N(d.lessonNode.answers)),c(!1)},p=async()=>{if(!r)return;c(!0);const d=await a("/CourseEditor/DeleteLessonNode","DELETE",{nodeId:r.id});d&&d.success&&(k(),t(s)),c(!1)},h=()=>r&&(b!=r.type||f.trim()!=r.text||A!=r.correctAnswer||o.length!=r.answers.length||!r.answers.every(d=>{const x=o.find(C=>C.id==d.id);return x&&x.text==d.text&&x.correct==d.correct})),_=d=>{if(b==2||b==3){if(o.length<2)return d&&R(["danger","Question cannot have less than 2 answers"]),!1;if(o.length>4)return d&&R(["danger","Question cannot have more than 4 answers"]),!1}else if(b==4&&A.length==0)return d&&R(["danger","Correct answer cannot be empty"]),!1;return!0},D=async d=>{if(!r||!_(d))return!1;const x=await a("/CourseEditor/EditLessonNode","PUT",{nodeId:r.id,type:b,text:f,correctAnswer:A,answers:o});return x&&x.success?(y(C=>C?{...C,type:x.data.type,text:x.data.text,correctAnswer:x.data.correctAnswer,answers:x.data.answers}:null),N(x.data.answers),d&&R(["success","Lessson node was saved successfully."]),!0):(d&&R(["danger",x==null?void 0:x.error[0].message]),!1)},W=async d=>{d.preventDefault(),c(!0),await D(!0),c(!1)},k=()=>{z(!1)},I=(d,x)=>{N(C=>{const F=[...C];return F[d].text=x,F})},i=(d,x,C)=>{N(F=>{const U=[...F];if(C&&x)for(let ne=0;ne<U.length;++ne)F[ne].correct=ne==d;else U[d].correct=x;return U})},j=d=>{N(x=>x.filter((C,F)=>d!=F))},T=d=>{N(x=>[...x,{text:"",correct:x.length==0&&d}])},l=async d=>{if(!r)return;if(c(!0),h()?await D(!0):_(!0)){const C=await a("/CourseEditor/ChangeLessonNodeIndex","POST",{nodeId:r.id,newIndex:d});C&&C.success?(y(F=>F?{...F,index:C.data.index}:null),u(r.id,d),R(["success","Node index changed successfully."])):R(["danger",C==null?void 0:C.error[0].message])}c(!1)},P=async()=>{c(!0);const d=h()?await D(!0):_(!0);c(!1),d&&v(s)},J=()=>{const d=[{name:"Text block",value:1},{name:"Singlechoice question",value:2},{name:"Multichoice question",value:3},{name:"Text question",value:4}];let x=e.jsx(e.Fragment,{});switch(b){case 2:x=e.jsxs($,{children:[e.jsx(V,{children:"Answers"}),o.map((C,F)=>e.jsxs("div",{className:"d-flex gap-3 align-items-center mb-2",children:[e.jsx(G,{value:C.text,onChange:U=>I(F,U.target.value),placeholder:`Answer ${F+1}`,required:!0}),e.jsx(je,{name:"answer-correct",type:"radio",label:"Correct",id:"answer-correct-input-"+F,checked:C.correct,onChange:U=>i(F,U.target.checked,!0)}),e.jsx("span",{className:"wb-comments__options__item",onClick:()=>j(F),children:e.jsx(ue,{})})]},F)),e.jsx("div",{children:e.jsxs(S,{size:"sm",className:"mt-2",onClick:()=>T(!0),disabled:o.length>=4,children:[e.jsx(xe,{className:"me-1"})," Add answer"]})})]});break;case 3:x=e.jsxs($,{children:[e.jsx(V,{children:"Answers"}),o.map((C,F)=>e.jsxs("div",{className:"d-flex gap-3 align-items-center mb-2",children:[e.jsx(G,{value:C.text,onChange:U=>I(F,U.target.value),placeholder:`Answer ${F+1}`,required:!0,maxLength:120}),e.jsx(je,{name:"answer-correct",type:"checkbox",label:"Correct",id:"answer-correct-input-"+F,checked:C.correct,onChange:U=>i(F,U.target.checked,!1)}),e.jsx("span",{className:"wb-comments__options__item",onClick:()=>j(F),children:e.jsx(ue,{})})]},F)),e.jsx("div",{children:e.jsxs(S,{size:"sm",className:"mt-2",onClick:()=>T(!1),disabled:o.length>=4,children:[e.jsx(xe,{className:"me-1"})," Add answer"]})})]});break;case 4:x=e.jsxs($,{children:[e.jsx(V,{children:"Correct answer"}),e.jsx(G,{value:A,onChange:C=>q(C.target.value),required:!0,maxLength:60})]});break}return r!==null&&e.jsx("div",{className:"mt-2",children:e.jsxs(se,{onSubmit:W,children:[e.jsxs($,{children:[e.jsx(V,{children:"Type"}),e.jsx(Ve,{value:b,onChange:C=>w(Number(C.target.value)),required:!0,children:d.map(C=>e.jsx("option",{value:C.value,children:C.name},C.value))})]}),e.jsxs($,{children:[e.jsx(V,{children:"Text"}),e.jsx(G,{value:f,onChange:C=>g(C.target.value),as:"textarea",rows:10,maxLength:2e3,required:!0})]}),x,e.jsxs("div",{className:"d-sm-flex justify-content-between mt-4",children:[e.jsxs("div",{className:"d-flex gap-2 justify-content-end",children:[e.jsx(S,{size:"sm",disabled:O||r.index<=1,onClick:()=>l(r.index-1),children:"Move left"}),e.jsx(S,{size:"sm",disabled:O||r.index>=m,onClick:()=>l(r.index+1),children:"Move right"}),e.jsx(S,{size:"sm",disabled:O,onClick:P,children:"Preview"})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-end mt-2 mt-sm-0",children:[e.jsx(S,{size:"sm",disabled:O,variant:"secondary",type:"button",onClick:()=>z(!0),children:"Delete"}),e.jsx(S,{size:"sm",disabled:O,type:"submit",children:"Save"})]})]})]})})};return r!==null&&e.jsxs(e.Fragment,{children:[e.jsxs(B,{show:E,onHide:k,centered:!0,children:[e.jsx(B.Header,{closeButton:!0,children:e.jsx(B.Title,{children:"Are you sure?"})}),e.jsx(B.Body,{children:"Lesson node will be permanently deleted."}),e.jsxs(B.Footer,{children:[e.jsx(S,{variant:"secondary",onClick:k,children:"Cancel"}),e.jsx(S,{variant:"danger",onClick:p,children:"Delete"})]})]}),M[1]&&e.jsx($e,{variant:M[0],onClose:()=>R(["",""]),dismissible:!0,children:M[1]}),J()]})},ms=[/^https?:\/\/.+/i],Ee=({nodeId:s,mock:m,onAnswered:t,onContinue:u,onEnter:v})=>{const[a,r]=n.useState(null),[y,f]=n.useState([]),[g,b]=n.useState(""),[w,o]=n.useState(null),{sendJsonRequest:N}=Q();n.useEffect(()=>{f([]),b(""),o(null),A()},[s]);const A=async()=>{const p=await N("/Courses/GetLessonNode","POST",{nodeId:s,mock:m});p&&p.lessonNode&&(r(p.lessonNode),v(s))},q=p=>{w===null&&f([p])},E=p=>{if(w!==null)return;let h=[...y];h.includes(p)?h=h.filter(_=>_!==p):h.push(p),f(h)},z=p=>{b(p)},M=async()=>{if(!a)return;let p={nodeId:a.id,mock:m};a.type===2||a.type===3?p.answers=a.answers.map(_=>({id:_.id,correct:y.includes(_.id)})):a.type===4&&(p.correctAnswer=g);const h=await N("/Courses/SolveNode","POST",p);h&&h.success&&(o(h.data.correct),t(a.id,h.data.correct))},R=()=>{f([]),o(null)},O=()=>{a&&u(a.id)},c=p=>y.includes(p)?w===null?"selected":w?"selected correct":"selected incorrect":"initial";let L=e.jsx(e.Fragment,{});if(a){const p=()=>a.answers.map((h,_)=>e.jsx("div",{className:`wb-courses-lesson-answer p-2 mt-3 ${c(h.id)}`,role:"button",onClick:()=>{a.type===2?q(h.id):E(h.id)},children:e.jsx("div",{className:"card-body",children:h.text})},_));L=e.jsxs(se,{className:"h-100 d-flex flex-column",children:[e.jsxs("div",{className:"wb-courses-lesson-node-question p-2 flex-grow-1",children:[e.jsx(Ze,{content:a.text,allowedUrls:ms}),a.type===2||a.type===3?p():a.type===4?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(G,{className:"wb-courses-lesson-answer p-2"+(w===null?"":w?" correct":" incorrect"),style:{width:"120px"},value:g,readOnly:w!==null,onChange:h=>z(h.target.value)})}):null]}),e.jsx("div",{className:"text-center bg-light p-3",children:a.type==1?e.jsx(S,{variant:"success",onClick:O,children:"Continue"}):e.jsx(e.Fragment,{children:w===!0?e.jsx(S,{variant:"success",onClick:O,children:"Continue"}):w===!1?e.jsx(S,{variant:"danger",onClick:R,children:"Try Again"}):e.jsx(S,{variant:"primary",onClick:M,disabled:a.type===4&&g.trim()===""||(a.type===2||a.type===3)&&y.length===0,children:"Check"})})})]})}return L},hs=({lessonId:s})=>{const{sendJsonRequest:m}=Q(),[t,u]=n.useState(null),[v,a]=n.useState(null),[r,y]=be(),[f,g]=n.useState(!1),[b,w]=n.useState(!1),{courseId:o}=te(),N=he();n.useEffect(()=>{A()},[s]),n.useEffect(()=>{if(t&&r.has("slide")){const c=t.nodes.find(L=>L.index==Number(r.get("slide")));c&&a(c.id)}},[t==null?void 0:t.id]);const A=async()=>{w(!0);const c=await m("/CourseEditor/GetLesson","POST",{lessonId:s});c&&c.lesson&&u(c.lesson),w(!1)},q=async()=>{const c=await m("/CourseEditor/CreateLessonNode","POST",{lessonId:s});c&&c.lessonNode&&(u(L=>L?{...L,nodeCount:L.nodeCount+1,nodes:[...L.nodes,{id:c.lessonNode.id,index:c.lessonNode.index,type:c.lessonNode.type,unlocked:!0}]}:null),a(c.lessonNode.id))},E=c=>{a(null),u(L=>{if(!L)return null;let p=[],h=!1;for(let _=0;_<L.nodes.length;++_){const D=L.nodes[_];if(D.id===c){h=!0;continue}h&&--D.index,p.push(D)}return{...L,nodeCount:p.length,nodes:p}})},z=(c,L)=>{u(p=>{if(!p)return null;let h=[...p.nodes];const _=h.find(D=>D.id==c);if(_){const D=_.index;h[L-1].index=D,h[D-1].index=L,h[D-1]=h[L-1],h[L-1]=_,r.set("slide",L.toString()),y(r,{replace:!0})}return{...p,nodes:h}})},M=c=>{if(!t)return;g(!1),a(c);const L=t.nodes.find(p=>p.id==c);L&&(r.set("slide",L.index.toString()),y(r,{replace:!0}))},R=()=>{g(!0)},O=()=>{g(!1)};return t!==null?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-2",children:[e.jsx("h4",{children:t.title}),e.jsxs("div",{className:"d-flex justify-content-between my-3",children:[e.jsx(es,{size:"sm",children:t.nodes.map((c,L)=>e.jsx(ss,{id:`current-lesson-input-${c.index}`,type:"radio",variant:"outline-primary",name:"current-lesson",value:c.id,checked:v===c.id,onChange:p=>M(p.currentTarget.value),size:"sm",children:c.index},L))}),e.jsx(S,{size:"sm",onClick:q,children:e.jsx(xe,{})})]}),v!==null&&(f?e.jsxs("div",{className:"d-flex flex-column",style:{minHeight:"368px"},children:[e.jsx("div",{className:"flex-grow-1 border border-2",children:e.jsx(Ee,{nodeId:v,mock:!0,onAnswered:()=>{},onContinue:()=>{},onEnter:()=>{}})}),e.jsx("div",{className:"d-flex justify-content-end mt-2",children:e.jsx(S,{variant:"secondary",size:"sm",onClick:O,children:"Exit Preview"})})]}):e.jsx(xs,{nodeId:v,nodeCount:t.nodeCount,onChangeIndex:z,onDelete:E,onPreview:R}))]})}):e.jsx("div",{className:"my-5 text-center",children:b?e.jsx(Se,{}):e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:"Lesson could not be loaded"}),e.jsx(S,{size:"sm",onClick:()=>N("/Courses/Editor/"+o),children:"Back to course"})]})})},ve=()=>{const{sendJsonRequest:s}=Q(),{courseId:m,lessonId:t}=te(),[u,v]=n.useState(null),[a,r]=n.useState([]),[y,f]=n.useState(!1),[g,b]=n.useState(!1),[w,o]=n.useState(""),[N,A]=n.useState(null),[q,E]=n.useState(!1),[z,M]=n.useState(null);n.useEffect(()=>{R(!0)},[m]);const R=async i=>{f(!0);const j=await s("/CourseEditor/GetCourse","POST",{courseId:m,includeLessons:i});j&&j.course&&(v(j.course),r(j.course.lessons)),f(!1)},O=(i,j)=>{o(i),b(!0),A(j)},c=()=>{b(!1),o("")},L=async()=>{f(!0);const i=await s("/CourseEditor/CreateLesson","POST",{courseId:u.id,title:w});i&&i.lesson?(r(j=>[...j,{...i.lesson}]),c(),M({type:"success",message:"Lesson created successfully"})):M({type:"error",message:i==null?void 0:i.error[0].message}),f(!1)},p=async()=>{f(!0);const i=a.find(T=>T.id===N);if(!i)return;const j=await s("/CourseEditor/EditLesson","PUT",{lessonId:N,title:w,index:i.index});j&&j.success?(r(T=>{let l=[...T];for(let P=0;P<l.length;++P)l[P].id===N&&(l[P].title=j.data.title);return l}),c(),M({type:"success",message:"Lesson edited successfully"})):M({type:"error",message:j==null?void 0:j.error[0].message}),f(!1)},h=async()=>{f(!0);const i=await s("/CourseEditor/DeleteLesson","DELETE",{lessonId:N});i&&i.success?(k(),r(j=>{let T=[],l=!1;for(let P=0;P<j.length;++P){const J=j[P];if(J.id===N){l=!0;continue}l&&--J.index,T.push(J)}return T}),M({type:"success",message:"Lesson deleted successfully"})):M({type:"error",message:i==null?void 0:i.error[0].message}),f(!1)},_=async(i,j)=>{f(!0);const T=await s("/CourseEditor/ChangeLessonIndex","POST",{lessonId:i,newIndex:j});T&&T.success?(r(l=>{const P=[...l],J=P.findIndex(x=>x.id===i);if(J===-1)return P;const d=P.findIndex(x=>x.index===j);return d===-1||([P[J].index,P[d].index]=[P[d].index,P[J].index],P.sort((x,C)=>x.index-C.index)),P}),M({type:"success",message:"Lesson index changed successfully"})):M({type:"error",message:T==null?void 0:T.error[0].message}),f(!1)},D=(i,j)=>{O(j,i)},W=i=>{A(i),E(!0)},k=()=>{E(!1)},I=()=>{const i=a.find(T=>T.id===t);if(!i)return e.jsx(e.Fragment,{});const j=ie(i.title,20);return e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"›"}),e.jsx("span",{children:j})]})};return u!==null?e.jsxs(e.Fragment,{children:[e.jsx(ts,{notification:z,onClose:()=>M(null)}),e.jsxs(B,{show:q,onHide:k,centered:!0,children:[e.jsx(B.Header,{closeButton:!0,children:e.jsx(B.Title,{children:"Are you sure?"})}),e.jsx(B.Body,{children:"Lesson will be permanently deleted."}),e.jsxs(B.Footer,{children:[e.jsx(S,{variant:"secondary",onClick:k,children:"Cancel"}),e.jsx(S,{variant:"danger",onClick:h,children:"Delete"})]})]}),e.jsxs("div",{className:"d-flex gap-2 py-2",children:[e.jsx(X,{to:"/Courses/Editor",children:"Course Editor"}),e.jsx("span",{children:"›"}),t!==null?e.jsxs(e.Fragment,{children:[e.jsx(X,{to:"/Courses/Editor/"+u.id,children:ie(u.title,20)}),I()]}):e.jsx("span",{children:ie(u.title,20)})]}),e.jsx("div",{className:"mb-3",children:e.jsx("h3",{className:"wb-courses-course__title",style:{wordBreak:"break-word"},children:u.title})}),e.jsx("div",{hidden:!g,className:"mb-2 border bg-white rounded p-2",children:e.jsxs(se,{children:[e.jsx("h4",{children:N===null?"New lesson":"Edit lesson"}),e.jsxs($,{children:[e.jsx(V,{children:"Title"}),e.jsx(G,{type:"text",placeholder:"Enter lesson title",maxLength:60,value:w,onChange:i=>o(i.target.value)})]}),e.jsxs("div",{className:"d-flex justify-content-end mt-2",children:[e.jsx(S,{size:"sm",variant:"secondary",disabled:y,onClick:()=>c(),children:"Cancel"}),N===null?e.jsx(S,{size:"sm",variant:"primary",className:"ms-2",onClick:L,disabled:y||w.length===0,children:"Create"}):e.jsx(S,{size:"sm",variant:"primary",className:"ms-2",onClick:p,disabled:y,children:"Save"})]})]})}),t?e.jsx(hs,{lessonId:t}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(S,{className:"ms-2 btn btn-primary btn-sm",onClick:()=>O("",null),children:"Create Lesson"})}),e.jsx("div",{className:"mt-3",children:a.map(i=>e.jsx("div",{className:"mt-2",children:e.jsx(us,{lesson:i,courseId:u.id,onDelete:W,onEdit:D,onChangeIndex:_,isFirst:i.index===1,isLast:i.index===a.length})},i.index))})]})]}):e.jsx("div",{className:"my-5 text-center",children:y?e.jsx(Se,{}):e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:"Course could not be loaded"}),e.jsx(X,{to:"/Courses/Editor",children:"Back"})]})})},js=()=>{var W;const{lessonId:s,courseCode:m}=te(),[t,u]=n.useState(null),[v,a]=n.useState(0),{sendJsonRequest:r}=Q(),y=he(),f=Ge(),[g,b]=be(),[w,o]=n.useState(!1),[N,A]=n.useState({section:"Courses",params:{lessonId:s}}),[q,E]=n.useState(0),[z,M]=n.useState(null);n.useEffect(()=>{s&&(R(),A({section:"Courses",params:{lessonId:s}}))},[s]),n.useEffect(()=>{g.has("slide")&&a(Number(g.get("slide")))},[g]),n.useEffect(()=>{f.state&&f.state.postId&&(h(),M({id:f.state.postId,isReply:f.state.isReply}))},[f]),n.useEffect(()=>{if(t&&!g.has("slide")){const k=t.nodes.filter(I=>I.unlocked).sort((I,i)=>i.index-I.index);k.length&&(g.set("slide",k[0].index.toString()),b(g,{replace:!0}))}},[t]);const R=async()=>{const k=await r("/Courses/GetLesson","POST",{lessonId:s});k&&k.lesson&&(u(k.lesson),E(k.lesson.comments))},O=(k,I)=>{t&&I&&(g.set("slide",k.toString()),b(g,{replace:!0}))},c=k=>{if(!t)return;const I=t.nodes.find(i=>i.id==k);I&&(I.index<t.nodeCount?(g.set("slide",(I.index+1).toString()),b(g,{replace:!0})):D())},L=k=>{if(!t)return;const I=t.nodes.find(i=>i.id==k);I&&I.type==1&&u(i=>{if(!i)return null;const j=i.nodes;for(let T=0;T<j.length;++T)j[T].index==I.index+1&&(j[T].unlocked=!0);return{...i,nodes:j}})},p=(k,I)=>{if(!t)return;const i=t.nodes.find(j=>j.id==k);i&&I&&u(j=>{if(!j)return null;const T=j.nodes;for(let l=0;l<T.length;++l)T[l].index==i.index+1&&(T[l].unlocked=!0);return{...j,nodes:T}})},h=()=>{s&&o(!0)},_=()=>{o(!1)},D=()=>{y("/Courses/"+m)};return e.jsx("div",{className:"wb-courses-lesson-container d-flex flex-column",children:t&&e.jsxs(e.Fragment,{children:[e.jsxs(oe,{show:w,onHide:_,placement:"end",children:[e.jsx(oe.Header,{closeButton:!0,children:e.jsxs(oe.Title,{children:[q," Comments"]})}),e.jsx(oe.Body,{className:"d-flex flex-column",style:{height:"calc(100% - 62px)"},children:e.jsx(ns,{findPost:z,options:N,setCommentCount:E})})]}),e.jsxs("div",{className:"d-flex justify-content-between p-2",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(S,{variant:"link",className:"text-secondary",onClick:D,children:e.jsx(Je,{})}),e.jsx("span",{className:"text-secondary",style:{fontSize:"24px",fontWeight:"bold"},children:t.title})]}),e.jsxs("div",{className:"d-flex align-items-center gap-1",children:[e.jsx("span",{className:"small text-secondary",children:q}),e.jsx(S,{variant:"link",className:"text-secondary",onClick:h,children:e.jsx(Qe,{})})]})]}),e.jsx("div",{className:"wb-courses-lesson-main",children:e.jsx(ae,{variant:"pills",className:"flex-row overflow-auto my-3 row-gap-1",children:t.nodes.map(k=>{const I=k.index===v,i=k.type===1?e.jsx(We,{}):e.jsx(Ye,{});return e.jsx(ae.Item,{children:e.jsx(ae.Link,{className:"wb-courses-lesson-arrow-pill "+(k.unlocked?I?"bg-warning text-dark":"bg-primary text-light":"bg-secondary text-light"),onClick:()=>O(k.index,k.unlocked),disabled:!k.unlocked,children:i})},k.id)})})}),e.jsx("div",{className:"flex-grow-1 mt-2",children:v!=0&&e.jsx(Ee,{nodeId:(W=t.nodes.find(k=>k.index==v))==null?void 0:W.id,mock:!1,onContinue:c,onAnswered:p,onEnter:L})})]})})},Pe=({courseId:s})=>{const{sendJsonRequest:m}=Q(),t=he(),[u,v]=n.useState(!1),[a,r]=n.useState(""),[y,f]=n.useState(""),[g,b]=n.useState(""),[w,o]=n.useState(!1),[N,A]=n.useState(),[q,E]=n.useState(""),[z,M]=n.useState(!1),[R,O]=n.useState(null),[c,L]=n.useState(null),[p,h]=n.useState({});n.useEffect(()=>{s&&_()},[s]);const _=async()=>{v(!0);const l=await m("/CourseEditor/GetCourse","POST",{courseId:s});l&&l.course&&(r(l.course.code),f(l.course.title),b(l.course.description),o(l.course.visible),O(l.course.coverImage)),v(!1)},D=async l=>{l.preventDefault(),v(!0),s?await k():await W(),v(!1)},W=async()=>{A(void 0);const l=await m("/CourseEditor/CreateCourse","POST",{code:a,title:y,description:g,visible:w});l&&l.course?t("/Courses/Editor"):A(l.error)},k=async()=>{A(void 0),E("");const l=await m("/CourseEditor/EditCourse","PUT",{courseId:s,title:y,code:a,description:g,visible:w});l&&l.success?E("Course edited successfully"):A(l.error)},I=()=>{M(!1)},i=async()=>{v(!0);const l=await m("/CourseEditor/DeleteCourse","DELETE",{courseId:s});l&&l.success?(I(),t("/Courses/Editor")):A(l!=null&&l.error?l.error.message:l.message),v(!1)},j=async l=>{l.preventDefault(),h({}),v(!0);const P=await m("/CourseEditor/UploadCourseCoverImage","POST",{courseId:s,coverImage:c},{},!0);P&&P.success?(O(P.data.coverImage),h({message:"Course cover image updated successfully"})):h({errors:P==null?void 0:P.error}),v(!1)},T=l=>{const P=l.target.files;P&&L(P[0])};return e.jsxs(e.Fragment,{children:[e.jsxs(B,{show:z,onHide:I,centered:!0,children:[e.jsx(B.Header,{closeButton:!0,children:e.jsx(B.Title,{children:"Are you sure?"})}),e.jsx(B.Body,{children:"Course will be permanently deleted."}),e.jsxs(B.Footer,{children:[e.jsx(S,{variant:"secondary",onClick:I,children:"Cancel"}),e.jsx(S,{variant:"danger",onClick:i,children:"Delete"})]})]}),e.jsxs("div",{className:"row",children:[s!==null&&e.jsxs("div",{className:"col-12 col-md-4",children:[e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx("div",{className:"rounded-circle",children:e.jsx("img",{className:"wb-courses-course__cover-image",src:R?"/uploads/courses/"+R:"/resources/images/logoicon.svg",alt:"Cover image"})})}),e.jsxs(se,{onSubmit:j,children:[e.jsx(fe,{errors:p.errors,message:p.message}),e.jsxs($,{children:[e.jsx(V,{children:"Cover image"}),e.jsx(G,{size:"sm",type:"file",required:!0,onChange:T,accept:"image/png"})]}),e.jsx("div",{className:"d-flex justify-content-end mt-2",children:e.jsx(S,{size:"sm",className:"ms-2",variant:"primary",type:"submit",disabled:u,children:"Upload"})})]})]}),e.jsx("div",{className:"col-12 col-md-8",children:e.jsxs(se,{onSubmit:D,children:[e.jsx(fe,{errors:N,message:q}),e.jsxs($,{children:[e.jsx(V,{children:"Course title"}),e.jsx(G,{type:"text",required:!0,value:y,onChange:l=>f(l.target.value)})]}),e.jsxs($,{children:[e.jsx(V,{children:"Course code"}),e.jsx(G,{type:"text",required:!0,value:a,onChange:l=>r(l.target.value)})]}),e.jsxs($,{children:[e.jsx(V,{children:"Course description"}),e.jsx(G,{as:"textarea",rows:8,maxLength:1e3,required:!0,value:g,onChange:l=>b(l.target.value)})]}),e.jsxs($,{className:"d-flex align-items-center mt-2 gap-2",children:[e.jsx(V,{children:"Is visible"}),e.jsx(rs,{value:w,onChange:l=>o(l.target.checked)})]}),e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx(ee.LinkContainer,{to:"/Courses/Editor",children:e.jsx(S,{size:"sm",type:"button",variant:"secondary",disabled:u,children:"Cancel"})}),s?e.jsxs(e.Fragment,{children:[e.jsx(S,{size:"sm",variant:"secondary",className:"ms-2",type:"button",onClick:()=>M(!0),disabled:u,children:"Delete"}),e.jsx(S,{size:"sm",variant:"primary",className:"ms-2",type:"submit",disabled:u,children:"Save changes"})]}):e.jsx(e.Fragment,{children:e.jsx(S,{size:"sm",className:"ms-2",variant:"primary",type:"submit",disabled:u,children:"Create course"})})]})]})})]})]})},fs=()=>{const{courseId:s}=te();return e.jsx(Pe,{courseId:s})};const Es=()=>e.jsxs(Ke,{children:[e.jsx(H,{element:e.jsx(le,{Header:e.jsx(ce,{variant:"light"}),Footer:e.jsx(de,{})}),children:e.jsx(H,{element:e.jsx(ge,{allowedRoles:["Admin","Creator"]}),children:e.jsxs(H,{path:"Editor",children:[e.jsx(H,{index:!0,element:e.jsx(Z,{MainPage:e.jsx(ds,{})})}),e.jsx(H,{path:"New",element:e.jsx(Z,{MainPage:e.jsx(Pe,{courseId:null})})}),e.jsx(H,{path:"Edit/:courseId",element:e.jsx(Z,{MainPage:e.jsx(fs,{})})}),e.jsxs(H,{path:":courseId",children:[e.jsx(H,{index:!0,element:e.jsx(Z,{MainPage:e.jsx(ve,{})})}),e.jsx(H,{path:"Lesson/:lessonId",element:e.jsx(Z,{MainPage:e.jsx(ve,{})})})]})]})})}),e.jsx(H,{element:e.jsx(le,{Header:e.jsx(ce,{variant:"light"}),Footer:e.jsx(de,{})}),children:e.jsx(H,{index:!0,element:e.jsx(ls,{})})}),e.jsx(H,{element:e.jsx(ge,{allowedRoles:Xe}),children:e.jsxs(H,{path:":courseCode",children:[e.jsx(H,{element:e.jsx(le,{Header:e.jsx(ce,{variant:"light"}),Footer:e.jsx(de,{})}),children:e.jsx(H,{index:!0,element:e.jsx(cs,{})})}),e.jsx(H,{path:"Lesson/:lessonId",element:e.jsx(js,{})})]})})]});export{Es as default};
