import{u as I,r as t,j as e,a2 as Je,M as Ge,b as Z,ag as je,m as V,Z as $,B as g,J as ee,d as Ye,ab as H,ac as z,F as Ke,R as Xe,a4 as Ze,an as fe,aa as $e,D as ge,c as pe,P as ve,H as we,ah as es,K as ss,a3 as he,$ as M,a0 as ts,ao as ns,A as as,ap as is,O as rs,Q as q,S as ls,U as os,am as cs,V as ds}from"./index-58cdf152.js";import{Q as ye,T as us,I as hs,W as ms}from"./Question-dade4c0a.js";import{P as be}from"./react-bootstrap-pagination-control.esm-69a75c1f.js";import{Q as Ne}from"./CodeList-0428c30b.js";import{P as Se,R as xs}from"./ReactionsList-42eaa2fe.js";import{a as Pe,P as De}from"./PostAttachmentSelect-5ed188cc.js";import{M as F}from"./Modal-8c57f9e2.js";import{a as Ce}from"./discussAllowedUrls-4f3044c5.js";import{M as Ae}from"./MarkdownRenderer-ea76a87c.js";import{t as js}from"./StringUtils-91be14c5.js";import{r as fs}from"./roles-68ed67e6.js";import"./Code-168e77e9.js";const _=({MainPage:a})=>{const{sendJsonRequest:h}=I(),[j,l]=t.useState([]);t.useEffect(()=>{i()},[]);const i=async()=>{const u=await h("/Discussion","POST",{page:1,count:10,searchQuery:"",filter:5,userId:null});u&&u.questions&&l(u.questions)};return e.jsxs(e.Fragment,{children:[e.jsxs(Je,{children:[" ",e.jsx("title",{children:"Q&A Discussions | Webler Codes"})," ",e.jsx("meta",{name:"description",content:"Join Webler’s programming forum to ask questions, share knowledge, and solve real-world coding challenges with a global community of developers."})," "]}),e.jsx("div",{className:"bg-white",children:e.jsx(Ge,{children:e.jsxs("div",{className:"row pt-2",style:{minHeight:"100vh"},children:[e.jsx("div",{className:"col-12 col-md-8",children:a}),e.jsxs("div",{className:"col-12 col-md-4",children:[e.jsx("h2",{children:"Hot today"}),e.jsx("div",{className:"my-3",children:j.map(u=>e.jsx("div",{className:"mb-2",children:e.jsx(ye,{question:u,searchQuery:"",showUserProfile:!1})},u.id))})]})]})})})]})},gs=()=>{const{sendJsonRequest:a}=I(),{userInfo:h}=Z(),[j,l]=t.useState([]),i=10,[u,b]=t.useState(1),[x,N]=t.useState(0),[m,f]=t.useState(!1),[Q,p]=t.useState(1),[D,v]=t.useState(""),[o,w]=je();t.useEffect(()=>{T()},[o]),t.useEffect(()=>{C(1)},[Q,D]),t.useEffect(()=>{o.has("page")&&b(Number(o.get("page"))),o.has("filter")&&p(Number(o.get("filter"))),o.has("query")&&v(o.get("query"))},[]);const C=d=>{u!==d&&(o.set("page",d.toString()),w(o,{replace:!0}),b(d))},R=d=>{o.set("query",d),w(o,{replace:!0}),v(d)},T=async()=>{f(!0);const d=o.has("page")?Number(o.get("page")):1,n=o.has("filter")?Number(o.get("filter")):1,A=o.has("query")?o.get("query"):"",k=await a("/Discussion","POST",{page:d,count:i,filter:n,searchQuery:A,userId:h?h.id:null});k&&k.questions&&(l(k.questions),N(k.count)),f(!1)},S=d=>{const n=Number(d.target.selectedOptions[0].value);o.set("filter",n.toString()),w(o,{replace:!0}),p(n)};let P=[];for(let d=0;d<i;++d)P.push(e.jsx(Ne,{},d));return e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("h2",{children:"Q&A Discussions"}),e.jsxs("div",{className:"mt-2",children:[e.jsx(V.Label,{htmlFor:"search",className:"visually-hidden",children:"Search"}),e.jsx(us,{id:"search",placeholder:"Search by tags or title...",maxWidthPx:360,query:D,handleSearch:R})]}),e.jsxs("div",{className:"mt-2 d-flex justify-content-between",children:[e.jsx(V.Label,{htmlFor:"filter",className:"visually-hidden",children:"Filter"}),e.jsxs(V.Select,{id:"filter",style:{width:"140px"},size:"sm",value:Q,onChange:S,children:[e.jsx("option",{value:"1",children:"Most Recent"}),e.jsx("option",{value:"2",children:"Unanswered"}),e.jsx("option",{value:"6",children:"Trending"}),h&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"3",children:"My Questions"}),e.jsx("option",{value:"4",children:"My Answers"})]})]}),e.jsx($.LinkContainer,{to:"/Discuss/New",children:e.jsx(g,{size:"sm",children:"Ask a question"})})]}),e.jsx("div",{className:"mt-2",children:m?P:x==0?e.jsx("div",{className:"wb-discuss-empty-questions",children:e.jsx("h3",{children:"Nothing to show"})}):j.map(d=>e.jsx(ye,{question:d,searchQuery:D,showUserProfile:!0},d.id))}),e.jsx("div",{className:"my-3",children:e.jsx(be,{page:u,between:3,total:x,limit:i,changePage:C,ellipsis:1})})]})},me=4096,ke=({questionId:a})=>{const{sendJsonRequest:h}=I(),j=ee(),[l,i]=t.useState(""),[u,b]=t.useState(""),[x,N]=t.useState([]),[m,f]=t.useState(!1),[Q,p]=t.useState(),[D,v]=t.useState(!1);t.useEffect(()=>{a&&o()},[a]);const o=async()=>{f(!0);const n=await h("/Discussion/GetQuestion","POST",{questionId:a});n&&n.question&&(i(n.question.title),b(n.question.message),N(n.question.tags)),f(!1)},w=async()=>{f(!0),p(void 0),a?await R():await C(),f(!1)},C=async()=>{const n=await h("/Discussion/CreateQuestion","POST",{title:l,message:u,tags:x});n&&n.question?j("/Discuss/"+n.question.id):p(n.error)},R=async()=>{const n=await h("/Discussion/EditQuestion","PUT",{questionId:a,title:l,message:u,tags:x});n&&n.success?j("/Discuss/"+a):p(n.error)},T=()=>{v(!1)},S=async()=>{f(!0);const n=await h("/Discussion/DeleteQuestion","DELETE",{questionId:a});n&&n.success?(T(),j("/Discuss?filter=3")):p(n!=null&&n.error?n.error.message:n.message),f(!1)},P=n=>{b(A=>(A.trim().length==0||A.endsWith(`
`)?A:A+`
`)+n.join(`
`)+`
`)};let d=m||l.trim().length==0||u.trim().length==0;return e.jsxs(e.Fragment,{children:[e.jsxs(F,{show:D,onHide:T,centered:!0,children:[e.jsx(F.Header,{closeButton:!0,children:e.jsx(F.Title,{children:"Are you sure?"})}),e.jsx(F.Body,{children:"Your question will be permanently deleted."}),e.jsxs(F.Footer,{children:[e.jsx(g,{variant:"secondary",onClick:T,children:"Cancel"}),e.jsx(g,{variant:"danger",onClick:S,children:"Delete"})]})]}),a===null&&e.jsx("h2",{className:"mb-4",children:"Ask the community a question"}),e.jsxs("div",{className:"d-flex flex-column gap-2",children:[e.jsx(Ye,{errors:Q}),e.jsxs(H,{children:[e.jsx(z,{children:"Your question"}),e.jsx(Ke,{placeholder:"What would you like to know?",type:"text",required:!0,value:l,onChange:n=>i(n.target.value)})]}),e.jsxs(H,{children:[e.jsx(z,{children:"Description"}),e.jsx(Se,{placeholder:"Include as much detail as possible to get the most relevant answers.",rows:10,maxLength:me,required:!0,value:u,setValue:b}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"mt-2 text-muted small",children:[u.length,"/",me," characters"]}),e.jsx(Pe,{onSubmit:P})]})]}),e.jsxs(H,{children:[e.jsx(z,{children:"Tags"}),e.jsx(hs,{values:x,setValues:N,placeholder:"Add tag..."})]}),e.jsxs("div",{className:"mt-2 d-flex justify-content-end",children:[e.jsx($.LinkContainer,{to:a?"/Discuss/"+a:"/Discuss",children:e.jsx(g,{type:"button",variant:"secondary",disabled:m,children:"Cancel"})}),a?e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"secondary",className:"ms-2",type:"button",onClick:()=>v(!0),disabled:m,children:"Delete"}),e.jsx(g,{variant:"primary",className:"ms-2",type:"button",onClick:w,disabled:d,children:"Save changes"})]}):e.jsx(g,{className:"ms-2",variant:"primary",type:"button",onClick:w,disabled:d,children:"Post question"})]})]})]})},xe=Xe.forwardRef(({answer:a,acceptedAnswer:h,toggleAcceptedAnswer:j,isQuestionOwner:l,showEditAnswer:i,newlyCreatedAnswer:u,onShowVoters:b},x)=>{const{sendJsonRequest:N}=I(),{userInfo:m}=Z(),[f,Q]=t.useState(a.isUpvoted),[p,D]=t.useState(a.votes),v=(m==null?void 0:m.id)===a.userId,o=ee(),w=async()=>{if(!m){o("/Users/Login");return}const n=f?0:1;(await N("/Discussion/VotePost","POST",{postId:a.id,vote:n})).vote===n&&(Q(n===1),D(p+(n?1:-1)))},C=()=>{b(a.id)};let R=h===a.id,S=u===a.id?"beige":"white",P=e.jsxs("div",{className:"gap-2 d-flex flex-column border-bottom border-2 py-2",style:{background:S},children:[e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("div",{className:"d-flex flex-column align-items-center",children:[(l||R)&&e.jsx("div",{onClick:()=>j(a.id),className:"wb-discuss-reply__actions__best-answer-button"+(R?" text-success":" text-secondary"),style:{cursor:l?"pointer":"default"},children:e.jsx(Ze,{})}),e.jsxs("div",{className:"wb-discuss-voting mt-2",children:[e.jsx("span",{onClick:w,className:"wb-icon-button"+(f?" text-black":""),children:e.jsx(fe,{})}),e.jsx("b",{className:"wb-icon-button text-black",onClick:C,children:p})]})]}),e.jsxs("div",{className:"flex-grow-1 d-flex flex-column gap-2",style:{minWidth:0},children:[e.jsx("div",{className:"d-flex justify-content-end align-items-center",children:v&&e.jsx("span",{style:{cursor:"pointer"},onClick:()=>i(a.id),children:e.jsx($e,{})})}),e.jsx("div",{className:"wb-discuss-question__description",children:e.jsx(Ae,{content:a.message,allowedUrls:Ce})}),e.jsx("div",{className:"mt-2",children:a.attachments.map(n=>e.jsx("div",{className:"mt-1",children:e.jsx(De,{data:n})},n.id))})]})]}),e.jsx("div",{className:"d-flex justify-content-end align-items-end mt-1",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("small",{className:"text-secondary",children:ge.format(new Date(a.date))})}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(pe,{userId:a.userId,userName:a.userName})})]}),e.jsx("div",{className:"ms-2",children:e.jsx(ve,{size:32,avatarImage:a.userAvatar})})]})})]});return x?e.jsx("div",{ref:x,children:P}):e.jsx("div",{children:P})}),ps=()=>{const{sendJsonRequest:a}=I(),{questionId:h}=we(),j=ee(),{userInfo:l}=Z(),[i,u]=t.useState(null),[b,x]=t.useState(["",""]),[N,m]=t.useState(!1),[f,Q]=t.useState(!1),[p,D]=t.useState(1),v=10,[o,w]=t.useState([]),C=t.useRef(null),[R,T]=t.useState(!1),[S,P]=t.useState(""),d=4096,[n,A]=t.useState(null),[k,Fe]=t.useState(null),[Qe,se]=t.useState(!1),[te,B]=t.useState(1),[y,ne]=je(),U=es(),[L,J]=t.useState(null),G=t.useRef(null),Y=t.useRef(null),[Te,Re]=t.useState(""),[Ee,K]=t.useState(!1),[Le,ae]=t.useState({parentId:""});ss(Te),t.useEffect(()=>{i&&Re(i.title+" | Webler Codes")},[i]),t.useEffect(()=>{U.state&&U.state.postId&&(J(U.state.postId),B(2))},[U]),t.useEffect(()=>{y.has("page")&&D(Number(y.get("page"))),y.has("filter")&&B(Number(y.get("filter")))},[]),t.useEffect(()=>{qe()},[h]),t.useEffect(()=>{Ve()},[y,h,L]),t.useEffect(()=>{ie(1)},[te]);const ie=s=>{s!==p&&(J(null),y.set("page",s.toString()),ne(y,{replace:!0}),D(s))},Me=s=>{const r=Number(s.target.selectedOptions[0].value);y.set("filter",r.toString()),ne(y,{replace:!0}),B(r),J(null)},qe=async()=>{m(!0);const s=await a("/Discussion/GetQuestion","POST",{questionId:h});s&&s.question&&u(s.question),m(!1)},Ve=async()=>{Q(!0);const s=y.has("page")?Number(y.get("page")):1,r=y.has("filter")?Number(y.get("filter")):1,c=await a("/Discussion/GetQuestionReplies","POST",{questionId:h,index:(s-1)*v,count:v,filter:r,findPostId:L});if(c&&c.posts){w(c.posts),L&&(D(c.posts.length>0?Math.floor(c.posts[0].index/v)+1:1),setTimeout(()=>{G.current&&G.current.scrollIntoView({behavior:"smooth",block:"end"})}));let E=null;for(let W=0;W<c.posts.length;++W)if(c.posts[W].isAccepted){E=c.posts[W].id;break}A(E)}Q(!1)},Ie=async()=>{if(!l){j("/Users/Login");return}m(!0);const s=await a("/Discussion/CreateReply","POST",{message:S,questionId:h});s&&s.post?(w(r=>[{...s.post,userName:l.name,userAvatar:l.avatarImage},...r]),u(r=>r?{...r,answers:r.answers+1}:null),O(),x(["success","Your answer was posted successfully"])):x(["danger",s!=null&&s.error?s.error.message:s.message]),m(!1)},Ue=async()=>{if(!l){j("/Users/Login");return}m(!0);const s=await a("/Discussion/EditReply","PUT",{message:S,replyId:k});s&&s.success?(w(r=>{const c=[...r];for(let E=0;E<c.length;++E)c[E].id===k&&(c[E].message=s.data.message,c[E].attachments=s.data.attachments);return c}),O(),x(["success","Your answer was updated successfully"])):x(["danger",s!=null&&s.error?s.error.message:s.message]),m(!1)},re=(s,r)=>{l?(x(["",""]),T(!0),P(s),Fe(r),setTimeout(()=>{C.current&&C.current.scrollIntoView({behavior:"smooth",block:"end"}),Y.current&&Y.current.focus()})):j("/Users/Login")},O=()=>{T(!1),P("")},le=async s=>{const r=await a("/Discussion/ToggleAcceptedAnswer","POST",{postId:s,accepted:s!==n});r&&r.success&&A(s===n?null:s)},oe=s=>{const r=o.find(c=>c.id==s);r&&re(r.message,s)},X=()=>{se(!1)},Oe=()=>{K(!1)},We=async()=>{m(!0);const s=await a("/Discussion/DeleteReply","DELETE",{replyId:k});s&&s.success?(X(),O(),w(r=>r.filter(c=>c.id!==k)),u(r=>r?{...r,answers:r.answers-1}:null)):x(["danger",s!=null&&s.error?s.error._message:s.message]),m(!1)},_e=async()=>{if(!i)return;if(!l){j("/Users/Login");return}const s=i.isUpvoted?0:1;(await a("/Discussion/VotePost","POST",{postId:h,vote:s})).vote===s&&u(c=>c?{...c,votes:c.votes+(s?1:-1),isUpvoted:s===1}:null)},He=async()=>{if(!i)return;if(!l){j("/Users/Login");return}const s=i.isFollowed,r=await a(s?"/Discussion/UnfollowQuestion":"/Discussion/FollowQuestion","POST",{postId:h});r&&r.success&&u(c=>c?{...c,isFollowed:!s}:null)},ze=()=>{i!=null&&i.id&&(ae({parentId:i.id}),K(!0))},ce=s=>{ae({parentId:s}),K(!0)},Be=s=>{P(r=>(r.trim().length==0||r.endsWith(`
`)?r:r+`
`)+s.join(`
`)+`
`)};let de=d-S.length,ue=[];for(let s=0;s<v;++s)ue.push(e.jsx(Ne,{},s));return i!==null?e.jsxs(e.Fragment,{children:[e.jsxs(F,{show:Qe,onHide:X,centered:!0,children:[e.jsx(F.Header,{closeButton:!0,children:e.jsx(F.Title,{children:"Are you sure?"})}),e.jsx(F.Body,{children:"Your answer will be permanently deleted."}),e.jsxs(F.Footer,{children:[e.jsx(g,{variant:"secondary",onClick:X,children:"Cancel"}),e.jsx(g,{variant:"danger",onClick:We,children:"Delete"})]})]}),e.jsx(xs,{title:"Likes",options:Le,visible:Ee,onClose:Oe,showReactions:!0,countPerPage:10}),e.jsxs("div",{className:"d-flex gap-2 py-2",children:[e.jsx(he,{to:"/Discuss",children:"Q&A"}),e.jsx("span",{children:"›"}),e.jsx("span",{children:js(i.title,20)})]}),e.jsxs("div",{className:"mb-3 d-flex flex-column position-relative",children:[e.jsx("div",{className:"wb-edit-button",children:e.jsxs(M,{drop:"start",children:[e.jsx(M.Toggle,{as:ts}),e.jsxs(M.Menu,{children:[l&&e.jsxs(e.Fragment,{children:[i&&i.userId===l.id&&e.jsx($.LinkContainer,{to:"/Discuss/Edit/"+h,children:e.jsx(M.Item,{children:"Edit"})}),e.jsx(M.Item,{onClick:He,children:i.isFollowed?"Unfollow":"Follow"})]}),e.jsx(M.Item,{onClick:()=>{navigator.clipboard.writeText(window.location.href)},children:"Share"})]})]})}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("div",{className:"d-flex flex-column align-items-center",children:[e.jsxs("div",{className:"wb-discuss-voting",children:[e.jsx("span",{onClick:_e,className:"wb-icon-button"+(i.isUpvoted?" text-black":""),children:e.jsx(fe,{})}),e.jsx("b",{className:"wb-icon-button text-black",onClick:ze,children:i.votes})]}),e.jsx("div",{children:e.jsx("span",{className:i.isFollowed?"text-warning":"text-secondary",children:e.jsx(ns,{})})})]}),e.jsxs("div",{className:"flex-grow-1 d-flex flex-column gap-2",style:{minWidth:"0"},children:[e.jsx("h3",{className:"wb-discuss-question__title",children:i.title}),e.jsx("div",{className:"d-flex mb-1 flex-wrap gap-1",children:i.tags.map((s,r)=>e.jsx(ms,{name:s,state:"neutral"},r))}),e.jsx("div",{className:"mt-1 wb-discuss-question__description",children:e.jsx(Ae,{content:i.message,allowedUrls:Ce})}),e.jsx("div",{className:"mt-1",children:i.attachments.map(s=>e.jsx("div",{className:"mt-1",children:e.jsx(De,{data:s})},s.id))})]})]}),e.jsxs("div",{className:"d-flex justify-content-end mt-2 align-items-center gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("small",{children:ge.format(new Date(i.date))})}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(pe,{userId:i.userId,userName:i.userName})})]}),e.jsx(ve,{size:32,avatarImage:i.userAvatar})]})]}),b[1]&&e.jsx(as,{variant:b[0],onClose:()=>x(["",""]),dismissible:!0,children:b[1]}),e.jsx("div",{hidden:!R,className:"mt-2 border bg-white rounded p-2",children:e.jsxs(V,{ref:C,children:[e.jsxs(H,{children:[e.jsx(z,{children:e.jsx("b",{children:l==null?void 0:l.name})}),e.jsx(Se,{ref:Y,rows:10,placeholder:"Write your reply here...",required:!0,maxLength:d,value:S,setValue:P}),e.jsxs("p",{className:de>0?"text-secondary":"text-danger",children:[de," characters remaining"]})]}),e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx(Pe,{onSubmit:Be}),e.jsx(g,{size:"sm",variant:"secondary",onClick:O,disabled:N,children:"Cancel"}),k===null?e.jsx(e.Fragment,{children:e.jsx(g,{size:"sm",variant:"primary",className:"ms-2",onClick:Ie,disabled:N||S.length===0,children:"Post"})}):e.jsxs(e.Fragment,{children:[e.jsx(g,{size:"sm",variant:"secondary",className:"ms-2",onClick:()=>se(!0),disabled:N,children:"Delete"}),e.jsx(g,{size:"sm",variant:"primary",className:"ms-2",onClick:Ue,disabled:N||S.length===0,children:"Save"})]})]})]})}),e.jsx("div",{className:"d-flex",children:e.jsxs("h4",{children:[i.answers," Answers"]})}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs(V.Select,{size:"sm",style:{width:"140px"},value:te,onChange:Me,children:[e.jsx("option",{value:"1",children:"Sort by: Votes"}),e.jsx("option",{value:"2",children:"Sort by: Date"})]}),e.jsx(g,{size:"sm",variant:"primary",className:"ms-2",onClick:()=>re("",null),children:"Answer"})]}),e.jsx("div",{className:"mt-2 d-flex flex-column w-100",children:f?ue:o.map(s=>L===s.id?e.jsx(xe,{ref:G,answer:s,acceptedAnswer:n,toggleAcceptedAnswer:le,isQuestionOwner:(l==null?void 0:l.id)===i.userId,showEditAnswer:oe,newlyCreatedAnswer:L,onShowVoters:ce},s.id):e.jsx(xe,{answer:s,acceptedAnswer:n,toggleAcceptedAnswer:le,isQuestionOwner:(l==null?void 0:l.id)===i.userId,showEditAnswer:oe,newlyCreatedAnswer:L,onShowVoters:ce},s.id))}),e.jsx("div",{className:"my-3",children:e.jsx(be,{page:p,between:3,total:i.answers,limit:v,changePage:ie,ellipsis:1})})]}):!N&&e.jsxs("div",{className:"d-flex h-100 flex-column align-items-center justify-content-center text-center",children:[e.jsx("h4",{children:e.jsx(is,{})}),e.jsx("h5",{children:"Question not found"}),e.jsx("div",{children:e.jsx(he,{to:"/Discuss",children:"Go back"})})]})},vs=()=>{const{questionId:a}=we();return e.jsx(ke,{questionId:a})};const Ts=()=>e.jsx(rs,{children:e.jsxs(q,{element:e.jsx(ls,{Header:e.jsx(os,{variant:"light"}),Footer:e.jsx(cs,{})}),children:[e.jsx(q,{index:!0,element:e.jsx(_,{MainPage:e.jsx(gs,{})})}),e.jsx(q,{path:":questionId",element:e.jsx(_,{MainPage:e.jsx(ps,{})})}),e.jsxs(q,{element:e.jsx(ds,{allowedRoles:fs}),children:[e.jsx(q,{path:"New",element:e.jsx(_,{MainPage:e.jsx(ke,{questionId:null})})}),e.jsx(q,{path:"Edit/:questionId",element:e.jsx(_,{MainPage:e.jsx(vs,{})})})]})]})});export{Ts as default};
