import{h as P,g as I,f as L,r as n,j as e,i as R}from"./index-b2f3d98e.js";import{P as F}from"./ProfileAvatar-4b9caa46.js";import{r as T}from"./index-19ddc0d1.js";import{R as D}from"./RequestResultAlert-53291c96.js";import{S as M}from"./Spinner-205e9aea.js";import{A as v}from"./Alert-f0171b20.js";import{M as d}from"./Modal-d6b02714.js";import{F as o}from"./Form-4647d33b.js";import{B as l}from"./Button-a8db19a8.js";import{C as E}from"./Container-aded6eb3.js";import{B as x}from"./Breadcrumb-b2cb3ddd.js";import{C as a}from"./Card-f2e16d11.js";import{B as G}from"./Badge-d192c51b.js";import"./index-11ee592c.js";import"./ThemeProvider-c318c21f.js";import"./useMergedRefs-f5c2a768.js";import"./Anchor-1fe32030.js";import"./CloseButton-439f23fc.js";import"./divWithClassName-9b80bbe4.js";import"./createWithBsPrefix-c6deafcc.js";import"./useWindow-763af26a.js";import"./AbstractModalHeader-f9d4f376.js";import"./DataKey-e12315fd.js";import"./FormControl-a036e454.js";import"./Col-1c3a04d0.js";import"./CardHeaderContext-82a24767.js";const ue=()=>{const{userId:j}=P(),{sendJsonRequest:c}=I(),{userInfo:p}=L(),[s,f]=n.useState(null),[g,m]=n.useState(!0),[U,u]=n.useState(!1),[b,A]=n.useState(""),[y,h]=n.useState(""),[B,N]=n.useState({});n.useEffect(()=>{if(!j)return;(async()=>{m(!0);const t=await c("/Admin/GetUser","POST",{userId:j});t&&t.user&&(f(t.user),h(t.user.roles.join(", "))),m(!1)})()},[j,c]);const S=async()=>{if(!s)return;const r=await c("/Admin/BanUser","POST",{userId:s.id,active:!s.active,note:b});r.success&&f(t=>t?{...t,active:r.data.active,ban:r.data.ban}:null),u(!1),A("")},w=async()=>{if(!s)return;const r=y.split(",").map(i=>i.trim()).filter(i=>i.length>0);if(r.length===0)return;m(!0);const t=await c("/Admin/UpdateRoles","POST",{userId:s.id,roles:r});t.success?(f(i=>i?{...i,roles:t.data.roles}:null),N({message:"Roles updated successfully."}),h(t.data.roles.join(", "))):N({errors:t==null?void 0:t.error}),m(!1)},C=()=>{s&&h(s.roles.join(", "))};if(g)return e.jsx("div",{className:"d-flex justify-content-center mt-5",children:e.jsx(M,{animation:"border"})});if(!s)return e.jsx(v,{variant:"warning",children:"No user found"});const k=s.roles.includes("Admin");return e.jsxs(e.Fragment,{children:[e.jsxs(d,{show:U,onHide:()=>u(!1),centered:!0,children:[e.jsx(d.Header,{closeButton:!0,children:e.jsx(d.Title,{children:s.active?"Ban User":"Unban User"})}),e.jsx(d.Body,{children:s.active?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Are you sure you want to ban ",e.jsx("b",{children:s.name}),"?"]}),e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Ban Note (optional)"}),e.jsx(o.Control,{as:"textarea",rows:3,value:b,maxLength:120,onChange:r=>A(r.target.value)})]})]}):e.jsxs("p",{children:["Are you sure you want to unban ",e.jsx("b",{children:s.name}),"?"]})}),e.jsxs(d.Footer,{children:[e.jsx(l,{variant:"secondary",onClick:()=>u(!1),children:"Cancel"}),e.jsx(l,{variant:s.active?"danger":"success",onClick:S,children:s.active?"Ban":"Unban"})]})]}),e.jsxs(E,{className:"mt-4",children:[e.jsxs(x,{children:[e.jsx(x.Item,{linkAs:R,linkProps:{to:"/Admin"},children:"Admin Panel"}),e.jsx(x.Item,{linkAs:R,linkProps:{to:"/Admin/UserSearch"},children:"User Search"}),e.jsx(x.Item,{active:!0,children:s.name})]}),e.jsx(a,{className:"mb-3",children:e.jsxs(a.Body,{className:"d-flex gap-2",children:[e.jsx(F,{avatarImage:s.avatarImage,size:96}),e.jsxs("div",{children:[e.jsx(a.Title,{children:s.name}),e.jsx(a.Subtitle,{className:"text-muted",children:s.email}),e.jsx("div",{className:"mt-2",children:s.roles.map(r=>e.jsx(G,{bg:"secondary",className:"me-1",children:r},r))}),e.jsxs("div",{children:["Verified: ",s.verified?"Yes":"No"]}),e.jsxs("div",{children:["Active: ",s.active?"Yes":"No"]}),e.jsxs("div",{children:["Registered: ",new Date(s.registerDate).toLocaleDateString("en")]}),e.jsx("div",{className:"mt-3",children:e.jsx(T.LinkContainer,{to:`/Profile/${s.id}`,children:e.jsx(l,{variant:"primary",children:"View Profile"})})})]})]})}),s.bio&&e.jsx(a,{className:"mb-3",children:e.jsx(a.Body,{children:e.jsx("i",{children:s.bio})})}),s.ban!=null&&e.jsxs(v,{variant:"danger",children:[e.jsx(v.Heading,{children:"User is Banned"}),e.jsxs("dl",{className:"mb-0",children:[e.jsx("dt",{children:"By"}),e.jsx("dd",{children:s.ban.author}),e.jsx("dt",{children:"Date"}),e.jsx("dd",{children:new Date(s.ban.date).toLocaleString("en")}),s.ban.note&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:"Note"}),e.jsx("dd",{children:s.ban.note})]})]})]}),!k&&e.jsx(l,{variant:s.active?"danger":"success",onClick:()=>u(!0),children:s.active?"Ban User":"Unban User"}),(p==null?void 0:p.roles.includes("Admin"))&&e.jsx(a,{className:"mt-3",children:e.jsxs(a.Body,{children:[e.jsx(D,{message:B.message,errors:B.errors}),e.jsxs(o.Group,{className:"mb-2",children:[e.jsx(o.Label,{children:"Roles (comma separated)"}),e.jsx(o.Control,{type:"text",value:y,onChange:r=>h(r.target.value),placeholder:"Enter roles separated by ,"})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(l,{variant:"primary",onClick:w,disabled:g,children:"Update roles"}),e.jsx(l,{variant:"secondary",onClick:C,children:"Reset Roles"})]})]})})]})]})};export{ue as default};
