import{d as q,r as n,j as e,ai as Ye,C as Ke,e as X,g as fe,h as V,k as Z,B as g,f as $,X as Xe,ap as B,s as K,i as Ze,Q as $e,F as es,ax as je,ao as ss,T as ge,W as pe,S as ve,n as we,as as ts,P as ns,o as he,D as M,E as as,ay as is,A as ls,v as rs,J as os,K as I,af as cs,M as ds,aw as us,N as ms}from"./index-bd769196.js";import{Q as ye,T as hs,I as xs,W as fs}from"./Question-89c1764f.js";import{P as be}from"./react-bootstrap-pagination-control.esm-22aecfd0.js";import{Q as Ne}from"./CodeList-f2372f68.js";import{M as Se,a as Pe}from"./MdEditorField-99b323ad.js";import{M as A}from"./Modal-eaaaa772.js";import{P as De}from"./PostAttachment-9e82b15f.js";import{M as Ce}from"./PostTextareaControl-431043f3.js";import{t as js}from"./StringUtils-91be14c5.js";import{R as gs}from"./ReactionsList-ddf54a52.js";import{r as ps}from"./roles-68ed67e6.js";import"./Code-4f965cfd.js";import"./PostAttachmentSelect-52cc9483.js";const z=({MainPage:i})=>{const{sendJsonRequest:d}=q(),[x,l]=n.useState([]);n.useEffect(()=>{a()},[]);const a=async()=>{const u=await d("/Discussion","POST",{page:1,count:10,searchQuery:"",filter:5,userId:null});u&&u.questions&&l(u.questions)};return e.jsxs(e.Fragment,{children:[e.jsxs(Ye,{children:[" ",e.jsx("title",{children:"Q&A Discussions | Webler Codes"})," ",e.jsx("meta",{name:"description",content:"Join Webler’s programming forum to ask questions, share knowledge, and solve real-world coding challenges with a global community of developers."})," "]}),e.jsx("div",{className:"bg-white",children:e.jsx(Ke,{children:e.jsxs("div",{className:"row pt-2",style:{minHeight:"100vh"},children:[e.jsx("div",{className:"col-12 col-md-8",children:i}),e.jsxs("div",{className:"col-12 col-md-4",children:[e.jsx("h2",{children:"Hot today"}),e.jsx("div",{className:"my-3",children:x.map(u=>e.jsx("div",{className:"mb-2",children:e.jsx(ye,{question:u,searchQuery:"",showUserProfile:!1})},u.id))})]})]})})})]})},vs=()=>{const{sendJsonRequest:i}=q(),{userInfo:d}=X(),[x,l]=n.useState([]),a=10,[u,S]=n.useState(1),[h,b]=n.useState(0),[m,j]=n.useState(!1),[k,p]=n.useState(1),[P,v]=n.useState(""),[o,w]=fe();n.useEffect(()=>{F()},[o]),n.useEffect(()=>{C(1)},[k,P]),n.useEffect(()=>{o.has("page")&&S(Number(o.get("page"))),o.has("filter")&&p(Number(o.get("filter"))),o.has("query")&&v(o.get("query"))},[]);const C=t=>{u!==t&&(o.set("page",t.toString()),w(o,{replace:!0}),S(t))},Q=t=>{o.set("query",t),w(o,{replace:!0}),v(t)},F=async()=>{j(!0);const t=o.has("page")?Number(o.get("page")):1,f=o.has("filter")?Number(o.get("filter")):1,T=o.has("query")?o.get("query"):"",R=await i("/Discussion","POST",{page:t,count:a,filter:f,searchQuery:T,userId:d?d.id:null});R&&R.questions&&(l(R.questions),b(R.count)),j(!1)},D=t=>{const f=Number(t.target.selectedOptions[0].value);o.set("filter",f.toString()),w(o,{replace:!0}),p(f)};let N=[];for(let t=0;t<a;++t)N.push(e.jsx(Ne,{},t));return e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("h2",{children:"Q&A Discussions"}),e.jsxs("div",{className:"mt-2",children:[e.jsx(V.Label,{htmlFor:"search",className:"visually-hidden",children:"Search"}),e.jsx(hs,{id:"search",placeholder:"Search by tags or title...",maxWidthPx:360,query:P,handleSearch:Q})]}),e.jsxs("div",{className:"mt-2 d-flex justify-content-between",children:[e.jsxs(V.Group,{children:[e.jsx(V.Label,{htmlFor:"filter",className:"visually-hidden",children:"Filter"}),e.jsxs(V.Select,{id:"filter",style:{width:"140px"},size:"sm",value:k,onChange:D,children:[e.jsx("option",{value:"1",children:"Most Recent"}),e.jsx("option",{value:"2",children:"Unanswered"}),e.jsx("option",{value:"6",children:"Trending"}),d&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"3",children:"My Questions"}),e.jsx("option",{value:"4",children:"My Answers"})]})]})]}),e.jsx(Z.LinkContainer,{to:"/Discuss/New",children:e.jsx(g,{size:"sm",children:"Ask a question"})})]}),e.jsx("div",{className:"mt-2",children:m?N:h==0?e.jsx("div",{className:"wb-empty-list",children:e.jsx("h3",{children:"Nothing to show"})}):x.map(t=>e.jsx(ye,{question:t,searchQuery:P,showUserProfile:!0},t.id))}),e.jsx("div",{className:"my-3",children:e.jsx(be,{page:u,between:3,total:h,limit:a,changePage:C,ellipsis:1})})]})},Ae=({questionId:i})=>{const{sendJsonRequest:d}=q(),x=$(),[l,a]=n.useState(""),[u,S]=n.useState(""),[h,b]=n.useState([]),[m,j]=n.useState(!1),[k,p]=n.useState(),[P,v]=n.useState(!1);n.useEffect(()=>{i&&o()},[i]);const o=async()=>{j(!0);const t=await d("/Discussion/GetQuestion","POST",{questionId:i});t&&t.question&&(a(t.question.title),S(t.question.message),b(t.question.tags)),j(!1)},w=async()=>{j(!0),p(void 0),i?await Q():await C(),j(!1)},C=async()=>{const t=await d("/Discussion/CreateQuestion","POST",{title:l,message:u,tags:h});t&&t.question?x("/Discuss/"+t.question.id):p(t.error)},Q=async()=>{const t=await d("/Discussion/EditQuestion","PUT",{questionId:i,title:l,message:u,tags:h});t&&t.success?x("/Discuss/"+i):p(t.error)},F=()=>{v(!1)},D=async()=>{j(!0);const t=await d("/Discussion/DeleteQuestion","DELETE",{questionId:i});t&&t.success?(F(),x("/Discuss?filter=3")):p(t!=null&&t.error?t.error.message:t.message),j(!1)};let N=m||l.trim().length==0||u.trim().length==0;return e.jsxs(e.Fragment,{children:[e.jsxs(A,{show:P,onHide:F,centered:!0,children:[e.jsx(A.Header,{closeButton:!0,children:e.jsx(A.Title,{children:"Are you sure?"})}),e.jsx(A.Body,{children:"Your question will be permanently deleted."}),e.jsxs(A.Footer,{children:[e.jsx(g,{variant:"secondary",onClick:F,children:"Cancel"}),e.jsx(g,{variant:"danger",onClick:D,children:"Delete"})]})]}),i===null&&e.jsx("h2",{className:"mb-4",children:"Ask the community a question"}),e.jsxs("div",{className:"d-flex flex-column gap-2 mb-5",children:[e.jsx(Xe,{errors:k}),e.jsxs(B,{children:[e.jsx(K,{children:"Your question"}),e.jsx(Ze,{placeholder:"What would you like to know?",type:"text",required:!0,value:l,onChange:t=>a(t.target.value)})]}),e.jsx(B,{children:e.jsx(Se,{text:u,setText:S,row:10,placeHolder:"Include as much detail as possible to get the most relevant answers."})}),e.jsxs(B,{children:[e.jsx(K,{children:"Tags"}),e.jsx(xs,{values:h,setValues:b,placeholder:"Add tag..."})]}),e.jsxs("div",{className:"mt-2 d-flex justify-content-end",children:[e.jsx(Z.LinkContainer,{to:i?"/Discuss/"+i:"/Discuss",children:e.jsx(g,{type:"button",variant:"secondary",disabled:m,children:"Cancel"})}),i?e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"secondary",className:"ms-2",type:"button",onClick:()=>v(!0),disabled:m,children:"Delete"}),e.jsx(g,{variant:"primary",className:"ms-2",type:"button",onClick:w,disabled:N,children:"Save changes"})]}):e.jsx(g,{className:"ms-2",variant:"primary",type:"button",onClick:w,disabled:N,children:"Post question"})]})]})]})},xe=$e.forwardRef(({answer:i,acceptedAnswer:d,toggleAcceptedAnswer:x,isQuestionOwner:l,showEditAnswer:a,newlyCreatedAnswer:u,onShowVoters:S},h)=>{const{sendJsonRequest:b}=q(),{userInfo:m}=X(),[j,k]=n.useState(i.isUpvoted),[p,P]=n.useState(i.votes),v=(m==null?void 0:m.id)===i.userId,o=$(),w=async()=>{if(!m){o("/Users/Login");return}const f=j?0:1;(await b("/Discussion/VotePost","POST",{postId:i.id,vote:f})).vote===f&&(k(f===1),P(p+(f?1:-1)))},C=()=>{S(i.id)};let Q=d===i.id,D=u===i.id?"beige":"white",N=e.jsxs("div",{className:"gap-2 d-flex flex-column border-bottom border-2 py-2",style:{background:D},children:[e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("div",{className:"d-flex flex-column align-items-center",children:[(l||Q)&&e.jsx("div",{onClick:()=>x(i.id),className:"wb-discuss-reply__actions__best-answer-button"+(Q?" text-success":" text-secondary"),style:{cursor:l?"pointer":"default"},children:e.jsx(es,{})}),e.jsxs("div",{className:"wb-discuss-voting mt-2",children:[e.jsx("span",{onClick:w,className:"wb-icon-button"+(j?" text-black":""),children:e.jsx(je,{})}),e.jsx("b",{className:"wb-icon-button text-black",onClick:C,children:p})]})]}),e.jsxs("div",{className:"flex-grow-1 d-flex flex-column gap-2",style:{minWidth:0},children:[e.jsx("div",{className:"d-flex justify-content-end align-items-center",children:v&&e.jsx("span",{style:{cursor:"pointer"},onClick:()=>a(i.id),children:e.jsx(ss,{})})}),e.jsx("div",{className:"mt-1",children:e.jsx(Ce,{content:i.message,allowedUrls:Pe})}),e.jsx("div",{className:"mt-2",children:i.attachments.map(f=>e.jsx("div",{className:"mt-1",children:e.jsx(De,{data:f})},f.id))})]})]}),e.jsx("div",{className:"d-flex justify-content-end align-items-end mt-1",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("small",{className:"text-secondary",children:ge.format(new Date(i.date))})}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(pe,{userId:i.userId,userName:i.userName})})]}),e.jsx("div",{className:"ms-2",children:e.jsx(ve,{size:32,avatarImage:i.userAvatar})})]})})]});return h?e.jsx("div",{ref:h,children:N}):e.jsx("div",{children:N})}),ws=()=>{const{sendJsonRequest:i}=q(),{questionId:d}=we(),x=$(),{userInfo:l}=X(),[a,u]=n.useState(null),[S,h]=n.useState(["",""]),[b,m]=n.useState(!1),[j,k]=n.useState(!1),[p,P]=n.useState(1),v=10,[o,w]=n.useState([]),C=n.useRef(null),[Q,F]=n.useState(!1),[D,N]=n.useState(""),[t,f]=n.useState(null),[T,R]=n.useState(null),[ke,ee]=n.useState(!1),[se,_]=n.useState(1),[y,te]=fe(),U=ts(),[L,J]=n.useState(null),G=n.useRef(null),ne=n.useRef(null),[Fe,Qe]=n.useState(""),[Te,Y]=n.useState(!1),[Ee,ae]=n.useState({parentId:""}),[Me,Re]=n.useState(!1),[ie,Le]=n.useState(!1);ns(Fe),n.useEffect(()=>{const s=(l==null?void 0:l.roles.some(r=>["Admin","Moderator"].includes(r)))||!1;Re(s)},[l]),n.useEffect(()=>{a&&Qe(a.title+" | Webler Codes")},[a]),n.useEffect(()=>{U.state&&U.state.postId&&(J(U.state.postId),_(2))},[U]),n.useEffect(()=>{y.has("page")&&P(Number(y.get("page"))),y.has("filter")&&_(Number(y.get("filter")))},[]),n.useEffect(()=>{Ve()},[d]),n.useEffect(()=>{qe()},[y,d,L]),n.useEffect(()=>{le(1)},[se]);const le=s=>{s!==p&&(J(null),y.set("page",s.toString()),te(y,{replace:!0}),P(s))},Ie=s=>{const r=Number(s.target.selectedOptions[0].value);y.set("filter",r.toString()),te(y,{replace:!0}),_(r),J(null)},Ve=async()=>{m(!0);const s=await i("/Discussion/GetQuestion","POST",{questionId:d});s&&s.question&&u(s.question),m(!1)},qe=async()=>{k(!0);const s=y.has("page")?Number(y.get("page")):1,r=y.has("filter")?Number(y.get("filter")):1,c=await i("/Discussion/GetQuestionReplies","POST",{questionId:d,index:(s-1)*v,count:v,filter:r,findPostId:L});if(c&&c.posts){w(c.posts),L&&(P(c.posts.length>0?Math.floor(c.posts[0].index/v)+1:1),setTimeout(()=>{G.current&&G.current.scrollIntoView({behavior:"smooth",block:"end"})}));let E=null;for(let W=0;W<c.posts.length;++W)if(c.posts[W].isAccepted){E=c.posts[W].id;break}f(E)}k(!1)},Ue=async()=>{if(!l){x("/Users/Login");return}m(!0);const s=await i("/Discussion/CreateReply","POST",{message:D,questionId:d});s&&s.post?(w(r=>[{...s.post,userName:l.name,userAvatar:l.avatarImage},...r]),u(r=>r?{...r,answers:r.answers+1}:null),O(),h(["success","Your answer was posted successfully"])):h(["danger",s!=null&&s.error?s.error.message:s.message]),m(!1)},Oe=async()=>{if(!l){x("/Users/Login");return}m(!0);const s=await i("/Discussion/EditReply","PUT",{message:D,replyId:T});s&&s.success?(w(r=>{const c=[...r];for(let E=0;E<c.length;++E)c[E].id===T&&(c[E].message=s.data.message,c[E].attachments=s.data.attachments);return c}),O(),h(["success","Your answer was updated successfully"])):h(["danger",s!=null&&s.error?s.error.message:s.message]),m(!1)},re=(s,r)=>{l?(h(["",""]),F(!0),N(s),R(r),setTimeout(()=>{C.current&&C.current.scrollIntoView({behavior:"smooth",block:"end"}),ne.current&&ne.current.focus()})):x("/Users/Login")},O=()=>{F(!1),N("")},oe=async s=>{const r=await i("/Discussion/ToggleAcceptedAnswer","POST",{postId:s,accepted:s!==t});r&&r.success&&f(s===t?null:s)},ce=s=>{const r=o.find(c=>c.id==s);r&&re(r.message,s)},H=()=>{ee(!1)},He=()=>{Y(!1)},de=(s=!1)=>{ee(!0),Le(s)},We=async()=>{m(!0);const s=await i("/Discussion/DeleteReply","DELETE",{replyId:T});s&&s.success?(H(),O(),w(r=>r.filter(c=>c.id!==T)),u(r=>r?{...r,answers:r.answers-1}:null)):h(["danger",s!=null&&s.error?s.error._message:s.message]),m(!1)},ze=async()=>{m(!0);const s=await i("/Discussion/DeleteQuestion","DELETE",{questionId:d});s&&s.success?(H(),x("/Discuss")):h(["danger",s!=null&&s.error?s.error._message:s.message]),m(!1)},Be=async()=>{ie?ze():We()},_e=async()=>{if(!a)return;if(!l){x("/Users/Login");return}const s=a.isUpvoted?0:1;(await i("/Discussion/VotePost","POST",{postId:d,vote:s})).vote===s&&u(c=>c?{...c,votes:c.votes+(s?1:-1),isUpvoted:s===1}:null)},Je=async()=>{if(!a)return;if(!l){x("/Users/Login");return}const s=a.isFollowed,r=await i(s?"/Discussion/UnfollowQuestion":"/Discussion/FollowQuestion","POST",{postId:d});r&&r.success&&u(c=>c?{...c,isFollowed:!s}:null)},Ge=()=>{a!=null&&a.id&&(ae({parentId:a.id}),Y(!0))},ue=s=>{ae({parentId:s}),Y(!0)};let me=[];for(let s=0;s<v;++s)me.push(e.jsx(Ne,{},s));return a!==null?e.jsxs(e.Fragment,{children:[e.jsxs(A,{show:ke,onHide:H,centered:!0,children:[e.jsx(A.Header,{closeButton:!0,children:e.jsx(A.Title,{children:"Are you sure?"})}),e.jsxs(A.Body,{children:["Your ",ie?"Question":"Answer"," will be permanently deleted."]}),e.jsxs(A.Footer,{children:[e.jsx(g,{variant:"secondary",onClick:H,children:"Cancel"}),e.jsx(g,{variant:"danger",onClick:Be,children:"Confirm"})]})]}),e.jsx(gs,{title:"Likes",options:Ee,visible:Te,onClose:He,showReactions:!0,countPerPage:10}),e.jsxs("div",{className:"d-flex gap-2 py-2",children:[e.jsx(he,{to:"/Discuss",children:"Q&A"}),e.jsx("span",{children:"›"}),e.jsx("span",{children:js(a.title,20)})]}),e.jsxs("div",{className:"mb-3 d-flex flex-column position-relative",children:[e.jsx("div",{className:"wb-edit-button",children:e.jsxs(M,{drop:"start",children:[e.jsx(M.Toggle,{as}),e.jsxs(M.Menu,{children:[l&&e.jsxs(e.Fragment,{children:[a&&a.userId===l.id&&e.jsx(Z.LinkContainer,{to:"/Discuss/Edit/"+d,children:e.jsx(M.Item,{children:"Edit"})}),e.jsx(M.Item,{onClick:Je,children:a.isFollowed?"Unfollow":"Follow"})]}),e.jsx(M.Item,{onClick:()=>{navigator.clipboard.writeText(window.location.href)},children:"Share"}),l&&(Me||a&&a.userId===l.id)&&e.jsx(M.Item,{onClick:()=>de(!0),children:"Delete"})]})]})}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("div",{className:"d-flex flex-column align-items-center",children:[e.jsxs("div",{className:"wb-discuss-voting",children:[e.jsx("span",{onClick:_e,className:"wb-icon-button"+(a.isUpvoted?" text-black":""),children:e.jsx(je,{})}),e.jsx("b",{className:"wb-icon-button text-black",onClick:Ge,children:a.votes})]}),e.jsx("div",{children:e.jsx("span",{className:a.isFollowed?"text-warning":"text-secondary",children:e.jsx(is,{})})})]}),e.jsxs("div",{className:"flex-grow-1 d-flex flex-column gap-2",style:{minWidth:"0"},children:[e.jsx("h3",{className:"wb-discuss-question__title",children:a.title}),e.jsx("div",{className:"d-flex mb-1 flex-wrap gap-1",children:a.tags.map((s,r)=>e.jsx(fs,{name:s,state:"neutral"},r))}),e.jsx("div",{className:"mt-1",children:e.jsx(Ce,{content:a.message,allowedUrls:Pe})}),e.jsx("div",{className:"mt-1",children:a.attachments.map(s=>e.jsx("div",{className:"mt-1",children:e.jsx(De,{data:s})},s.id))})]})]}),e.jsxs("div",{className:"d-flex justify-content-end mt-2 align-items-center gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("small",{children:ge.format(new Date(a.date))})}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(pe,{userId:a.userId,userName:a.userName})})]}),e.jsx(ve,{size:32,avatarImage:a.userAvatar})]})]}),S[1]&&e.jsx(ls,{variant:S[0],onClose:()=>h(["",""]),dismissible:!0,children:S[1]}),e.jsx("div",{hidden:!Q,className:"mt-2 border bg-white rounded p-2",children:e.jsxs(V,{ref:C,children:[e.jsxs(B,{children:[e.jsx(K,{children:e.jsx("b",{children:l==null?void 0:l.name})}),e.jsx(Se,{text:D,setText:N,row:10,placeHolder:"Write your reply here..."})]}),e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx(g,{size:"sm",variant:"secondary",onClick:O,disabled:b,children:"Cancel"}),T===null?e.jsx(e.Fragment,{children:e.jsx(g,{size:"sm",variant:"primary",className:"ms-2",onClick:Ue,disabled:b||D.length===0,children:"Post"})}):e.jsxs(e.Fragment,{children:[e.jsx(g,{size:"sm",variant:"secondary",className:"ms-2",onClick:()=>de(!1),disabled:b,children:"Delete"}),e.jsx(g,{size:"sm",variant:"primary",className:"ms-2",onClick:Oe,disabled:b||D.length===0,children:"Save"})]})]})]})}),e.jsx("div",{className:"d-flex",children:e.jsxs("h4",{children:[a.answers," Answers"]})}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs(V.Select,{size:"sm",style:{width:"140px"},value:se,onChange:Ie,children:[e.jsx("option",{value:"1",children:"Sort by: Votes"}),e.jsx("option",{value:"2",children:"Sort by: Date"})]}),e.jsx(g,{size:"sm",variant:"primary",className:"ms-2",onClick:()=>re("",null),children:"Answer"})]}),e.jsx("div",{className:"mt-2 d-flex flex-column w-100",children:j?me:o.map(s=>L===s.id?e.jsx(xe,{ref:G,answer:s,acceptedAnswer:t,toggleAcceptedAnswer:oe,isQuestionOwner:(l==null?void 0:l.id)===a.userId,showEditAnswer:ce,newlyCreatedAnswer:L,onShowVoters:ue},s.id):e.jsx(xe,{answer:s,acceptedAnswer:t,toggleAcceptedAnswer:oe,isQuestionOwner:(l==null?void 0:l.id)===a.userId,showEditAnswer:ce,newlyCreatedAnswer:L,onShowVoters:ue},s.id))}),e.jsx("div",{className:"my-3",children:e.jsx(be,{page:p,between:3,total:a.answers,limit:v,changePage:le,ellipsis:1})})]}):!b&&e.jsxs("div",{className:"d-flex h-100 flex-column align-items-center justify-content-center text-center",children:[e.jsx("h4",{children:e.jsx(rs,{})}),e.jsx("h5",{children:"Question not found"}),e.jsx("div",{children:e.jsx(he,{to:"/Discuss",children:"Go back"})})]})},ys=()=>{const{questionId:i}=we();return e.jsx(Ae,{questionId:i})};const Rs=()=>e.jsx(os,{children:e.jsxs(I,{element:e.jsx(cs,{Header:e.jsx(ds,{variant:"light"}),Footer:e.jsx(us,{})}),children:[e.jsx(I,{index:!0,element:e.jsx(z,{MainPage:e.jsx(vs,{})})}),e.jsx(I,{path:":questionId",element:e.jsx(z,{MainPage:e.jsx(ws,{})})}),e.jsxs(I,{element:e.jsx(ms,{allowedRoles:ps}),children:[e.jsx(I,{path:"New",element:e.jsx(z,{MainPage:e.jsx(Ae,{questionId:null})})}),e.jsx(I,{path:"Edit/:questionId",element:e.jsx(z,{MainPage:e.jsx(ys,{})})})]})]})});export{Rs as default};
