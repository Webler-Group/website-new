import{K as xe,u as V,r as n,j as e,M as Be,b as $,af as fe,m as Z,Z as X,B as g,J as ee,d as He,aa as z,ab as W,F as Je,R as Ge,a3 as Ye,am as je,a9 as Ke,D as ge,c as pe,P as ve,H as we,ag as Ze,a2 as me,$ as q,a0 as $e,an as Xe,A as es,ao as ss,O as ts,Q as M,S as ns,U as as,al as is,V as rs}from"./index-30c62725.js";import{Q as ye,T as ls,I as os,W as cs}from"./Question-059953bf.js";import{P as be}from"./react-bootstrap-pagination-control.esm-f4f0cce8.js";import{Q as Ne}from"./QuestionPlaceholder-cbabff55.js";import{P as Se,R as ds}from"./ReactionsList-b50d12d1.js";import{M as k}from"./Modal-a497ee33.js";import{P as Pe}from"./UserSearch-4fecda3c.js";import{a as De}from"./discussAllowedUrls-4f3044c5.js";import{M as Ce}from"./MarkdownRenderer-81a80de0.js";import{t as us}from"./StringUtils-91be14c5.js";import{r as ms}from"./roles-68ed67e6.js";const O=({MainPage:a})=>{xe("Q&A Discussions | Webler Codes",!1);const{sendJsonRequest:u}=V(),[f,l]=n.useState([]);n.useEffect(()=>{i()},[]);const i=async()=>{const d=await u("/Discussion","POST",{page:1,count:10,searchQuery:"",filter:5,userId:null});d&&d.questions&&l(d.questions)};return e.jsx("div",{className:"bg-white",children:e.jsx(Be,{children:e.jsxs("div",{className:"wb-discuss-questions-list-page row pt-2",children:[e.jsx("div",{className:"col-12 col-md-8",children:a}),e.jsxs("div",{className:"col-12 col-md-4",children:[e.jsx("h2",{children:"Hot today"}),e.jsx("div",{className:"my-3",children:f.map(d=>e.jsx("div",{className:"mb-2",children:e.jsx(ye,{question:d,searchQuery:"",showUserProfile:!1})},d.id))})]})]})})})},hs=()=>{const{sendJsonRequest:a}=V(),{userInfo:u}=$(),[f,l]=n.useState([]),i=10,[d,P]=n.useState(1),[h,b]=n.useState(0),[m,j]=n.useState(!1),[F,p]=n.useState(1),[D,v]=n.useState(""),[o,w]=fe();n.useEffect(()=>{Q()},[o]),n.useEffect(()=>{C(1)},[F,D]),n.useEffect(()=>{o.has("page")&&P(Number(o.get("page"))),o.has("filter")&&p(Number(o.get("filter"))),o.has("query")&&v(o.get("query"))},[]);const C=t=>{d!==t&&(o.set("page",t.toString()),w(o,{replace:!0}),P(t))},T=t=>{o.set("query",t),w(o,{replace:!0}),v(t)},Q=async()=>{j(!0);const t=o.has("page")?Number(o.get("page")):1,x=o.has("filter")?Number(o.get("filter")):1,L=o.has("query")?o.get("query"):"",A=await a("/Discussion","POST",{page:t,count:i,filter:x,searchQuery:L,userId:u?u.id:null});A&&A.questions&&(l(A.questions),b(A.count)),j(!1)},N=t=>{const x=Number(t.target.selectedOptions[0].value);o.set("filter",x.toString()),w(o,{replace:!0}),p(x)};let S=[];for(let t=0;t<i;++t)S.push(e.jsx(Ne,{},t));return e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("h2",{children:"Q&A Discussions"}),e.jsx("div",{className:"mt-2",children:e.jsx(ls,{placeholder:"Search by tags or title...",maxWidthPx:360,query:D,handleSearch:T})}),e.jsxs("div",{className:"mt-2 d-flex justify-content-between",children:[e.jsxs(Z.Select,{style:{width:"140px"},size:"sm",value:F,onChange:N,children:[e.jsx("option",{value:"1",children:"Most Recent"}),e.jsx("option",{value:"2",children:"Unanswered"}),e.jsx("option",{value:"6",children:"Trending"}),u&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"3",children:"My Questions"}),e.jsx("option",{value:"4",children:"My Answers"})]})]}),e.jsx(X.LinkContainer,{to:"/Discuss/New",children:e.jsx(g,{size:"sm",children:"Ask a question"})})]}),e.jsx("div",{className:"mt-2",children:m?S:h==0?e.jsx("div",{className:"wb-discuss-empty-questions",children:e.jsx("h3",{children:"Nothing to show"})}):f.map(t=>e.jsx(ye,{question:t,searchQuery:D,showUserProfile:!0},t.id))}),e.jsx("div",{className:"my-3",children:e.jsx(be,{page:d,between:3,total:h,limit:i,changePage:C,ellipsis:1})})]})},Ae=({questionId:a})=>{const{sendJsonRequest:u}=V(),f=ee(),[l,i]=n.useState(""),[d,P]=n.useState(""),[h,b]=n.useState([]),[m,j]=n.useState(!1),[F,p]=n.useState(),[D,v]=n.useState(!1);n.useEffect(()=>{a&&o()},[a]);const o=async()=>{j(!0);const t=await u("/Discussion/GetQuestion","POST",{questionId:a});t&&t.question&&(i(t.question.title),P(t.question.message),b(t.question.tags)),j(!1)},w=async()=>{j(!0),p(void 0),a?await T():await C(),j(!1)},C=async()=>{const t=await u("/Discussion/CreateQuestion","POST",{title:l,message:d,tags:h});t&&t.question?f("/Discuss/"+t.question.id):p(t.error)},T=async()=>{const t=await u("/Discussion/EditQuestion","PUT",{questionId:a,title:l,message:d,tags:h});t&&t.success?f("/Discuss/"+a):p(t.error)},Q=()=>{v(!1)},N=async()=>{j(!0);const t=await u("/Discussion/DeleteQuestion","DELETE",{questionId:a});t&&t.success?(Q(),f("/Discuss?filter=3")):p(t!=null&&t.error?t.error.message:t.message),j(!1)};let S=m||l.trim().length==0||d.trim().length==0;return e.jsxs(e.Fragment,{children:[e.jsxs(k,{show:D,onHide:Q,centered:!0,children:[e.jsx(k.Header,{closeButton:!0,children:e.jsx(k.Title,{children:"Are you sure?"})}),e.jsx(k.Body,{children:"Your question will be permanently deleted."}),e.jsxs(k.Footer,{children:[e.jsx(g,{variant:"secondary",onClick:Q,children:"Cancel"}),e.jsx(g,{variant:"danger",onClick:N,children:"Delete"})]})]}),a===null&&e.jsx("h2",{className:"mb-4",children:"Ask the community a question"}),e.jsxs("div",{className:"small",children:[e.jsx(He,{errors:F}),e.jsxs(z,{children:[e.jsx(W,{children:"Your question"}),e.jsx(Je,{size:"sm",placeholder:"What would you like to know?",type:"text",required:!0,value:l,onChange:t=>i(t.target.value)}),e.jsx("p",{className:"text-secondary",children:"Tip: write as if asking a friend, being as specific as possible"})]}),e.jsxs(z,{children:[e.jsx(W,{children:"Description"}),e.jsx(Se,{size:"sm",placeholder:"Include as much detail as possible to get the most relevant answers.",rows:10,maxLength:4096,required:!0,value:d,setValue:P})]}),e.jsxs(z,{children:[e.jsx(W,{children:"Tags"}),e.jsx(os,{values:h,setValues:b,placeholder:"Add tag..."})]}),e.jsxs("div",{className:"mt-2 d-flex justify-content-end",children:[e.jsx(X.LinkContainer,{to:a?"/Discuss/"+a:"/Discuss",children:e.jsx(g,{size:"sm",type:"button",variant:"secondary",disabled:m,children:"Cancel"})}),a?e.jsxs(e.Fragment,{children:[e.jsx(g,{size:"sm",variant:"secondary",className:"ms-2",type:"button",onClick:()=>v(!0),disabled:m,children:"Delete"}),e.jsx(g,{size:"sm",variant:"primary",className:"ms-2",type:"button",onClick:w,disabled:S,children:"Save changes"})]}):e.jsx(g,{size:"sm",className:"ms-2",variant:"primary",type:"button",onClick:w,disabled:S,children:"Post question"})]})]})]})},he=Ge.forwardRef(({answer:a,acceptedAnswer:u,toggleAcceptedAnswer:f,isQuestionOwner:l,showEditAnswer:i,newlyCreatedAnswer:d,onShowVoters:P},h)=>{const{sendJsonRequest:b}=V(),{userInfo:m}=$(),[j,F]=n.useState(a.isUpvoted),[p,D]=n.useState(a.votes),v=(m==null?void 0:m.id)===a.userId,o=ee(),w=async()=>{if(!m){o("/Users/Login");return}const x=j?0:1;(await b("/Discussion/VotePost","POST",{postId:a.id,vote:x})).vote===x&&(F(x===1),D(p+(x?1:-1)))},C=()=>{P(a.id)};let T=u===a.id,N=d===a.id?"beige":"white",S=e.jsxs("div",{className:"gap-2 d-flex flex-column border-bottom border-2 py-2",style:{background:N},children:[e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("div",{className:"d-flex flex-column align-items-center",children:[(l||T)&&e.jsx("div",{onClick:()=>f(a.id),className:"wb-discuss-reply__actions__best-answer-button"+(T?" text-success":" text-secondary"),style:{cursor:l?"pointer":"default"},children:e.jsx(Ye,{})}),e.jsxs("div",{className:"wb-discuss-voting mt-2",children:[e.jsx("span",{onClick:w,className:"wb-discuss-voting__button"+(j?" text-black":""),children:e.jsx(je,{})}),e.jsx("b",{className:"wb-discuss-voting__button text-black",onClick:C,children:p})]})]}),e.jsxs("div",{className:"flex-grow-1 d-flex flex-column gap-2",style:{minWidth:0},children:[e.jsx("div",{className:"d-flex justify-content-end align-items-center",children:v&&e.jsx("span",{style:{cursor:"pointer"},onClick:()=>i(a.id),children:e.jsx(Ke,{})})}),e.jsx("div",{className:"wb-discuss-question__description",children:e.jsx(Ce,{content:a.message,allowedUrls:De})}),e.jsx("div",{className:"mt-2",children:a.attachments.map(x=>e.jsx("div",{className:"mt-1",children:e.jsx(Pe,{data:x})},x.id))})]})]}),e.jsx("div",{className:"d-flex justify-content-end align-items-end mt-1",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("small",{className:"text-secondary",children:ge.format(new Date(a.date))})}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(pe,{userId:a.userId,userName:a.userName})})]}),e.jsx("div",{className:"ms-2 wb-p-follow-item__avatar",children:e.jsx(ve,{size:32,avatarImage:a.userAvatar})})]})})]});return h?e.jsx("div",{ref:h,children:S}):e.jsx("div",{children:S})}),xs=()=>{const{sendJsonRequest:a}=V(),{questionId:u}=we(),f=ee(),{userInfo:l}=$(),[i,d]=n.useState(null),[P,h]=n.useState(["",""]),[b,m]=n.useState(!1),[j,F]=n.useState(!1),[p,D]=n.useState(1),v=10,[o,w]=n.useState([]),C=n.useRef(null),[T,Q]=n.useState(!1),[N,S]=n.useState(""),t=4096,[x,L]=n.useState(null),[A,ke]=n.useState(null),[Fe,se]=n.useState(!1),[te,B]=n.useState(1),[y,ne]=fe(),I=Ze(),[E,H]=n.useState(null),J=n.useRef(null),G=n.useRef(null),[Qe,Te]=n.useState(""),[Re,Y]=n.useState(!1),[Ee,ae]=n.useState({parentId:""});xe(Qe),n.useEffect(()=>{i&&Te(i.title+" | Webler Codes")},[i]),n.useEffect(()=>{I.state&&I.state.postId&&(H(I.state.postId),B(2))},[I]),n.useEffect(()=>{y.has("page")&&D(Number(y.get("page"))),y.has("filter")&&B(Number(y.get("filter")))},[]),n.useEffect(()=>{Me()},[u]),n.useEffect(()=>{Le()},[y,u,E]),n.useEffect(()=>{ie(1)},[te]);const ie=s=>{s!==p&&(H(null),y.set("page",s.toString()),ne(y,{replace:!0}),D(s))},qe=s=>{const r=Number(s.target.selectedOptions[0].value);y.set("filter",r.toString()),ne(y,{replace:!0}),B(r),H(null)},Me=async()=>{m(!0);const s=await a("/Discussion/GetQuestion","POST",{questionId:u});s&&s.question&&d(s.question),m(!1)},Le=async()=>{F(!0);const s=y.has("page")?Number(y.get("page")):1,r=y.has("filter")?Number(y.get("filter")):1,c=await a("/Discussion/GetQuestionReplies","POST",{questionId:u,index:(s-1)*v,count:v,filter:r,findPostId:E});if(c&&c.posts){w(c.posts),E&&(D(c.posts.length>0?Math.floor(c.posts[0].index/v)+1:1),setTimeout(()=>{J.current&&J.current.scrollIntoView({behavior:"smooth",block:"end"})}));let R=null;for(let U=0;U<c.posts.length;++U)if(c.posts[U].isAccepted){R=c.posts[U].id;break}L(R)}F(!1)},Ve=async()=>{if(!l){f("/Users/Login");return}m(!0);const s=await a("/Discussion/CreateReply","POST",{message:N,questionId:u});s&&s.post?(w(r=>[{...s.post,userName:l.name,userAvatar:l.avatarImage},...r]),d(r=>r?{...r,answers:r.answers+1}:null),_(),h(["success","Your answer was posted successfully"])):h(["danger",s!=null&&s.error?s.error.message:s.message]),m(!1)},Ie=async()=>{if(!l){f("/Users/Login");return}m(!0);const s=await a("/Discussion/EditReply","PUT",{message:N,replyId:A});s&&s.success?(w(r=>{const c=[...r];for(let R=0;R<c.length;++R)c[R].id===A&&(c[R].message=s.data.message,c[R].attachments=s.data.attachments);return c}),_(),h(["success","Your answer was updated successfully"])):h(["danger",s!=null&&s.error?s.error.message:s.message]),m(!1)},re=(s,r)=>{l?(h(["",""]),Q(!0),S(s),ke(r),setTimeout(()=>{C.current&&C.current.scrollIntoView({behavior:"smooth",block:"end"}),G.current&&G.current.focus()})):f("/Users/Login")},_=()=>{Q(!1),S("")},le=async s=>{const r=await a("/Discussion/ToggleAcceptedAnswer","POST",{postId:s,accepted:s!==x});r&&r.success&&L(s===x?null:s)},oe=s=>{const r=o.find(c=>c.id==s);r&&re(r.message,s)},K=()=>{se(!1)},_e=()=>{Y(!1)},Ue=async()=>{m(!0);const s=await a("/Discussion/DeleteReply","DELETE",{replyId:A});s&&s.success?(K(),_(),w(r=>r.filter(c=>c.id!==A)),d(r=>r?{...r,answers:r.answers-1}:null)):h(["danger",s!=null&&s.error?s.error._message:s.message]),m(!1)},Oe=async()=>{if(!i)return;if(!l){f("/Users/Login");return}const s=i.isUpvoted?0:1;(await a("/Discussion/VotePost","POST",{postId:u,vote:s})).vote===s&&d(c=>c?{...c,votes:c.votes+(s?1:-1),isUpvoted:s===1}:null)},ze=async()=>{if(!i)return;if(!l){f("/Users/Login");return}const s=i.isFollowed,r=await a(s?"/Discussion/UnfollowQuestion":"/Discussion/FollowQuestion","POST",{postId:u});r&&r.success&&d(c=>c?{...c,isFollowed:!s}:null)},We=()=>{i!=null&&i.id&&(ae({parentId:i.id}),Y(!0))},ce=s=>{ae({parentId:s}),Y(!0)};let de=t-N.length,ue=[];for(let s=0;s<v;++s)ue.push(e.jsx(Ne,{},s));return i!==null?e.jsxs(e.Fragment,{children:[e.jsxs(k,{show:Fe,onHide:K,centered:!0,children:[e.jsx(k.Header,{closeButton:!0,children:e.jsx(k.Title,{children:"Are you sure?"})}),e.jsx(k.Body,{children:"Your answer will be permanently deleted."}),e.jsxs(k.Footer,{children:[e.jsx(g,{variant:"secondary",onClick:K,children:"Cancel"}),e.jsx(g,{variant:"danger",onClick:Ue,children:"Delete"})]})]}),e.jsx(ds,{title:"Likes",options:Ee,visible:Re,onClose:_e,showReactions:!0,countPerPage:10}),e.jsxs("div",{className:"d-flex gap-2 py-2",children:[e.jsx(me,{to:"/Discuss",children:"Q&A"}),e.jsx("span",{children:"›"}),e.jsx("span",{children:us(i.title,20)})]}),e.jsxs("div",{className:"mb-3 d-flex flex-column position-relative",children:[e.jsx("div",{className:"wb-discuss-reply__edit-button",children:e.jsxs(q,{drop:"start",children:[e.jsx(q.Toggle,{as:$e}),e.jsxs(q.Menu,{children:[l&&e.jsxs(e.Fragment,{children:[i&&i.userId===l.id&&e.jsx(X.LinkContainer,{to:"/Discuss/Edit/"+u,children:e.jsx(q.Item,{children:"Edit"})}),e.jsx(q.Item,{onClick:ze,children:i.isFollowed?"Unfollow":"Follow"})]}),e.jsx(q.Item,{onClick:()=>{navigator.clipboard.writeText(window.location.href)},children:"Share"})]})]})}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("div",{className:"d-flex flex-column align-items-center",children:[e.jsxs("div",{className:"wb-discuss-voting",children:[e.jsx("span",{onClick:Oe,className:"wb-discuss-voting__button"+(i.isUpvoted?" text-black":""),children:e.jsx(je,{})}),e.jsx("b",{className:"wb-discuss-voting__button text-black",onClick:We,children:i.votes})]}),e.jsx("div",{children:e.jsx("span",{className:i.isFollowed?"text-warning":"text-secondary",children:e.jsx(Xe,{})})})]}),e.jsxs("div",{className:"flex-grow-1 d-flex flex-column gap-2",style:{minWidth:"0"},children:[e.jsx("h3",{className:"wb-discuss-question__title",children:i.title}),e.jsx("div",{className:"d-flex mb-1 flex-wrap gap-1",children:i.tags.map((s,r)=>e.jsx(cs,{name:s,state:"neutral"},r))}),e.jsx("div",{className:"mt-1 wb-discuss-question__description",children:e.jsx(Ce,{content:i.message,allowedUrls:De})}),e.jsx("div",{className:"mt-1",children:i.attachments.map(s=>e.jsx("div",{className:"mt-1",children:e.jsx(Pe,{data:s})},s.id))})]})]}),e.jsxs("div",{className:"d-flex justify-content-end mt-2 align-items-center gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("small",{children:ge.format(new Date(i.date))})}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(pe,{userId:i.userId,userName:i.userName})})]}),e.jsx(ve,{size:32,avatarImage:i.userAvatar})]})]}),P[1]&&e.jsx(es,{variant:P[0],onClose:()=>h(["",""]),dismissible:!0,children:P[1]}),e.jsx("div",{hidden:!T,className:"mt-2 border bg-white rounded p-2",children:e.jsxs(Z,{ref:C,children:[e.jsxs(z,{children:[e.jsx(W,{children:e.jsx("b",{children:l==null?void 0:l.name})}),e.jsx(Se,{ref:G,rows:10,placeholder:"Write your reply here...",required:!0,maxLength:t,value:N,setValue:S}),e.jsxs("p",{className:de>0?"text-secondary":"text-danger",children:[de," characters remaining"]})]}),e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx(g,{size:"sm",variant:"secondary",onClick:_,disabled:b,children:"Cancel"}),A===null?e.jsx(e.Fragment,{children:e.jsx(g,{size:"sm",variant:"primary",className:"ms-2",onClick:Ve,disabled:b||N.length===0,children:"Post"})}):e.jsxs(e.Fragment,{children:[e.jsx(g,{size:"sm",variant:"secondary",className:"ms-2",onClick:()=>se(!0),disabled:b,children:"Delete"}),e.jsx(g,{size:"sm",variant:"primary",className:"ms-2",onClick:Ie,disabled:b||N.length===0,children:"Save"})]})]})]})}),e.jsx("div",{className:"d-flex",children:e.jsxs("h4",{children:[i.answers," Answers"]})}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs(Z.Select,{size:"sm",style:{width:"140px"},value:te,onChange:qe,children:[e.jsx("option",{value:"1",children:"Sort by: Votes"}),e.jsx("option",{value:"2",children:"Sort by: Date"})]}),e.jsx(g,{size:"sm",variant:"primary",className:"ms-2",onClick:()=>re("",null),children:"Answer"})]}),e.jsx("div",{className:"mt-2 d-flex flex-column w-100",children:j?ue:o.map(s=>E===s.id?e.jsx(he,{ref:J,answer:s,acceptedAnswer:x,toggleAcceptedAnswer:le,isQuestionOwner:(l==null?void 0:l.id)===i.userId,showEditAnswer:oe,newlyCreatedAnswer:E,onShowVoters:ce},s.id):e.jsx(he,{answer:s,acceptedAnswer:x,toggleAcceptedAnswer:le,isQuestionOwner:(l==null?void 0:l.id)===i.userId,showEditAnswer:oe,newlyCreatedAnswer:E,onShowVoters:ce},s.id))}),e.jsx("div",{className:"my-3",children:e.jsx(be,{page:p,between:3,total:i.answers,limit:v,changePage:ie,ellipsis:1})})]}):!b&&e.jsxs("div",{className:"d-flex h-100 flex-column align-items-center justify-content-center text-center",children:[e.jsx("h4",{children:e.jsx(ss,{})}),e.jsx("h5",{children:"Question not found"}),e.jsx("div",{children:e.jsx(me,{to:"/Discuss",children:"Go back"})})]})},fs=()=>{const{questionId:a}=we();return e.jsx(Ae,{questionId:a})},Cs=()=>e.jsx(ts,{children:e.jsxs(M,{element:e.jsx(ns,{Header:e.jsx(as,{variant:"light"}),Footer:e.jsx(is,{})}),children:[e.jsx(M,{index:!0,element:e.jsx(O,{MainPage:e.jsx(hs,{})})}),e.jsx(M,{path:":questionId",element:e.jsx(O,{MainPage:e.jsx(xs,{})})}),e.jsxs(M,{element:e.jsx(rs,{allowedRoles:ms}),children:[e.jsx(M,{path:"New",element:e.jsx(O,{MainPage:e.jsx(Ae,{questionId:null})})}),e.jsx(M,{path:"Edit/:questionId",element:e.jsx(O,{MainPage:e.jsx(fs,{})})})]})]})});export{Cs as default};
