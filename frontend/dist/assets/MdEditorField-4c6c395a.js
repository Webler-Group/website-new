import{r as n,u as V,j as e,c as X,B as F,aO as le,aP as ie,ai as re,aQ as oe,d as ce,e as de,A as z,_,R as ue,a as me,X as W,F as P,at as he,h as ge}from"./index-39cfc24f.js";import{P as fe,M as xe}from"./PostTextareaControl-1c99a64b.js";import{P as je}from"./PostAttachmentSelect-ae1d51e6.js";import{M as I}from"./Modal-eb79c083.js";import{T as K}from"./Tab-875264b5.js";import{S as pe}from"./Spinner-f9aedc0f.js";import{a as L}from"./react-bootstrap-pagination-control.esm-95f9c811.js";const Y=n.forwardRef(({bsPrefix:f,size:x,vertical:l=!1,className:u,role:i="group",as:y="div",...m},s)=>{const d=V(f,"btn-group");let p=d;return l&&(p=`${d}-vertical`),e.jsx(y,{...m,ref:s,role:i,className:X(u,p,x&&`${d}-${x}`)})});Y.displayName="ButtonGroup";const be=Y,ve=()=>{},Z=n.forwardRef(({bsPrefix:f,name:x,className:l,checked:u,type:i,onChange:y,value:m,disabled:s,id:d,inputRef:p,...C},g)=>(f=V(f,"btn-check"),e.jsxs(e.Fragment,{children:[e.jsx("input",{className:f,name:x,type:i,value:m,ref:p,autoComplete:"off",checked:!!u,disabled:!!s,onChange:y||ve,id:d}),e.jsx(F,{...C,ref:g,className:X(l,s&&"disabled"),type:void 0,role:void 0,as:"label",htmlFor:d})]})));Z.displayName="ToggleButton";const q=Z,ye=n.forwardRef((f,x)=>{const{children:l,type:u="radio",name:i,value:y,onChange:m,vertical:s=!1,...d}=le(f,{value:"onChange"}),p=()=>y==null?[]:[].concat(y),C=(g,N)=>{if(!m)return;const w=p(),b=w.indexOf(g)!==-1;if(u==="radio"){b||m(g,N);return}m(b?w.filter(o=>o!==g):[...w,g],N)};return u!=="radio"||i||ie(!1),e.jsx(be,{...d,ref:x,vertical:s,children:re(l,g=>{const N=p(),{value:w,onChange:b}=g.props,o=U=>C(w,U);return n.cloneElement(g,{type:u,name:g.name||i,checked:N.indexOf(w)!==-1,onChange:oe(b,o)})})})}),Ne=Object.assign(ye,{Button:q}),we=[/^https?:\/\/.*/i,/^\/.*/];const Ce=({show:f,onHide:x,onSelect:l})=>{const{sendJsonRequest:u}=ce(),{userInfo:i}=de(),[y,m]=n.useState("library"),[s,d]=n.useState(1),p=10,[C,g]=n.useState(!1),[N,w]=n.useState(null),[b,o]=n.useState([]),[U,G]=n.useState(0),[a,c]=n.useState(""),[h,v]=n.useState(null),[j,T]=n.useState(!1),[E,S]=n.useState(null),[k,A]=n.useState(null),[M,$]=n.useState(null),[H,R]=n.useState(null),D=Math.max(1,Math.ceil(U/p)),ee=n.useMemo(()=>{const t=[],r=Math.max(1,s-2),ae=Math.min(D,s+2);for(let O=r;O<=ae;O++)t.push(O);return t},[s,D]),B=async(t=s)=>{if(!(i!=null&&i.id))return;g(!0),w(null);const r=await u("/Profile/GetPostImages","POST",{page:t,count:p,userId:i.id});r&&r.success?(o(r.data.items??[]),G(r.data.total??0),d(r.data.page??t)):w("Failed to load images"),g(!1)};n.useEffect(()=>{f&&(m("library"),d(1),o([]),G(0),c(""),v(null),S(null),R(null),A(null),$(null),B(1))},[f]);const Q=(t,r)=>{l(t,r||"image"),x()},te=async()=>{if(!(i!=null&&i.id))return;S(null);const t=a.trim();if(!h){S("Select a file");return}if(!t){S("Enter a name");return}if(t.length>80){S("Name is too long");return}T(!0);const r=await u("/Profile/UploadPostImage","POST",{postImage:h,name:t},void 0,!0);r&&r.success?(c(""),v(null),m("library"),await B(1),Q(r.data.url,r.data.name)):S("Upload failed"),T(!1)},se=(t,r)=>{R(null),A({id:t,name:r})},J=()=>{M||(A(null),R(null))},ne=async()=>{if(!k)return;R(null),$(k.id);const t=await u("/Profile/DeletePostImage","DELETE",{fileId:k.id});t&&t.success?(A(null),$(null),await B(b.length===1&&s>1?s-1:s)):(R("Delete failed"),$(null))};return e.jsxs(e.Fragment,{children:[e.jsxs(I,{style:{zIndex:1060},backdropClassName:"wb-user-images-delete-modal__backdrop",size:"sm",show:!!k,onHide:J,centered:!0,children:[e.jsx(I.Header,{closeButton:!0,children:e.jsx(I.Title,{children:"Are you sure?"})}),e.jsxs(I.Body,{children:[H&&e.jsx(z,{variant:"danger",className:"mb-2",children:H}),k?e.jsxs("div",{children:["Image ",e.jsx("span",{className:"fw-semibold",children:k.name})," will be permanently deleted."]}):null]}),e.jsxs(I.Footer,{children:[e.jsx(F,{variant:"secondary",onClick:J,disabled:!!M,children:"Cancel"}),e.jsx(F,{variant:"danger",onClick:ne,disabled:!!M,children:M?"Deleting...":"Delete"})]})]}),e.jsxs(I,{show:f,onHide:x,size:"lg",fullscreen:"sm-down",className:"d-flex justify-content-center align-items-center",contentClassName:"wb-modal__container user-images",children:[e.jsx(I.Header,{closeButton:!0,children:e.jsx(I.Title,{children:"Images"})}),e.jsx(I.Body,{className:"wb-user-images__body",children:e.jsxs(K.Container,{activeKey:y,onSelect:t=>m(t??"library"),children:[e.jsxs(_,{variant:"tabs",children:[e.jsx(_.Item,{children:e.jsx(_.Link,{eventKey:"library",children:"My images"})}),e.jsx(_.Item,{children:e.jsx(_.Link,{eventKey:"upload",children:"Upload"})})]}),e.jsxs(K.Content,{className:"pt-3 wb-user-images__tabcontent",children:[e.jsxs(K.Pane,{eventKey:"library",className:"wb-user-images__library",children:[N&&e.jsx(z,{variant:"danger",children:N}),C?e.jsx("div",{className:"d-flex justify-content-center py-4",children:e.jsx(pe,{animation:"border"})}):b.length===0?e.jsx("div",{className:"text-muted",children:"No images yet."}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"g-3",children:b.map(t=>e.jsx(me,{xs:6,md:4,children:e.jsxs(W,{className:"h-100",children:[e.jsx("div",{style:{aspectRatio:"1 / 1",overflow:"hidden"},children:e.jsx(W.Img,{src:t.url,alt:t.name,style:{width:"100%",height:"100%",objectFit:"cover"}})}),e.jsxs(W.Body,{className:"py-2",children:[e.jsx("div",{className:"fw-semibold text-truncate",title:t.name,children:t.name}),e.jsxs("div",{className:"d-flex gap-2 mt-2",children:[e.jsx(F,{size:"sm",variant:"primary",className:"w-100",onClick:()=>Q(t.url,t.name),disabled:M===t.id,children:"Insert"}),e.jsx(F,{size:"sm",variant:"outline-danger",onClick:()=>se(t.id,t.name),disabled:M===t.id,children:"Delete"})]})]})]})},t.id))}),D>1&&e.jsx("div",{className:"d-flex justify-content-center mt-3",children:e.jsxs(L,{className:"mb-0",children:[e.jsx(L.First,{disabled:s===1,onClick:()=>B(1)}),e.jsx(L.Prev,{disabled:s===1,onClick:()=>B(s-1)}),ee.map(t=>e.jsx(L.Item,{active:t===s,onClick:()=>B(t),children:t},t)),e.jsx(L.Next,{disabled:s===D,onClick:()=>B(s+1)}),e.jsx(L.Last,{disabled:s===D,onClick:()=>B(D)})]})})]})]}),e.jsxs(K.Pane,{eventKey:"upload",children:[E&&e.jsx(z,{variant:"danger",children:E}),e.jsxs(P,{children:[e.jsxs(P.Group,{className:"mb-3",children:[e.jsx(P.Label,{children:"File"}),e.jsx(P.Control,{type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp,image/avif",onChange:t=>{var r;return v(((r=t.target.files)==null?void 0:r[0])??null)},disabled:j})]}),e.jsxs(P.Group,{className:"mb-3",children:[e.jsx(P.Label,{children:"Name"}),e.jsx(P.Control,{value:a,onChange:t=>c(t.target.value),maxLength:80,disabled:j})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx(F,{variant:"secondary",onClick:x,disabled:j,children:"Close"}),e.jsx(F,{variant:"primary",onClick:te,disabled:j,children:j?"Uploading...":"Upload & Insert"})]})]})]})]})]})})]})]})},Ee=({row:f,placeHolder:x,text:l,setText:u,maxCharacters:i=4096,customPreview:y,onModeChange:m,isPost:s=!0})=>{const[d,p]=n.useState("write"),C=n.useRef(null),[g,N]=n.useState(!1);n.useEffect(()=>{m==null||m(d)},[d]);const w=a=>{u(c=>(c.trim().length==0||c.endsWith(`
`)?c:c+`
`)+a.join(`
`)+`
`)},b=a=>{const c=a.slice(0,i);u(c)},o=(a,c="")=>{const h=C.current;if(!h)return;const v=h.selectionStart,j=h.selectionEnd,T=l.slice(v,j),E=l.slice(0,v),S=l.slice(j),k=E+a+T+c+S;b(k),setTimeout(()=>{h.focus(),h.setSelectionRange(v+a.length,j+a.length)},50)},U=(a,c)=>{const h=C.current,v=`![${c||"image"}](${a})`;if(!h){b(l+(l.endsWith(`
`)?"":`
`)+v+`
`);return}const j=h.selectionStart,T=h.selectionEnd,E=l.slice(0,j),S=l.slice(T),k=E+v+S;b(k),setTimeout(()=>{h.focus(),h.setSelectionRange(j+v.length,j+v.length)},50)},G=[{icon:"B",title:"Bold",action:()=>o("**","**")},{icon:"I",title:"Italic",action:()=>o("_","_")},{icon:"S",title:"Small",action:()=>o("~~","~~")},{icon:"M",title:"Mark",action:()=>o("`","`")},{icon:"H3",title:"Heading",action:()=>o("### ","")},{icon:"LINK",title:"Link",action:()=>o("[text](",")")},{icon:"IMG",title:"Image",action:()=>N(!0)},{icon:"-",title:"List",action:()=>o("- ","")},{icon:"</>",title:"Code Block",action:()=>o("```bash\n","\n```")},{icon:">",title:"Quote",action:()=>o("> ","")},{icon:"1.",title:"Numbered List",action:()=>o("1. ","")},{icon:"|",title:"Divider",action:()=>o("---")}];return e.jsxs("div",{children:[e.jsx(Ce,{show:g,onHide:()=>N(!1),onSelect:(a,c)=>U(a,c)}),e.jsx("div",{className:"d-flex overflow-auto mb-2 p-2 bg-light rounded border gap-2",children:G.map((a,c)=>e.jsx("button",{className:"btn btn-sm btn-outline-secondary flex-shrink-0",title:a.title,onClick:h=>{h.preventDefault(),a.action()},style:{minWidth:"40px"},children:a.icon},c))}),e.jsx("div",{className:"mb-3",children:e.jsxs(Ne,{type:"radio",name:"editorMode",value:d,onChange:a=>p(a),children:[e.jsx(q,{id:"write-btn",value:"write",variant:"outline-primary",children:"Write"}),e.jsx(q,{id:"preview-btn",value:"preview",variant:"outline-primary",children:"Preview"})]})}),d==="write"&&e.jsx(he,{className:"mb-3",children:s?e.jsxs(e.Fragment,{children:[e.jsx(fe,{ref:C,rows:f,placeholder:x,value:l,setValue:u,required:!0,maxLength:i}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"mt-2 text-muted small",children:[l.length,"/",i," characters"]}),e.jsx(je,{onSubmit:w})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{ref:C,as:"textarea",rows:f,placeholder:x,value:l,onChange:a=>u(a.target.value),required:!0,maxLength:i}),e.jsx("div",{className:"d-flex justify-content-between",children:e.jsxs("div",{className:"mt-2 text-muted small",children:[l.length,"/",i," characters"]})})]})}),d==="preview"&&(y??e.jsx("div",{className:"p-2 border rounded bg-light",children:e.jsx(xe,{content:l,allowedUrls:we})}))]})};export{be as B,Ee as M,q as T,we as a};
