import{R as M,r as n,j as e,g as S,d as J,k as B,i as W,f as H}from"./index-b2f3d98e.js";import{C as V}from"./Container-aded6eb3.js";import{N as y}from"./Nav-faaa223c.js";import{c as T,u as L}from"./ThemeProvider-c318c21f.js";import{S as X}from"./NavContext-f8abb837.js";import{u as Y}from"./useMergedRefs-f5c2a768.js";import{c as K}from"./createWithBsPrefix-c6deafcc.js";import{T as Q,t as Z,s as O,E as ee,a as se,b as te,c as ae,d as ne}from"./CloseButton-439f23fc.js";import{c as R}from"./createChainedFunction-fd08587d.js";import{N as P}from"./NavbarContext-864acb8f.js";import{u as oe}from"./Anchor-1fe32030.js";import{O as re}from"./Offcanvas-c2fce8b4.js";import{r as I}from"./index-19ddc0d1.js";import{A as le}from"./AuthNavigation-0db8c457.js";import{D as k,E as ie}from"./EllipsisDropdownToggle-ab206b50.js";import{k as ce,l as de,d as ue}from"./index.esm-4a619d62.js";import{P as fe,D as pe}from"./DateUtils-6b83375c.js";import{P as me}from"./ProfileAvatar-4b9caa46.js";import{B as D}from"./Badge-d192c51b.js";import"./Nav-131532f4.js";import"./DataKey-e12315fd.js";import"./Button-a8db19a8.js";import"./CardHeaderContext-82a24767.js";import"./index-11ee592c.js";import"./useWindow-763af26a.js";import"./AbstractModalHeader-f9d4f376.js";import"./divWithClassName-9b80bbe4.js";import"./index.esm-cb18ecd9.js";import"./iconBase-7a454df3.js";import"./import-c49ebc7f.js";import"./InputGroupContext-66571c02.js";const xe={height:["marginTop","marginBottom"],width:["marginLeft","marginRight"]};function ge(s,a){const o=`offset${s[0].toUpperCase()}${s.slice(1)}`,t=a[o],r=xe[s];return t+parseInt(O(a,r[0]),10)+parseInt(O(a,r[1]),10)}const he={[ee]:"collapse",[se]:"collapsing",[te]:"collapsing",[ae]:"collapse show"},ve=M.forwardRef(({onEnter:s,onEntering:a,onEntered:o,onExit:t,onExiting:r,className:c,children:u,dimension:l="height",in:h=!1,timeout:v=300,mountOnEnter:p=!1,unmountOnExit:f=!1,appear:g=!1,getDimensionValue:i=ge,...d},C)=>{const m=typeof l=="function"?l():l,w=n.useMemo(()=>R(j=>{j.style[m]="0"},s),[m,s]),x=n.useMemo(()=>R(j=>{const $=`scroll${m[0].toUpperCase()}${m.slice(1)}`;j.style[m]=`${j[$]}px`},a),[m,a]),N=n.useMemo(()=>R(j=>{j.style[m]=null},o),[m,o]),b=n.useMemo(()=>R(j=>{j.style[m]=`${i(m,j)}px`,ne(j)},t),[t,i,m]),z=n.useMemo(()=>R(j=>{j.style[m]=null},r),[m,r]);return e.jsx(Q,{ref:C,addEndListener:Z,...d,"aria-expanded":d.role?h:null,onEnter:w,onEntering:x,onEntered:N,onExit:b,onExiting:z,childRef:u.ref,in:h,timeout:v,mountOnEnter:p,unmountOnExit:f,appear:g,children:(j,$)=>M.cloneElement(u,{...$,className:T(c,u.props.className,he[j],m==="width"&&"collapse-horizontal")})})}),Ne=ve,A=n.forwardRef(({bsPrefix:s,className:a,as:o,...t},r)=>{s=L(s,"navbar-brand");const c=o||(t.href?"a":"span");return e.jsx(c,{...t,ref:r,className:T(a,s)})});A.displayName="NavbarBrand";const je=A,_=n.forwardRef(({children:s,bsPrefix:a,...o},t)=>{a=L(a,"navbar-collapse");const r=n.useContext(P);return e.jsx(Ne,{in:!!(r&&r.expanded),...o,children:e.jsx("div",{ref:t,className:a,children:s})})});_.displayName="NavbarCollapse";const Ce=_,F=n.forwardRef(({bsPrefix:s,className:a,children:o,label:t="Toggle navigation",as:r="button",onClick:c,...u},l)=>{s=L(s,"navbar-toggler");const{onToggle:h,expanded:v}=n.useContext(P)||{},p=oe(f=>{c&&c(f),h&&h()});return r==="button"&&(u.type="button"),e.jsx(r,{...u,ref:l,onClick:p,"aria-label":t,className:T(a,s,!v&&"collapsed"),children:o||e.jsx("span",{className:`${s}-icon`})})});F.displayName="NavbarToggle";const be=F,q=n.forwardRef((s,a)=>{const o=n.useContext(P);return e.jsx(re,{ref:a,show:!!(o!=null&&o.expanded),...s,renderStaticNode:!0})});q.displayName="NavbarOffcanvas";const we=q,ke=K("navbar-text",{Component:"span"}),G=n.forwardRef((s,a)=>{const{bsPrefix:o,expand:t=!0,variant:r="light",bg:c,fixed:u,sticky:l,className:h,as:v="nav",expanded:p,onToggle:f,onSelect:g,collapseOnSelect:i=!1,...d}=Y(s,{expanded:"onToggle"}),C=L(o,"navbar"),m=n.useCallback((...N)=>{g==null||g(...N),i&&p&&(f==null||f(!1))},[g,i,p,f]);d.role===void 0&&v!=="nav"&&(d.role="navigation");let w=`${C}-expand`;typeof t=="string"&&(w=`${w}-${t}`);const x=n.useMemo(()=>({onToggle:()=>f==null?void 0:f(!p),bsPrefix:C,expanded:!!p,expand:t}),[C,p,t,f]);return e.jsx(P.Provider,{value:x,children:e.jsx(X.Provider,{value:m,children:e.jsx(v,{ref:a,...d,className:T(h,C,t&&w,r&&`${C}-${r}`,c&&`bg-${c}`,l&&`sticky-${l}`,u&&`fixed-${u}`)})})})});G.displayName="Navbar";const E=Object.assign(G,{Brand:je,Collapse:Ce,Offcanvas:we,Text:ke,Toggle:be}),U=M.forwardRef(({notification:s,onClose:a,onView:o},t)=>{const{sendJsonRequest:r}=S(),c=J(),[u,l]=n.useState(s.isClicked);n.useEffect(()=>{l(s.isClicked)},[s]);const h=async g=>{if(a(),g.target.closest("a"))return;u===!1&&(await r("/Profile/MarkNotificationsClicked","POST",{ids:[s.id]}),l(!0),o());const i={to:"/",state:{}};switch(s.type){case 101:i.to="/Profile/"+s.actionUser.id;break;case 201:i.to="/Discuss/"+s.questionId,i.state={postId:s.postId};break;case 202:case 205:i.to="/Compiler-Playground/"+s.codeId,i.state={postId:s.postId,isReply:s.post.parentId!==null};break;case 203:case 204:i.to="/Discuss/"+s.questionId,i.state={postId:s.postId,isReply:s.post.parentId!==null};break;case 301:case 303:case 304:i.to="/Feed/"+s.feedId;break;case 302:case 305:i.to="/Feed/"+s.feedId,i.state={postId:s.postId,isReply:s.post.parentId!=null};break;case 401:case 402:i.to="/Courses/"+s.courseCode+"/Lesson/"+s.lessonId,i.state={postId:s.postId,isReply:s.post.parentId!=null};break}c(i.to,{state:i.state})},v=s.message.split("{action_user}"),p=e.jsxs("div",{className:"d-flex p-2 border-bottom gap-2 align-items-center",onClick:h,style:{cursor:"pointer"},children:[e.jsx("div",{className:"wb-p-follow-item__avatar",children:e.jsx(me,{size:32,avatarImage:s.actionUser.avatar})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("div",{style:{wordBreak:"break-word",fontSize:"14px"},children:[v[0],e.jsx(fe,{userId:s.actionUser.id,userName:s.actionUser.name}),v[1]]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("small",{className:"text-secondary",children:pe.format2(new Date(s.date))}),u===!1&&e.jsx("small",{className:"text-info",children:e.jsx(ce,{})})]})]})]});return t?e.jsx("div",{ref:t,children:p}):e.jsx("div",{children:p})}),ye=(s,a,o)=>{const{sendJsonRequest:t}=S(),[r,c]=n.useState([]),[u,l]=n.useState(!1),[h,v]=n.useState(""),[p,f]=n.useState(!1);return n.useEffect(()=>{if(!o)return;(async()=>{l(!0),v("");const d=await t("/Profile/GetNotifications","POST",{count:s,fromId:a??null});d&&d.notifications?(c(C=>a?[...C,...d.notifications]:d.notifications),f(d.notifications.length===s),l(!1)):v((d==null?void 0:d.error[0].message)??"Something went wrong"),l(!1)})()},[a,o]),{isLoading:u,error:h,results:r,hasNextPage:p,onMarkAllAsRead:()=>{c(i=>i.map(d=>({...d,isClicked:!0})))}}},Ie=()=>{const{sendJsonRequest:s}=S(),[a,o]=n.useState(null),[t,r]=n.useState(!1),{isLoading:c,error:u,results:l,hasNextPage:h,onMarkAllAsRead:v}=ye(20,a,t),[p,f]=n.useState(0),{socket:g}=B();n.useEffect(()=>{(async()=>{const N=await s("/Profile/GetUnseenNotificationCount","POST",{});N&&N.count!==void 0&&f(N.count)})()},[]),n.useEffect(()=>{if(!g)return;const x=()=>{f(b=>b+1)},N=()=>{f(b=>b-1)};return g.on("notification:new",x),g.on("notification:deleted",N),()=>{g.off("notification:new",x),g.off("notification:deleted",N)}},[g]);const i=async()=>{await s("/Profile/MarkNotificationsClicked","POST",{}),f(0),v()},d=n.useRef(),C=n.useCallback(x=>{c||(d.current&&d.current.disconnect(),d.current=new IntersectionObserver(N=>{N[0].isIntersecting&&h&&o(l[l.length-1].id)}),x&&d.current.observe(x))},[c,h]),m=x=>{r(x),x&&o(null)},w=l.length>0?l.map((x,N)=>l.length===N+1?e.jsx(U,{ref:C,notification:x,onClose:()=>r(!1),onView:()=>f(b=>b-1)},x.id):e.jsx(U,{notification:x,onClose:()=>r(!1),onView:()=>f(b=>b-1)},x.id)):e.jsx("div",{className:"text-center my-4",children:e.jsx("p",{children:"You have no notifications"})});return e.jsxs(k,{style:{zIndex:1040},show:t,onToggle:m,autoClose:"outside",align:{lg:"start"},children:[e.jsxs(k.Toggle,{size:"sm",children:[e.jsx(de,{}),p>0&&e.jsx(D,{pill:!0,bg:"danger",className:"position-absolute top-0 start-100 translate-middle",children:p<100?p.toString():"99+"})]}),e.jsx(k.Menu,{style:{boxShadow:"0px 0px 8px rgba(0,0,0,.5)",borderRadius:"6px"},children:e.jsxs("div",{style:{width:"calc(100vw - 64px)",maxWidth:"480px",maxHeight:"calc(100dvh - 80px)"},className:"d-flex flex-column",children:[e.jsxs("div",{className:"px-2 border-bottom d-flex justify-content-between",children:[e.jsx("div",{children:e.jsx("h4",{children:"Notifications"})}),e.jsx("div",{children:e.jsxs(k,{align:"end",children:[e.jsx(k.Toggle,{as:ie}),e.jsx(k.Menu,{children:e.jsx(k.Item,{onClick:i,children:"Mark all as read"})})]})})]}),e.jsx("div",{className:"overflow-auto",children:u?e.jsx("p",{children:u}):e.jsx("div",{children:w})})]})})]})},Re=()=>{const[s,a]=n.useState(0),{sendJsonRequest:o}=S(),{socket:t}=B();return n.useEffect(()=>{(async()=>{const c=await o("/Channels/GetUnseenMessagesCount","POST",{});c&&c.count!==void 0&&a(c.count)})()},[]),n.useEffect(()=>{if(!t)return;const r=async()=>{a(l=>l+1)},c=()=>{a(l=>l+1)},u=()=>{a(l=>l-1)};return t.on("channels:new_invite",c),t.on("channels:invite_canceled",u),t.on("channels:new_message_info",r),()=>{t.off("channels:new_message_info",r),t.off("channels:new_invite",c),t.off("channels:invite_canceled",u)}},[t]),e.jsxs(W,{to:"/Channels",className:"btn btn-sm btn-primary position-relative d-flex p-2 align-items-center justify-content-center",children:[e.jsx(ue,{className:"text-white"}),s>0&&e.jsx(D,{pill:!0,bg:"danger",className:"position-absolute top-0 start-100 translate-middle",children:s<100?s.toString():"99+"})]})};function os({variant:s,hideChannelsButton:a}){const{userInfo:o}=H();return e.jsx(E,{expand:"lg",bg:s,variant:s,className:"border-bottom",collapseOnSelect:!0,children:e.jsxs(V,{fluid:!0,children:[e.jsx(I.LinkContainer,{to:"/",children:e.jsx(E.Brand,{children:e.jsx("img",{src:"/resources/images/logo.png",height:"32px",width:"96px"})})}),e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsx(E.Toggle,{"aria-controls":"navbarScroll"}),o&&e.jsxs("div",{className:"d-flex gap-3",children:[!a&&e.jsx(Re,{}),e.jsx(Ie,{})]})]}),e.jsxs(E.Collapse,{id:"navbarScroll",className:"text-center",children:[e.jsxs(y,{className:"me-auto",children:[e.jsx(I.LinkContainer,{to:"/Courses",children:e.jsx(y.Link,{children:"Courses"})}),e.jsx(I.LinkContainer,{to:"/Codes",children:e.jsx(y.Link,{children:"Codes"})}),e.jsx(I.LinkContainer,{to:"/Discuss",children:e.jsx(y.Link,{children:"Discuss"})}),e.jsx(I.LinkContainer,{to:"/Feed",children:e.jsx(y.Link,{children:"Feed"})}),o&&o.roles.some(t=>t!=="User")&&e.jsx(I.LinkContainer,{to:"/Tools",children:e.jsx(y.Link,{children:"Tools"})})]}),e.jsx(le,{})]})]})})}export{os as default};
