import{r as n,u as De,j as e,c as ke,ai as Be,i as ie,D as ee,E as Se,aj as Oe,l as oe,d as Z,e as qe,ak as ze,B as k,C as ge,n as ae,P as Ee,o as se,t as ce,R as Ue,a as He,X as K,al as $e,am as Ve,an as Ge,ao as Je,ap as Qe,aq as We,ar as Xe,as as Ye,ab as je,h as Y,A as Ze,F as de,at as Q,q as W,s as Ke,au as Ce,av as fe,H as es,g as Le,f as pe,L as Pe,aw as ss,ax as ts,b as le,m as ns,ay as rs,_ as ue,az as os,aA as is,Z as ve,M as as,N as $,ah as xe,Q as me,aB as he,S as ye}from"./index-39cfc24f.js";import{M as z}from"./Modal-eb79c083.js";import{r as ls}from"./roles-68ed67e6.js";import{M as cs}from"./PostTextareaControl-1c99a64b.js";import{M as ds,B as us,T as xs}from"./MdEditorField-4c6c395a.js";import{N as ms}from"./NotificationToast-f8b906d9.js";import{C as hs}from"./CommentList-adbc6a87.js";import{T as js}from"./ToggleSwitch-1e0d38eb.js";import"./PostAttachmentSelect-ae1d51e6.js";import"./CodeList-f241da5f.js";import"./react-bootstrap-pagination-control.esm-95f9c811.js";import"./Code-da17448f.js";import"./Tab-875264b5.js";import"./Spinner-f9aedc0f.js";import"./PostAttachment-d6132de4.js";import"./ReactionsList-a8a01792.js";import"./Toast-237a6189.js";const we=1e3;function fs(s,m,t){const d=(s-m)/(t-m)*100;return Math.round(d*we)/we}function Ne({min:s,now:m,max:t,label:d,visuallyHidden:f,striped:N,animated:r,className:a,style:C,variant:h,bsPrefix:S,...x},i){return e.jsx("div",{ref:i,...x,role:"progressbar",className:ke(a,`${S}-bar`,{[`bg-${h}`]:h,[`${S}-bar-animated`]:r,[`${S}-bar-striped`]:r||N}),style:{width:`${fs(m,s,t)}%`,...C},"aria-valuenow":m,"aria-valuemin":s,"aria-valuemax":t,children:f?e.jsx("span",{className:"visually-hidden",children:d}):d})}const Te=n.forwardRef(({isChild:s=!1,...m},t)=>{const d={min:0,max:100,animated:!1,visuallyHidden:!1,striped:!1,...m};if(d.bsPrefix=De(d.bsPrefix,"progress"),s)return Ne(d,t);const{min:f,now:N,max:r,label:a,visuallyHidden:C,striped:h,animated:S,bsPrefix:x,variant:i,className:g,children:E,..._}=d;return e.jsx("div",{ref:t,..._,className:ke(g,x),children:E?Be(E,L=>n.cloneElement(L,{isChild:!0})):Ne({min:f,now:N,max:r,label:a,visuallyHidden:C,striped:h,animated:S,bsPrefix:x,variant:i},t)})});Te.displayName="ProgressBar";const gs=Te,Fe=({course:s,isEditor:m})=>e.jsx(ie.LinkContainer,{to:m?"/Courses/Editor/"+s.id:"/Courses/"+s.code,children:e.jsxs("div",{className:"wb-courses-course-card rounded border p-2 bg-white d-sm-flex gap-3 position-relative",children:[m&&e.jsx("div",{className:"wb-courses-course__edit-button",children:e.jsxs(ee,{drop:"start",children:[e.jsx(ee.Toggle,{as:Se}),e.jsx(ee.Menu,{children:e.jsx(ie.LinkContainer,{to:"/Courses/Editor/Edit/"+s.id,children:e.jsx(ee.Item,{children:"Edit"})})})]})}),e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx("div",{className:"rounded-circle",children:e.jsx("img",{className:"wb-courses-course__cover-image",src:s.coverImage?"/media/files/"+s.coverImage:"/resources/images/logoicon.svg",alt:"Cover image"})})}),e.jsxs("div",{className:"d-flex flex-column align-items-sm-start align-items-center",children:[e.jsxs("h5",{style:{wordBreak:"break-word"},children:[s.title," ",!s.visible&&e.jsx(Oe,{})]}),e.jsx("p",{className:"wb-courses-course__description",children:s.description})]})]})}),ps=({course:s,onRestart:m})=>{const t=d=>{d.stopPropagation(),d.preventDefault(),m(s.id)};return e.jsx(ie.LinkContainer,{to:"/Courses/"+s.code,children:e.jsxs("div",{className:`wb-courses-course-card rounded border p-2 d-sm-flex gap-3 bg-white position-relative ${s.completed?"wb-course-completed":""}`,children:[e.jsx("div",{className:"wb-courses-course__edit-button",children:e.jsxs(ee,{drop:"start",children:[e.jsx(ee.Toggle,{as:Se}),e.jsx(ee.Menu,{children:e.jsx(ee.Item,{onClick:t,children:"Restart"})})]})}),e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx("div",{className:"rounded-circle",children:e.jsx("img",{className:"wb-courses-course__cover-image",src:s.coverImage?"/media/files/"+s.coverImage:"/resources/images/logoicon.svg",alt:"Cover image"})})}),e.jsxs("div",{className:"d-flex flex-column align-items-sm-start align-items-center",children:[e.jsx("h5",{style:{wordBreak:"break-word"},children:s.title}),s.completed&&e.jsx(oe,{bg:"success",className:"mt-1",children:"Completed"})]})]})})},Cs=()=>{const{sendJsonRequest:s}=Z(),[m,t]=n.useState([]),[d,f]=n.useState([]),[N,r]=n.useState(!1),{userInfo:a}=qe(),[C,h]=n.useState(!1),[S,x]=n.useState(null);n.useEffect(()=>{i()},[]);const i=async()=>{r(!0);const L=await s("/Courses","POST",{excludeUserId:a==null?void 0:a.id});if(L&&L.courses&&t(L.courses),a){const H=await s("/Courses/GetUserCourses","POST",{userId:a.id});H&&H.courses&&f(H.courses)}r(!1)},g=()=>{h(!1)},E=async()=>{if(!S)return;const L=await s("/Courses/ResetCourseProgress","POST",{courseId:S});L!=null&&L.success&&f(H=>H.map(T=>T.id===S?{...T,completed:!1}:T)),h(!1)},_=L=>{x(L),h(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(ze,{children:[" ",e.jsx("title",{children:"Courses | Webler Codes"})," ",e.jsx("meta",{name:"description",content:"Learn by doing with Webler’s interactive coding courses. Practice with hands-on lessons, quizzes, and real-world projects at your own pace."})," "]}),e.jsxs(z,{show:C,onHide:g,centered:!0,children:[e.jsx(z.Header,{closeButton:!0,children:e.jsx(z.Title,{children:"Are you sure?"})}),e.jsx(z.Body,{children:"Course progress will be restarted."}),e.jsxs(z.Footer,{children:[e.jsx(k,{variant:"secondary",onClick:g,children:"Cancel"}),e.jsx(k,{variant:"danger",onClick:E,children:"Restart"})]})]}),e.jsx(ge,{children:e.jsxs("div",{className:"wb-courses-main p-4",children:[a!==null&&d.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx("h2",{children:"My Courses"})}),e.jsx("div",{className:"my-3",children:d.map(L=>e.jsx("div",{className:"mt-3",children:e.jsx(ps,{course:L,onRestart:_})},L.id))})]}),m.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx("h2",{children:"Explore our courses"})}),e.jsx("div",{className:"my-3",children:m.map(L=>e.jsx("div",{className:"mt-3",children:e.jsx(Fe,{course:L,isEditor:!1})},L.id))})]})]})})]})},vs=()=>{const{courseCode:s}=ae(),{sendJsonRequest:m}=Z(),[t,d]=n.useState(null),[f,N]=n.useState(!0),[r,a]=n.useState("Webler Codes");Ee(r),n.useEffect(()=>{C()},[s]);const C=async()=>{N(!0);const i=await m("/Courses/GetCourse","POST",{courseCode:s,includeLessons:!0});i&&i.course&&(d(i.course),a("Courses - "+i.course.title+" | Webler Codes")),N(!1)},h=()=>{if(!t||!t.lessons.length)return 0;const i=t.lessons.filter(g=>g.completed).length;return Math.round(i/t.lessons.length*100)};let x=(()=>{let i=null;if(t){const g=t.lessons.filter(E=>E.unlocked).sort((E,_)=>_.index-E.index);g.length&&(i=g[0])}return i})();return e.jsx(ge,{children:e.jsx("div",{className:"wb-courses-main pt-2",children:f?e.jsx("p",{children:"Loading..."}):t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex gap-2 py-2",children:[e.jsx(se,{to:"/Courses",children:"Courses"}),e.jsx("span",{children:"›"}),e.jsx("span",{children:ce(t.title,20)})]}),e.jsx("h3",{children:t.title}),e.jsx("p",{className:"wb-courses-course__description",children:t.description}),x&&!t.userProgress.completed&&e.jsx(K,{className:"mt-4 shadow-sm",children:e.jsxs(K.Body,{children:[e.jsx(K.Title,{children:"Continue your progress"}),e.jsxs(K.Text,{children:["You can continue with lesson ",e.jsx("strong",{children:x.title}),"."]}),e.jsx(se,{to:`/Courses/${t.code}/Lesson/${x.id}`,children:e.jsx(k,{variant:"primary",children:"Go to Lesson"})})]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{children:"Progress"}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(gs,{now:h(),className:"flex-grow-1 me-2"}),e.jsxs("span",{children:[t.lessons.filter(i=>i.completed).length," / ",t.lessons.length]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{children:"Lessons"}),e.jsx(Ue,{children:t.lessons.map(i=>{const g=i.unlocked&&!i.completed;return e.jsx(He,{md:6,lg:4,className:"mb-3",children:e.jsx(K,{className:`h-100 shadow-sm ${i.unlocked?"":"bg-light text-muted"}`,style:{cursor:i.unlocked?"pointer":"not-allowed"},children:e.jsxs(K.Body,{children:[e.jsx(K.Title,{children:i.title}),e.jsxs(K.Text,{children:["Slides: ",i.nodeCount]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[i.unlocked&&i.completed&&e.jsxs(oe,{bg:"success",children:[e.jsx($e,{}),"Completed"]}),g&&e.jsxs(oe,{bg:"info",children:[e.jsx(Ve,{}),"In Progress"]}),i.unlocked&&!i.completed&&!g&&e.jsxs(oe,{bg:"light",text:"dark",children:[e.jsx(Ge,{}),"Available"]}),!i.unlocked&&e.jsxs(oe,{bg:"secondary",children:[e.jsx(Je,{}),"Locked"]}),e.jsxs("small",{children:["#",i.index]})]}),i.unlocked&&e.jsx(se,{to:`/Courses/${t.code}/Lesson/${i.id}`,children:e.jsx(k,{size:"sm",variant:"outline-primary",children:"Open"})})]})})},i.id)})})]})]}):e.jsx("p",{children:"Course not found."})})})},re=({MainPage:s})=>(Ee("Course Editor",!1),e.jsx(ge,{children:e.jsx("div",{className:"wb-courses-main pt-2",children:s})})),ys=()=>{const{sendJsonRequest:s}=Z(),[m,t]=n.useState([]),[d,f]=n.useState(!1);n.useEffect(()=>{N()},[]);const N=async()=>{f(!0);const r=await s("/CourseEditor","POST",{});r&&r.courses&&t(r.courses),f(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Course Editor"}),e.jsx("div",{className:"mt-4 d-flex justify-content-end",children:e.jsx(ie.LinkContainer,{to:"/Courses/Editor/New",children:e.jsx(k,{size:"sm",children:"Create course"})})}),e.jsx("div",{className:"my-3",children:m.length==0?e.jsx("div",{className:"wb-empty-list",children:e.jsx("h3",{children:"Nothing to show"})}):m.map(r=>e.jsx("div",{className:"mt-3",children:e.jsx(Fe,{course:r,isEditor:!0})},r.id))})]})},ws=({lesson:s,courseId:m,onEdit:t,onDelete:d,onExport:f,onChangeIndex:N,isFirst:r,isLast:a})=>{const C=()=>{t(s.id,s.title)},h=()=>{d(s.id)},S=()=>{f(s.id,s.title)},x=()=>{r||N(s.id,s.index-1)},i=()=>{a||N(s.id,s.index+1)};return e.jsxs("div",{className:"border p-2 bg-white d-flex justify-content-between gap-3 align-items-center",children:[e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("span",{className:`wb-comments__options__item ${r?"text-muted":""}`,onClick:x,style:{cursor:r?"not-allowed":"pointer"},children:e.jsx(Qe,{})}),e.jsx("span",{className:`wb-comments__options__item ${a?"text-muted":""}`,onClick:i,style:{cursor:a?"not-allowed":"pointer"},children:e.jsx(We,{})}),e.jsxs("div",{children:[e.jsxs("b",{className:"me-1",children:[s.index,"."]}),e.jsx(se,{to:"/Courses/Editor/"+m+"/Lesson/"+s.id,children:s.title})]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("span",{className:"wb-comments__options__item",onClick:S,children:e.jsx(Xe,{})}),e.jsx("span",{className:"wb-comments__options__item",onClick:C,children:e.jsx(Ye,{})}),e.jsx("span",{className:"wb-comments__options__item",onClick:h,children:e.jsx(je,{})})]})]})},Ns=[/^https?:\/\/.+/i],Ae=({nodeData:s,nodeId:m,mock:t,onAnswered:d,onContinue:f,onEnter:N})=>{const[r,a]=n.useState(null),[C,h]=n.useState([]),[S,x]=n.useState(""),[i,g]=n.useState(null),{sendJsonRequest:E}=Z();n.useEffect(()=>{h([]),x(""),g(null),_()},[m]);const _=async()=>{if(s)a(s),N(s.id);else{const u=await E("/Courses/GetLessonNode","POST",{nodeId:m,mock:t});u&&u.lessonNode&&(a(u.lessonNode),N(m))}},L=u=>{i===null&&h([u])},H=u=>{if(i!==null)return;let p=[...C];p.includes(u)?p=p.filter(D=>D!==u):p.push(u),h(p)},T=u=>{x(u)},V=async()=>{if(!r)return;let u={nodeId:r.id};s&&(u.mock={type:s.type,correctAnswer:s.correctAnswer,answers:s.answers}),r.type===2||r.type===3?u.answers=r.answers.map(D=>({id:D.id,correct:C.includes(D.id)})):r.type===4&&(u.correctAnswer=S);const p=await E("/Courses/SolveNode","POST",u);p&&p.success&&(g(p.data.correct),d(r.id,p.data.correct))},B=()=>{h([]),g(null)},U=()=>{r&&f(r.id)},y=u=>C.includes(u)?i===null?"selected":i?"selected correct":"selected incorrect":"initial";let w=e.jsx(e.Fragment,{});if(r){const u=()=>r.answers.map((p,D)=>e.jsx("div",{className:`wb-courses-lesson-answer p-2 mt-3 ${y(p.id)}`,role:"button",onClick:()=>{r.type===2?L(p.id):H(p.id)},children:e.jsx("div",{className:"card-body",children:p.text})},D));w=e.jsxs("div",{className:"h-100 d-flex flex-column",children:[e.jsxs("div",{className:"wb-courses-lesson-node-question p-2 flex-grow-1",children:[e.jsx(cs,{content:r.text,allowedUrls:Ns}),r.type===2||r.type===3?u():r.type===4?e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(Y,{className:"wb-courses-lesson-answer p-2"+(i===null?"":i?" correct":" incorrect"),style:{width:"120px"},value:S,readOnly:i!==null,onChange:p=>T(p.target.value)})}):null]}),e.jsx("div",{className:"text-center bg-light p-3",children:r.type==1?e.jsx(k,{variant:"success",onClick:U,children:"Continue"}):e.jsx(e.Fragment,{children:i===!0?e.jsx(k,{variant:"success",onClick:U,children:"Continue"}):i===!1?e.jsx(k,{variant:"danger",onClick:B,children:"Try Again"}):e.jsx(k,{variant:"primary",onClick:V,disabled:r.type===4&&S.trim()===""||(r.type===2||r.type===3)&&C.length===0,children:"Check"})})})]})}return w},bs=[{name:"Text block",value:1},{name:"Singlechoice question",value:2},{name:"Multichoice question",value:3},{name:"Text question",value:4}],Ie=n.forwardRef(({nodeId:s,nodeCount:m,onDelete:t,onChangeIndex:d,onExit:f},N)=>{const{sendJsonRequest:r}=Z(),[a,C]=n.useState(null),[h,S]=n.useState(""),[x,i]=n.useState(0),[g,E]=n.useState([]),[_,L]=n.useState(""),[H,T]=n.useState(!1),[V,B]=n.useState(["",""]),[U,y]=n.useState(!1),[w,u]=n.useState(!0);n.useEffect(()=>{p(),B(["",""])},[s]),n.useEffect(()=>{x==2&&E(l=>{const j=l.map(R=>({...R}));let I=!1;for(let R=0;R<j.length;++R)j[R].correct&&(I?j[R].correct=!1:I=!0);return!I&&j.length>0&&(j[0].correct=!0),j})},[x]);const p=async()=>{y(!0);const l=await r("/CourseEditor/GetLessonNode","POST",{nodeId:s});l&&l.lessonNode&&(C(l.lessonNode),i(l.lessonNode.type),S(l.lessonNode.text??""),L(l.lessonNode.correctAnswer??""),E(l.lessonNode.answers??[])),y(!1)},D=async()=>{if(!a)return;y(!0);const l=await r("/CourseEditor/DeleteLessonNode","DELETE",{nodeId:a.id});l&&l.success&&(c(),t(s)),y(!1)},M=n.useMemo(()=>{var I;if(!a)return!1;const l=h.trim(),j=(a.text??"").trim();return x!=a.type||l!=j||_!=(a.correctAnswer??"")||g.length!=(((I=a.answers)==null?void 0:I.length)??0)||!(a.answers??[]).every(R=>{const q=g.find(J=>J.id==R.id);return q&&q.text==R.text&&q.correct==R.correct})},[a,x,h,_,g]),b=l=>{if(x==2||x==3){if(g.length<2)return l&&B(["danger","Question cannot have less than 2 answers"]),!1;if(g.length>4)return l&&B(["danger","Question cannot have more than 4 answers"]),!1}else if(x==4&&_.length==0)return l&&B(["danger","Correct answer cannot be empty"]),!1;return!0},P=async l=>{var I,R;if(!a||!b(l))return!1;const j=await r("/CourseEditor/EditLessonNode","PUT",{nodeId:a.id,type:x,text:h,correctAnswer:_,answers:g});return j&&j.success?(C(q=>q?{...q,type:j.data.type,text:j.data.text,correctAnswer:j.data.correctAnswer,answers:j.data.answers}:null),E(j.data.answers),l&&B(["success","Lessson node was saved successfully."]),!0):(l&&B(["danger",((R=(I=j==null?void 0:j.error)==null?void 0:I[0])==null?void 0:R.message)??"Failed to save node"]),!1)};n.useImperativeHandle(N,()=>({saveIfDirty:async()=>{if(!a)return!0;if(M){y(!0);const l=await P(!0);return y(!1),l}return b(!0)}}));const O=async l=>{l.preventDefault(),y(!0),await P(!0),y(!1)},c=()=>{T(!1)},v=(l,j)=>{E(I=>{const R=I.map(q=>({...q}));return R[l].text=j,R})},o=(l,j,I)=>{E(R=>{const q=R.map(J=>({...J}));if(I&&j)for(let J=0;J<q.length;++J)q[J].correct=J===l;else q[l].correct=j;return q})},F=l=>{E(j=>j.filter((I,R)=>l!=R))},A=l=>{E(j=>[...j,{id:es(),text:"",correct:j.length==0&&l}])},G=async l=>{var I,R;if(!a)return;if(y(!0),M?await P(!0):b(!0)){const q=await r("/CourseEditor/ChangeLessonNodeIndex","POST",{nodeId:a.id,newIndex:l});q&&q.success?(C(J=>J?{...J,index:q.data.index}:null),d(a.id,l),B(["success","Node index changed successfully."])):B(["danger",((R=(I=q==null?void 0:q.error)==null?void 0:I[0])==null?void 0:R.message)??"Failed to change index"])}y(!1)},te=l=>{u(l=="write")},X=n.useCallback(()=>{},[]),ne=n.useMemo(()=>a?{...a,type:x,text:h,correctAnswer:_,answers:g}:null,[a,x,h,_,g]),Me=n.useMemo(()=>{if(ne)return e.jsx("div",{className:"d-flex flex-column",style:{minHeight:"368px"},children:e.jsx("div",{className:"flex-grow-1 border border-2 rounded",children:e.jsx(Ae,{nodeData:ne,mock:!0,onAnswered:X,onContinue:X,onEnter:X})})})},[ne,X]),Re=()=>{switch(x){case 2:return e.jsxs(Q,{children:[e.jsx(W,{children:"Answers"}),g.map((l,j)=>e.jsxs("div",{className:"d-flex gap-3 align-items-center mb-2",children:[e.jsx(Y,{value:l.text,onChange:I=>v(j,I.target.value),placeholder:`Answer ${j+1}`,required:!0}),e.jsx(Ce,{name:"answer-correct",type:"radio",label:"Correct",id:"answer-correct-input-"+j,checked:l.correct,onChange:I=>o(j,I.target.checked,!0)}),e.jsx("span",{className:"wb-comments__options__item",onClick:()=>F(j),children:e.jsx(je,{})})]},l.id??j)),e.jsx("div",{children:e.jsxs(k,{size:"sm",className:"mt-2",onClick:()=>A(!0),disabled:g.length>=4,type:"button",children:[e.jsx(fe,{className:"me-1"})," Add answer"]})})]});case 3:return e.jsxs(Q,{children:[e.jsx(W,{children:"Answers"}),g.map((l,j)=>e.jsxs("div",{className:"d-flex gap-3 align-items-center mb-2",children:[e.jsx(Y,{value:l.text,onChange:I=>v(j,I.target.value),placeholder:`Answer ${j+1}`,required:!0,maxLength:120}),e.jsx(Ce,{name:"answer-correct",type:"checkbox",label:"Correct",id:"answer-correct-input-"+j,checked:l.correct,onChange:I=>o(j,I.target.checked,!1)}),e.jsx("span",{className:"wb-comments__options__item",onClick:()=>F(j),children:e.jsx(je,{})})]},l.id??j)),e.jsx("div",{children:e.jsxs(k,{size:"sm",className:"mt-2",onClick:()=>A(!1),disabled:g.length>=4,type:"button",children:[e.jsx(fe,{className:"me-1"})," Add answer"]})})]});case 4:return e.jsxs(Q,{children:[e.jsx(W,{children:"Correct answer"}),e.jsx(Y,{value:_,onChange:l=>L(l.target.value),required:!0,maxLength:60})]});default:return e.jsx(e.Fragment,{})}};return a!==null&&e.jsxs(e.Fragment,{children:[e.jsxs(z,{show:H,onHide:c,centered:!0,children:[e.jsx(z.Header,{closeButton:!0,children:e.jsx(z.Title,{children:"Are you sure?"})}),e.jsx(z.Body,{children:"Lesson node will be permanently deleted."}),e.jsxs(z.Footer,{children:[e.jsx(k,{variant:"secondary",onClick:c,type:"button",children:"Cancel"}),e.jsx(k,{variant:"danger",onClick:D,type:"button",children:"Delete"})]})]}),V[1]&&e.jsx(Ze,{variant:V[0],onClose:()=>B(["",""]),dismissible:!0,children:V[1]}),e.jsx("div",{className:"mt-2",children:e.jsxs(de,{onSubmit:O,children:[e.jsxs(Q,{children:[e.jsx(W,{children:"Type"}),e.jsx(Ke,{value:x,onChange:l=>i(Number(l.target.value)),required:!0,children:bs.map(l=>e.jsx("option",{value:l.value,children:l.name},l.value))})]}),e.jsxs(Q,{children:[e.jsx(W,{children:"Text"}),e.jsx(ds,{text:h,setText:S,maxCharacters:2e3,row:10,placeHolder:"Enter Description",onModeChange:te,customPreview:Me,isPost:!1})]}),w&&Re(),e.jsxs("div",{className:"d-sm-flex justify-content-between mt-4",children:[e.jsxs("div",{className:"d-flex gap-2 justify-content-end",children:[e.jsx(k,{size:"sm",disabled:U||a.index<=1,onClick:()=>void G(a.index-1),type:"button",children:"Move left"}),e.jsx(k,{size:"sm",disabled:U||a.index>=m,onClick:()=>void G(a.index+1),type:"button",children:"Move right"})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-end mt-2 mt-sm-0",children:[e.jsx(k,{size:"sm",disabled:U,variant:"secondary",type:"button",onClick:f,children:"Exit"}),e.jsx(k,{size:"sm",disabled:U,variant:"secondary",type:"button",onClick:()=>T(!0),children:"Delete"}),e.jsx(k,{size:"sm",disabled:U,type:"submit",children:"Save"})]})]})]})})]})});Ie.displayName="LessonNodeEditor";const ks=({lessonId:s})=>{const{sendJsonRequest:m}=Z(),[t,d]=n.useState(null),[f,N]=n.useState(null),[r,a]=Le(),[C,h]=n.useState(!1),[S,x]=n.useState(!1),{courseId:i}=ae(),g=pe(),E=n.useRef(null);n.useEffect(()=>{_()},[s]),n.useEffect(()=>{if(t)if(r.has("slide")){const y=Number(r.get("slide")),w=t.nodes.find(u=>u.index==y);w&&N(w.id)}else t.nodes.length>0&&(N(t.nodes[0].id),r.set("slide",t.nodes[0].index.toString()),a(r,{replace:!0}))},[t==null?void 0:t.id]);const _=async()=>{h(!0);const y=await m("/CourseEditor/GetLesson","POST",{lessonId:s});y&&y.lesson&&d(y.lesson),h(!1)},L=async()=>E.current?await E.current.saveIfDirty():!0,H=async()=>{if(S)return;if(x(!0),!await L()){x(!1);return}const w=await m("/CourseEditor/CreateLessonNode","POST",{lessonId:s});w&&w.lessonNode&&(d(u=>{if(!u)return null;const p=[...u.nodes,{id:w.lessonNode.id,index:w.lessonNode.index,type:w.lessonNode.type,unlocked:!0}];return{...u,nodeCount:p.length,nodes:p}}),N(w.lessonNode.id),r.set("slide",w.lessonNode.index.toString()),a(r,{replace:!0})),x(!1)},T=y=>{N(null),d(w=>{if(!w)return null;const u=[];let p=!1;for(let D=0;D<w.nodes.length;++D){const M={...w.nodes[D]};if(M.id===y){p=!0;continue}p&&(M.index=M.index-1),u.push(M)}return{...w,nodeCount:u.length,nodes:u}})},V=(y,w)=>{d(u=>{if(!u)return null;const p=u.nodes.map(M=>({...M})),D=p.find(M=>M.id==y);if(D){const M=D.index;p[w-1].index=M,p[M-1].index=w;const b=p[M-1];p[M-1]=p[w-1],p[w-1]=b,r.set("slide",w.toString()),a(r,{replace:!0})}return{...u,nodes:p}})},B=()=>{N(null)},U=async y=>{if(!t||S||y===f)return;if(x(!0),!await L()){x(!1);return}N(y);const u=t.nodes.find(p=>p.id==y);u&&(r.set("slide",u.index.toString()),a(r,{replace:!0})),x(!1)};return t!==null?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-2",children:[e.jsx("h4",{children:t.title}),e.jsxs("div",{className:"d-flex justify-content-between my-3",children:[e.jsx(us,{size:"sm",children:t.nodes.map((y,w)=>e.jsx(xs,{id:`current-lesson-input-${y.index}`,type:"radio",variant:"outline-primary",name:"current-lesson",value:y.id,checked:f===y.id,onChange:u=>void U(u.currentTarget.value),size:"sm",disabled:S,children:y.index},w))}),e.jsx(k,{size:"sm",onClick:()=>void H(),disabled:S,children:e.jsx(fe,{})})]}),f!==null&&e.jsx(Ie,{ref:E,nodeId:f,nodeCount:t.nodeCount,onChangeIndex:V,onDelete:T,onExit:B})]})}):e.jsx("div",{className:"my-5 text-center",children:C?e.jsx(Pe,{}):e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:"Lesson could not be loaded"}),e.jsx(k,{size:"sm",onClick:()=>g("/Courses/Editor/"+i),children:"Back to course"})]})})},Ss=(s,m)=>{const t=new Blob([JSON.stringify(m,null,2)],{type:"application/json"}),d=URL.createObjectURL(t),f=document.createElement("a");f.href=d,f.download=s,document.body.appendChild(f),f.click(),f.remove(),URL.revokeObjectURL(d)},be=()=>{const{sendJsonRequest:s}=Z(),{courseId:m,lessonId:t}=ae(),[d,f]=n.useState(null),[N,r]=n.useState([]),[a,C]=n.useState(!1),[h,S]=n.useState(!1),[x,i]=n.useState(""),[g,E]=n.useState(null),[_,L]=n.useState(!1),[H,T]=n.useState(null);n.useEffect(()=>{V(!0)},[m]);const V=async c=>{C(!0);const v=await s("/CourseEditor/GetCourse","POST",{courseId:m,includeLessons:c});v&&v.course&&(f(v.course),r(v.course.lessons)),C(!1)},B=(c,v)=>{i(c),S(!0),E(v)},U=()=>{S(!1),i("")},y=async()=>{C(!0);const c=await s("/CourseEditor/CreateLesson","POST",{courseId:d.id,title:x});c&&c.lesson?(r(v=>[...v,{...c.lesson}]),U(),T({type:"success",message:"Lesson created successfully"})):T({type:"error",message:c==null?void 0:c.error[0].message}),C(!1)},w=async()=>{C(!0);const c=N.find(o=>o.id===g);if(!c)return;const v=await s("/CourseEditor/EditLesson","PUT",{lessonId:g,title:x,index:c.index});v&&v.success?(r(o=>{let F=[...o];for(let A=0;A<F.length;++A)F[A].id===g&&(F[A].title=v.data.title);return F}),U(),T({type:"success",message:"Lesson edited successfully"})):T({type:"error",message:v==null?void 0:v.error[0].message}),C(!1)},u=async()=>{C(!0);const c=await s("/CourseEditor/DeleteLesson","DELETE",{lessonId:g});c&&c.success?(P(),r(v=>{let o=[],F=!1;for(let A=0;A<v.length;++A){const G=v[A];if(G.id===g){F=!0;continue}F&&--G.index,o.push(G)}return o}),T({type:"success",message:"Lesson deleted successfully"})):T({type:"error",message:c==null?void 0:c.error[0].message}),C(!1)},p=async(c,v)=>{C(!0);const o=await s("/CourseEditor/ChangeLessonIndex","POST",{lessonId:c,newIndex:v});o&&o.success?(r(F=>{const A=[...F],G=A.findIndex(X=>X.id===c);if(G===-1)return A;const te=A.findIndex(X=>X.index===v);return te===-1||([A[G].index,A[te].index]=[A[te].index,A[G].index],A.sort((X,ne)=>X.index-ne.index)),A}),T({type:"success",message:"Lesson index changed successfully"})):T({type:"error",message:o==null?void 0:o.error[0].message}),C(!1)},D=(c,v)=>{B(v,c)},M=c=>{E(c),L(!0)},b=async(c,v)=>{var F,A;C(!0);const o=await s("/CourseEditor/ExportCourseLesson","POST",{lessonId:c});if(o&&o.success&&o.data){const G=`${ss(v)}.json`;Ss(G,o.data),T({type:"success",message:"Lesson exported"})}else T({type:"error",message:((A=(F=o==null?void 0:o.error)==null?void 0:F[0])==null?void 0:A.message)??"Export failed"});C(!1)},P=()=>{L(!1)},O=()=>{const c=N.find(o=>o.id===t);if(!c)return e.jsx(e.Fragment,{});const v=ce(c.title,20);return e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"›"}),e.jsx("span",{children:v})]})};return d!==null?e.jsxs(e.Fragment,{children:[e.jsx(ms,{notification:H,onClose:()=>T(null)}),e.jsxs(z,{show:_,onHide:P,centered:!0,children:[e.jsx(z.Header,{closeButton:!0,children:e.jsx(z.Title,{children:"Are you sure?"})}),e.jsx(z.Body,{children:"Lesson will be permanently deleted."}),e.jsxs(z.Footer,{children:[e.jsx(k,{variant:"secondary",onClick:P,children:"Cancel"}),e.jsx(k,{variant:"danger",onClick:u,children:"Delete"})]})]}),e.jsxs("div",{className:"d-flex gap-2 py-2",children:[e.jsx(se,{to:"/Courses/Editor",children:"Course Editor"}),e.jsx("span",{children:"›"}),t!==null?e.jsxs(e.Fragment,{children:[e.jsx(se,{to:"/Courses/Editor/"+d.id,children:ce(d.title,20)}),O()]}):e.jsx("span",{children:ce(d.title,20)})]}),e.jsx("div",{className:"mb-3",children:e.jsx("h3",{className:"wb-courses-course__title",style:{wordBreak:"break-word"},children:d.title})}),e.jsx("div",{hidden:!h,className:"mb-2 border bg-white rounded p-2",children:e.jsxs(de,{children:[e.jsx("h4",{children:g===null?"New lesson":"Edit lesson"}),e.jsxs(Q,{children:[e.jsx(W,{children:"Title"}),e.jsx(Y,{type:"text",placeholder:"Enter lesson title",maxLength:60,value:x,onChange:c=>i(c.target.value)})]}),e.jsxs("div",{className:"d-flex justify-content-end mt-2",children:[e.jsx(k,{size:"sm",variant:"secondary",disabled:a,onClick:()=>U(),children:"Cancel"}),g===null?e.jsx(k,{size:"sm",variant:"primary",className:"ms-2",onClick:y,disabled:a||x.length===0,children:"Create"}):e.jsx(k,{size:"sm",variant:"primary",className:"ms-2",onClick:w,disabled:a,children:"Save"})]})]})}),t?e.jsx(ks,{lessonId:t}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(k,{className:"ms-2 btn btn-primary btn-sm",onClick:()=>B("",null),children:"Create Lesson"})}),e.jsx("div",{className:"mt-3",children:N.map(c=>e.jsx("div",{className:"mt-2",children:e.jsx(ws,{lesson:c,courseId:d.id,onDelete:M,onEdit:D,onChangeIndex:p,onExport:b,isFirst:c.index===1,isLast:c.index===N.length})},c.index))})]})]}):e.jsx("div",{className:"my-5 text-center",children:a?e.jsx(Pe,{}):e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:"Course could not be loaded"}),e.jsx(se,{to:"/Courses/Editor",children:"Back"})]})})},Es=()=>{var M;const{lessonId:s,courseCode:m}=ae(),[t,d]=n.useState(null),[f,N]=n.useState(0),{sendJsonRequest:r}=Z(),a=pe(),C=ts(),[h,S]=Le(),[x,i]=n.useState(!1),[g,E]=n.useState({section:"Courses",params:{lessonId:s}}),[_,L]=n.useState(0),[H,T]=n.useState(null);n.useEffect(()=>{s&&(V(),E({section:"Courses",params:{lessonId:s}}))},[s]),n.useEffect(()=>{h.has("slide")&&N(Number(h.get("slide")))},[h]),n.useEffect(()=>{C.state&&C.state.postId&&(u(),T({id:C.state.postId,isReply:C.state.isReply}))},[C]),n.useEffect(()=>{if(t&&!h.has("slide")){const b=t.nodes.filter(P=>P.unlocked).sort((P,O)=>O.index-P.index);b.length&&(h.set("slide",b[0].index.toString()),S(h,{replace:!0}))}},[t]);const V=async()=>{const b=await r("/Courses/GetLesson","POST",{lessonId:s});b&&b.lesson&&(d(b.lesson),L(b.lesson.comments))},B=(b,P)=>{t&&P&&(h.set("slide",b.toString()),S(h,{replace:!0}))},U=b=>{if(!t)return;const P=t.nodes.find(O=>O.id==b);P&&(P.index<t.nodeCount?(h.set("slide",(P.index+1).toString()),S(h,{replace:!0})):D())},y=b=>{if(!t)return;const P=t.nodes.find(O=>O.id==b);P&&P.type==1&&d(O=>{if(!O)return null;const c=O.nodes;for(let v=0;v<c.length;++v)c[v].index==P.index+1&&(c[v].unlocked=!0);return{...O,nodes:c}})},w=(b,P)=>{if(!t)return;const O=t.nodes.find(c=>c.id==b);O&&P&&d(c=>{if(!c)return null;const v=c.nodes;for(let o=0;o<v.length;++o)v[o].index==O.index+1&&(v[o].unlocked=!0);return{...c,nodes:v}})},u=()=>{s&&i(!0)},p=()=>{i(!1)},D=()=>{a("/Courses/"+m)};return e.jsx("div",{className:"wb-courses-lesson-container d-flex flex-column",children:t&&e.jsxs(e.Fragment,{children:[e.jsxs(le,{show:x,onHide:p,placement:"end",children:[e.jsx(le.Header,{closeButton:!0,children:e.jsxs(le.Title,{children:[_," Comments"]})}),e.jsx(le.Body,{className:"d-flex flex-column",style:{height:"calc(100% - 62px)"},children:e.jsx(hs,{findPost:H,options:g,setCommentCount:L})})]}),e.jsxs("div",{className:"d-flex justify-content-between p-2",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(k,{variant:"link",className:"text-secondary",onClick:D,children:e.jsx(ns,{})}),e.jsx("span",{className:"text-secondary",style:{fontSize:"24px",fontWeight:"bold"},children:t.title})]}),e.jsxs("div",{className:"d-flex align-items-center gap-1",children:[e.jsx("span",{className:"small text-secondary",children:_}),e.jsx(k,{variant:"link",className:"text-secondary",onClick:u,children:e.jsx(rs,{})})]})]}),e.jsx("div",{className:"wb-courses-lesson-main",children:e.jsx(ue,{variant:"pills",className:"flex-row overflow-auto my-3 row-gap-1",children:t.nodes.map(b=>{const P=b.index===f,O=b.type===1?e.jsx(os,{}):e.jsx(is,{});return e.jsx(ue.Item,{children:e.jsx(ue.Link,{className:"wb-courses-lesson-arrow-pill "+(b.unlocked?P?"bg-warning text-dark":"bg-primary text-light":"bg-secondary text-light"),onClick:()=>B(b.index,b.unlocked),disabled:!b.unlocked,children:O})},b.id)})})}),e.jsx("div",{className:"flex-grow-1 mt-2",children:f!=0&&e.jsx(Ae,{nodeId:(M=t.nodes.find(b=>b.index==f))==null?void 0:M.id,mock:!1,onContinue:U,onAnswered:w,onEnter:y})})]})})},_e=({courseId:s})=>{const{sendJsonRequest:m}=Z(),t=pe(),[d,f]=n.useState(!1),[N,r]=n.useState(""),[a,C]=n.useState(""),[h,S]=n.useState(""),[x,i]=n.useState(!1),[g,E]=n.useState(),[_,L]=n.useState(""),[H,T]=n.useState(!1),[V,B]=n.useState(null),[U,y]=n.useState(null),[w,u]=n.useState({});n.useEffect(()=>{s&&p()},[s]);const p=async()=>{f(!0);const o=await m("/CourseEditor/GetCourse","POST",{courseId:s});o&&o.course&&(r(o.course.code),C(o.course.title),S(o.course.description),i(o.course.visible),B(o.course.coverImage)),f(!1)},D=async o=>{o.preventDefault(),f(!0),s?await b():await M(),f(!1)},M=async()=>{E(void 0);const o=await m("/CourseEditor/CreateCourse","POST",{code:N,title:a,description:h,visible:x});o&&o.course?t("/Courses/Editor"):E(o.error)},b=async()=>{E(void 0),L("");const o=await m("/CourseEditor/EditCourse","PUT",{courseId:s,title:a,code:N,description:h,visible:x});o&&o.success?L("Course edited successfully"):E(o.error)},P=()=>{T(!1)},O=async()=>{f(!0);const o=await m("/CourseEditor/DeleteCourse","DELETE",{courseId:s});o&&o.success?(P(),t("/Courses/Editor")):E(o!=null&&o.error?o.error.message:o.message),f(!1)},c=async o=>{o.preventDefault(),u({}),f(!0);const F=await m("/CourseEditor/UploadCourseCoverImage","POST",{courseId:s,coverImage:U},{},!0);F&&F.success?(B(F.data.coverImage),u({message:"Course cover image updated successfully"})):u({errors:F==null?void 0:F.error}),f(!1)},v=o=>{const F=o.target.files;F&&y(F[0])};return e.jsxs(e.Fragment,{children:[e.jsxs(z,{show:H,onHide:P,centered:!0,children:[e.jsx(z.Header,{closeButton:!0,children:e.jsx(z.Title,{children:"Are you sure?"})}),e.jsx(z.Body,{children:"Course will be permanently deleted."}),e.jsxs(z.Footer,{children:[e.jsx(k,{variant:"secondary",onClick:P,children:"Cancel"}),e.jsx(k,{variant:"danger",onClick:O,children:"Delete"})]})]}),e.jsxs("div",{className:"row",children:[s!==null&&e.jsxs("div",{className:"col-12 col-md-4",children:[e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx("div",{className:"rounded-circle",children:e.jsx("img",{className:"wb-courses-course__cover-image",src:V?"/media/files/"+V:"/resources/images/logoicon.svg",alt:"Cover image"})})}),e.jsxs(de,{onSubmit:c,children:[e.jsx(ve,{errors:w.errors,message:w.message}),e.jsxs(Q,{children:[e.jsx(W,{children:"Cover image"}),e.jsx(Y,{size:"sm",type:"file",required:!0,onChange:v,accept:"image/png"})]}),e.jsx("div",{className:"d-flex justify-content-end mt-2",children:e.jsx(k,{size:"sm",className:"ms-2",variant:"primary",type:"submit",disabled:d,children:"Upload"})})]})]}),e.jsx("div",{className:"col-12 col-md-8",children:e.jsxs(de,{onSubmit:D,children:[e.jsx(ve,{errors:g,message:_}),e.jsxs(Q,{children:[e.jsx(W,{children:"Course title"}),e.jsx(Y,{type:"text",required:!0,value:a,onChange:o=>C(o.target.value)})]}),e.jsxs(Q,{children:[e.jsx(W,{children:"Course code"}),e.jsx(Y,{type:"text",required:!0,value:N,onChange:o=>r(o.target.value)})]}),e.jsxs(Q,{children:[e.jsx(W,{children:"Course description"}),e.jsx(Y,{as:"textarea",rows:8,maxLength:1e3,required:!0,value:h,onChange:o=>S(o.target.value)})]}),e.jsxs(Q,{className:"d-flex align-items-center mt-2 gap-2",children:[e.jsx(W,{children:"Is visible"}),e.jsx(js,{value:x,onChange:o=>i(o.target.checked)})]}),e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx(ie.LinkContainer,{to:"/Courses/Editor",children:e.jsx(k,{size:"sm",type:"button",variant:"secondary",disabled:d,children:"Cancel"})}),s?e.jsxs(e.Fragment,{children:[e.jsx(k,{size:"sm",variant:"secondary",className:"ms-2",type:"button",onClick:()=>T(!0),disabled:d,children:"Delete"}),e.jsx(k,{size:"sm",variant:"primary",className:"ms-2",type:"submit",disabled:d,children:"Save changes"})]}):e.jsx(e.Fragment,{children:e.jsx(k,{size:"sm",className:"ms-2",variant:"primary",type:"submit",disabled:d,children:"Create course"})})]})]})})]})]})},Ls=()=>{const{courseId:s}=ae();return e.jsx(_e,{courseId:s})};const Gs=()=>e.jsxs(as,{children:[e.jsx($,{element:e.jsx(xe,{Header:e.jsx(me,{variant:"light"}),Footer:e.jsx(he,{})}),children:e.jsx($,{element:e.jsx(ye,{allowedRoles:["Admin","Creator"]}),children:e.jsxs($,{path:"Editor",children:[e.jsx($,{index:!0,element:e.jsx(re,{MainPage:e.jsx(ys,{})})}),e.jsx($,{path:"New",element:e.jsx(re,{MainPage:e.jsx(_e,{courseId:null})})}),e.jsx($,{path:"Edit/:courseId",element:e.jsx(re,{MainPage:e.jsx(Ls,{})})}),e.jsxs($,{path:":courseId",children:[e.jsx($,{index:!0,element:e.jsx(re,{MainPage:e.jsx(be,{})})}),e.jsx($,{path:"Lesson/:lessonId",element:e.jsx(re,{MainPage:e.jsx(be,{})})})]})]})})}),e.jsx($,{element:e.jsx(xe,{Header:e.jsx(me,{variant:"light"}),Footer:e.jsx(he,{})}),children:e.jsx($,{index:!0,element:e.jsx(Cs,{})})}),e.jsx($,{element:e.jsx(ye,{allowedRoles:ls}),children:e.jsxs($,{path:":courseCode",children:[e.jsx($,{element:e.jsx(xe,{Header:e.jsx(me,{variant:"light"}),Footer:e.jsx(he,{})}),children:e.jsx($,{index:!0,element:e.jsx(vs,{})})}),e.jsx($,{path:"Lesson/:lessonId",element:e.jsx(Es,{})})]})})]});export{Gs as default};
