import{r as t,aw as Ee,ax as Pe,j as e,ab as ke,ay as Re,ad as Me,az as Te,aA as Le,aB as be,n as te,e as U,aC as Ie,aD as me,p as Oe,aE as De,s as ue,A as Ae,d as X,G as ve,M as we,aF as oe,aG as He,I as Be,D as q,E as ze,a3 as _e,a4 as $e,aH as he,ap as qe,L as Ne,B as Q,a9 as xe,b as ee,m as Ve,al as fe,g as Ue,ao as We,aI as Je,aJ as Ye,ac as Ke,aK as Qe,q as Xe,an as Ze,F as Ge,N as es,ak as ss,x as ts,y as K,aa as as,H as ns,z as is}from"./index-887d117b.js";import{M as k}from"./Modal-8b4aeb5f.js";import{N as Se}from"./NotificationToast-cf28d25f.js";import{r as V,a as ye,P as Fe,R as os}from"./ReactionsList-9c5aba02.js";import{a as re}from"./discussAllowedUrls-4f3044c5.js";import{M as ce}from"./MarkdownRenderer-a92eb709.js";import{P as ls,a as rs}from"./PostAttachmentSelect-36ebe2ee.js";import{C as cs}from"./CommentList-220fe5df.js";import{r as ds}from"./roles-68ed67e6.js";import{T as le,B as ms}from"./ToggleButton-4a96d588.js";import"./CodeList-aa3324ec.js";import"./react-bootstrap-pagination-control.esm-88405e9b.js";import"./compilerLanguages-dfca652b.js";import"./Code-b164eb42.js";import"./Toast-ccb39475.js";const us=t.forwardRef((s,l)=>{const{children:m,type:o="radio",name:c,value:j,onChange:n,vertical:p=!1,...x}=Ee(s,{value:"onChange"}),v=()=>j==null?[]:[].concat(j),u=(r,F)=>{if(!n)return;const w=v(),h=w.indexOf(r)!==-1;if(o==="radio"){h||n(r,F);return}n(h?w.filter(I=>I!==r):[...w,r],F)};return o!=="radio"||c||Pe(!1),e.jsx(ms,{...x,ref:l,vertical:p,children:ke(m,r=>{const F=v(),{value:w,onChange:h}=r.props,I=M=>u(w,M);return t.cloneElement(r,{type:o,name:r.name||c,checked:F.indexOf(w)!==-1,onChange:Re(h,I)})})})}),hs=Object.assign(us,{Button:le}),ie=({MainPage:s})=>e.jsxs(e.Fragment,{children:[e.jsxs(Me,{children:[" ",e.jsx("title",{children:"Feed | Webler Codes"})," ",e.jsx("meta",{name:"description",content:"Stay up to date with the Webler community! Explore the latest project updates, shared snippets, and highlights from developers worldwide."})," "]}),e.jsx("div",{className:"wb-feed-layout-container",children:s})]});var Ce=(s=>(s[s.QUESTION=1]="QUESTION",s[s.ANSWER=2]="ANSWER",s[s.CODE_COMMENT=3]="CODE_COMMENT",s[s.FEED=4]="FEED",s[s.SHARED_FEED=5]="SHARED_FEED",s[s.FEED_COMMENT=6]="FEED_COMMENT",s))(Ce||{});const xs=({show:s,feedId:l,onShare:m,onClose:o})=>{const[c,j]=t.useState(""),[n,p]=t.useState(!1),[x,v]=t.useState(!1),[u]=t.useState([]),r=window.location.origin+`/feed/${l}`,F=async()=>{p(!0),await m(c,u),o(),p(!1)},w=async()=>{await navigator.clipboard.writeText(r),v(!0),setTimeout(()=>v(!1),2e3)};return e.jsxs(k,{show:s,onHide:o,size:"lg",centered:!0,backdropClassName:"wb-feed-edit-modal__backdrop",fullscreen:"sm-down",backdrop:"static",style:{zIndex:"1060"},children:[e.jsx(k.Header,{closeButton:!0,children:e.jsxs(k.Title,{children:[e.jsx(Te,{}),"Share Post"]})}),e.jsxs(k.Body,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"Add your thoughts"}),e.jsx("textarea",{value:c,onChange:h=>j(h.target.value),placeholder:"What do you think about this post?",rows:12,className:"form-control",disabled:n})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between p-2 border rounded bg-light",children:[e.jsx("span",{className:"text-truncate me-2",style:{maxWidth:"75%"},children:r}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-secondary d-flex align-items-center gap-1",onClick:w,children:[e.jsx(Le,{}),x?"Copied!":"Copy"]})]})]}),e.jsxs(k.Footer,{children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:o,disabled:n,children:"Cancel"}),e.jsxs("button",{type:"button",className:"btn btn-primary d-flex align-items-center gap-2",onClick:F,disabled:n,children:[e.jsx(be,{}),n?"Sharing...":"Share Post"]})]})]})},fs=({onReactionChange:s,currentState:l})=>{const[m,o]=t.useState(l),[c,j]=t.useState(!1),[n,p]=t.useState(null),x=t.useRef(null),v=t.useRef(null),{userInfo:u}=te(),r=U();t.useEffect(()=>{o(l)},[l]);const F=N=>{const E=N==m?null:N;o(E),s(E),j(!1)},w=()=>{u!=null&&u.id||r("/Users/Login"),j(!c)},h=()=>{u!=null&&u.id||r("/Users/Login");const N=window.setTimeout(()=>{j(!0)},500);p(N)},I=()=>{n&&(clearTimeout(n),p(null))},M=()=>{v.current&&clearTimeout(v.current)};return t.useEffect(()=>{const N=E=>{x.current&&!x.current.contains(E.target)&&j(!1)};return document.addEventListener("mousedown",N),document.addEventListener("touchstart",N),()=>{document.removeEventListener("mousedown",N),document.removeEventListener("touchstart",N),v.current&&clearTimeout(v.current),n&&clearTimeout(n)}},[n]),e.jsxs("div",{ref:x,className:"position-relative d-flex align-items-center",children:[e.jsxs("span",{className:"wb-reaction-picker-btn",onClick:w,onTouchStart:h,onTouchEnd:I,style:{color:m?V[m].color:"#65676b"},children:[e.jsx("span",{children:m?V[m].emoji:e.jsx(Ie,{})}),e.jsx("span",{children:m?V[m].label:V[ye.LIKE].label})]}),c&&e.jsx("div",{className:"position-absolute bg-white border rounded-pill shadow-lg d-flex align-items-center gap-1",style:{bottom:"100%",left:"0",marginBottom:"8px",zIndex:1e3,animation:"slideUp 0.2s ease-out",whiteSpace:"nowrap",borderColor:"#dadde1"},onMouseEnter:M,onTouchStart:N=>N.stopPropagation(),children:Object.entries(V).map(([N,E])=>{const D=Number(N);return e.jsx("button",{type:"button",className:"btn p-1 border-0 d-flex align-items-center justify-content-center",style:{width:"32px",height:"32px",borderRadius:"50%",backgroundColor:m==D?`${E.color}20`:"transparent"},onClick:d=>{d.stopPropagation(),F(D)},title:E.label,children:E.emoji},D)})})]})},js=({show:s,feed:l,onSave:m,onClose:o})=>{const[c,j]=t.useState(l.message),[n,p]=t.useState(!1),[x,v]=t.useState("write"),u=async()=>{c.trim()&&(p(!0),await m(c.trim()),p(!1))};return e.jsxs(k,{show:s,onHide:o,size:"lg",centered:!0,backdrop:"static",backdropClassName:"wb-feed-edit-modal__backdrop",fullscreen:"sm-down",style:{zIndex:"1060"},children:[e.jsx(k.Header,{closeButton:!0,children:e.jsxs(k.Title,{children:[e.jsx(me,{}),"Edit Post"]})}),e.jsx(k.Body,{style:{maxHeight:"70vh",overflow:"auto"},children:e.jsxs("div",{children:[e.jsx("label",{className:"form-label fw-medium text-muted",children:"Post Content"}),e.jsxs("div",{className:"d-flex gap-2 mb-2",children:[e.jsxs("button",{type:"button",className:`btn btn-sm ${x==="write"?"btn-primary":"btn-outline-primary"}`,onClick:()=>v("write"),children:[e.jsx(Oe,{className:"me-1"})," Write"]}),e.jsxs("button",{type:"button",className:`btn btn-sm ${x==="preview"?"btn-primary":"btn-outline-primary"}`,onClick:()=>v("preview"),children:[e.jsx(De,{className:"me-1"})," Preview"]})]}),x==="write"&&e.jsx(Fe,{value:c,setValue:j,placeholder:"What's on your mind?",rows:12}),x==="preview"&&e.jsx(ce,{content:c,allowedUrls:re})]})}),e.jsxs(k.Footer,{children:[e.jsx("button",{onClick:o,className:"btn btn-light px-4 rounded-3 shadow-sm",disabled:n,children:"Cancel"}),e.jsxs("button",{onClick:u,disabled:!c.trim()||n,className:"btn btn-primary px-4 d-inline-flex align-items-center gap-2 rounded-3 shadow-sm",children:[e.jsx(me,{}),n?"Saving...":"Save Changes"]})]})]})},gs=({show:s,onConfirm:l,onClose:m})=>{const[o,c]=t.useState(!1),j=async()=>{c(!0),await l(),c(!1)};return e.jsxs(k,{show:s,onHide:m,centered:!0,backdropClassName:"wb-feed-edit-modal__backdrop",style:{zIndex:"1060"},children:[e.jsx(k.Header,{closeButton:!0,children:e.jsxs(k.Title,{children:[e.jsx(ue,{}),"Delete Post"]})}),e.jsx(k.Body,{children:e.jsx("p",{className:"text-muted mb-0",children:"Are you sure you want to delete this post? This action cannot be undone."})}),e.jsxs(k.Footer,{children:[e.jsx("button",{onClick:m,className:"btn btn-light px-4 rounded-3 shadow-sm",disabled:o,children:"Cancel"}),e.jsxs("button",{onClick:j,disabled:o,className:"btn btn-danger px-4 d-inline-flex align-items-center gap-2 rounded-3 shadow-sm",children:[e.jsx(ue,{}),o?"Deleting...":"Delete"]})]})]})},ps=({originalPost:s})=>{const l=U();return e.jsxs("div",{onClick:()=>l(`/feed/${s.id}`),className:"mt-2 border bg-light p-2 text-dark text-decoration-none mb-2",style:{cursor:"pointer"},children:[e.jsxs("div",{className:"d-flex gap-2 align-items-center mb-2",children:[e.jsx(ve,{size:28,avatarImage:s.userAvatarImage}),e.jsx(we,{userId:s.userId,userName:s.userName}),e.jsx("span",{children:"wrote"})]}),e.jsx("div",{className:"wb-feed-content__message",children:e.jsx("i",{children:s.message})})]})},se=Ae.forwardRef(({feed:s,onCommentsClick:l,onShowFullContent:m,onShowUserReactions:o,onGeneralUpdate:c,commentCount:j,onDelete:n,onTogglePin:p,showFullContent:x=!0},v)=>{var G,a,f,y;const{sendJsonRequest:u}=X(),{userInfo:r}=te(),F=r==null?void 0:r.id,[w,h]=t.useState(!1),[I,M]=t.useState(!1),[N,E]=t.useState(!1),D=U(),d=((G=r==null?void 0:r.roles)==null?void 0:G.includes("Admin"))||((a=r==null?void 0:r.roles)==null?void 0:a.includes("Moderator")),[C,b]=t.useState(null),[S,A]=t.useState(!1),O=t.useRef(null),T=t.useCallback((i,g)=>{b({type:i,message:g}),setTimeout(()=>b(null),3e3)},[]);t.useLayoutEffect(()=>{if(O.current&&!x){const{scrollHeight:i,clientHeight:g}=O.current;A(i>g)}else A(!1)},[s.message,s.attachments,x]);const _=async()=>{const i=await u("/Feed/PinFeed","POST",{feedId:s.id,pinned:!s.isPinned});i&&i.success?(p==null||p({...s,isPinned:i.data.isPinned}),T("success",i.data.isPinned?"Post pinned":"Post unpinned")):T("error",i==null?void 0:i.error[0].message)},H=async i=>{const g=await u("/Feed/EditFeed","PUT",{feedId:s.id,message:i});g&&g.success?(c==null||c({...s,message:g.data.message,attachments:g.data.attachments}),T("success","Post updated successfully"),h(!1)):T("error",g==null?void 0:g.error[0].message)},L=async()=>{const i=await u("/Feed/DeleteFeed","DELETE",{feedId:s.id});i&&i.success?(n(s),D("/feed"),T("success","Post deleted successfully")):T("error",i==null?void 0:i.error[0].message)},Z=async i=>{const g=await u("/Feed/VotePost","POST",{postId:s.id,vote:i!=null,reaction:i});if(g&&g.success){const B=s.votes+(s.isUpvoted!=g.vote?g.vote?1:-1:0);let R=[...s.topReactions];const de=s.reaction;if(de){for(let P=0;P<R.length;++P)if(R[P].reaction==de){R[P].count==1?R.splice(P,1):--R[P].count;break}}if(i){let P=-1;for(let Y=0;Y<R.length;++Y)if(R[Y].reaction==i){++R[Y].count,P=Y;break}if(P==-1)R.push({reaction:i,count:1});else for(;P>0&&!(R[P-1].count>R[P].count);)[R[P],R[P-1]]=[R[P-1],R[P]],--P}g.vote===1?s.isUpvoted&&s.reaction===i?(s.totalReactions-=1,s.isUpvoted=!1):s.isUpvoted||(s.totalReactions+=1,s.isUpvoted=!0):s.isUpvoted&&(s.totalReactions-=1,s.isUpvoted=!1),c==null||c({...s,reaction:i,votes:B,isUpvoted:g.vote,topReactions:R,totalReactions:s.totalReactions})}else T("error",g==null?void 0:g.error[0].message)},ae=async(i,g)=>{const B=await u("/Feed/ShareFeed","POST",{feedId:s.id,message:i,tags:g});B&&B.success?(D(`/feed/${B.feed.id}`),M(!1),T("success","Post shared successfully")):T("error",B==null?void 0:B.error[0].message)},ne=()=>{l==null||l(s.id)},W=()=>{o==null||o(s.id)},J=()=>{m==null||m(s.id)},z=s.userId===F,$=e.jsx(e.Fragment,{children:e.jsxs("article",{className:"wb-feed-item",children:[e.jsx(Se,{notification:C,onClose:()=>b(null)}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"d-flex align-items-start gap-2 flex-grow-1",children:[e.jsx(ve,{size:36,avatarImage:s.userAvatarImage}),e.jsxs("div",{className:"d-flex flex-column",children:[e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(we,{userId:s.userId,userName:s.userName}),s.isPinned&&e.jsxs("span",{className:"badge bg-warning bg-opacity-10 text-warning border border-warning border-opacity-25",children:[e.jsx(oe,{className:"me-1"}),"Pinned"]})]}),e.jsxs("div",{className:"text-muted d-flex align-items-center gap-1 small",children:[e.jsx(He,{}),e.jsx("time",{dateTime:s.date,children:Be.format2(new Date(s.date))})]})]})]}),(z||d)&&e.jsxs(q,{children:[e.jsx(q.Toggle,{as:ze}),e.jsxs(q.Menu,{style:{width:"200px"},children:[z&&e.jsx(e.Fragment,{children:e.jsxs(q.Item,{className:"dropdown-item d-flex align-items-center gap-2",onClick:()=>h(!0),children:[e.jsx(_e,{})," Edit Post"]})}),(z||d)&&e.jsx(e.Fragment,{children:e.jsxs(q.Item,{className:"dropdown-item d-flex align-items-center gap-2 text-danger",onClick:()=>E(!0),children:[e.jsx($e,{})," Delete Post"]})}),d&&e.jsxs(q.Item,{className:"dropdown-item d-flex align-items-center gap-2 text-warning",onClick:()=>_(),children:[e.jsx(oe,{})," ",s.isPinned?"Unpin Post":"Pin Post"]})]})]})]}),s.type===Ce.SHARED_FEED&&(s.originalPost?e.jsx(ps,{originalPost:s.originalPost}):e.jsxs("div",{className:"wb-feed-shared-post-unavailable",children:[e.jsx(he,{className:"mb-3 opacity-50"}),e.jsx("p",{className:"mb-0 fw-medium text-muted",children:"This shared post is no longer available"})]})),e.jsxs("div",{ref:O,className:`mt-2 wb-feed-content position-relative ${x?"":"truncated clickable"}`,onClick:x?void 0:J,children:[e.jsx("div",{style:x?{}:{pointerEvents:"none"},children:e.jsx(ce,{content:s.message,allowedUrls:re})}),((f=s.attachments)==null?void 0:f.length)>0&&e.jsx("div",{className:"mt-2 rounded text-dark text-decoration-none",children:((y=s.attachments)==null?void 0:y.length)>0&&e.jsx("div",{className:"mt-2 rounded text-dark text-decoration-none",children:e.jsx("div",{className:"d-flex flex-column gap-2",children:s.attachments.map(i=>e.jsx("div",{className:"mt-1",children:e.jsx(ls,{data:i})},i.id))})})}),!x&&S&&e.jsx("div",{className:"fade-overlay"})]}),e.jsxs("div",{className:"wb-feed-reactions mt-2 d-flex gap-1 align-items-center",onClick:W,children:[e.jsx("div",{className:"d-flex",children:s.topReactions.map((i,g)=>e.jsx("span",{className:"bg-white rounded-circle d-flex align-items-center justify-content-center",style:{marginLeft:g===0?"0":"-6px",width:"18px",height:"18px",zIndex:(s.topReactions.length-g).toString()},children:V[i.reaction??ye.LIKE].emoji},`${i.reaction}-${g}`))}),s.totalReactions>0&&e.jsx("span",{className:"text-muted",children:s.totalReactions})]}),e.jsxs("div",{className:"mt-3 d-flex align-items-center justify-content-between",children:[e.jsx(fs,{onReactionChange:Z,currentState:s.reaction}),e.jsxs("span",{className:"wb-feed-action-btn",onClick:ne,children:[e.jsx(he,{}),e.jsx("span",{children:j}),e.jsx("span",{children:j===1?"comment":"comments"})]}),e.jsxs("span",{className:"wb-feed-action-btn",onClick:()=>{if(!r){D("/Users/Login");return}M(!0)},children:[e.jsx(be,{}),e.jsx("span",{children:s.shares||0}),e.jsx("span",{children:s.shares===1?"share":"shares"})]})]}),w&&e.jsx(js,{show:w,feed:s,onSave:H,onClose:()=>h(!1)}),N&&e.jsx(gs,{show:N,onConfirm:L,onClose:()=>E(!1)}),I&&e.jsx(xs,{show:I,feedId:s.id,onShare:ae,onClose:()=>M(!1)})]})});return v?e.jsx("div",{ref:v,children:$}):$});se.displayName="FeedItem";const bs=({feedId:s,onGeneralUpdate:l,onShowUserReactions:m,onDelete:o,onTogglePin:c})=>{const j=U(),[n,p]=t.useState(null),[x,v]=t.useState(!0),[u,r]=t.useState(null),{sendJsonRequest:F}=X(),[w,h]=t.useState(null),[I,M]=t.useState(null),[N,E]=t.useState(!1),[D,d]=t.useState({section:"Feed",params:{feedId:s}}),[C,b]=t.useState(0),S=qe();t.useEffect(()=>{S.state?((S.state.postId||S.state.comments)&&A(),S.state.postId&&M({id:S.state.postId,isReply:S.state.isReply})):O()},[S]),t.useEffect(()=>{if(!s)return;(async()=>{try{v(!0);const L=await F("/Feed/GetFeed","POST",{feedId:s});if(!L.success)throw new Error(L.message);p(L.feed),b(L.feed.answers),l(L.feed)}catch(L){r("Failed to load feed"),console.error("Error fetching feed:",L),T("error",String(L))}finally{v(!1)}})(),d({section:"Feed",params:{feedId:s}})},[s]),t.useEffect(()=>{n&&l({...n,answers:C})},[C]);const A=()=>{s&&E(!0)},O=()=>{E(!1)},T=(H,L)=>{h({type:H,message:L}),setTimeout(()=>h(null),5e3)},_=H=>{p(H),l(H)};return x?e.jsx(e.Fragment,{children:e.jsx("div",{className:"loading-container",children:e.jsx(Ne,{})})}):u||!n?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"error-container",children:[e.jsx(Se,{notification:w,onClose:()=>h(null)}),e.jsxs("div",{className:"error-content",children:[e.jsx("h4",{className:"error-title",children:u||"Feed not found"}),e.jsxs(Q,{onClick:()=>j("/feed"),variant:"primary",children:[e.jsx(xe,{}),"Back to Feed"]})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(ee,{show:N,onHide:O,backdropClassName:"wb-feed-comment-modal__backdrop",style:{zIndex:1060},placement:"end",children:[e.jsx(ee.Header,{closeButton:!0,children:e.jsxs(ee.Title,{children:[C," Comments"]})}),e.jsx(ee.Body,{className:"d-flex flex-column",style:{height:"calc(100% - 62px)"},children:e.jsx(cs,{findPost:I,options:D,setCommentCount:b})})]}),e.jsx("div",{className:"wb-feed-details-container p-2",children:e.jsxs("div",{className:"wb-feed-main-content",children:[e.jsxs("button",{onClick:()=>j("/feed"),className:"wb-feed-back-button",children:[e.jsx(xe,{size:16}),"Back to Feed"]}),e.jsx(se,{feed:n,onCommentsClick:A,onGeneralUpdate:_,commentCount:C,onShowUserReactions:m,onDelete:o,onTogglePin:c})]})})]})},vs=(s,l,m)=>{const[o,c]=t.useState({page:0}),[j,n]=t.useState([]),[p,x]=t.useState(!1),[v,u]=t.useState([]),[r,F]=t.useState(!1),[w,h]=t.useState(0),{sendJsonRequest:I}=X(),{userInfo:M}=te();t.useEffect(()=>{o.page!=0&&N()},[o]),t.useEffect(()=>{c({page:1})},[s,l]);const N=async()=>{u([]),x(!0);let C=o.page!=1;C||n([]);const b=await I("/Feed","POST",{page:o.page,count:m,filter:s,searchQuery:l,userId:M==null?void 0:M.id});b&&b.success?(n(C?S=>{const A=b.feeds.filter(O=>!S.some(T=>T.id===O.id));return[...S,...A]}:()=>b.feeds),h(b.count),F(b.feeds.length===m)):u(b.error),x(!1)};return{state:o,results:j,loading:p,error:v,hasNextPage:r,totalCount:w,setState:c,editPost:C=>{n(b=>b.map(S=>S.id==C.id?C:S))},deletePost:C=>{n(b=>b.filter(S=>S.id!=C))},addPost:C=>{n(b=>[C,...b])}}},je=[{value:1,label:"Latest",requireLogin:!1},{value:2,label:"My Posts",requireLogin:!0},{value:3,label:"Following",requireLogin:!0},{value:4,label:"Trending (24h)",requireLogin:!1},{value:5,label:"Most Popular",requireLogin:!1},{value:6,label:"Most Shared",requireLogin:!1}],ge=()=>{const{feedId:s}=Ve(),l=U(),{userInfo:m}=te(),[o,c]=t.useState("");let j=1;const n=localStorage.getItem("feed");if(n){const a=JSON.parse(n),f=je.find(y=>y.value===a.filter);f&&(!f.requireLogin||m!=null)&&(j=a.filter)}const[p,x]=t.useState(j),[v,u]=t.useState(!0),[r,F]=t.useState(o),[w,h]=t.useState(!1),[I,M]=t.useState({parentId:""}),[N,E]=t.useState(!0),{sendJsonRequest:D}=X(),d=vs(p,o,10),[C,b]=t.useState([]),[S,A]=t.useState(!1),O=t.useRef(),T=t.useCallback(a=>{d.loading||(O.current&&O.current.disconnect(),O.current=new IntersectionObserver(f=>{f[0].isIntersecting&&d.hasNextPage&&d.results.length>0&&d.setState(y=>({page:y.page+1}))}),a&&O.current.observe(a))},[d.loading,d.hasNextPage,d.results]);t.useEffect(()=>{let a=window.scrollY;const f=()=>{const y=window.scrollY;y<60?u(!0):y>a?u(!1):y<a&&u(!0),a=y};return addEventListener("scroll",f,{passive:!0}),()=>removeEventListener("scroll",f)},[]),t.useEffect(()=>{_()},[]),t.useEffect(()=>{d.state.page===1&&setTimeout(()=>{scrollTo({top:0,behavior:"instant"})})},[d.state]),t.useEffect(()=>{localStorage.setItem("feed",JSON.stringify({filter:p}))},[p]);const _=async()=>{A(!0);const a=await D("/Feed","POST",{page:1,count:10,filter:7,searchQuery:""});a&&a.feeds&&b(()=>a.feeds),A(!1)},H=a=>{const f=Number(a.target.selectedOptions[0].value);x(f)},L=()=>{c(()=>r)},Z=async()=>{A(!0),d.setState({page:1}),await _(),A(!1)},ae=()=>{l("/Feed")},ne=()=>{h(!1)},W=a=>{a.isPinned?b(f=>f.map(y=>y.id==a.id?a:y)):d.editPost(a)},J=a=>{a.isPinned?b(f=>f.filter(y=>y.id!=a.id)):d.deletePost(a.id)},z=a=>{M({parentId:a}),h(!0)},$=a=>{a.isPinned?(d.deletePost(a.id),b(f=>[a,...f]),setTimeout(()=>{scrollTo({top:0,behavior:"smooth"})})):(b(f=>f.filter(y=>y.id!==a.id)),d.addPost(a))},G=()=>{E(a=>!a)};return e.jsxs(e.Fragment,{children:[e.jsx(k,{show:s!=null,onHide:ae,fullscreen:!0,backdrop:"static",children:e.jsx(k.Body,{className:"p-0",children:e.jsx(bs,{feedId:s,onGeneralUpdate:W,onShowUserReactions:z,onDelete:J,onTogglePin:$})})}),e.jsx(os,{title:"Reactions",options:I,visible:w,onClose:ne,showReactions:!0,countPerPage:10}),e.jsxs("div",{className:"wb-feed-list-container",children:[e.jsx("div",{className:`p-2 wb-feed-list-header ${v?"wb-feed-visible":"wb-feed-hidden"}`,children:e.jsxs("div",{className:"d-flex flex-column gap-2",children:[e.jsx("h2",{className:"h4 fw-bold text-dark mb-0",children:"Feed"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(fe,{htmlFor:"search",className:"visually-hidden",children:"Search"}),e.jsx(Ue,{id:"search",type:"search",size:"sm",placeholder:"Search...",value:r,onChange:a=>F(a.target.value),onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),L())}}),e.jsx(Q,{size:"sm",onClick:L,children:"Search"})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between gap-2",children:[e.jsx(fe,{htmlFor:"filter",className:"visually-hidden",children:"Filter"}),e.jsx(We,{id:"filter",size:"sm",style:{width:"140px"},value:p,onChange:H,children:je.filter(a=>a.requireLogin==!1||m!=null).map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsxs("button",{onClick:Z,disabled:d.loading||S,className:"btn btn-light rounded-pill shadow-sm d-flex align-items-center justify-content-center gap-2 wb-feed-control-button",children:[e.jsx(Je,{className:"text-muted"}),e.jsx("span",{className:"d-none d-sm-inline",children:"Refresh"})]})]})]})}),S?e.jsx("div",{className:"d-flex justify-content-center mt-5 text-center",children:e.jsx(Ne,{})}):e.jsxs(e.Fragment,{children:[C.length>0&&e.jsxs("div",{className:"px-2 wb-pinned-feeds-section bg-light",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2",children:[e.jsxs("h6",{className:"text-warning mb-0",children:[e.jsx(oe,{})," Pinned Posts"]}),e.jsx(Q,{size:"sm",variant:"link",className:"text-secondary",onClick:G,children:N?e.jsx(Ye,{}):e.jsx(Ke,{})})]}),N&&e.jsx("div",{children:C.map(a=>e.jsx("div",{className:"border-2 border-bottom mt-3",children:e.jsx(se,{feed:a,onGeneralUpdate:W,onCommentsClick:f=>l(`/feed/${f}`,{state:{comments:!0}}),commentCount:a.answers||0,onShowUserReactions:z,onDelete:J,onTogglePin:$,showFullContent:!1,onShowFullContent:f=>l(`/feed/${f}`)})},a.id))})]}),e.jsxs("div",{className:"px-2 wb-feed-items",children:[d.error.length>0&&e.jsxs("div",{className:"alert alert-danger rounded-4 border-0 d-flex align-items-center gap-3",children:[e.jsx(Qe,{}),e.jsxs("div",{children:[e.jsx("strong",{children:"Error loading feeds"}),e.jsx("ul",{children:d.error.map((a,f)=>e.jsx("li",{children:a.message},f))}),e.jsx("button",{onClick:Z,className:"btn btn-sm btn-outline-danger mt-2",children:"Try Again"})]})]}),!d.loading&&d.error.length==0&&d.results.length===0&&e.jsxs("div",{className:"text-center py-5",children:[e.jsx(Xe,{size:40,className:"opacity-50 mb-3"}),e.jsx("h5",{className:"text-muted",children:"No feeds found"}),e.jsx("p",{className:"text-muted small",children:o?`No results found for "${o}". Try adjusting search or filters.`:"No feeds available at the moment."})]}),e.jsx("div",{children:d.results.map((a,f)=>{const y=f===d.results.length-1;return e.jsx("div",{className:"border-2 border-bottom mt-3",ref:y?T:void 0,children:e.jsx(se,{feed:a,onGeneralUpdate:W,onCommentsClick:i=>l(`/feed/${i}`,{state:{comments:!0}}),commentCount:a.answers||0,onShowUserReactions:z,onDelete:J,onTogglePin:$,showFullContent:!1,onShowFullContent:i=>l(`/feed/${i}`)})},a.id)})}),!d.hasNextPage&&d.results.length>0&&e.jsx("div",{className:"text-center py-4 text-muted small",children:e.jsx("span",{children:"You've reached the end of the feed"})})]})]}),e.jsxs("button",{onClick:()=>l("/feed/new"),className:"wb-feed-new-post-button",title:"Create new post",children:[e.jsx("span",{className:"d-none d-md-inline",children:"New Post"}),e.jsx(Ze,{className:"d-md-none",size:24})]})]})]})},pe=4096,ws=()=>{const[s,l]=t.useState(""),[m,o]=t.useState(!1),[c,j]=t.useState(),[n,p]=t.useState("write"),x=U(),{sendJsonRequest:v}=X(),u=async w=>{if(w.preventDefault(),!s.trim())return;o(!0),j(void 0);const h=await v("/Feed/CreateFeed","POST",{message:s});h.success?x("/Feed/"+h.feed.id):j(h.error),o(!1)},r=()=>{x("/Feed")},F=w=>{l(h=>(h.trim().length==0||h.endsWith(`
`)?h:h+`
`)+w.join(`
`)+`
`)};return e.jsxs("div",{className:"p-2",children:[e.jsx("h2",{className:"fw-semibold my-3",children:"Create New Post"}),e.jsxs(Ge,{onSubmit:u,children:[e.jsx(es,{errors:c}),e.jsx("div",{className:"mb-3",children:e.jsxs(hs,{type:"radio",name:"editorMode",value:n,onChange:w=>p(w),children:[e.jsx(le,{id:"write-btn",value:"write",variant:"outline-primary",children:"Write"}),e.jsx(le,{id:"preview-btn",value:"preview",variant:"outline-primary",children:"Preview"})]})}),n==="write"&&e.jsxs(ss,{className:"mb-3",children:[e.jsx(Fe,{rows:10,placeholder:"What's on your mind?",value:s,setValue:l,required:!0,maxLength:pe}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"mt-2 text-muted small",children:[s.length,"/",pe," characters"]}),e.jsx(rs,{onSubmit:F})]})]}),n==="preview"&&e.jsx("div",{className:"p-3 border rounded bg-light",children:e.jsx(ce,{content:s,allowedUrls:re})}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx(Q,{type:"button",variant:"secondary",onClick:r,disabled:m,children:"Cancel"}),e.jsx(Q,{type:"submit",variant:"primary",disabled:!s.trim()||m,children:"Post"})]})]})]})};const As=()=>e.jsx(ts,{children:e.jsxs(K,{element:e.jsx(as,{Header:e.jsx(ns,{variant:"light"}),Footer:null}),children:[e.jsx(K,{index:!0,element:e.jsx(ie,{MainPage:e.jsx(ge,{})})}),e.jsx(K,{element:e.jsx(is,{allowedRoles:ds}),children:e.jsx(K,{path:"New",element:e.jsx(ie,{MainPage:e.jsx(ws,{})})})}),e.jsx(K,{path:":feedId",element:e.jsx(ie,{MainPage:e.jsx(ge,{})})})]})});export{As as default};
