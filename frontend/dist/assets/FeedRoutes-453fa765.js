import{r as t,aq as Pe,ar as ke,j as e,Y as Re,as as Me,a2 as Te,at as Le,au as Ie,av as pe,b as se,J as V,aw as Oe,ax as de,w as ve,ay as De,az as Ae,aA as me,R as _e,u as K,P as Ne,c as we,aB as ie,aC as $e,D as qe,$ as B,a0 as ze,t as Be,v as He,aD as ue,ah as Ve,L as ye,B as Q,G as he,ai as G,H as Ue,ac as xe,F as We,af as Je,aE as Ye,aF as Qe,a1 as Ke,aG as Xe,ap as Ze,ae as Ge,m as es,d as ss,ab as ts,O as as,Q as Y,S as ns,U as is,V as ls}from"./index-343737ff.js";import{N as Se}from"./NotificationToast-79343890.js";import{r as H,a as Fe,P as Ce,R as os}from"./ReactionsList-cd4a7652.js";import{a as oe}from"./discussAllowedUrls-4f3044c5.js";import{M as re}from"./MarkdownRenderer-61fba914.js";import{P as rs}from"./UserSearch-d02dba13.js";import{C as cs}from"./CommentList-93b95c8a.js";import{M as fe}from"./Modal-88de8eda.js";import{r as ds}from"./roles-68ed67e6.js";import{T as le,B as ms}from"./ToggleButton-34241fc2.js";const us=t.forwardRef((s,r)=>{const{children:l,type:i="radio",name:f,value:m,onChange:o,vertical:g=!1,...h}=Pe(s,{value:"onChange"}),p=()=>m==null?[]:[].concat(m),u=(c,w)=>{if(!o)return;const v=p(),F=v.indexOf(c)!==-1;if(i==="radio"){F||o(c,w);return}o(F?v.filter(L=>L!==c):[...v,c],w)};return i!=="radio"||f||ke(!1),e.jsx(ms,{...h,ref:r,vertical:g,children:Re(l,c=>{const w=p(),{value:v,onChange:F}=c.props,L=R=>u(v,R);return t.cloneElement(c,{type:i,name:c.name||f,checked:w.indexOf(v)!==-1,onChange:Me(F,L)})})})}),hs=Object.assign(us,{Button:le}),ne=({MainPage:s})=>e.jsxs(e.Fragment,{children:[e.jsxs(Te,{children:[" ",e.jsx("title",{children:"Feed | Webler Codes"})," ",e.jsx("meta",{name:"description",content:"Stay up to date with the Webler community! Explore the latest project updates, shared snippets, and highlights from developers worldwide."})," "]}),e.jsx("div",{className:"wb-feed-layout-container",children:s})]});var Ee=(s=>(s[s.QUESTION=1]="QUESTION",s[s.ANSWER=2]="ANSWER",s[s.CODE_COMMENT=3]="CODE_COMMENT",s[s.FEED=4]="FEED",s[s.SHARED_FEED=5]="SHARED_FEED",s[s.FEED_COMMENT=6]="FEED_COMMENT",s))(Ee||{});const xs=({feedId:s,onShare:r,onClose:l})=>{const[i,f]=t.useState(""),[m,o]=t.useState(!1),[g,h]=t.useState(!1),[p]=t.useState([]),u=window.location.origin+`/feed/${s}`,c=async()=>{o(!0),await r(i,p),l(),o(!1)},w=async()=>{await navigator.clipboard.writeText(u),h(!0),setTimeout(()=>h(!1),2e3)};return e.jsx("div",{className:"modal fade show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered modal-fullscreen-sm-down",children:e.jsxs("div",{className:"modal-content shadow-lg rounded-3 border-0",children:[e.jsxs("div",{className:"modal-header border-bottom",children:[e.jsxs("h5",{className:"modal-title d-flex align-items-center gap-2",children:[e.jsx(Le,{})," Share Post"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:l})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Add your thoughts"}),e.jsx("textarea",{value:i,onChange:v=>f(v.target.value),placeholder:"What do you think about this post?",rows:4,className:"form-control",disabled:m})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between p-2 border rounded bg-light",children:[e.jsx("span",{className:"text-truncate me-2",style:{maxWidth:"75%"},children:u}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-secondary d-flex align-items-center gap-1",onClick:w,children:[e.jsx(Ie,{}),g?"Copied!":"Copy"]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:l,disabled:m,children:"Cancel"}),e.jsxs("button",{type:"button",className:"btn btn-primary d-flex align-items-center gap-2",onClick:c,disabled:m,children:[e.jsx(pe,{}),m?"Sharing...":"Share Post"]})]})]})})})},fs=({onReactionChange:s,currentState:r})=>{const[l,i]=t.useState(r),[f,m]=t.useState(!1),[o,g]=t.useState(null),h=t.useRef(null),p=t.useRef(null),{userInfo:u}=se(),c=V();t.useEffect(()=>{i(r)},[r]);const w=N=>{const E=N==l?null:N;i(E),s(E),m(!1)},v=()=>{u!=null&&u.id||c("/Users/Login"),m(!f)},F=()=>{u!=null&&u.id||c("/Users/Login");const N=window.setTimeout(()=>{m(!0)},500);g(N)},L=()=>{o&&(clearTimeout(o),g(null))},R=()=>{p.current&&clearTimeout(p.current)};return t.useEffect(()=>{const N=E=>{h.current&&!h.current.contains(E.target)&&m(!1)};return document.addEventListener("mousedown",N),document.addEventListener("touchstart",N),()=>{document.removeEventListener("mousedown",N),document.removeEventListener("touchstart",N),p.current&&clearTimeout(p.current),o&&clearTimeout(o)}},[o]),e.jsxs("div",{ref:h,className:"position-relative d-flex align-items-center",children:[e.jsxs("span",{className:"wb-reaction-picker-btn",onClick:v,onTouchStart:F,onTouchEnd:L,style:{color:l?H[l].color:"#65676b"},children:[e.jsx("span",{children:l?H[l].emoji:e.jsx(Oe,{})}),e.jsx("span",{children:l?H[l].label:H[Fe.LIKE].label})]}),f&&e.jsx("div",{className:"position-absolute bg-white border rounded-pill shadow-lg d-flex align-items-center gap-1",style:{bottom:"100%",left:"0",marginBottom:"8px",zIndex:1e3,animation:"slideUp 0.2s ease-out",whiteSpace:"nowrap",borderColor:"#dadde1"},onMouseEnter:R,onTouchStart:N=>N.stopPropagation(),children:Object.entries(H).map(([N,E])=>{const O=Number(N);return e.jsx("button",{type:"button",className:"btn p-1 border-0 d-flex align-items-center justify-content-center",style:{width:"32px",height:"32px",borderRadius:"50%",backgroundColor:l==O?`${E.color}20`:"transparent"},onClick:d=>{d.stopPropagation(),w(O)},title:E.label,children:E.emoji},O)})})]})},gs=({feed:s,onSave:r,onClose:l})=>{const[i,f]=t.useState(s.message),[m,o]=t.useState(!1),[g,h]=t.useState("write"),p=async()=>{i.trim()&&(o(!0),await r(i.trim()),o(!1))};return e.jsx("div",{className:"modal fade show d-block",style:{backgroundColor:"rgba(0,0,0,0.6)",backdropFilter:"blur(4px)",zIndex:1050},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered modal-fullscreen-sm-down",children:e.jsxs("div",{className:"modal-content border-0 shadow-lg rounded-4 overflow-hidden",children:[e.jsxs("div",{className:"modal-header bg-light border-0",children:[e.jsxs("h5",{className:"modal-title d-flex align-items-center gap-2 fw-semibold text-dark mb-0",children:[e.jsx(de,{}),"Edit Post"]}),e.jsx("button",{type:"button",className:"btn btn-sm btn-icon btn-outline-secondary","aria-label":"Close",onClick:l,disabled:m,children:e.jsx(ve,{})})]}),e.jsx("div",{className:"modal-body bg-white",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-medium text-muted",children:"Post Content"}),e.jsxs("div",{className:"d-flex gap-2 mb-2",children:[e.jsxs("button",{type:"button",className:`btn btn-sm ${g==="write"?"btn-primary":"btn-outline-primary"}`,onClick:()=>h("write"),children:[e.jsx(De,{className:"me-1"})," Write"]}),e.jsxs("button",{type:"button",className:`btn btn-sm ${g==="preview"?"btn-primary":"btn-outline-primary"}`,onClick:()=>h("preview"),children:[e.jsx(Ae,{className:"me-1"})," Preview"]})]}),g==="write"&&e.jsx(Ce,{value:i,setValue:f,placeholder:"What's on your mind?",rows:6}),g==="preview"&&e.jsx("div",{className:"wb-feed-content__message",children:e.jsx(re,{content:i,allowedUrls:oe})})]})}),e.jsxs("div",{className:"modal-footer border-0 d-flex justify-content-end gap-2",children:[e.jsx("button",{onClick:l,className:"btn btn-light px-4 rounded-3 shadow-sm",disabled:m,children:"Cancel"}),e.jsxs("button",{onClick:p,disabled:!i.trim()||m,className:"btn btn-primary px-4 d-inline-flex align-items-center gap-2 rounded-3 shadow-sm",children:[e.jsx(de,{}),m?"Saving...":"Save Changes"]})]})]})})})},js=({onConfirm:s,onClose:r})=>{const[l,i]=t.useState(!1),f=async()=>{i(!0),await s(),i(!1)};return e.jsx("div",{className:"modal fade show d-block",style:{backgroundColor:"rgba(0,0,0,0.6)",backdropFilter:"blur(4px)",zIndex:1050},onClick:r,children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content border-0 shadow-lg rounded-4 overflow-hidden",children:[e.jsxs("div",{className:"modal-header bg-light border-0",children:[e.jsxs("h5",{className:"modal-title d-flex align-items-center gap-2 fw-semibold text-danger mb-0",children:[e.jsx(me,{}),"Delete Post"]}),e.jsx("button",{type:"button",className:"btn btn-sm btn-icon btn-outline-secondary","aria-label":"Close",onClick:r,disabled:l,children:e.jsx(ve,{})})]}),e.jsx("div",{className:"modal-body bg-white",children:e.jsx("p",{className:"text-muted mb-0",children:"Are you sure you want to delete this post? This action cannot be undone."})}),e.jsxs("div",{className:"modal-footer border-0 d-flex justify-content-end gap-2",children:[e.jsx("button",{onClick:r,className:"btn btn-light px-4 rounded-3 shadow-sm",disabled:l,children:"Cancel"}),e.jsxs("button",{onClick:f,disabled:l,className:"btn btn-danger px-4 d-inline-flex align-items-center gap-2 rounded-3 shadow-sm",children:[e.jsx(me,{}),l?"Deleting...":"Delete"]})]})]})})})},bs=({originalPost:s})=>{const r=V();return e.jsxs("div",{onClick:()=>r(`/feed/${s.id}`),className:"mt-2 border bg-light p-2 text-dark text-decoration-none mb-2",style:{cursor:"pointer"},children:[e.jsxs("div",{className:"d-flex gap-2 align-items-center mb-2",children:[e.jsx(Ne,{size:28,avatarImage:s.userAvatarImage}),e.jsx(we,{userId:s.userId,userName:s.userName}),e.jsx("span",{children:"wrote"})]}),e.jsx("div",{className:"wb-feed-content__message",children:e.jsx("i",{children:s.message})})]})},ee=_e.forwardRef(({feed:s,onCommentsClick:r,onShowFullContent:l,onShowUserReactions:i,onGeneralUpdate:f,commentCount:m,onDelete:o,onTogglePin:g,showFullContent:h=!0},p)=>{var Z,a,x,S;const{sendJsonRequest:u}=K(),{userInfo:c}=se(),w=c==null?void 0:c.id,[v,F]=t.useState(!1),[L,R]=t.useState(!1),[N,E]=t.useState(!1),O=V(),d=((Z=c==null?void 0:c.roles)==null?void 0:Z.includes("Admin"))||((a=c==null?void 0:c.roles)==null?void 0:a.includes("Moderator")),[C,b]=t.useState(null),[y,D]=t.useState(!1),I=t.useRef(null),M=t.useCallback((n,j)=>{b({type:n,message:j}),setTimeout(()=>b(null),3e3)},[]);t.useLayoutEffect(()=>{if(I.current&&!h){const{scrollHeight:n,clientHeight:j}=I.current;D(n>j)}else D(!1)},[s.message,s.attachments,h]);const q=async()=>{const n=await u("/Feed/PinFeed","POST",{feedId:s.id,pinned:!s.isPinned});n&&n.success?(g==null||g({...s,isPinned:n.data.isPinned}),M("success",n.data.isPinned?"Post pinned":"Post unpinned")):M("error",n==null?void 0:n.error[0].message)},A=async n=>{const j=await u("/Feed/EditFeed","PUT",{feedId:s.id,message:n});j&&j.success?(f==null||f({...s,message:j.data.message,attachments:j.data.attachments}),M("success","Post updated successfully"),F(!1)):M("error",j==null?void 0:j.error[0].message)},T=async()=>{const n=await u("/Feed/DeleteFeed","DELETE",{feedId:s.id});n&&n.success?(o(s),O("/feed"),M("success","Post deleted successfully")):M("error",n==null?void 0:n.error[0].message)},X=async n=>{const j=await u("/Feed/VotePost","POST",{postId:s.id,vote:n!=null,reaction:n});if(j&&j.success){const _=s.votes+(s.isUpvoted!=j.vote?j.vote?1:-1:0);let k=[...s.topReactions];const ce=s.reaction;if(ce){for(let P=0;P<k.length;++P)if(k[P].reaction==ce){k[P].count==1?k.splice(P,1):--k[P].count;break}}if(n){let P=-1;for(let J=0;J<k.length;++J)if(k[J].reaction==n){++k[J].count,P=J;break}if(P==-1)k.push({reaction:n,count:1});else for(;P>0&&!(k[P-1].count>k[P].count);)[k[P],k[P-1]]=[k[P-1],k[P]],--P}j.vote===1?s.isUpvoted&&s.reaction===n?(s.totalReactions-=1,s.isUpvoted=!1):s.isUpvoted||(s.totalReactions+=1,s.isUpvoted=!0):s.isUpvoted&&(s.totalReactions-=1,s.isUpvoted=!1),f==null||f({...s,reaction:n,votes:_,isUpvoted:j.vote,topReactions:k,totalReactions:s.totalReactions})}else M("error",j==null?void 0:j.error[0].message)},te=async(n,j)=>{const _=await u("/Feed/ShareFeed","POST",{feedId:s.id,message:n,tags:j});_&&_.success?(O(`/feed/${_.feed.id}`),R(!1),M("success","Post shared successfully")):M("error",_==null?void 0:_.error[0].message)},ae=()=>{r==null||r(s.id)},U=()=>{i==null||i(s.id)},W=()=>{l==null||l(s.id)},$=s.userId===w,z=e.jsx(e.Fragment,{children:e.jsxs("article",{className:"wb-feed-item",children:[e.jsx(Se,{notification:C,onClose:()=>b(null)}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"d-flex align-items-start gap-2 flex-grow-1",children:[e.jsx(Ne,{size:36,avatarImage:s.userAvatarImage}),e.jsxs("div",{className:"d-flex flex-column",children:[e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(we,{userId:s.userId,userName:s.userName}),s.isPinned&&e.jsxs("span",{className:"badge bg-warning bg-opacity-10 text-warning border border-warning border-opacity-25",children:[e.jsx(ie,{className:"me-1"}),"Pinned"]})]}),e.jsxs("div",{className:"text-muted d-flex align-items-center gap-1 small",children:[e.jsx($e,{}),e.jsx("time",{dateTime:s.date,children:qe.format2(new Date(s.date))})]})]})]}),($||d)&&e.jsxs(B,{children:[e.jsx(B.Toggle,{as:ze}),e.jsxs(B.Menu,{style:{width:"200px"},children:[$&&e.jsx(e.Fragment,{children:e.jsxs(B.Item,{className:"dropdown-item d-flex align-items-center gap-2",onClick:()=>F(!0),children:[e.jsx(Be,{})," Edit Post"]})}),($||d)&&e.jsx(e.Fragment,{children:e.jsxs(B.Item,{className:"dropdown-item d-flex align-items-center gap-2 text-danger",onClick:()=>E(!0),children:[e.jsx(He,{})," Delete Post"]})}),d&&e.jsxs(B.Item,{className:"dropdown-item d-flex align-items-center gap-2 text-warning",onClick:()=>q(),children:[e.jsx(ie,{})," ",s.isPinned?"Unpin Post":"Pin Post"]})]})]})]}),s.type===Ee.SHARED_FEED&&(s.originalPost?e.jsx(bs,{originalPost:s.originalPost}):e.jsxs("div",{className:"wb-feed-shared-post-unavailable",children:[e.jsx(ue,{className:"mb-3 opacity-50"}),e.jsx("p",{className:"mb-0 fw-medium text-muted",children:"This shared post is no longer available"})]})),e.jsxs("div",{ref:I,className:`mt-2 wb-feed-content position-relative ${h?"":"truncated clickable"}`,onClick:h?void 0:W,children:[e.jsx("div",{className:"wb-feed-content__message",style:h?{}:{pointerEvents:"none"},children:e.jsx(re,{content:s.message,allowedUrls:oe})}),((x=s.attachments)==null?void 0:x.length)>0&&e.jsx("div",{className:"mt-2 rounded text-dark text-decoration-none",children:((S=s.attachments)==null?void 0:S.length)>0&&e.jsx("div",{className:"mt-2 rounded text-dark text-decoration-none",children:e.jsx("div",{className:"d-flex flex-column gap-2",children:s.attachments.map(n=>e.jsx("div",{className:"mt-1",children:e.jsx(rs,{data:n})},n.id))})})}),!h&&y&&e.jsx("div",{className:"fade-overlay"})]}),e.jsxs("div",{className:"wb-feed-reactions mt-2 d-flex gap-1 align-items-center",onClick:U,children:[e.jsx("div",{className:"d-flex",children:s.topReactions.map((n,j)=>e.jsx("span",{className:"bg-white rounded-circle d-flex align-items-center justify-content-center",style:{marginLeft:j===0?"0":"-6px",width:"18px",height:"18px",zIndex:(s.topReactions.length-j).toString()},children:H[n.reaction??Fe.LIKE].emoji},`${n.reaction}-${j}`))}),s.totalReactions>0&&e.jsx("span",{className:"text-muted",children:s.totalReactions})]}),e.jsxs("div",{className:"mt-3 d-flex align-items-center justify-content-between",children:[e.jsx(fs,{onReactionChange:X,currentState:s.reaction}),e.jsxs("span",{className:"wb-feed-action-btn",onClick:ae,children:[e.jsx(ue,{}),e.jsx("span",{children:m}),e.jsx("span",{children:m===1?"comment":"comments"})]}),e.jsxs("span",{className:"wb-feed-action-btn",onClick:()=>{if(!c){O("/Users/Login");return}R(!0)},children:[e.jsx(pe,{}),e.jsx("span",{children:s.shares||0}),e.jsx("span",{children:s.shares===1?"share":"shares"})]})]}),v&&e.jsx(gs,{feed:s,onSave:A,onClose:()=>F(!1)}),N&&e.jsx(js,{onConfirm:T,onClose:()=>E(!1)}),L&&e.jsx(xs,{feedId:s.id,onShare:te,onClose:()=>R(!1)})]})});return p?e.jsx("div",{ref:p,children:z}):z});ee.displayName="FeedItem";const ps=({feedId:s,onGeneralUpdate:r,onShowUserReactions:l,onDelete:i,onTogglePin:f})=>{const m=V(),[o,g]=t.useState(null),[h,p]=t.useState(!0),[u,c]=t.useState(null),{sendJsonRequest:w}=K(),[v,F]=t.useState(null),[L,R]=t.useState(null),[N,E]=t.useState(!1),[O,d]=t.useState({section:"Feed",params:{feedId:s}}),[C,b]=t.useState(0),y=Ve();t.useEffect(()=>{y.state?((y.state.postId||y.state.comments)&&D(),y.state.postId&&R({id:y.state.postId,isReply:y.state.isReply})):I()},[y]),t.useEffect(()=>{if(!s)return;(async()=>{try{p(!0);const T=await w("/Feed/GetFeed","POST",{feedId:s});if(!T.success)throw new Error(T.message);g(T.feed),b(T.feed.answers),r(T.feed)}catch(T){c("Failed to load feed"),console.error("Error fetching feed:",T),M("error",String(T))}finally{p(!1)}})(),d({section:"Feed",params:{feedId:s}})},[s]),t.useEffect(()=>{o&&r({...o,answers:C})},[C]);const D=()=>{s&&E(!0)},I=()=>{E(!1)},M=(A,T)=>{F({type:A,message:T}),setTimeout(()=>F(null),5e3)},q=A=>{g(A),r(A)};return h?e.jsx(e.Fragment,{children:e.jsx("div",{className:"loading-container",children:e.jsx(ye,{})})}):u||!o?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"error-container",children:[e.jsx(Se,{notification:v,onClose:()=>F(null)}),e.jsxs("div",{className:"error-content",children:[e.jsx("h4",{className:"error-title",children:u||"Feed not found"}),e.jsxs(Q,{onClick:()=>m("/feed"),variant:"primary",children:[e.jsx(he,{}),"Back to Feed"]})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(G,{show:N,onHide:I,backdropClassName:"wb-feed-comment-modal__backdrop",style:{zIndex:1060},placement:"end",children:[e.jsx(G.Header,{closeButton:!0,children:e.jsxs(G.Title,{children:[C," Comments"]})}),e.jsx(G.Body,{className:"d-flex flex-column",style:{height:"calc(100% - 62px)"},children:e.jsx(cs,{findPost:L,options:O,setCommentCount:b})})]}),e.jsx("div",{className:"wb-feed-details-container p-2",children:e.jsxs("div",{className:"wb-feed-main-content",children:[e.jsxs("button",{onClick:()=>m("/feed"),className:"wb-feed-back-button",children:[e.jsx(he,{size:16}),"Back to Feed"]}),e.jsx(ee,{feed:o,onCommentsClick:D,onGeneralUpdate:q,commentCount:C,onShowUserReactions:l,onDelete:i,onTogglePin:f})]})})]})},vs=(s,r,l)=>{const[i,f]=t.useState({page:0}),[m,o]=t.useState([]),[g,h]=t.useState(!1),[p,u]=t.useState([]),[c,w]=t.useState(!1),[v,F]=t.useState(0),{sendJsonRequest:L}=K(),{userInfo:R}=se();t.useEffect(()=>{i.page!=0&&N()},[i]),t.useEffect(()=>{f({page:1})},[s,r]);const N=async()=>{u([]),h(!0);let C=i.page!=1;C||o([]);const b=await L("/Feed","POST",{page:i.page,count:l,filter:s,searchQuery:r,userId:R==null?void 0:R.id});b&&b.success?(o(C?y=>{const D=b.feeds.filter(I=>!y.some(M=>M.id===I.id));return[...y,...D]}:()=>b.feeds),F(b.count),w(b.feeds.length===l)):u(b.error),h(!1)};return{state:i,results:m,loading:g,error:p,hasNextPage:c,totalCount:v,setState:f,editPost:C=>{o(b=>b.map(y=>y.id==C.id?C:y))},deletePost:C=>{o(b=>b.filter(y=>y.id!=C))},addPost:C=>{o(b=>[C,...b])}}},ge=[{value:1,label:"Latest",requireLogin:!1},{value:2,label:"My Posts",requireLogin:!0},{value:3,label:"Following",requireLogin:!0},{value:4,label:"Trending (24h)",requireLogin:!1},{value:5,label:"Most Popular",requireLogin:!1},{value:6,label:"Most Shared",requireLogin:!1}],je=()=>{const{feedId:s}=Ue(),r=V(),{userInfo:l}=se(),[i,f]=t.useState("");let m=1;const o=localStorage.getItem("feed");if(o){const a=JSON.parse(o),x=ge.find(S=>S.value===a.filter);x&&(!x.requireLogin||l!=null)&&(m=a.filter)}const[g,h]=t.useState(m),[p,u]=t.useState(!0),[c,w]=t.useState(i),[v,F]=t.useState(!1),[L,R]=t.useState({parentId:""}),[N,E]=t.useState(!0),{sendJsonRequest:O}=K(),d=vs(g,i,10),[C,b]=t.useState([]),[y,D]=t.useState(!1),I=t.useRef(),M=t.useCallback(a=>{d.loading||(I.current&&I.current.disconnect(),I.current=new IntersectionObserver(x=>{x[0].isIntersecting&&d.hasNextPage&&d.results.length>0&&d.setState(S=>({page:S.page+1}))}),a&&I.current.observe(a))},[d.loading,d.hasNextPage,d.results]);t.useEffect(()=>{let a=window.scrollY;const x=()=>{const S=window.scrollY;S<60?u(!0):S>a?u(!1):S<a&&u(!0),a=S};return addEventListener("scroll",x,{passive:!0}),()=>removeEventListener("scroll",x)},[]),t.useEffect(()=>{q()},[]),t.useEffect(()=>{d.state.page===1&&setTimeout(()=>{scrollTo({top:0,behavior:"instant"})})},[d.state]),t.useEffect(()=>{localStorage.setItem("feed",JSON.stringify({filter:g}))},[g]);const q=async()=>{D(!0);const a=await O("/Feed","POST",{page:1,count:10,filter:7,searchQuery:""});a&&a.feeds&&b(()=>a.feeds),D(!1)},A=a=>{const x=Number(a.target.selectedOptions[0].value);h(x)},T=()=>{f(()=>c)},X=async()=>{D(!0),d.setState({page:1}),await q(),D(!1)},te=()=>{r("/Feed")},ae=()=>{F(!1)},U=a=>{a.isPinned?b(x=>x.map(S=>S.id==a.id?a:S)):d.editPost(a)},W=a=>{a.isPinned?b(x=>x.filter(S=>S.id!=a.id)):d.deletePost(a.id)},$=a=>{R({parentId:a}),F(!0)},z=a=>{a.isPinned?(d.deletePost(a.id),b(x=>[a,...x]),setTimeout(()=>{scrollTo({top:0,behavior:"smooth"})})):(b(x=>x.filter(S=>S.id!==a.id)),d.addPost(a))},Z=()=>{E(a=>!a)};return e.jsxs(e.Fragment,{children:[e.jsx(fe,{show:s!=null,onHide:te,fullscreen:!0,backdrop:"static",children:e.jsx(fe.Body,{className:"p-0",children:e.jsx(ps,{feedId:s,onGeneralUpdate:U,onShowUserReactions:$,onDelete:W,onTogglePin:z})})}),e.jsx(os,{title:"Reactions",options:L,visible:v,onClose:ae,showReactions:!0,countPerPage:10}),e.jsxs("div",{className:"wb-feed-list-container",children:[e.jsx("div",{className:`p-2 wb-feed-list-header ${p?"wb-feed-visible":"wb-feed-hidden"}`,children:e.jsxs("div",{className:"d-flex flex-column gap-2",children:[e.jsx("h2",{className:"h4 fw-bold text-dark mb-0",children:"Feed"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(xe,{htmlFor:"search",className:"visually-hidden",children:"Search"}),e.jsx(We,{id:"search",type:"search",size:"sm",placeholder:"Search...",value:c,onChange:a=>w(a.target.value),onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),T())}}),e.jsx(Q,{size:"sm",onClick:T,children:"Search"})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between gap-2",children:[e.jsx(xe,{htmlFor:"filter",className:"visually-hidden",children:"Filter"}),e.jsx(Je,{id:"filter",size:"sm",style:{width:"140px"},value:g,onChange:A,children:ge.filter(a=>a.requireLogin==!1||l!=null).map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsxs("button",{onClick:X,disabled:d.loading||y,className:"btn btn-light rounded-pill shadow-sm d-flex align-items-center justify-content-center gap-2 wb-feed-control-button",children:[e.jsx(Ye,{className:"text-muted"}),e.jsx("span",{className:"d-none d-sm-inline",children:"Refresh"})]})]})]})}),y?e.jsx("div",{className:"d-flex justify-content-center mt-5 text-center",children:e.jsx(ye,{})}):e.jsxs(e.Fragment,{children:[C.length>0&&e.jsxs("div",{className:"px-2 wb-pinned-feeds-section bg-light",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2",children:[e.jsxs("h6",{className:"text-warning mb-0",children:[e.jsx(ie,{})," Pinned Posts"]}),e.jsx(Q,{size:"sm",variant:"link",className:"text-secondary",onClick:Z,children:N?e.jsx(Qe,{}):e.jsx(Ke,{})})]}),N&&e.jsx("div",{children:C.map(a=>e.jsx("div",{className:"border-2 border-bottom mt-3",children:e.jsx(ee,{feed:a,onGeneralUpdate:U,onCommentsClick:x=>r(`/feed/${x}`,{state:{comments:!0}}),commentCount:a.answers||0,onShowUserReactions:$,onDelete:W,onTogglePin:z,showFullContent:!1,onShowFullContent:x=>r(`/feed/${x}`)})},a.id))})]}),e.jsxs("div",{className:"px-2 wb-feed-items",children:[d.error.length>0&&e.jsxs("div",{className:"alert alert-danger rounded-4 border-0 d-flex align-items-center gap-3",children:[e.jsx(Xe,{}),e.jsxs("div",{children:[e.jsx("strong",{children:"Error loading feeds"}),e.jsx("ul",{children:d.error.map((a,x)=>e.jsx("li",{children:a.message},x))}),e.jsx("button",{onClick:X,className:"btn btn-sm btn-outline-danger mt-2",children:"Try Again"})]})]}),!d.loading&&d.error.length==0&&d.results.length===0&&e.jsxs("div",{className:"text-center py-5",children:[e.jsx(Ze,{size:40,className:"opacity-50 mb-3"}),e.jsx("h5",{className:"text-muted",children:"No feeds found"}),e.jsx("p",{className:"text-muted small",children:i?`No results found for "${i}". Try adjusting search or filters.`:"No feeds available at the moment."})]}),e.jsx("div",{children:d.results.map((a,x)=>{const S=x===d.results.length-1;return e.jsx("div",{className:"border-2 border-bottom mt-3",ref:S?M:void 0,children:e.jsx(ee,{feed:a,onGeneralUpdate:U,onCommentsClick:n=>r(`/feed/${n}`,{state:{comments:!0}}),commentCount:a.answers||0,onShowUserReactions:$,onDelete:W,onTogglePin:z,showFullContent:!1,onShowFullContent:n=>r(`/feed/${n}`)})},a.id)})}),!d.hasNextPage&&d.results.length>0&&e.jsx("div",{className:"text-center py-4 text-muted small",children:e.jsx("span",{children:"You've reached the end of the feed"})})]})]}),e.jsxs("button",{onClick:()=>r("/feed/new"),className:"wb-feed-new-post-button",title:"Create new post",children:[e.jsx("span",{className:"d-none d-md-inline",children:"New Post"}),e.jsx(Ge,{className:"d-md-none",size:24})]})]})]})},be=4096,Ns=()=>{const[s,r]=t.useState(""),[l,i]=t.useState(!1),[f,m]=t.useState(),[o,g]=t.useState("write"),h=V(),{sendJsonRequest:p}=K(),u=async w=>{if(w.preventDefault(),!s.trim())return;i(!0),m(void 0);const v=await p("/Feed/CreateFeed","POST",{message:s});v.success?h("/Feed/"+v.feed.id):m(v.error),i(!1)},c=()=>{h("/Feed")};return e.jsxs("div",{className:"p-2",children:[e.jsx("h2",{className:"fw-semibold my-3",children:"Create New Post"}),e.jsxs(es,{onSubmit:u,children:[e.jsx(ss,{errors:f}),e.jsx("div",{className:"mb-3",children:e.jsxs(hs,{type:"radio",name:"editorMode",value:o,onChange:w=>g(w),children:[e.jsx(le,{id:"write-btn",value:"write",variant:"outline-primary",children:"Write"}),e.jsx(le,{id:"preview-btn",value:"preview",variant:"outline-primary",children:"Preview"})]})}),o==="write"&&e.jsxs(ts,{className:"mb-3",children:[e.jsx(Ce,{rows:10,placeholder:"What's on your mind?",value:s,setValue:r,required:!0,maxLength:be}),e.jsxs("div",{className:"mt-2 text-muted small",children:[s.length,"/",be," characters"]})]}),o==="preview"&&e.jsx("div",{className:"p-3 border rounded bg-light",children:e.jsx("div",{className:"wb-feed-content__message",children:e.jsx(re,{content:s,allowedUrls:oe})})}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx(Q,{type:"button",variant:"secondary",onClick:c,disabled:l,children:"Cancel"}),e.jsx(Q,{type:"submit",variant:"primary",disabled:!s.trim()||l,children:"Post"})]})]})]})};const Ts=()=>e.jsx(as,{children:e.jsxs(Y,{element:e.jsx(ns,{Header:e.jsx(is,{variant:"light"}),Footer:null}),children:[e.jsx(Y,{index:!0,element:e.jsx(ne,{MainPage:e.jsx(je,{})})}),e.jsx(Y,{element:e.jsx(ls,{allowedRoles:ds}),children:e.jsx(Y,{path:"New",element:e.jsx(ne,{MainPage:e.jsx(Ns,{})})})}),e.jsx(Y,{path:":feedId",element:e.jsx(ne,{MainPage:e.jsx(je,{})})})]})});export{Ts as default};
