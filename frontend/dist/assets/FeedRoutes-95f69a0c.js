import{j as e,ad as Se,r as t,aw as ye,al as se,ax as Fe,ay as je,n as ae,e as U,az as Ee,aA as de,s as ue,A as Ce,d as X,G as ge,M as pe,aB as le,aC as Pe,I as ke,D as $,E as Re,a3 as Me,a4 as Te,aD as me,ap as Le,L as be,B as K,a9 as he,b as ee,m as Ie,g as De,ao as Oe,aE as He,aF as Ae,ac as ze,aG as _e,q as qe,an as Be,F as $e,N as Ve,x as Ue,y as Q,aa as We,H as Je,z as Ye}from"./index-11d2e42e.js";import{M as re,a as Qe}from"./MdEditorField-10097716.js";import{M as E}from"./Modal-772d06a5.js";import{N as ve}from"./NotificationToast-4109e069.js";import{r as V,a as Ne,R as Ke}from"./ReactionsList-f82cc35a.js";import{P as Xe}from"./PostAttachment-d1f9204a.js";import{M as Ze}from"./PostTextareaControl-aba28153.js";import{C as Ge}from"./CommentList-1208afa4.js";import{r as es}from"./roles-68ed67e6.js";import"./PostAttachmentSelect-89cfd0db.js";import"./CodeList-3ead88bb.js";import"./react-bootstrap-pagination-control.esm-f5e252ef.js";import"./Code-4f0eb453.js";import"./Toast-0c9237c7.js";const oe=({MainPage:s})=>e.jsxs(e.Fragment,{children:[e.jsxs(Se,{children:[" ",e.jsx("title",{children:"Feed | Webler Codes"})," ",e.jsx("meta",{name:"description",content:"Stay up to date with the Webler community! Explore the latest project updates, shared snippets, and highlights from developers worldwide."})," "]}),e.jsx("div",{className:"wb-feed-layout-container",children:s})]});var we=(s=>(s[s.QUESTION=1]="QUESTION",s[s.ANSWER=2]="ANSWER",s[s.CODE_COMMENT=3]="CODE_COMMENT",s[s.FEED=4]="FEED",s[s.SHARED_FEED=5]="SHARED_FEED",s[s.FEED_COMMENT=6]="FEED_COMMENT",s))(we||{});const ss=({show:s,feedId:r,onShare:c,onClose:i})=>{const[d,j]=t.useState(""),[o,g]=t.useState(!1),[p,w]=t.useState(!1),[x]=t.useState([]),m=window.location.origin+`/feed/${r}`,O=async()=>{g(!0),await c(d,x),i(),g(!1)},L=async()=>{await navigator.clipboard.writeText(m),w(!0),setTimeout(()=>w(!1),2e3)};return e.jsxs(E,{show:s,onHide:i,size:"lg",centered:!0,backdropClassName:"wb-feed-edit-modal__backdrop",fullscreen:"sm-down",backdrop:"static",style:{zIndex:"1060"},children:[e.jsx(E.Header,{closeButton:!0,children:e.jsxs(E.Title,{children:[e.jsx(ye,{}),"Share Post"]})}),e.jsxs(E.Body,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx(se,{className:"form-label",children:"Add your thoughts"}),e.jsx(re,{text:d,setText:j,row:10,placeHolder:"What do you think about this post?"})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between p-2 border rounded bg-light",children:[e.jsx("span",{className:"text-truncate me-2",style:{maxWidth:"75%"},children:m}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-secondary d-flex align-items-center gap-1",onClick:L,children:[e.jsx(Fe,{}),p?"Copied!":"Copy"]})]})]}),e.jsxs(E.Footer,{children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:i,disabled:o,children:"Cancel"}),e.jsxs("button",{type:"button",className:"btn btn-primary d-flex align-items-center gap-2",onClick:O,disabled:o,children:[e.jsx(je,{}),o?"Sharing...":"Share Post"]})]})]})},ts=({onReactionChange:s,currentState:r})=>{const[c,i]=t.useState(r),[d,j]=t.useState(!1),[o,g]=t.useState(null),p=t.useRef(null),w=t.useRef(null),{userInfo:x}=ae(),m=U();t.useEffect(()=>{i(r)},[r]);const O=b=>{const y=b==c?null:b;i(y),s(y),j(!1)},L=()=>{x!=null&&x.id||m("/Users/Login"),j(!d)},R=()=>{x!=null&&x.id||m("/Users/Login");const b=window.setTimeout(()=>{j(!0)},500);g(b)},H=()=>{o&&(clearTimeout(o),g(null))},M=()=>{w.current&&clearTimeout(w.current)};return t.useEffect(()=>{const b=y=>{p.current&&!p.current.contains(y.target)&&j(!1)};return document.addEventListener("mousedown",b),document.addEventListener("touchstart",b),()=>{document.removeEventListener("mousedown",b),document.removeEventListener("touchstart",b),w.current&&clearTimeout(w.current),o&&clearTimeout(o)}},[o]),e.jsxs("div",{ref:p,className:"position-relative d-flex align-items-center",children:[e.jsxs("span",{className:"wb-reaction-picker-btn",onClick:L,onTouchStart:R,onTouchEnd:H,style:{color:c?V[c].color:"#65676b"},children:[e.jsx("span",{children:c?V[c].emoji:e.jsx(Ee,{})}),e.jsx("span",{children:c?V[c].label:V[Ne.LIKE].label})]}),d&&e.jsx("div",{className:"position-absolute bg-white border rounded-pill shadow-lg d-flex align-items-center gap-1",style:{bottom:"100%",left:"0",marginBottom:"8px",zIndex:1e3,animation:"slideUp 0.2s ease-out",whiteSpace:"nowrap",borderColor:"#dadde1"},onMouseEnter:M,onTouchStart:b=>b.stopPropagation(),children:Object.entries(V).map(([b,y])=>{const I=Number(b);return e.jsx("button",{type:"button",className:"btn p-1 border-0 d-flex align-items-center justify-content-center",style:{width:"32px",height:"32px",borderRadius:"50%",backgroundColor:c==I?`${y.color}20`:"transparent"},onClick:l=>{l.stopPropagation(),O(I)},title:y.label,children:y.emoji},I)})})]})},as=({show:s,feed:r,onSave:c,onClose:i})=>{const[d,j]=t.useState(r.message),[o,g]=t.useState(!1),p=async()=>{d.trim()&&(g(!0),await c(d.trim()),g(!1))};return e.jsxs(E,{show:s,onHide:i,size:"lg",centered:!0,backdrop:"static",backdropClassName:"wb-feed-edit-modal__backdrop",fullscreen:"sm-down",style:{zIndex:"1060"},children:[e.jsx(E.Header,{closeButton:!0,children:e.jsxs(E.Title,{children:[e.jsx(de,{}),"Edit Post"]})}),e.jsx(E.Body,{style:{maxHeight:"70vh",overflow:"auto"},children:e.jsxs("div",{children:[e.jsx(se,{className:"form-label fw-medium text-muted",children:"Post Content"}),e.jsx(re,{text:d,setText:j,row:10,placeHolder:"What do you think about this post?"})]})}),e.jsxs(E.Footer,{children:[e.jsx("button",{onClick:i,className:"btn btn-light px-4 rounded-3 shadow-sm",disabled:o,children:"Cancel"}),e.jsxs("button",{onClick:p,disabled:!d.trim()||o,className:"btn btn-primary px-4 d-inline-flex align-items-center gap-2 rounded-3 shadow-sm",children:[e.jsx(de,{}),o?"Saving...":"Save Changes"]})]})]})},ns=({show:s,onConfirm:r,onClose:c})=>{const[i,d]=t.useState(!1),j=async()=>{d(!0),await r(),d(!1)};return e.jsxs(E,{show:s,onHide:c,centered:!0,backdropClassName:"wb-feed-edit-modal__backdrop",style:{zIndex:"1060"},children:[e.jsx(E.Header,{closeButton:!0,children:e.jsxs(E.Title,{children:[e.jsx(ue,{}),"Delete Post"]})}),e.jsx(E.Body,{children:e.jsx("p",{className:"text-muted mb-0",children:"Are you sure you want to delete this post? This action cannot be undone."})}),e.jsxs(E.Footer,{children:[e.jsx("button",{onClick:c,className:"btn btn-light px-4 rounded-3 shadow-sm",disabled:i,children:"Cancel"}),e.jsxs("button",{onClick:j,disabled:i,className:"btn btn-danger px-4 d-inline-flex align-items-center gap-2 rounded-3 shadow-sm",children:[e.jsx(ue,{}),i?"Deleting...":"Delete"]})]})]})},is=({originalPost:s})=>{const r=U();return e.jsxs("div",{onClick:()=>r(`/feed/${s.id}`),className:"mt-2 border bg-light p-2 text-dark text-decoration-none mb-2",style:{cursor:"pointer"},children:[e.jsxs("div",{className:"d-flex gap-2 align-items-center mb-2",children:[e.jsx(ge,{size:28,avatarImage:s.userAvatarImage}),e.jsx(pe,{userId:s.userId,userName:s.userName}),e.jsx("span",{children:"wrote"})]}),e.jsx("div",{className:"wb-feed-content__message",children:e.jsx("i",{children:s.message})})]})},te=Ce.forwardRef(({feed:s,onCommentsClick:r,onShowFullContent:c,onShowUserReactions:i,onGeneralUpdate:d,commentCount:j,onDelete:o,onTogglePin:g,showFullContent:p=!0},w)=>{var G,a,u,N;const{sendJsonRequest:x}=X(),{userInfo:m}=ae(),O=m==null?void 0:m.id,[L,R]=t.useState(!1),[H,M]=t.useState(!1),[b,y]=t.useState(!1),I=U(),l=((G=m==null?void 0:m.roles)==null?void 0:G.includes("Admin"))||((a=m==null?void 0:m.roles)==null?void 0:a.includes("Moderator")),[S,f]=t.useState(null),[v,D]=t.useState(!1),T=t.useRef(null),P=t.useCallback((n,h)=>{f({type:n,message:h}),setTimeout(()=>f(null),3e3)},[]);t.useLayoutEffect(()=>{if(T.current&&!p){const{scrollHeight:n,clientHeight:h}=T.current;D(n>h)}else D(!1)},[s.message,s.attachments,p]);const q=async()=>{const n=await x("/Feed/PinFeed","POST",{feedId:s.id,pinned:!s.isPinned});n&&n.success?(g==null||g({...s,isPinned:n.data.isPinned}),P("success",n.data.isPinned?"Post pinned":"Post unpinned")):P("error",n==null?void 0:n.error[0].message)},A=async n=>{const h=await x("/Feed/EditFeed","PUT",{feedId:s.id,message:n});h&&h.success?(d==null||d({...s,message:h.data.message,attachments:h.data.attachments}),P("success","Post updated successfully"),R(!1)):P("error",h==null?void 0:h.error[0].message)},k=async()=>{const n=await x("/Feed/DeleteFeed","DELETE",{feedId:s.id});n&&n.success?(o(s),I("/feed"),P("success","Post deleted successfully")):P("error",n==null?void 0:n.error[0].message)},Z=async n=>{const h=await x("/Feed/VotePost","POST",{postId:s.id,vote:n!=null,reaction:n});if(h&&h.success){const z=s.votes+(s.isUpvoted!=h.vote?h.vote?1:-1:0);let C=[...s.topReactions];const ce=s.reaction;if(ce){for(let F=0;F<C.length;++F)if(C[F].reaction==ce){C[F].count==1?C.splice(F,1):--C[F].count;break}}if(n){let F=-1;for(let Y=0;Y<C.length;++Y)if(C[Y].reaction==n){++C[Y].count,F=Y;break}if(F==-1)C.push({reaction:n,count:1});else for(;F>0&&!(C[F-1].count>C[F].count);)[C[F],C[F-1]]=[C[F-1],C[F]],--F}h.vote===1?s.isUpvoted&&s.reaction===n?(s.totalReactions-=1,s.isUpvoted=!1):s.isUpvoted||(s.totalReactions+=1,s.isUpvoted=!0):s.isUpvoted&&(s.totalReactions-=1,s.isUpvoted=!1),d==null||d({...s,reaction:n,votes:z,isUpvoted:h.vote,topReactions:C,totalReactions:s.totalReactions})}else P("error",h==null?void 0:h.error[0].message)},ne=async(n,h)=>{const z=await x("/Feed/ShareFeed","POST",{feedId:s.id,message:n,tags:h});z&&z.success?(I(`/feed/${z.feed.id}`),M(!1),P("success","Post shared successfully")):P("error",z==null?void 0:z.error[0].message)},ie=()=>{r==null||r(s.id)},W=()=>{i==null||i(s.id)},J=()=>{c==null||c(s.id)},_=s.userId===O,B=e.jsx(e.Fragment,{children:e.jsxs("article",{className:"wb-feed-item",children:[e.jsx(ve,{notification:S,onClose:()=>f(null)}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"d-flex align-items-start gap-2 flex-grow-1",children:[e.jsx(ge,{size:36,avatarImage:s.userAvatarImage}),e.jsxs("div",{className:"d-flex flex-column",children:[e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(pe,{userId:s.userId,userName:s.userName}),s.isPinned&&e.jsxs("span",{className:"badge bg-warning bg-opacity-10 text-warning border border-warning border-opacity-25",children:[e.jsx(le,{className:"me-1"}),"Pinned"]})]}),e.jsxs("div",{className:"text-muted d-flex align-items-center gap-1 small",children:[e.jsx(Pe,{}),e.jsx("time",{dateTime:s.date,children:ke.format2(new Date(s.date))})]})]})]}),(_||l)&&e.jsxs($,{children:[e.jsx($.Toggle,{as:Re}),e.jsxs($.Menu,{style:{width:"200px"},children:[_&&e.jsx(e.Fragment,{children:e.jsxs($.Item,{className:"dropdown-item d-flex align-items-center gap-2",onClick:()=>R(!0),children:[e.jsx(Me,{})," Edit Post"]})}),(_||l)&&e.jsx(e.Fragment,{children:e.jsxs($.Item,{className:"dropdown-item d-flex align-items-center gap-2 text-danger",onClick:()=>y(!0),children:[e.jsx(Te,{})," Delete Post"]})}),l&&e.jsxs($.Item,{className:"dropdown-item d-flex align-items-center gap-2 text-warning",onClick:()=>q(),children:[e.jsx(le,{})," ",s.isPinned?"Unpin Post":"Pin Post"]})]})]})]}),s.type===we.SHARED_FEED&&(s.originalPost?e.jsx(is,{originalPost:s.originalPost}):e.jsxs("div",{className:"wb-feed-shared-post-unavailable",children:[e.jsx(me,{className:"mb-3 opacity-50"}),e.jsx("p",{className:"mb-0 fw-medium text-muted",children:"This shared post is no longer available"})]})),e.jsxs("div",{ref:T,className:`mt-2 wb-feed-content position-relative ${p?"":"truncated clickable"}`,onClick:p?void 0:J,children:[e.jsx("div",{style:p?{}:{pointerEvents:"none"},children:e.jsx(Ze,{content:s.message,allowedUrls:Qe})}),((u=s.attachments)==null?void 0:u.length)>0&&e.jsx("div",{className:"mt-2 rounded text-dark text-decoration-none",children:((N=s.attachments)==null?void 0:N.length)>0&&e.jsx("div",{className:"mt-2 rounded text-dark text-decoration-none",children:e.jsx("div",{className:"d-flex flex-column gap-2",children:s.attachments.map(n=>e.jsx("div",{className:"mt-1",children:e.jsx(Xe,{data:n})},n.id))})})}),!p&&v&&e.jsx("div",{className:"fade-overlay"})]}),e.jsxs("div",{className:"wb-feed-reactions mt-2 d-flex gap-1 align-items-center",onClick:W,children:[e.jsx("div",{className:"d-flex",children:s.topReactions.map((n,h)=>e.jsx("span",{className:"bg-white rounded-circle d-flex align-items-center justify-content-center",style:{marginLeft:h===0?"0":"-6px",width:"18px",height:"18px",zIndex:(s.topReactions.length-h).toString()},children:V[n.reaction??Ne.LIKE].emoji},`${n.reaction}-${h}`))}),s.totalReactions>0&&e.jsx("span",{className:"text-muted",children:s.totalReactions})]}),e.jsxs("div",{className:"mt-3 d-flex align-items-center justify-content-between",children:[e.jsx(ts,{onReactionChange:Z,currentState:s.reaction}),e.jsxs("span",{className:"wb-feed-action-btn",onClick:ie,children:[e.jsx(me,{}),e.jsx("span",{children:j}),e.jsx("span",{children:j===1?"comment":"comments"})]}),e.jsxs("span",{className:"wb-feed-action-btn",onClick:()=>{if(!m){I("/Users/Login");return}M(!0)},children:[e.jsx(je,{}),e.jsx("span",{children:s.shares||0}),e.jsx("span",{children:s.shares===1?"share":"shares"})]})]}),L&&e.jsx(as,{show:L,feed:s,onSave:A,onClose:()=>R(!1)}),b&&e.jsx(ns,{show:b,onConfirm:k,onClose:()=>y(!1)}),H&&e.jsx(ss,{show:H,feedId:s.id,onShare:ne,onClose:()=>M(!1)})]})});return w?e.jsx("div",{ref:w,children:B}):B});te.displayName="FeedItem";const os=({feedId:s,onGeneralUpdate:r,onShowUserReactions:c,onDelete:i,onTogglePin:d})=>{const j=U(),[o,g]=t.useState(null),[p,w]=t.useState(!0),[x,m]=t.useState(null),{sendJsonRequest:O}=X(),[L,R]=t.useState(null),[H,M]=t.useState(null),[b,y]=t.useState(!1),[I,l]=t.useState({section:"Feed",params:{feedId:s}}),[S,f]=t.useState(0),v=Le();t.useEffect(()=>{v.state?((v.state.postId||v.state.comments)&&D(),v.state.postId&&M({id:v.state.postId,isReply:v.state.isReply})):T()},[v]),t.useEffect(()=>{if(!s)return;(async()=>{try{w(!0);const k=await O("/Feed/GetFeed","POST",{feedId:s});if(!k.success)throw new Error(k.message);g(k.feed),f(k.feed.answers),r(k.feed)}catch(k){m("Failed to load feed"),console.error("Error fetching feed:",k),P("error",String(k))}finally{w(!1)}})(),l({section:"Feed",params:{feedId:s}})},[s]),t.useEffect(()=>{o&&r({...o,answers:S})},[S]);const D=()=>{s&&y(!0)},T=()=>{y(!1)},P=(A,k)=>{R({type:A,message:k}),setTimeout(()=>R(null),5e3)},q=A=>{g(A),r(A)};return p?e.jsx(e.Fragment,{children:e.jsx("div",{className:"loading-container",children:e.jsx(be,{})})}):x||!o?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"error-container",children:[e.jsx(ve,{notification:L,onClose:()=>R(null)}),e.jsxs("div",{className:"error-content",children:[e.jsx("h4",{className:"error-title",children:x||"Feed not found"}),e.jsxs(K,{onClick:()=>j("/feed"),variant:"primary",children:[e.jsx(he,{}),"Back to Feed"]})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(ee,{show:b,onHide:T,backdropClassName:"wb-feed-comment-modal__backdrop",style:{zIndex:1060},placement:"end",children:[e.jsx(ee.Header,{closeButton:!0,children:e.jsxs(ee.Title,{children:[S," Comments"]})}),e.jsx(ee.Body,{className:"d-flex flex-column",style:{height:"calc(100% - 62px)"},children:e.jsx(Ge,{findPost:H,options:I,setCommentCount:f})})]}),e.jsx("div",{className:"wb-feed-details-container p-2",children:e.jsxs("div",{className:"wb-feed-main-content",children:[e.jsxs("button",{onClick:()=>j("/feed"),className:"wb-feed-back-button",children:[e.jsx(he,{size:16}),"Back to Feed"]}),e.jsx(te,{feed:o,onCommentsClick:D,onGeneralUpdate:q,commentCount:S,onShowUserReactions:c,onDelete:i,onTogglePin:d})]})})]})},ls=(s,r,c)=>{const[i,d]=t.useState({page:0}),[j,o]=t.useState([]),[g,p]=t.useState(!1),[w,x]=t.useState([]),[m,O]=t.useState(!1),[L,R]=t.useState(0),{sendJsonRequest:H}=X(),{userInfo:M}=ae();t.useEffect(()=>{i.page!=0&&b()},[i]),t.useEffect(()=>{d({page:1})},[s,r]);const b=async()=>{x([]),p(!0);let S=i.page!=1;S||o([]);const f=await H("/Feed","POST",{page:i.page,count:c,filter:s,searchQuery:r,userId:M==null?void 0:M.id});f&&f.success?(o(S?v=>{const D=f.feeds.filter(T=>!v.some(P=>P.id===T.id));return[...v,...D]}:()=>f.feeds),R(f.count),O(f.feeds.length===c)):x(f.error),p(!1)};return{state:i,results:j,loading:g,error:w,hasNextPage:m,totalCount:L,setState:d,editPost:S=>{o(f=>f.map(v=>v.id==S.id?S:v))},deletePost:S=>{o(f=>f.filter(v=>v.id!=S))},addPost:S=>{o(f=>[S,...f])}}},xe=[{value:1,label:"Latest",requireLogin:!1},{value:2,label:"My Posts",requireLogin:!0},{value:3,label:"Following",requireLogin:!0},{value:4,label:"Trending (24h)",requireLogin:!1},{value:5,label:"Most Popular",requireLogin:!1},{value:6,label:"Most Shared",requireLogin:!1}],fe=()=>{const{feedId:s}=Ie(),r=U(),{userInfo:c}=ae(),[i,d]=t.useState("");let j=1;const o=localStorage.getItem("feed");if(o){const a=JSON.parse(o),u=xe.find(N=>N.value===a.filter);u&&(!u.requireLogin||c!=null)&&(j=a.filter)}const[g,p]=t.useState(j),[w,x]=t.useState(!0),[m,O]=t.useState(i),[L,R]=t.useState(!1),[H,M]=t.useState({parentId:""}),[b,y]=t.useState(!0),{sendJsonRequest:I}=X(),l=ls(g,i,10),[S,f]=t.useState([]),[v,D]=t.useState(!1),T=t.useRef(),P=t.useCallback(a=>{l.loading||(T.current&&T.current.disconnect(),T.current=new IntersectionObserver(u=>{u[0].isIntersecting&&l.hasNextPage&&l.results.length>0&&l.setState(N=>({page:N.page+1}))}),a&&T.current.observe(a))},[l.loading,l.hasNextPage,l.results]);t.useEffect(()=>{let a=window.scrollY;const u=()=>{const N=window.scrollY;N<60?x(!0):N>a?x(!1):N<a&&x(!0),a=N};return addEventListener("scroll",u,{passive:!0}),()=>removeEventListener("scroll",u)},[]),t.useEffect(()=>{q()},[]),t.useEffect(()=>{l.state.page===1&&setTimeout(()=>{scrollTo({top:0,behavior:"instant"})})},[l.state]),t.useEffect(()=>{localStorage.setItem("feed",JSON.stringify({filter:g}))},[g]);const q=async()=>{D(!0);const a=await I("/Feed","POST",{page:1,count:10,filter:7,searchQuery:""});a&&a.feeds&&f(()=>a.feeds),D(!1)},A=a=>{const u=Number(a.target.selectedOptions[0].value);p(u)},k=()=>{d(()=>m)},Z=async()=>{D(!0),l.setState({page:1}),await q(),D(!1)},ne=()=>{r("/Feed")},ie=()=>{R(!1)},W=a=>{a.isPinned?f(u=>u.map(N=>N.id==a.id?a:N)):l.editPost(a)},J=a=>{a.isPinned?f(u=>u.filter(N=>N.id!=a.id)):l.deletePost(a.id)},_=a=>{M({parentId:a}),R(!0)},B=a=>{a.isPinned?(l.deletePost(a.id),f(u=>[a,...u]),setTimeout(()=>{scrollTo({top:0,behavior:"smooth"})})):(f(u=>u.filter(N=>N.id!==a.id)),l.addPost(a))},G=()=>{y(a=>!a)};return e.jsxs(e.Fragment,{children:[e.jsx(E,{show:s!=null,onHide:ne,fullscreen:!0,backdrop:"static",children:e.jsx(E.Body,{className:"p-0",children:e.jsx(os,{feedId:s,onGeneralUpdate:W,onShowUserReactions:_,onDelete:J,onTogglePin:B})})}),e.jsx(Ke,{title:"Reactions",options:H,visible:L,onClose:ie,showReactions:!0,countPerPage:10}),e.jsxs("div",{className:"wb-feed-list-container",children:[e.jsx("div",{className:`p-2 wb-feed-list-header ${w?"wb-feed-visible":"wb-feed-hidden"}`,children:e.jsxs("div",{className:"d-flex flex-column gap-2",children:[e.jsx("h2",{className:"h4 fw-bold text-dark mb-0",children:"Feed"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(se,{htmlFor:"search",className:"visually-hidden",children:"Search"}),e.jsx(De,{id:"search",type:"search",size:"sm",placeholder:"Search...",value:m,onChange:a=>O(a.target.value),onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),k())}}),e.jsx(K,{size:"sm",onClick:k,children:"Search"})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between gap-2",children:[e.jsx(se,{htmlFor:"filter",className:"visually-hidden",children:"Filter"}),e.jsx(Oe,{id:"filter",size:"sm",style:{width:"140px"},value:g,onChange:A,children:xe.filter(a=>a.requireLogin==!1||c!=null).map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsxs("button",{onClick:Z,disabled:l.loading||v,className:"btn btn-light rounded-pill shadow-sm d-flex align-items-center justify-content-center gap-2 wb-feed-control-button",children:[e.jsx(He,{className:"text-muted"}),e.jsx("span",{className:"d-none d-sm-inline",children:"Refresh"})]})]})]})}),v?e.jsx("div",{className:"d-flex justify-content-center mt-5 text-center",children:e.jsx(be,{})}):e.jsxs(e.Fragment,{children:[S.length>0&&e.jsxs("div",{className:"px-2 wb-pinned-feeds-section bg-light",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center py-2",children:[e.jsxs("h6",{className:"text-warning mb-0",children:[e.jsx(le,{})," Pinned Posts"]}),e.jsx(K,{size:"sm",variant:"link",className:"text-secondary",onClick:G,children:b?e.jsx(Ae,{}):e.jsx(ze,{})})]}),b&&e.jsx("div",{children:S.map(a=>e.jsx("div",{className:"border-2 border-bottom mt-3",children:e.jsx(te,{feed:a,onGeneralUpdate:W,onCommentsClick:u=>r(`/feed/${u}`,{state:{comments:!0}}),commentCount:a.answers||0,onShowUserReactions:_,onDelete:J,onTogglePin:B,showFullContent:!1,onShowFullContent:u=>r(`/feed/${u}`)})},a.id))})]}),e.jsxs("div",{className:"px-2 wb-feed-items",children:[l.error.length>0&&e.jsxs("div",{className:"alert alert-danger rounded-4 border-0 d-flex align-items-center gap-3",children:[e.jsx(_e,{}),e.jsxs("div",{children:[e.jsx("strong",{children:"Error loading feeds"}),e.jsx("ul",{children:l.error.map((a,u)=>e.jsx("li",{children:a.message},u))}),e.jsx("button",{onClick:Z,className:"btn btn-sm btn-outline-danger mt-2",children:"Try Again"})]})]}),!l.loading&&l.error.length==0&&l.results.length===0&&e.jsxs("div",{className:"text-center py-5",children:[e.jsx(qe,{size:40,className:"opacity-50 mb-3"}),e.jsx("h5",{className:"text-muted",children:"No feeds found"}),e.jsx("p",{className:"text-muted small",children:i?`No results found for "${i}". Try adjusting search or filters.`:"No feeds available at the moment."})]}),e.jsx("div",{children:l.results.map((a,u)=>{const N=u===l.results.length-1;return e.jsx("div",{className:"border-2 border-bottom mt-3",ref:N?P:void 0,children:e.jsx(te,{feed:a,onGeneralUpdate:W,onCommentsClick:n=>r(`/feed/${n}`,{state:{comments:!0}}),commentCount:a.answers||0,onShowUserReactions:_,onDelete:J,onTogglePin:B,showFullContent:!1,onShowFullContent:n=>r(`/feed/${n}`)})},a.id)})}),!l.hasNextPage&&l.results.length>0&&e.jsx("div",{className:"text-center py-4 text-muted small",children:e.jsx("span",{children:"You've reached the end of the feed"})})]})]}),e.jsxs("button",{onClick:()=>r("/feed/new"),className:"wb-feed-new-post-button",title:"Create new post",children:[e.jsx("span",{className:"d-none d-md-inline",children:"New Post"}),e.jsx(Be,{className:"d-md-none",size:24})]})]})]})},rs=()=>{const[s,r]=t.useState(""),[c,i]=t.useState(!1),[d,j]=t.useState(),o=U(),{sendJsonRequest:g}=X(),p=async x=>{if(x.preventDefault(),!s.trim())return;i(!0),j(void 0);const m=await g("/Feed/CreateFeed","POST",{message:s});m.success?o("/Feed/"+m.feed.id):j(m.error),i(!1)},w=()=>{o("/Feed")};return e.jsxs("div",{className:"p-2",children:[e.jsx("h2",{className:"fw-semibold my-3",children:"Create New Post"}),e.jsxs($e,{onSubmit:p,children:[e.jsx(Ve,{errors:d}),e.jsx(re,{text:s,setText:r,row:10,placeHolder:"What's on your mind"}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx(K,{type:"button",variant:"secondary",onClick:w,disabled:c,children:"Cancel"}),e.jsx(K,{type:"submit",variant:"primary",disabled:!s.trim()||c,children:"Post"})]})]})]})};const Ss=()=>e.jsx(Ue,{children:e.jsxs(Q,{element:e.jsx(We,{Header:e.jsx(Je,{variant:"light"}),Footer:null}),children:[e.jsx(Q,{index:!0,element:e.jsx(oe,{MainPage:e.jsx(fe,{})})}),e.jsx(Q,{element:e.jsx(Ye,{allowedRoles:es}),children:e.jsx(Q,{path:"New",element:e.jsx(oe,{MainPage:e.jsx(rs,{})})})}),e.jsx(Q,{path:":feedId",element:e.jsx(oe,{MainPage:e.jsx(fe,{})})})]})});export{Ss as default};
