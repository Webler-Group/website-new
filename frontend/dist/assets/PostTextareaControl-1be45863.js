import{r as a,j as t,R as y,i as k}from"./index-b2f3d98e.js";import{c as B}from"./index.esm-cb18ecd9.js";import{U as L}from"./UserSearch-78852d36.js";import{F as N}from"./FormControl-a036e454.js";import{B as V}from"./Button-a8db19a8.js";function D(n){const p=/\[user id="([0-9a-fA-F]{24})"\](.*?)\[\/user\]/g,r=[];let c=0,i;for(;(i=p.exec(n))!==null;){i.index>c&&r.push(t.jsx(y.Fragment,{children:n.substring(c,i.index)},r.length));const g=i[1],m=i[2];r.push(t.jsxs(k,{to:`/Profile/${g}`,children:["@",m]},r.length)),c=p.lastIndex}return c<n.length&&r.push(t.jsx(y.Fragment,{children:n.substring(c)},r.length)),r}const W=a.forwardRef(({value:n,setValue:p,placeholder:r,rows:c=3,size:i,required:g,maxLength:m},T)=>{const v=a.useRef(null),o=T??v,j=a.useRef(null),[d,x]=a.useState(!1),[w,R]=a.useState(""),[P,C]=a.useState({top:0,left:0}),[S,F]=a.useState(null),H=e=>{const s=e.target.selectionStart,l=e.target.value;p(l),l[s-1]==="@"&&(F(s-1),R(""),I(),x(!0)),d&&S!==null&&x(!1)},I=()=>{const e=o.current;if(!e)return;const s=5;C({top:e.offsetHeight+s,left:10})};a.useLayoutEffect(()=>{if(!d)return;const e=o.current,s=j.current;if(!e||!s)return;const l=e.getBoundingClientRect(),u=s.offsetHeight,b=l.top,f=5;let h;const E=10;b>=u+f?h=-(u+f):h=e.offsetHeight+f,C({top:h,left:E})},[d,w]);const U=e=>{var f;if(S===null)return;const s=n.substring(0,S),l=n.substring(((f=o.current)==null?void 0:f.selectionStart)??0),u=`[user id="${e.id}"]${e.name}[/user] `,b=s+u+l;p(b),x(!1),setTimeout(()=>{if(o.current){const h=s.length+u.length;o.current.selectionStart=o.current.selectionEnd=h,o.current.focus()}})};return t.jsxs("div",{style:{position:"relative"},children:[t.jsx(N,{ref:o,as:"textarea",rows:c,placeholder:r??"Write your comment here...",value:n,onChange:H,size:i,required:g,maxLength:m}),d&&t.jsxs("div",{ref:j,style:{position:"absolute",top:P.top,left:P.left,zIndex:2e3,background:"white",border:"1px solid #ccc",borderRadius:"0.25rem",padding:"0.25rem",boxShadow:"0 2px 6px rgba(0,0,0,0.15)",minWidth:"250px"},children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[t.jsx("small",{className:"text-muted",children:"Mention user"}),t.jsx(V,{size:"sm",variant:"light",onClick:()=>x(!1),style:{lineHeight:"1",padding:"0.1rem 0.25rem"},children:t.jsx(B,{})})]}),t.jsx(L,{value:w,setValue:R,onSelect:U,placeholder:"Search users...",maxWidthPx:250})]})]})});W.displayName="PostTextareaControl";export{W as P,D as p};
