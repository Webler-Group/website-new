import{r,j as t,F as O,B as U,w as W,R,a2 as z,u as A,b as B,P as V,c as D,L as M}from"./index-795837a4.js";import{U as _}from"./UserSearch-6cc5ea48.js";import{M as N}from"./Modal-61b83090.js";function X(e){const d=/\[user id="([0-9a-fA-F]{24})"\](.*?)\[\/user\]/g,n=[];let l=0,o;for(;(o=d.exec(e))!==null;){o.index>l&&n.push(t.jsx(R.Fragment,{children:e.substring(l,o.index)},n.length));const f=o[1],u=o[2];n.push(t.jsxs(z,{to:`/Profile/${f}`,children:["@",u]},n.length)),l=d.lastIndex}return l<e.length&&n.push(t.jsx(R.Fragment,{children:e.substring(l)},n.length)),n}const G=r.forwardRef(({value:e,setValue:d,placeholder:n,rows:l=3,size:o,required:f,maxLength:u},g)=>{const p=r.useRef(null),a=g??p,b=r.useRef(null),[s,h]=r.useState(!1),[c,i]=r.useState(""),[j,L]=r.useState({top:0,left:0}),[y,C]=r.useState(null),F=x=>{const m=x.target.selectionStart,w=x.target.value;d(w),w[m-1]==="@"&&(C(m-1),i(""),H(),h(!0)),s&&y!==null&&h(!1)},H=()=>{const x=a.current;if(!x)return;const m=5;L({top:x.offsetHeight+m,left:10})};r.useLayoutEffect(()=>{if(!s)return;const x=a.current,m=b.current;if(!x||!m)return;const w=x.getBoundingClientRect(),S=m.offsetHeight,P=w.top,v=5;let I;const k=10;P>=S+v?I=-(S+v):I=x.offsetHeight+v,L({top:I,left:k})},[s,c]);const T=x=>{var v;if(y===null)return;const m=e.substring(0,y),w=e.substring(((v=a.current)==null?void 0:v.selectionStart)??0),S=`[user id="${x.id}"]${x.name}[/user] `,P=m+S+w;d(P),h(!1),setTimeout(()=>{if(a.current){const I=m.length+S.length;a.current.selectionStart=a.current.selectionEnd=I,a.current.focus()}})};return t.jsxs("div",{style:{position:"relative"},children:[t.jsx(O,{ref:a,as:"textarea",rows:l,placeholder:n??"Write your comment here...",value:e,onChange:F,size:o,required:f,maxLength:u}),s&&t.jsxs("div",{ref:b,style:{position:"absolute",top:j.top,left:j.left,zIndex:2e3,background:"white",border:"1px solid #ccc",borderRadius:"0.25rem",padding:"0.25rem",boxShadow:"0 2px 6px rgba(0,0,0,0.15)",minWidth:"250px"},children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[t.jsx("small",{className:"text-muted",children:"Mention user"}),t.jsx(U,{size:"sm",variant:"light",onClick:()=>h(!1),style:{lineHeight:"1",padding:"0.1rem 0.25rem"},children:t.jsx(W,{})})]}),t.jsx(_,{value:c,setValue:i,onSelect:T,placeholder:"Search users...",maxWidthPx:250})]})]})});G.displayName="PostTextareaControl";const $=(e,d)=>{const{sendJsonRequest:n}=A(),[l,o]=r.useState([]),[f,u]=r.useState(!1),[g,p]=r.useState(!0),[a,b]=r.useState(),[s,h]=r.useState({page:1});return r.useEffect(()=>{(async()=>{if(s.page==0||!e.parentId)return;b(void 0),u(!0);const i=await n("/Feed/GetUserReactions","POST",{parentId:e.parentId,page:s.page,count:d});i&&i.userReactions?(o(j=>s.page==1?i.userReactions:[...j,...i.userReactions]),p(i.userReactions.length===d)):b(i.error),u(!1)})()},[s]),r.useEffect(()=>{o([]),h({page:1})},[e]),{results:l,loading:f,hasNextPage:g,error:a,setState:h}};var q=(e=>(e[e.LIKE=1]="LIKE",e[e.HAHA=2]="HAHA",e[e.ANGRY=3]="ANGRY",e[e.LOVE=4]="LOVE",e[e.SAD=5]="SAD",e[e.WOW=6]="WOW",e))(q||{});const J={1:{emoji:"👍",label:"Like",color:"#1877f2"},4:{emoji:"❤️",label:"Love",color:"#e91e63"},2:{emoji:"😂",label:"Haha",color:"#f39c12"},6:{emoji:"😮",label:"Wow",color:"#f39c12"},5:{emoji:"😢",label:"Sad",color:"#f39c12"},3:{emoji:"😡",label:"Angry",color:"#e74c3c"}},K=R.forwardRef(({item:e,showReactions:d},n)=>{const{sendJsonRequest:l}=A(),[o,f]=r.useState(!1),[u,g]=r.useState(e.isFollowing),{userInfo:p}=B(),a=async()=>{if(!p)return;f(!0);const c=await l("/Profile/Follow","POST",{userId:e.userId});c&&c.success&&g(!0),f(!1)},b=async()=>{if(!p)return;f(!0);const c=await l("/Profile/Unfollow","POST",{userId:e.userId});c&&c.success&&g(!1),f(!1)},s=J[e.reaction],h=t.jsxs("div",{className:"d-flex justify-content-between align-items-start py-2 border-bottom",children:[t.jsxs("div",{className:"d-flex align-items-start",children:[t.jsx("div",{className:"me-2",children:t.jsx(V,{size:42,avatarImage:e.userAvatar??null})}),t.jsxs("div",{className:"d-flex flex-column",children:[t.jsx(D,{userId:e.userId,userName:e.userName}),d&&t.jsxs("div",{className:"mt-1 d-flex align-items-center",title:s.label,children:[t.jsx("span",{className:"me-1",children:s.emoji}),t.jsx("span",{style:{fontSize:"15px",color:s.color,fontWeight:600},children:s.label})]})]})]}),p&&p.id!==e.userId&&(u?t.jsx("button",{className:"btn btn-outline-secondary btn-sm",disabled:o,onClick:b,children:"Unfollow"}):t.jsx("button",{className:"btn btn-primary btn-sm",disabled:o,onClick:a,children:"Follow"}))]});return n?t.jsx("div",{ref:n,children:h}):t.jsx("div",{children:h})}),Z=({options:e,visible:d,onClose:n,title:l,showReactions:o,countPerPage:f})=>{const{results:u,loading:g,hasNextPage:p,error:a,setState:b}=$(e,f),s=r.useRef(),h=r.useCallback(c=>{g||(s.current&&s.current.disconnect(),s.current=new IntersectionObserver(i=>{i[0].isIntersecting&&p&&u.length>0&&b(j=>({page:j.page+1}))}),c&&s.current.observe(c))},[g,p,u]);return t.jsxs(N,{show:d,onHide:n,className:"d-flex justify-content-center align-items-center",style:{zIndex:1070},backdropClassName:"wb-reactions-modal__backdrop",fullscreen:"sm-down",contentClassName:"wb-modal__container follows",children:[t.jsx(N.Header,{closeButton:!0,children:t.jsx(N.Title,{children:l})}),t.jsxs(N.Body,{className:"overflow-auto",children:[a?t.jsx("p",{className:"text-danger",children:a}):u.map((c,i)=>t.jsx("div",{className:"mb-2",children:t.jsx(K,{ref:i===u.length-1?h:void 0,item:c,showReactions:o})},i)),g&&t.jsx(M,{})]})]})};export{G as P,Z as R,q as a,X as p,J as r};
