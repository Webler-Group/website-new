import{j as e,i as J,g as Z,r as u,u as re,h as se,d as oe,L as te}from"./index-b2f3d98e.js";import{t as ie,u as ae,e as le,v as X,w as Y}from"./index.esm-4a619d62.js";import{M as I}from"./Modal-d6b02714.js";import{B as j}from"./Button-a8db19a8.js";import{A as de}from"./Alert-f0171b20.js";import{a as H,b as R,c as ee,F as ne,d as ce}from"./Form-4647d33b.js";import{F as U}from"./FormControl-a036e454.js";import{L as ue}from"./LessonNode-b285ef1b.js";import{B as me,T as xe}from"./ToggleButton-0c78b2c4.js";import{t as W}from"./StringUtils-91be14c5.js";import{N as he}from"./NotificationToast-79b767d9.js";import"./iconBase-7a454df3.js";import"./ThemeProvider-c318c21f.js";import"./useMergedRefs-f5c2a768.js";import"./useWindow-763af26a.js";import"./Anchor-1fe32030.js";import"./AbstractModalHeader-f9d4f376.js";import"./CloseButton-439f23fc.js";import"./index-11ee592c.js";import"./DataKey-e12315fd.js";import"./createWithBsPrefix-c6deafcc.js";import"./divWithClassName-9b80bbe4.js";import"./Col-1c3a04d0.js";import"./MarkdownRenderer-0f98c67a.js";import"./index.esm-cb18ecd9.js";const fe=({lesson:c,courseId:z,onEdit:x,onDelete:C,onChangeIndex:T,isFirst:h,isLast:i})=>{const E=()=>{x(c.id,c.title)},f=()=>{C(c.id)},_=()=>{h||T(c.id,c.index-1)},v=()=>{i||T(c.id,c.index+1)};return e.jsxs("div",{className:"border p-2 bg-white d-flex justify-content-between gap-3 align-items-center",children:[e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("span",{className:`wb-user-comment__options__item ${h?"text-muted":""}`,onClick:_,style:{cursor:h?"not-allowed":"pointer"},children:e.jsx(ie,{})}),e.jsx("span",{className:`wb-user-comment__options__item ${i?"text-muted":""}`,onClick:v,style:{cursor:i?"not-allowed":"pointer"},children:e.jsx(ae,{})}),e.jsxs("div",{children:[e.jsxs("b",{className:"me-1",children:[c.index,"."]}),e.jsx(J,{to:"/Courses/Editor/"+z+"/Lesson/"+c.id,children:c.title})]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("span",{className:"wb-user-comment__options__item",onClick:E,children:e.jsx(le,{})}),e.jsx("span",{className:"wb-user-comment__options__item",onClick:f,children:e.jsx(X,{})})]})]})},je=({nodeId:c,nodeCount:z,onDelete:x,onChangeIndex:C,onPreview:T})=>{const{sendJsonRequest:h}=Z(),[i,E]=u.useState(null),[f,_]=u.useState(""),[v,P]=u.useState(0),[w,p]=u.useState([]),[q,V]=u.useState(""),[O,G]=u.useState(!1),[N,k]=u.useState(["",""]),[D,n]=u.useState(!1);u.useEffect(()=>{d(),k(["",""])},[c]),u.useEffect(()=>{v==2&&p(s=>{const t=[...s];let o=!1;for(let a=0;a<t.length;++a)t[a].correct&&(o?t[a].correct=!1:o=!0);return!o&&t.length>0&&(t[0].correct=!0),t})},[v]);const d=async()=>{n(!0);const s=await h("/CourseEditor/GetLessonNode","POST",{nodeId:c});s&&s.lessonNode&&(E(s.lessonNode),P(s.lessonNode.type),_(s.lessonNode.text??""),V(s.lessonNode.correctAnswer??""),p(s.lessonNode.answers)),n(!1)},y=async()=>{if(!i)return;n(!0);const s=await h("/CourseEditor/DeleteLessonNode","DELETE",{nodeId:i.id});s&&s.success&&(M(),x(c)),n(!1)},b=()=>i&&(v!=i.type||f.trim()!=i.text||q!=i.correctAnswer||w.length!=i.answers.length||!i.answers.every(s=>{const t=w.find(o=>o.id==s.id);return t&&t.text==s.text&&t.correct==s.correct})),S=s=>{if(v==2||v==3){if(w.length<2)return s&&k(["danger","Question cannot have less than 2 answers"]),!1;if(w.length>4)return s&&k(["danger","Question cannot have more than 4 answers"]),!1}else if(v==4&&q.length==0)return s&&k(["danger","Correct answer cannot be empty"]),!1;return!0},L=async s=>{if(!i||!S(s))return!1;const t=await h("/CourseEditor/EditLessonNode","PUT",{nodeId:i.id,type:v,text:f,correctAnswer:q,answers:w});return t&&t.success?(E(o=>o?{...o,type:t.data.type,text:t.data.text,correctAnswer:t.data.correctAnswer,answers:t.data.answers}:null),p(t.data.answers),s&&k(["success","Lessson node was saved successfully."]),!0):(s&&k(["danger",t==null?void 0:t.error[0].message]),!1)},K=async s=>{s.preventDefault(),n(!0),await L(!0),n(!1)},M=()=>{G(!1)},$=(s,t)=>{p(o=>{const a=[...o];return a[s].text=t,a})},r=(s,t,o)=>{p(a=>{const F=[...a];if(o&&t)for(let Q=0;Q<F.length;++Q)a[Q].correct=Q==s;else F[s].correct=t;return F})},l=s=>{p(t=>t.filter((o,a)=>s!=a))},g=s=>{p(t=>[...t,{text:"",correct:t.length==0&&s}])},A=async s=>{if(!i)return;if(n(!0),b()?await L(!0):S(!0)){const o=await h("/CourseEditor/ChangeLessonNodeIndex","POST",{nodeId:i.id,newIndex:s});o&&o.success?(E(a=>a?{...a,index:o.data.index}:null),C(i.id,s),k(["success","Node index changed successfully."])):k(["danger",o==null?void 0:o.error[0].message])}n(!1)},m=async()=>{n(!0);const s=b()?await L(!0):S(!0);n(!1),s&&T(c)},B=()=>{const s=[{name:"Text block",value:1},{name:"Singlechoice question",value:2},{name:"Multichoice question",value:3},{name:"Text question",value:4}];let t=e.jsx(e.Fragment,{});switch(v){case 2:t=e.jsxs(H,{children:[e.jsx(R,{children:"Answers"}),w.map((o,a)=>e.jsxs("div",{className:"d-flex gap-3 align-items-center mb-2",children:[e.jsx(U,{value:o.text,onChange:F=>$(a,F.target.value),placeholder:`Answer ${a+1}`,required:!0}),e.jsx(ee,{name:"answer-correct",type:"radio",label:"Correct",id:"answer-correct-input-"+a,checked:o.correct,onChange:F=>r(a,F.target.checked,!0)}),e.jsx("span",{className:"wb-user-comment__options__item",onClick:()=>l(a),children:e.jsx(X,{})})]},a)),e.jsx("div",{children:e.jsxs(j,{size:"sm",className:"mt-2",onClick:()=>g(!0),disabled:w.length>=4,children:[e.jsx(Y,{className:"me-1"})," Add answer"]})})]});break;case 3:t=e.jsxs(H,{children:[e.jsx(R,{children:"Answers"}),w.map((o,a)=>e.jsxs("div",{className:"d-flex gap-3 align-items-center mb-2",children:[e.jsx(U,{value:o.text,onChange:F=>$(a,F.target.value),placeholder:`Answer ${a+1}`,required:!0,maxLength:120}),e.jsx(ee,{name:"answer-correct",type:"checkbox",label:"Correct",id:"answer-correct-input-"+a,checked:o.correct,onChange:F=>r(a,F.target.checked,!1)}),e.jsx("span",{className:"wb-user-comment__options__item",onClick:()=>l(a),children:e.jsx(X,{})})]},a)),e.jsx("div",{children:e.jsxs(j,{size:"sm",className:"mt-2",onClick:()=>g(!1),disabled:w.length>=4,children:[e.jsx(Y,{className:"me-1"})," Add answer"]})})]});break;case 4:t=e.jsxs(H,{children:[e.jsx(R,{children:"Correct answer"}),e.jsx(U,{value:q,onChange:o=>V(o.target.value),required:!0,maxLength:60})]});break}return i!==null&&e.jsx("div",{className:"mt-2",children:e.jsxs(ne,{onSubmit:K,children:[e.jsxs(H,{children:[e.jsx(R,{children:"Type"}),e.jsx(ce,{value:v,onChange:o=>P(Number(o.target.value)),required:!0,children:s.map(o=>e.jsx("option",{value:o.value,children:o.name},o.value))})]}),e.jsxs(H,{children:[e.jsx(R,{children:"Text"}),e.jsx(U,{value:f,onChange:o=>_(o.target.value),as:"textarea",rows:10,maxLength:2e3,required:!0})]}),t,e.jsxs("div",{className:"d-sm-flex justify-content-between mt-4",children:[e.jsxs("div",{className:"d-flex gap-2 justify-content-end",children:[e.jsx(j,{size:"sm",disabled:D||i.index<=1,onClick:()=>A(i.index-1),children:"Move left"}),e.jsx(j,{size:"sm",disabled:D||i.index>=z,onClick:()=>A(i.index+1),children:"Move right"}),e.jsx(j,{size:"sm",disabled:D,onClick:m,children:"Preview"})]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-end mt-2 mt-sm-0",children:[e.jsx(j,{size:"sm",disabled:D,variant:"secondary",type:"button",onClick:()=>G(!0),children:"Delete"}),e.jsx(j,{size:"sm",disabled:D,type:"submit",children:"Save"})]})]})]})})};return i!==null&&e.jsxs(e.Fragment,{children:[e.jsxs(I,{show:O,onHide:M,centered:!0,children:[e.jsx(I.Header,{closeButton:!0,children:e.jsx(I.Title,{children:"Are you sure?"})}),e.jsx(I.Body,{children:"Lesson node will be permanently deleted."}),e.jsxs(I.Footer,{children:[e.jsx(j,{variant:"secondary",onClick:M,children:"Cancel"}),e.jsx(j,{variant:"danger",onClick:y,children:"Delete"})]})]}),N[1]&&e.jsx(de,{variant:N[0],onClose:()=>k(["",""]),dismissible:!0,children:N[1]}),B()]})},pe=({lessonId:c})=>{const{sendJsonRequest:z}=Z(),[x,C]=u.useState(null),[T,h]=u.useState(null),[i,E]=re(),[f,_]=u.useState(!1),[v,P]=u.useState(!1),{courseId:w}=se(),p=oe();u.useEffect(()=>{q()},[c]),u.useEffect(()=>{if(x&&i.has("slide")){const n=x.nodes.find(d=>d.index==Number(i.get("slide")));n&&h(n.id)}},[x==null?void 0:x.id]);const q=async()=>{P(!0);const n=await z("/CourseEditor/GetLesson","POST",{lessonId:c});n&&n.lesson&&C(n.lesson),P(!1)},V=async()=>{const n=await z("/CourseEditor/CreateLessonNode","POST",{lessonId:c});n&&n.lessonNode&&(C(d=>d?{...d,nodeCount:d.nodeCount+1,nodes:[...d.nodes,{id:n.lessonNode.id,index:n.lessonNode.index,type:n.lessonNode.type,unlocked:!0}]}:null),h(n.lessonNode.id))},O=n=>{h(null),C(d=>{if(!d)return null;let y=[],b=!1;for(let S=0;S<d.nodes.length;++S){const L=d.nodes[S];if(L.id===n){b=!0;continue}b&&--L.index,y.push(L)}return{...d,nodeCount:y.length,nodes:y}})},G=(n,d)=>{C(y=>{if(!y)return null;let b=[...y.nodes];const S=b.find(L=>L.id==n);if(S){const L=S.index;b[d-1].index=L,b[L-1].index=d,b[L-1]=b[d-1],b[d-1]=S,i.set("slide",d.toString()),E(i,{replace:!0})}return{...y,nodes:b}})},N=n=>{if(!x)return;_(!1),h(n);const d=x.nodes.find(y=>y.id==n);d&&(i.set("slide",d.index.toString()),E(i,{replace:!0}))},k=()=>{_(!0)},D=()=>{_(!1)};return x!==null?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-2",children:[e.jsx("h4",{children:x.title}),e.jsxs("div",{className:"d-flex justify-content-between my-3",children:[e.jsx(me,{size:"sm",children:x.nodes.map((n,d)=>e.jsx(xe,{id:`current-lesson-input-${n.index}`,type:"radio",variant:"outline-primary",name:"current-lesson",value:n.id,checked:T===n.id,onChange:y=>N(y.currentTarget.value),size:"sm",children:n.index},d))}),e.jsx(j,{size:"sm",onClick:V,children:e.jsx(Y,{})})]}),T!==null&&(f?e.jsxs("div",{className:"d-flex flex-column",style:{minHeight:"368px"},children:[e.jsx("div",{className:"flex-grow-1 border border-2",children:e.jsx(ue,{nodeId:T,mock:!0,onAnswered:()=>{},onContinue:()=>{},onEnter:()=>{}})}),e.jsx("div",{className:"d-flex justify-content-end mt-2",children:e.jsx(j,{variant:"secondary",size:"sm",onClick:D,children:"Exit Preview"})})]}):e.jsx(je,{nodeId:T,nodeCount:x.nodeCount,onChangeIndex:G,onDelete:O,onPreview:k}))]})}):e.jsx("div",{className:"my-5 text-center",children:v?e.jsx(te,{}):e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:"Lesson could not be loaded"}),e.jsx(j,{size:"sm",onClick:()=>p("/Courses/Editor/"+w),children:"Back to course"})]})})},He=({})=>{const{sendJsonRequest:c}=Z(),{courseId:z,lessonId:x}=se(),[C,T]=u.useState(null),[h,i]=u.useState([]),[E,f]=u.useState(!1),[_,v]=u.useState(!1),[P,w]=u.useState(""),[p,q]=u.useState(null),[V,O]=u.useState(!1),[G,N]=u.useState(null);u.useEffect(()=>{k(!0)},[z]);const k=async r=>{f(!0);const l=await c("/CourseEditor/GetCourse","POST",{courseId:z,includeLessons:r});l&&l.course&&(T(l.course),i(l.course.lessons)),f(!1)},D=(r,l)=>{w(r),v(!0),q(l)},n=()=>{v(!1),w("")},d=async()=>{f(!0);const r=await c("/CourseEditor/CreateLesson","POST",{courseId:C.id,title:P});r&&r.lesson?(i(l=>[...l,{...r.lesson}]),n(),N({type:"success",message:"Lesson created successfully"})):N({type:"error",message:r==null?void 0:r.error[0].message}),f(!1)},y=async()=>{f(!0);const r=h.find(g=>g.id===p);if(!r)return;const l=await c("/CourseEditor/EditLesson","PUT",{lessonId:p,title:P,index:r.index});l&&l.success?(i(g=>{let A=[...g];for(let m=0;m<A.length;++m)A[m].id===p&&(A[m].title=l.data.title);return A}),n(),N({type:"success",message:"Lesson edited successfully"})):N({type:"error",message:l==null?void 0:l.error[0].message}),f(!1)},b=async()=>{f(!0);const r=await c("/CourseEditor/DeleteLesson","DELETE",{lessonId:p});r&&r.success?(M(),i(l=>{let g=[],A=!1;for(let m=0;m<l.length;++m){const B=l[m];if(B.id===p){A=!0;continue}A&&--B.index,g.push(B)}return g}),N({type:"success",message:"Lesson deleted successfully"})):N({type:"error",message:r==null?void 0:r.error[0].message}),f(!1)},S=async(r,l)=>{f(!0);const g=await c("/CourseEditor/ChangeLessonIndex","POST",{lessonId:r,newIndex:l});g&&g.success?(i(A=>{const m=[...A],B=m.findIndex(t=>t.id===r);if(B===-1)return m;const s=m.findIndex(t=>t.index===l);return s===-1||([m[B].index,m[s].index]=[m[s].index,m[B].index],m.sort((t,o)=>t.index-o.index)),m}),N({type:"success",message:"Lesson index changed successfully"})):N({type:"error",message:g==null?void 0:g.error[0].message}),f(!1)},L=(r,l)=>{D(l,r)},K=r=>{q(r),O(!0)},M=()=>{O(!1)},$=()=>{const r=h.find(g=>g.id===x);if(!r)return e.jsx(e.Fragment,{});const l=W(r.title,20);return e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"›"}),e.jsx("span",{children:l})]})};return C!==null?e.jsxs(e.Fragment,{children:[e.jsx(he,{notification:G,onClose:()=>N(null)}),e.jsxs(I,{show:V,onHide:M,centered:!0,children:[e.jsx(I.Header,{closeButton:!0,children:e.jsx(I.Title,{children:"Are you sure?"})}),e.jsx(I.Body,{children:"Lesson will be permanently deleted."}),e.jsxs(I.Footer,{children:[e.jsx(j,{variant:"secondary",onClick:M,children:"Cancel"}),e.jsx(j,{variant:"danger",onClick:b,children:"Delete"})]})]}),e.jsxs("div",{className:"d-flex gap-2 py-2",children:[e.jsx(J,{to:"/Courses/Editor",children:"Course Editor"}),e.jsx("span",{children:"›"}),x!==null?e.jsxs(e.Fragment,{children:[e.jsx(J,{to:"/Courses/Editor/"+C.id,children:W(C.title,20)}),$()]}):e.jsx("span",{children:W(C.title,20)})]}),e.jsx("div",{className:"mb-3",children:e.jsx("h3",{className:"wb-courses-course__title",style:{wordBreak:"break-word"},children:C.title})}),e.jsx("div",{hidden:!_,className:"mb-2 border bg-white rounded p-2",children:e.jsxs(ne,{children:[e.jsx("h4",{children:p===null?"New lesson":"Edit lesson"}),e.jsxs(H,{children:[e.jsx(R,{children:"Title"}),e.jsx(U,{type:"text",placeholder:"Enter lesson title",maxLength:60,value:P,onChange:r=>w(r.target.value)})]}),e.jsxs("div",{className:"d-flex justify-content-end mt-2",children:[e.jsx(j,{size:"sm",variant:"secondary",disabled:E,onClick:()=>n(),children:"Cancel"}),p===null?e.jsx(j,{size:"sm",variant:"primary",className:"ms-2",onClick:d,disabled:E||P.length===0,children:"Create"}):e.jsx(j,{size:"sm",variant:"primary",className:"ms-2",onClick:y,disabled:E,children:"Save"})]})]})}),x?e.jsx(pe,{lessonId:x}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(j,{className:"ms-2 btn btn-primary btn-sm",onClick:()=>D("",null),children:"Create Lesson"})}),e.jsx("div",{className:"mt-3",children:h.map(r=>e.jsx("div",{className:"mt-2",children:e.jsx(fe,{lesson:r,courseId:C.id,onDelete:K,onEdit:L,onChangeIndex:S,isFirst:r.index===1,isLast:r.index===h.length})},r.index))})]})]}):e.jsx("div",{className:"my-5 text-center",children:E?e.jsx(te,{}):e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:"Course could not be loaded"}),e.jsx(J,{to:"/Courses/Editor",children:"Back"})]})})};export{He as default};
